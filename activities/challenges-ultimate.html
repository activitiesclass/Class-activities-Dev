<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>üèÜ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ© | ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿπŸÑŸÖ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä ÿßŸÑŸÖÿ™ŸÇÿØŸÖ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/responsive.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --dark-gradient: linear-gradient(135deg, #232526 0%, #414345 100%);
      
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-light: #a0aec0;
      --bg-primary: #f7fafc;
      --bg-secondary: #edf2f7;
      --border-radius: 20px;
      --shadow-light: 0 10px 25px rgba(0,0,0,0.1);
      --shadow-heavy: 0 20px 40px rgba(0,0,0,0.15);
      
      --arabic-font: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--arabic-font);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
      padding-top: 80px; /* ŸÖÿ≥ÿßÿ≠ÿ© ŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ */
    }

    /* ===== PARTICLES BACKGROUND ===== */
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
    }

    /* ==== ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπŸÑŸàŸäÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ==== */
    .cosmic-control-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 2px solid rgba(255, 215, 0, 0.5);
      padding: 1rem 2rem;
      z-index: 99999;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.7);
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
    }

    .control-buttons-container {
      display: flex !important;
      justify-content: space-between;
      align-items: center;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
      height: 60px;
    }

    .app-title-cosmic {
      display: flex !important;
      align-items: center;
      gap: 1rem;
      color: white;
      visibility: visible !important;
    }

    .title-icon {
      font-size: 2rem;
      animation: cosmic-glow 2s ease-in-out infinite alternate;
    }

    .title-text {
      font-size: 1.5rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #00ffff, #ff69b4);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% 200%;
      animation: cosmic-text 3s ease-in-out infinite;
    }

    .version-badge {
      background: linear-gradient(45deg, #ff6b35, #f7931e);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(255, 107, 53, 0.4);
    }

    .control-group-cosmic {
      display: flex !important;
      gap: 0.8rem;
      align-items: center;
      visibility: visible !important;
    }

    .cosmic-control-btn {
      position: relative;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 215, 0, 0.5);
      color: white;
      padding: 0.8rem;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.2rem;
      min-width: 4rem;
      height: 4rem;
      display: flex !important;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      visibility: visible !important;
      opacity: 1 !important;
      z-index: 99999;
      gap: 0.2rem;
      overflow: hidden;
    }

    .cosmic-control-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .cosmic-control-btn:hover::before {
      left: 100%;
    }

    .cosmic-control-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      border-color: #ffd700;
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    .cosmic-control-btn:active {
      transform: translateY(-1px) scale(1.02);
    }

    .btn-icon {
      font-size: 1.4rem;
      transition: transform 0.3s ease;
    }

    .cosmic-control-btn:hover .btn-icon {
      transform: scale(1.2);
    }

    .btn-tooltip {
      font-size: 0.7rem;
      font-weight: 600;
      opacity: 0.8;
    }

    @keyframes cosmic-glow {
      0% { text-shadow: 0 0 5px #ffd700, 0 0 10px #ffd700; }
      100% { text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700, 0 0 30px #ffd700; }
    }

    @keyframes cosmic-text {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ÿ™ÿ≠ÿØŸäÿ´ padding ŸÑŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä */
    .main-header {
      margin-top: 6rem !important;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿ®ÿßÿπÿØ ÿßŸÑÿπÿßŸÖ ŸÑŸÑÿµŸÅÿ≠ÿ© */
    .container {
      padding: 2rem 1rem 3rem 1rem;
      margin: 0 auto;
      max-width: 1200px;
      box-sizing: border-box;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿ®ÿßÿπÿØ ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ */
    .section {
      margin-bottom: 3rem;
      padding: 0 0.5rem;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ footer spacing */
    .main-content {
      padding-bottom: 4rem;
      min-height: calc(100vh - 8rem);
    }

    /* ==== ŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸàÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ==== */
    .settings-modal, .stats-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      z-index: 20000;
      backdrop-filter: blur(15px);
      align-items: center;
      justify-content: center;
      animation: modalFadeIn 0.3s ease;
    }

    @keyframes modalFadeIn {
      0% { opacity: 0; backdrop-filter: blur(0px); }
      100% { opacity: 1; backdrop-filter: blur(15px); }
    }

    .settings-modal.active, .stats-modal.active {
      display: flex;
    }

    .settings-content {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      border: 3px solid #ffd700;
      border-radius: 25px;
      padding: 2.5rem;
      max-width: 900px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 
        0 25px 60px rgba(0, 0, 0, 0.8),
        0 0 40px rgba(255, 215, 0, 0.3),
        inset 0 0 30px rgba(255, 215, 0, 0.1);
      animation: modalSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .stats-content {
      background: linear-gradient(135deg, #0f3460 0%, #16537e 50%, #1a1a2e 100%);
      border: 3px solid #00ffff;
      border-radius: 25px;
      padding: 2.5rem;
      max-width: 1000px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 
        0 25px 60px rgba(0, 255, 255, 0.4),
        0 0 40px rgba(0, 255, 255, 0.3),
        inset 0 0 30px rgba(0, 255, 255, 0.1);
      animation: modalSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes modalSlideIn {
      0% { 
        transform: scale(0.8) translateY(-50px);
        opacity: 0;
      }
      100% { 
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid rgba(255, 215, 0, 0.3);
      position: relative;
    }

    .settings-header::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #ffd700, transparent);
      animation: headerGlow 2s ease-in-out infinite;
    }

    @keyframes headerGlow {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .settings-title-container {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .settings-icon-main {
      font-size: 3.5rem;
      background: linear-gradient(135deg, #ffd700, #ff6b35, #ffd700);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: iconRotate 4s ease-in-out infinite;
      filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
    }

    @keyframes iconRotate {
      0%, 100% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(10deg) scale(1.1); }
      50% { transform: rotate(0deg) scale(1); }
      75% { transform: rotate(-10deg) scale(1.1); }
    }

    .settings-title {
      margin: 0;
      font-size: 2.2rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      animation: titleShimmer 3s ease-in-out infinite;
    }

    @keyframes titleShimmer {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }

    .settings-subtitle {
      margin: 0.5rem 0 0 0;
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
    }

    .close-settings {
      background: linear-gradient(135deg, #ff4757, #ff3838, #ff4757);
      border: none;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.4rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 
        0 6px 20px rgba(255, 71, 87, 0.4),
        inset 0 0 10px rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .close-settings::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }

    .close-settings:hover::before {
      left: 100%;
    }

    .close-settings:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 
        0 8px 25px rgba(255, 71, 87, 0.6),
        inset 0 0 15px rgba(255, 255, 255, 0.3);
    }

    .close-settings:active {
      transform: scale(0.95) rotate(90deg);
    }

    .setting-section {
      margin-bottom: 2.5rem;
      padding: 2rem;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.3),
        inset 0 0 20px rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .setting-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.8s ease;
    }

    .setting-section:hover::before {
      left: 100%;
    }

    .setting-section:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 12px 35px rgba(0, 0, 0, 0.4),
        inset 0 0 25px rgba(255, 255, 255, 0.08);
    }

    .setting-item {
      margin-bottom: 1.5rem;
      color: white;
    }

    .setting-item label {
      display: block;
      margin-bottom: 0.8rem;
      font-weight: 700;
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
    }

    /* ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© */
    .settings-tabs-container {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      border-bottom: 3px solid rgba(255, 215, 0, 0.2);
      position: relative;
      overflow-x: auto;
      padding-bottom: 0;
    }

    .settings-tab-btn {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: rgba(255, 255, 255, 0.8);
      padding: 1rem 1.8rem;
      border-radius: 15px 15px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
      font-weight: 700;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      min-width: 150px;
      text-align: center;
    }

    .settings-tab-btn::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .settings-tab-btn:hover {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
      color: #ffd700;
      border-color: rgba(255, 215, 0, 0.6);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
    }

    .settings-tab-btn:hover::before {
      transform: scaleX(1);
    }

    .settings-tab-btn.active {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.2));
      color: #ffd700;
      border-color: #ffd700;
      border-bottom-color: transparent;
      transform: translateY(-3px);
      box-shadow: 
        0 8px 20px rgba(255, 215, 0, 0.4),
        inset 0 0 15px rgba(255, 215, 0, 0.1);
    }

    .settings-tab-btn.active::before {
      transform: scaleX(1);
    }

    .settings-tab-content {
      display: none;
      animation: contentFadeIn 0.4s ease;
    }

    .settings-tab-content.active {
      display: block;
    }

    @keyframes contentFadeIn {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .setting-select {
      width: 100%;
      padding: 1rem;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      color: white;
      font-size: 1rem;
      margin-top: 0.8rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .setting-select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 
        0 0 0 3px rgba(255, 215, 0, 0.3),
        0 5px 15px rgba(255, 215, 0, 0.2);
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
    }

    .setting-select option {
      background: #1a1a2e;
      color: white;
      padding: 0.5rem;
    }

    /* ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© */
    .settings-action-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 2px solid rgba(255, 215, 0, 0.3);
      flex-wrap: wrap;
    }

    .settings-action-btn {
      flex: 1;
      min-width: 150px;
      padding: 1.2rem 2rem;
      border: none;
      border-radius: 15px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .settings-action-btn.primary {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
    }

    .settings-action-btn.secondary {
      background: linear-gradient(135deg, #6c757d, #495057);
      color: white;
      box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    }

    .settings-action-btn.success {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: white;
      box-shadow: 0 6px 20px rgba(67, 233, 123, 0.4);
    }

    .settings-action-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }

    .settings-action-btn:hover::before {
      left: 100%;
    }

    .settings-action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .settings-action-btn:active {
      transform: translateY(-1px);
    }

    /* ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© */
    .achievements-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, 
        rgba(0, 0, 0, 0.8), 
        rgba(26, 26, 46, 0.9),
        rgba(52, 58, 64, 0.8)
      );
      backdrop-filter: blur(15px);
      z-index: 10000;
      animation: modalFadeIn 0.5s ease;
    }

    .achievements-modal.show {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .achievements-modal-content {
      background: linear-gradient(135deg, 
        rgba(26, 26, 46, 0.95), 
        rgba(16, 21, 35, 0.95),
        rgba(52, 58, 64, 0.95)
      );
      border-radius: 25px;
      padding: 3rem 2.5rem;
      width: 95%;
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      border: 2px solid rgba(255, 215, 0, 0.4);
      box-shadow: 
        0 25px 60px rgba(0, 0, 0, 0.5),
        inset 0 0 30px rgba(255, 215, 0, 0.1),
        0 0 100px rgba(255, 215, 0, 0.2);
      animation: modalSlideIn 0.6s ease-out;
      position: relative;
      overflow: hidden;
    }

    .achievements-modal-content::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, 
        rgba(255, 215, 0, 0.05) 0%, 
        transparent 70%);
      animation: backgroundPulse 4s ease-in-out infinite;
      pointer-events: none;
    }

    .achievements-header {
      text-align: center;
      margin-bottom: 2.5rem;
      position: relative;
    }

    .achievements-header h2 {
      font-size: 2.8rem;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
      text-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
      animation: titleShimmer 2s ease-in-out infinite;
      position: relative;
    }

    .achievements-header h2::after {
      content: 'üèÜ';
      position: absolute;
      top: -10px;
      right: -50px;
      font-size: 2rem;
      animation: iconRotate 3s ease-in-out infinite;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .achievement-card {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.1), 
        rgba(255, 255, 255, 0.05)
      );
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid rgba(255, 215, 0, 0.3);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .achievement-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 215, 0, 0.1), 
        transparent
      );
      transition: left 0.8s ease;
    }

    .achievement-card:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: #ffd700;
      box-shadow: 
        0 15px 40px rgba(255, 215, 0, 0.3),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    }

    .achievement-card:hover::before {
      left: 100%;
    }

    .achievement-card.unlocked {
      background: linear-gradient(135deg, 
        rgba(67, 233, 123, 0.2), 
        rgba(56, 249, 215, 0.15)
      );
      border-color: #43e97b;
      box-shadow: 0 10px 30px rgba(67, 233, 123, 0.2);
    }

    .achievement-icon {
      font-size: 3.5rem;
      text-align: center;
      margin-bottom: 1rem;
      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
    }

    .achievement-card.unlocked .achievement-icon {
      animation: achievementGlow 2s ease-in-out infinite;
    }

    .achievement-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #ffd700;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .achievement-description {
      color: rgba(255, 255, 255, 0.8);
      text-align: center;
      line-height: 1.5;
      font-size: 1rem;
    }

    .achievement-status {
      text-align: center;
      margin-top: 1rem;
      padding: 0.8rem;
      border-radius: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .achievement-status.unlocked {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: white;
      box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);
    }

    .achievement-status.locked {
      background: linear-gradient(135deg, #6c757d, #495057);
      color: rgba(255, 255, 255, 0.7);
    }

    .achievements-close {
      position: absolute;
      top: 20px;
      right: 25px;
      background: linear-gradient(135deg, #ff4757, #ff3742);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
    }

    .achievements-close:hover {
      transform: rotate(90deg) scale(1.1);
      box-shadow: 0 8px 25px rgba(255, 71, 87, 0.6);
      background: linear-gradient(135deg, #ff3742, #ff1744);
    }

    @keyframes achievementGlow {
      0%, 100% { filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3)); }
      50% { filter: drop-shadow(0 5px 15px rgba(67, 233, 123, 0.6)); }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.1), 
        rgba(255, 255, 255, 0.05)
      );
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid rgba(255, 215, 0, 0.3);
      text-align: center;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 215, 0, 0.1), 
        transparent
      );
      transition: left 0.8s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      border-color: #ffd700;
      box-shadow: 0 12px 30px rgba(255, 215, 0, 0.3);
    }

    .stat-card:hover::before {
      left: 100%;
    }

    .stat-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 900;
      color: #ffd700;
      margin-bottom: 0.5rem;
      text-shadow: 0 3px 6px rgba(255, 215, 0, 0.3);
    }

    .stat-label {
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.1rem;
      font-weight: 600;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿπÿßŸÖ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸàÿßŸÅÿ∞ */
    .modal-overlay, .quantum-overlay {
      backdrop-filter: blur(20px) saturate(1.2);
      background: linear-gradient(135deg, 
        rgba(0, 0, 0, 0.8), 
        rgba(26, 26, 46, 0.9),
        rgba(52, 58, 64, 0.8)
      );
    }

    .quantum-notification, .coaching-panel {
      border: 2px solid rgba(255, 215, 0, 0.4);
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.5),
        inset 0 0 20px rgba(255, 215, 0, 0.1),
        0 0 80px rgba(255, 215, 0, 0.2);
      backdrop-filter: blur(15px);
    }

    .quantum-notification::before, .coaching-panel::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, 
        rgba(255, 215, 0, 0.03) 0%, 
        transparent 70%);
      animation: backgroundPulse 4s ease-in-out infinite;
      pointer-events: none;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ */
    .close-btn, .modal-close {
      background: linear-gradient(135deg, #ff4757, #ff3742) !important;
      border: none !important;
      border-radius: 50% !important;
      width: 45px !important;
      height: 45px !important;
      color: white !important;
      font-size: 1.3rem !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4) !important;
      position: absolute !important;
      top: 15px !important;
      right: 20px !important;
      z-index: 1000 !important;
    }

    .close-btn:hover, .modal-close:hover {
      transform: rotate(90deg) scale(1.1) !important;
      box-shadow: 0 8px 25px rgba(255, 71, 87, 0.6) !important;
      background: linear-gradient(135deg, #ff3742, #ff1744) !important;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ© */
    select, .custom-select {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) !important;
      border: 2px solid rgba(255, 215, 0, 0.3) !important;
      border-radius: 12px !important;
      color: white !important;
      padding: 1rem !important;
      transition: all 0.3s ease !important;
      backdrop-filter: blur(10px) !important;
    }

    select:focus, .custom-select:focus {
      outline: none !important;
      border-color: #ffd700 !important;
      box-shadow: 
        0 0 0 3px rgba(255, 215, 0, 0.3) !important,
        0 5px 15px rgba(255, 215, 0, 0.2) !important;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05)) !important;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™ ÿßŸÑŸÜÿµŸäÿ© */
    input[type="text"], input[type="number"], textarea {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) !important;
      border: 2px solid rgba(255, 215, 0, 0.3) !important;
      border-radius: 12px !important;
      color: white !important;
      padding: 1rem !important;
      transition: all 0.3s ease !important;
      backdrop-filter: blur(10px) !important;
    }

    input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
      outline: none !important;
      border-color: #ffd700 !important;
      box-shadow: 
        0 0 0 3px rgba(255, 215, 0, 0.3) !important,
        0 5px 15px rgba(255, 215, 0, 0.2) !important;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05)) !important;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ */
    .notification, .alert {
      border-radius: 20px !important;
      backdrop-filter: blur(15px) !important;
      border: 2px solid rgba(255, 215, 0, 0.4) !important;
      box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.4) !important,
        inset 0 0 20px rgba(255, 215, 0, 0.1) !important;
      animation: notificationSlide 0.5s ease-out !important;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿßŸÑŸÖÿ±ŸÜÿ© */
    .leaderboard-modal {
      backdrop-filter: blur(20px) saturate(1.2) !important;
    }

    .leaderboard-content {
      position: relative;
      overflow: hidden;
    }

    .leaderboard-list {
      scrollbar-width: thin;
      scrollbar-color: #ffd700 rgba(255,255,255,0.1);
    }

    .competitor-item {
      animation: competitorSlideIn 0.5s ease-out;
      animation-fill-mode: both;
    }

    .competitor-item:nth-child(1) { animation-delay: 0.1s; }
    .competitor-item:nth-child(2) { animation-delay: 0.2s; }
    .competitor-item:nth-child(3) { animation-delay: 0.3s; }
    .competitor-item:nth-child(4) { animation-delay: 0.4s; }
    .competitor-item:nth-child(5) { animation-delay: 0.5s; }

    @keyframes competitorSlideIn {
      0% { 
        opacity: 0; 
        transform: translateX(-50px) scale(0.9); 
      }
      100% { 
        opacity: 1; 
        transform: translateX(0) scale(1); 
      }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑŸÖÿ™ÿµŸÅÿ≠ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© */
    .leaderboard-list::-webkit-scrollbar {
      width: 10px;
    }

    .leaderboard-list::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      margin: 10px 0;
    }

    .leaderboard-list::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      border-radius: 10px;
      border: 2px solid rgba(255,255,255,0.1);
    }

    .leaderboard-list::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #ffed4e, #ffd700);
      border-color: rgba(255,255,255,0.2);
    }

    .leaderboard-list::-webkit-scrollbar-corner {
      background: rgba(255,255,255,0.05);
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© */
    @media (max-width: 768px) {
      .leaderboard-content {
        width: 99% !important;
        height: 99vh !important;
        padding: 1.5rem !important;
        border-radius: 15px !important;
      }
      
      .leaderboard-header h2 {
        font-size: 2rem !important;
      }
      
      .leaderboard-stats {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
      }
      
      .competitor-item {
        padding: 1.5rem !important;
        flex-direction: column !important;
        gap: 1rem !important;
        text-align: center !important;
      }
      
      .competitor-item > div:first-child {
        order: -1 !important;
      }
    }

    @media (max-width: 480px) {
      .leaderboard-content {
        width: 99% !important;
        height: 99vh !important;
        padding: 1rem !important;
        border-radius: 10px !important;
      }
      
      .leaderboard-header {
        flex-direction: column !important;
        gap: 1rem !important;
        text-align: center !important;
      }
      
      .leaderboard-header h2 {
        font-size: 1.5rem !important;
      }
      
      .leaderboard-stats {
        grid-template-columns: 1fr !important;
      }
      
      .competitor-item {
        padding: 1rem !important;
      }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑŸÉÿ®Ÿäÿ±ÿ© */
    @media (min-width: 1920px) {
      .leaderboard-content {
        max-width: none !important;
      }
      
      .competitor-item {
        padding: 2.5rem !important;
        gap: 2rem !important;
      }
      
      .competitor-item div:first-child {
        width: 100px !important;
        height: 100px !important;
        font-size: 2.5rem !important;
      }
      
      .competitor-item div:nth-child(3) > div:first-child {
        font-size: 2.2rem !important;
      }
      
      .competitor-item div:nth-child(3) > div:nth-child(2) {
        font-size: 1.4rem !important;
      }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
    .secondary {
      background: rgba(108, 117, 125, 0.2) !important;
      border-color: #6c757d !important;
    }

    .secondary:hover {
      background: rgba(108, 117, 125, 0.4) !important;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ responsive */
    @media (max-width: 768px) {
      .control-group-cosmic {
        gap: 0.4rem;
      }
      
      .cosmic-control-btn {
        min-width: 3rem;
        height: 3rem;
        padding: 0.5rem;
      }
      
      .btn-tooltip {
        display: none;
      }
      
      .title-text {
        font-size: 1.2rem;
      }
      
      .cosmic-control-header {
        padding: 0.8rem 1rem;
      }
    }

    /* ===== GLASSMORPHISM CONTAINER ===== */
    .glass-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-heavy);
      padding: 2rem;
      margin: 1rem;
    }

    /* ===== MAIN HEADER ===== */
    .main-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    .kingdom-title {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347, #FF1493);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: titleGlow 3s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.5)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
    }

    .subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
      margin-bottom: 2rem;
    }

    /* ===== KINGDOM CONTENT ===== */
    #kingdomContent {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }

    /* ===== INTERACTIVE DASHBOARD ===== */
    .kingdom-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
      padding: 0 1rem;
    }

    .realm-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(15px);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
      min-height: 240px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 100%;
      box-sizing: border-box;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .realm-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.6s;
    }

    .realm-card:hover::before {
      left: 100%;
    }

    .realm-card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑŸÑŸÖÿ≥ ÿπŸÑŸâ ÿßŸÑŸáÿßÿ™ŸÅ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ */
    @media (hover: none) and (pointer: coarse) {
      .realm-card:hover {
        transform: none;
      }
      
      .realm-card:active {
        transform: scale(0.98);
        opacity: 0.8;
      }
    }

    .realm-card:nth-child(1):hover { border-color: #ffd700; box-shadow: 0 25px 50px rgba(255,215,0,0.3); }
    .realm-card:nth-child(2):hover { border-color: #00ffff; box-shadow: 0 25px 50px rgba(0,255,255,0.3); }
    .realm-card:nth-child(3):hover { border-color: #ff6347; box-shadow: 0 25px 50px rgba(255,99,71,0.3); }
    .realm-card:nth-child(4):hover { border-color: #ff69b4; box-shadow: 0 25px 50px rgba(255,105,180,0.3); }
    .realm-card:nth-child(5):hover { border-color: #32cd32; box-shadow: 0 25px 50px rgba(50,205,50,0.3); }
    .realm-card:nth-child(6):hover { border-color: #9370db; box-shadow: 0 25px 50px rgba(147,112,219,0.3); }
    .realm-card:nth-child(7):hover { border-color: #ffa500; box-shadow: 0 25px 50px rgba(255,165,0,0.3); }
    .realm-card:nth-child(8):hover { border-color: #20b2aa; box-shadow: 0 25px 50px rgba(32,178,170,0.3); }
    .realm-card:nth-child(9):hover { border-color: #daa520; box-shadow: 0 25px 50px rgba(218,165,32,0.3); }

    .realm-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .realm-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }

    .realm-description {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.6;
      flex-grow: 1;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }

    .realm-stats {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      color: #ffd700;
      font-weight: 600;
      font-size: 0.85rem;
      border: 1px solid rgba(255,215,0,0.3);
      word-wrap: break-word;
    }

    /* ===== BATTLE ARENA ===== */
    .battle-arena {
      display: none;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 3rem;
      margin: 2rem 0;
      border: 2px solid rgba(255,215,0,0.5);
      position: relative;
      overflow: hidden;
    }

    .battle-arena::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: battleAura 4s linear infinite;
    }

    @keyframes battleAura {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .arena-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 10;
    }

    .challenge-timer {
      font-size: 6rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ff0000, #ff4500, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255,0,0,0.5);
      animation: timerPulse 1s ease-in-out infinite;
    }

    @keyframes timerPulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.3); }
    }

    /* ===== HOLOGRAPHIC TEAMS ===== */
    .teams-hologram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-hologram {
      background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1));
      border: 2px solid rgba(0,255,255,0.3);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }

    .team-hologram::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: holoScan 3s linear infinite;
    }

    @keyframes holoScan {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .team-avatar-3d {
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #ff006e, #ffbe0b, #8338ec, #3a86ff, #06ffa5, #ff006e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: avatarFloat 3s ease-in-out infinite;
      position: relative;
    }

    @keyframes avatarFloat {
      0%, 100% { transform: translateY(0px) rotateY(0deg); }
      50% { transform: translateY(-10px) rotateY(180deg); }
    }

    .team-name-glow {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 20px #00ffff;
      margin-bottom: 1rem;
    }

    .score-crystal {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.8));
      animation: crystalGlow 2s ease-in-out infinite alternate;
    }

    @keyframes crystalGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.8)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,1)); }
    }

    /* ===== NEURAL NETWORK BUTTONS ===== */
    .neural-button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 50px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      margin: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .neural-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s;
    }

    .neural-button:hover::before {
      left: 100%;
    }

    .neural-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .neural-button:active {
      transform: translateY(0);
    }

    /* ===== QUANTUM NOTIFICATIONS ===== */
    .quantum-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      color: white;
      border: 2px solid rgba(0,255,255,0.5);
      box-shadow: 0 10px 30px rgba(0,255,255,0.3);
      z-index: 10000;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 350px;
    }

    .quantum-notification.show {
      transform: translateX(0);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .notification-icon {
      font-size: 1.5rem;
      animation: quantumSpin 2s linear infinite;
    }

    @keyframes quantumSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* ===== COSMIC EFFECTS ===== */
    .cosmic-star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: cosmicFall 4s linear forwards;
    }

    @keyframes cosmicFall {
      0% {
        transform: translateY(-50px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .cosmic-explosion {
      position: fixed;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      animation: cosmicBlast 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes cosmicBlast {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(10);
        opacity: 0;
      }
    }

    /* ===== LIGHTNING KINGDOM SPECIAL EFFECTS ===== */
    @keyframes lightningPulse {
      0%, 100% { 
        background: radial-gradient(circle, rgba(255,255,0,0.1) 0%, transparent 70%);
        transform: scale(1);
      }
      50% { 
        background: radial-gradient(circle, rgba(255,255,0,0.3) 0%, transparent 70%);
        transform: scale(1.05);
      }
    }

    @keyframes electricPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 15px rgba(255,255,0,0.8));
        transform: scale(1);
      }
      50% { 
        filter: drop-shadow(0 0 25px rgba(255,255,0,1)) drop-shadow(0 0 35px rgba(255,165,0,0.8));
        transform: scale(1.05);
      }
    }

    .lightning-competitor-card {
      background: linear-gradient(135deg, rgba(255,255,0,0.2), rgba(255,165,0,0.2));
      border: 2px solid rgba(255,255,0,0.4);
      border-radius: 15px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .lightning-competitor-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,0,0.3), transparent);
      transform: rotate(45deg);
      transition: all 0.6s ease;
      opacity: 0;
    }

    .lightning-competitor-card:hover::before {
      opacity: 1;
      animation: lightningStrike 0.6s ease;
    }

    @keyframes lightningStrike {
      0% { transform: translateX(-100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }

    .lightning-competitor-card.winner {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255,215,0,0.4), rgba(255,165,0,0.4));
      box-shadow: 
        0 0 20px rgba(255,215,0,0.6),
        inset 0 0 20px rgba(255,215,0,0.2);
      animation: winnerGlow 2s ease-in-out infinite;
    }

    @keyframes winnerGlow {
      0%, 100% { 
        box-shadow: 
          0 0 20px rgba(255,215,0,0.6),
          inset 0 0 20px rgba(255,215,0,0.2);
      }
      50% { 
        box-shadow: 
          0 0 30px rgba(255,215,0,0.9),
          inset 0 0 25px rgba(255,215,0,0.4);
      }
    }

    .lightning-competitor-card.active {
      border-color: #00ffff;
      background: linear-gradient(135deg, rgba(0,255,255,0.3), rgba(0,150,255,0.3));
      transform: scale(1.05);
      animation: activePlayer 1.5s ease-in-out infinite;
    }

    @keyframes activePlayer {
      0%, 100% { border-color: #00ffff; }
      50% { border-color: #00ff00; }
    }

    .competitor-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #ffff00, #ff6600, #ff0000, #ffff00);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.5rem;
      font-size: 1.5rem;
      color: white;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(0,0,0,0.8);
      animation: avatarSpin 4s linear infinite;
    }

    @keyframes avatarSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .competitor-name {
      color: white;
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 5px rgba(0,0,0,0.8);
    }

    .competitor-score {
      background: rgba(0,0,0,0.5);
      color: #ffd700;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9rem;
      border: 1px solid rgba(255,215,0,0.3);
    }

    .lightning-reaction {
      background: rgba(255,255,255,0.1);
      border-left: 4px solid #ffd700;
      padding: 0.8rem;
      margin: 0.5rem 0;
      border-radius: 0 10px 10px 0;
      animation: slideInLeft 0.5s ease;
    }

    @keyframes slideInLeft {
      0% { transform: translateX(-100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }

    @keyframes lightningBlast {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 0.8;
      }
      100% {
        transform: translate(-50%, -50%) scale(3);
        opacity: 0;
      }
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .kingdom-title {
        font-size: 2rem;
      }
      
      .glass-container {
        margin: 0.5rem;
        padding: 1rem;
      }
      
      .challenge-timer {
        font-size: 4rem;
      }
      
      .team-avatar-3d {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }
    }

    /* ===== SELECTION PANEL STYLES ===== */
    .selection-panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .class-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .class-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 215, 0, 0.5);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .class-card.selected {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 99, 71, 0.4));
      box-shadow: 
        0 0 25px rgba(255, 215, 0, 0.7),
        inset 0 0 15px rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { 
        box-shadow: 
          0 0 25px rgba(255, 215, 0, 0.7),
          inset 0 0 15px rgba(255, 215, 0, 0.2);
      }
      50% { 
        box-shadow: 
          0 0 35px rgba(255, 215, 0, 0.9),
          inset 0 0 20px rgba(255, 215, 0, 0.4);
      }
    }

    .class-card h4 {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .class-card .student-count {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    .student-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .student-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .student-card.selected {
      border-color: #00ffff;
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
      box-shadow: 
        0 0 15px rgba(0, 255, 255, 0.5),
        inset 0 0 10px rgba(0, 255, 255, 0.2);
      transform: scale(1.02);
      animation: selectedGlow 2s ease-in-out infinite alternate;
    }

    @keyframes selectedGlow {
      0% { 
        box-shadow: 
          0 0 15px rgba(0, 255, 255, 0.5),
          inset 0 0 10px rgba(0, 255, 255, 0.2);
      }
      100% { 
        box-shadow: 
          0 0 25px rgba(0, 255, 255, 0.8),
          inset 0 0 15px rgba(0, 255, 255, 0.4);
      }
    }

    .student-card .student-name {
      color: white;
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .student-card .selection-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .student-card.selected .selection-indicator {
      background: linear-gradient(135deg, #00ffff, #ff00ff);
      color: #000;
      font-weight: bold;
      transform: scale(1.2);
      animation: checkmarkPulse 0.5s ease-out;
    }

    @keyframes checkmarkPulse {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.4); opacity: 1; }
      100% { transform: scale(1.2); opacity: 1; }
    }

    /* ===== ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ===== */
    .settings-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .settings-icon-main {
      font-size: 3rem;
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rotateIcon 3s ease-in-out infinite;
    }

    @keyframes rotateIcon {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(15deg); }
    }

    .settings-title {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .settings-subtitle {
      margin: 0.3rem 0 0 0;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
    }

    .close-settings {
      background: linear-gradient(135deg, #ff4757, #ff3838);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
    }

    .close-settings:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.5);
    }

    .settings-tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: white;
      padding: 0.8rem 1.5rem;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 600;
      position: relative;
      overflow: hidden;
    }

    .settings-tab-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      border-color: rgba(255, 215, 0, 0.6);
      transform: translateY(-2px);
    }

    .settings-tab-btn.active {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 107, 53, 0.3));
      border-color: #ffd700;
      color: #ffd700;
      font-weight: 800;
    }

    .settings-tab-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .settings-tab-btn:hover::before {
      left: 100%;
    }

    .setting-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      border: 1px solid rgba(255, 215, 0, 0.2);
      transition: all 0.3s ease;
    }

    .setting-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 215, 0, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .setting-item label {
      display: block;
      color: #ffd700;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .setting-select, .setting-input {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .setting-select:focus, .setting-input:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }

    .setting-select option {
      background: #1a1a2e;
      color: white;
      padding: 0.5rem;
    }

    /* ===== ÿ≥ÿßÿ≠ÿ© ÿ™ÿ≠ÿØŸä ÿßŸÑÿ®ÿ±ŸÇ ===== */
    .lightning-arena {
      position: fixed;
      top: 80px;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 30%, #16213e 60%, #0f3460 100%);
      overflow-y: auto;
      z-index: 1000;
      animation: lightningEnter 1s ease-out;
    }

    @keyframes lightningEnter {
      0% { opacity: 0; transform: scale(0.8); }
      50% { opacity: 0.7; transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }

    .lightning-arena-container {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
    }

    .lightning-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 20px;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .lightning-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .lightning-icon {
      font-size: 4rem;
      background: linear-gradient(45deg, #ffff00, #00ffff);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: electricPulse 2s ease-in-out infinite;
    }

    @keyframes electricPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 10px #ffff00);
        transform: scale(1);
      }
      50% { 
        filter: drop-shadow(0 0 20px #00ffff);
        transform: scale(1.1);
      }
    }

    .lightning-title {
      font-size: 3rem;
      font-weight: 900;
      color: #ffff00;
      text-shadow: 0 0 20px rgba(255, 255, 0, 0.7);
      margin: 0;
    }

    .lightning-subtitle {
      font-size: 1.2rem;
      color: #00ffff;
      margin: 0.5rem 0 0 0;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    .lightning-timer-container {
      position: relative;
    }

    .timer-circle {
      width: 120px;
      height: 120px;
      border: 4px solid rgba(255, 255, 0, 0.3);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle, rgba(255, 255, 0, 0.2), transparent);
      animation: timerGlow 3s ease-in-out infinite;
      position: relative;
      overflow: hidden;
    }

    @keyframes timerGlow {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        border-color: rgba(255, 255, 0, 0.3);
      }
      50% { 
        box-shadow: 0 0 40px rgba(255, 255, 0, 0.8);
        border-color: rgba(255, 255, 0, 0.7);
      }
    }

    @keyframes urgentPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 0 40px rgba(255, 71, 87, 0.9);
      }
    }

    @keyframes criticalPulse {
      0%, 100% {
        transform: scale(1);
        color: #ff4757;
        text-shadow: 0 0 15px rgba(255, 71, 87, 0.8);
      }
      50% {
        transform: scale(1.2);
        color: #ff3742;
        text-shadow: 0 0 25px rgba(255, 71, 87, 1);
      }
    }

    @keyframes leaderboardExit {
      0% {
        opacity: 1;
        transform: scale(1) rotateY(0deg);
      }
      100% {
        opacity: 0;
        transform: scale(0.8) rotateY(-180deg);
      }
    }

    .timer-text {
      font-size: 2.5rem;
      font-weight: 900;
      color: #ffff00;
      text-shadow: 0 0 15px rgba(255, 255, 0, 0.8);
    }

    .timer-label {
      font-size: 0.9rem;
      color: #00ffff;
      margin-top: 0.2rem;
    }

    .lightning-controls {
      display: flex;
      gap: 1rem;
      flex-direction: column;
    }

    .lightning-btn {
      background: linear-gradient(135deg, #ffff00, #ffa500);
      border: 2px solid rgba(255, 255, 0, 0.5);
      color: #000;
      padding: 1rem 1.5rem;
      border-radius: 15px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(255, 255, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .lightning-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 255, 0, 0.5);
    }

    .lightning-btn.secondary {
      background: linear-gradient(135deg, #00ffff, #0099cc);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .lightning-btn.danger {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      border-color: rgba(255, 107, 107, 0.5);
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
      color: white;
    }

    .competitors-zone {
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(0, 255, 255, 0.3);
      border-radius: 20px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
    }

    .zone-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    .competitors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .competitor-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(0, 255, 255, 0.1));
      border: 2px solid rgba(255, 255, 0, 0.3);
      border-radius: 15px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .competitor-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 255, 0, 0.7);
      box-shadow: 0 10px 25px rgba(255, 255, 0, 0.3);
    }

    .competitor-card.answered-correct {
      background: linear-gradient(135deg, rgba(0, 255, 0, 0.3), rgba(0, 200, 0, 0.3));
      border-color: #00ff00;
      animation: correctAnswer 0.8s ease-out;
    }

    .competitor-card.answered-wrong {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(200, 0, 0, 0.3));
      border-color: #ff0000;
      animation: wrongAnswer 0.8s ease-out;
    }

    @keyframes correctAnswer {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(0, 255, 0, 0.7); }
      100% { transform: scale(1); }
    }

    @keyframes wrongAnswer {
      0% { transform: scale(1); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
      100% { transform: scale(1); }
    }

    .competitor-name {
      font-weight: 600;
      color: white;
      margin-bottom: 0.5rem;
    }

    .competitor-score {
      font-size: 1.5rem;
      font-weight: 900;
      color: #ffff00;
      text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
    }

    .question-zone {
      background: radial-gradient(circle, rgba(255, 255, 0, 0.1), transparent);
      border: 3px solid rgba(255, 255, 0, 0.5);
      border-radius: 25px;
      padding: 2rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
    }

    .gameplay-instructions {
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(0, 255, 255, 0.3);
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: right;
    }

    .gameplay-instructions h4 {
      color: #00ffff;
      font-size: 1.3rem;
      margin-bottom: 1rem;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    .instructions-list {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .instruction-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border-right: 4px solid #ffff00;
      transition: all 0.3s ease;
    }

    .instruction-item:hover {
      background: rgba(255, 255, 0, 0.1);
      transform: translateX(-5px);
    }

    .step-number {
      background: linear-gradient(45deg, #ffff00, #ffa500);
      color: #000;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 1.1rem;
      box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
    }

    .instruction-item span:last-child {
      color: white;
      font-size: 1rem;
      line-height: 1.4;
    }

    .question-display {
      text-align: center;
      min-height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .waiting-state {
      animation: waitingPulse 2s ease-in-out infinite;
    }

    @keyframes waitingPulse {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }

    .waiting-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: electricSpin 3s linear infinite;
    }

    @keyframes electricSpin {
      0% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(90deg) scale(1.1); }
      50% { transform: rotate(180deg) scale(1); }
      75% { transform: rotate(270deg) scale(1.1); }
      100% { transform: rotate(360deg) scale(1); }
    }

    .question-active {
      background: linear-gradient(135deg, rgba(255, 255, 0, 0.2), rgba(0, 255, 255, 0.2));
      animation: questionGlow 2s ease-in-out infinite;
    }

    @keyframes questionGlow {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
        border-color: rgba(255, 255, 0, 0.5);
      }
      50% { 
        box-shadow: 0 0 40px rgba(255, 255, 0, 0.7);
        border-color: rgba(255, 255, 0, 0.9);
      }
    }

    .lightning-scoreboard {
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 20px;
      padding: 1.5rem;
      backdrop-filter: blur(15px);
    }

    .scoreboard-title {
      font-size: 1.8rem;
      font-weight: 800;
      color: #ffd700;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
    }

    .lightning-effects {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: -1;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ© */
    .lightning-bolt {
      position: absolute;
      width: 2px;
      background: linear-gradient(to bottom, #ffff00, transparent);
      animation: lightningStrike 0.5s ease-out;
      box-shadow: 0 0 10px #ffff00;
    }

    @keyframes lightningStrike {
      0% { height: 0; opacity: 1; }
      50% { height: 100vh; opacity: 0.8; }
      100% { height: 100vh; opacity: 0; }
    }

    /* ===== TEACHER GUIDE MODAL ===== */
    .teacher-guide-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 100000;
      display: none;
      overflow-y: auto;
      padding: 2rem;
    }

    .guide-content {
      max-width: 1000px;
      margin: 0 auto;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .guide-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .guide-section h3 {
      color: #ffd700;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .guide-section p, .guide-section li {
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    .guide-section ul {
      padding-right: 1.5rem;
    }

    /* ===== ENHANCED BUTTON STYLES ===== */
    .neural-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .neural-button:disabled:hover {
      transform: none !important;
      box-shadow: none !important;
    }

    /* ===== RESPONSIVE DESIGN ENHANCEMENTS ===== */
    @media (max-width: 768px) {
      .selection-panel {
        padding: 1rem;
      }
      
      .class-grid, .students-grid {
        grid-template-columns: 1fr;
      }
      
      .guide-content {
        padding: 1rem;
      }
    }

    /* ===== LOADING SCREEN ===== */
    .cosmic-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000000, #1a1a2e, #16213e);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100000;
      transition: opacity 1s ease;
    }

    .loader-animation {
      width: 150px;
      height: 150px;
      border: 4px solid transparent;
      border-top: 4px solid #00ffff;
      border-right: 4px solid #ff00ff;
      border-radius: 50%;
      animation: cosmicSpin 2s linear infinite;
      margin-bottom: 2rem;
      position: relative;
    }

    .loader-animation::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100px;
      height: 100px;
      border: 2px solid transparent;
      border-bottom: 2px solid #ffd700;
      border-left: 2px solid #ff4500;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: cosmicSpin 1s linear infinite reverse;
    }

    @keyframes cosmicSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loader-text {
      color: #00ffff;
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      animation: textPulse 2s ease-in-out infinite;
    }

    @keyframes textPulse {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    .loader-progress {
      width: 300px;
      height: 6px;
      background: rgba(255,255,255,0.2);
      border-radius: 3px;
      margin-top: 2rem;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00ffff, #ff00ff, #ffd700);
      border-radius: 3px;
      width: 0%;
      transition: width 0.5s ease;
      animation: progressGlow 2s ease-in-out infinite;
    }

    @keyframes progressGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(0,255,255,0.5); }
      50% { box-shadow: 0 0 20px rgba(0,255,255,1); }
    }

    /* ===== WISDOM ARENA STYLES ===== */
    .wisdom-arena {
      background: linear-gradient(135deg, rgba(79,70,229,0.1), rgba(139,92,246,0.1));
      border: 2px solid rgba(79,70,229,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: wisdomGlow 3s ease-in-out infinite;
    }

    @keyframes wisdomGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(79,70,229,0.3); }
      50% { box-shadow: 0 0 40px rgba(139,92,246,0.5); }
    }

    .wisdom-btn {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      border: 2px solid rgba(79,70,229,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .wisdom-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(79,70,229,0.4);
    }

    .wisdom-card {
      border: 2px solid rgba(79,70,229,0.5);
      background: linear-gradient(135deg, rgba(79,70,229,0.2), rgba(139,92,246,0.1));
    }

    /* ===== CREATIVE ARENA STYLES ===== */
    .creative-arena {
      background: linear-gradient(135deg, rgba(236,72,153,0.1), rgba(244,114,182,0.1));
      border: 2px solid rgba(236,72,153,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: creativeGlow 3s ease-in-out infinite;
    }

    @keyframes creativeGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(236,72,153,0.3); }
      50% { box-shadow: 0 0 40px rgba(244,114,182,0.5); }
    }

    .creative-btn {
      background: linear-gradient(135deg, #ec4899, #f472b6);
      border: 2px solid rgba(236,72,153,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .creative-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(236,72,153,0.4);
    }

    .creative-card {
      border: 2px solid rgba(236,72,153,0.5);
      background: linear-gradient(135deg, rgba(236,72,153,0.2), rgba(244,114,182,0.1));
    }

    /* ===== SCIENCE ARENA STYLES ===== */
    .science-arena {
      background: linear-gradient(135deg, rgba(6,182,212,0.1), rgba(14,165,233,0.1));
      border: 2px solid rgba(6,182,212,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: scienceGlow 3s ease-in-out infinite;
    }

    @keyframes scienceGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(6,182,212,0.3); }
      50% { box-shadow: 0 0 40px rgba(14,165,233,0.5); }
    }

    .science-btn {
      background: linear-gradient(135deg, #06b6d4, #0ea5e9);
      border: 2px solid rgba(6,182,212,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .science-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(6,182,212,0.4);
    }

    .science-card {
      border: 2px solid rgba(6,182,212,0.5);
      background: linear-gradient(135deg, rgba(6,182,212,0.2), rgba(14,165,233,0.1));
    }

    /* ===== LANGUAGE ARENA STYLES ===== */
    .language-arena {
      background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(34,197,94,0.1));
      border: 2px solid rgba(16,185,129,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: languageGlow 3s ease-in-out infinite;
    }

    @keyframes languageGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(16,185,129,0.3); }
      50% { box-shadow: 0 0 40px rgba(34,197,94,0.5); }
    }

    .language-btn {
      background: linear-gradient(135deg, #10b981, #22c55e);
      border: 2px solid rgba(16,185,129,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .language-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(16,185,129,0.4);
    }

    .language-card {
      border: 2px solid rgba(16,185,129,0.5);
      background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(34,197,94,0.1));
    }

    /* ===== MATH ARENA STYLES ===== */
    .math-arena {
      background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(251,191,36,0.1));
      border: 2px solid rgba(245,158,11,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: mathGlow 3s ease-in-out infinite;
    }

    @keyframes mathGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(245,158,11,0.3); }
      50% { box-shadow: 0 0 40px rgba(251,191,36,0.5); }
    }

    .math-btn {
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      border: 2px solid rgba(245,158,11,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .math-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(245,158,11,0.4);
    }

    .math-card {
      border: 2px solid rgba(245,158,11,0.5);
      background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(251,191,36,0.1));
    }

    /* ===== HISTORY ARENA STYLES ===== */
    .history-arena {
      background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(168,85,247,0.1));
      border: 2px solid rgba(139,92,246,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: historyGlow 3s ease-in-out infinite;
    }

    @keyframes historyGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(139,92,246,0.3); }
      50% { box-shadow: 0 0 40px rgba(168,85,247,0.5); }
    }

    .history-btn {
      background: linear-gradient(135deg, #8b5cf6, #a855f7);
      border: 2px solid rgba(139,92,246,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .history-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(139,92,246,0.4);
    }

    .history-card {
      border: 2px solid rgba(139,92,246,0.5);
      background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(168,85,247,0.1));
    }

    /* ===== MYSTERY ARENA STYLES ===== */
    .mystery-arena {
      background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(248,113,113,0.1));
      border: 2px solid rgba(239,68,68,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: mysteryGlow 3s ease-in-out infinite;
    }

    @keyframes mysteryGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(239,68,68,0.3); }
      50% { box-shadow: 0 0 40px rgba(248,113,113,0.5); }
    }

    .mystery-btn {
      background: linear-gradient(135deg, #ef4444, #f87171);
      border: 2px solid rgba(239,68,68,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .mystery-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(239,68,68,0.4);
    }

    .mystery-card {
      border: 2px solid rgba(239,68,68,0.5);
      background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(248,113,113,0.1));
    }

    /* ===== TEAM BATTLE ARENA STYLES ===== */
    .team-battle-arena {
      background: linear-gradient(135deg, rgba(220,38,38,0.1), rgba(239,68,68,0.1));
      border: 2px solid rgba(220,38,38,0.5);
      border-radius: 25px;
      padding: 2rem;
      margin: 2rem auto;
      backdrop-filter: blur(15px);
      animation: battleGlow 3s ease-in-out infinite;
    }

    @keyframes battleGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(220,38,38,0.3); }
      50% { box-shadow: 0 0 40px rgba(239,68,68,0.5); }
    }

    .team-battle-btn {
      background: linear-gradient(135deg, #dc2626, #ef4444);
      border: 2px solid rgba(220,38,38,0.6);
      color: white;
      padding: 1rem 2rem;
      border-radius: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem;
    }

    .team-battle-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(220,38,38,0.4);
    }

    .team-card {
      border: 2px solid rgba(220,38,38,0.5);
      background: linear-gradient(135deg, rgba(220,38,38,0.2), rgba(239,68,68,0.1));
      padding: 1.5rem;
      margin: 1rem;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .team-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(220,38,38,0.3);
    }

    .team-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
    }

    .team-members {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.7);
      margin-bottom: 1rem;
    }

    .team-score {
      font-size: 1.5rem;
      font-weight: 900;
      color: #ff4444;
      text-shadow: 0 0 10px rgba(255,68,68,0.5);
    }

    /* ===== SHARED ARENA STYLES ===== */
    .arena-header,
    .wisdom-header,
    .creative-header,
    .science-header,
    .language-header,
    .math-header,
    .history-header,
    .mystery-header,
    .team-battle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }

    .title-container,
    .wisdom-title-container,
    .creative-title-container,
    .science-title-container,
    .language-title-container,
    .math-title-container,
    .history-title-container,
    .mystery-title-container,
    .team-battle-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .wisdom-icon, .creative-icon, .science-icon, .language-icon,
    .math-icon, .history-icon, .mystery-icon, .team-battle-icon {
      font-size: 3rem;
      filter: drop-shadow(0 3px 6px rgba(0,0,0,0.3));
    }

    .wisdom-title, .creative-title, .science-title, .language-title,
    .math-title, .history-title, .mystery-title, .team-battle-title {
      font-size: 2.5rem;
      font-weight: 900;
      color: white;
      text-shadow: 0 3px 6px rgba(0,0,0,0.5);
      margin: 0;
    }

    .wisdom-subtitle, .creative-subtitle, .science-subtitle, .language-subtitle,
    .math-subtitle, .history-subtitle, .mystery-subtitle, .team-battle-subtitle {
      font-size: 1.1rem;
      color: rgba(255,255,255,0.8);
      margin: 0;
    }

    .timer-container,
    .wisdom-timer-container,
    .creative-timer-container,
    .science-timer-container,
    .language-timer-container,
    .math-timer-container,
    .history-timer-container,
    .mystery-timer-container,
    .team-battle-timer-container {
      text-align: center;
    }

    .controls,
    .wisdom-controls,
    .creative-controls,
    .science-controls,
    .language-controls,
    .math-controls,
    .history-controls,
    .mystery-controls,
    .team-battle-controls {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .secondary {
      background: linear-gradient(135deg, #6b7280, #9ca3af) !important;
      border-color: rgba(107,114,128,0.6) !important;
    }

    .danger {
      background: linear-gradient(135deg, #dc2626, #ef4444) !important;
      border-color: rgba(220,38,38,0.6) !important;
    }

    /* ===== RESPONSIVE DESIGN MEDIA QUERIES ===== */
    
    /* Tablets (‚â§1024px) */
    @media screen and (max-width: 1024px) {
      body {
        padding-top: 70px;
      }
      
      .container {
        padding: 15px;
        margin: 0 10px;
      }
      
      .grid-container {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
      }
      
      .challenge-card {
        margin-bottom: 15px;
      }
      
      .header-controls {
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .control-panel {
        padding: 15px;
      }
    }
    
    /* Medium Tablets (‚â§768px) */
    @media screen and (max-width: 768px) {
      body {
        padding-top: 60px;
      }
      
      .container {
        padding: 10px;
        margin: 0 5px;
      }
      
      /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ŸÑŸÑÿ™ÿßÿ®ŸÑÿ™ */
      .kingdom-dashboard {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        padding: 0 0.75rem;
      }
      
      .realm-card {
        padding: 1.75rem 1.5rem;
        min-height: 220px;
      }
      
      .realm-icon {
        font-size: 3rem;
        margin-bottom: 0.875rem;
      }
      
      .realm-title {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
      }
      
      .realm-description {
        font-size: 0.85rem;
        line-height: 1.5;
      }
      
      .realm-stats {
        font-size: 0.8rem;
        padding: 0.45rem 0.9rem;
      }
      
      .grid-container {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .challenge-card {
        padding: 15px;
        margin-bottom: 12px;
      }
      
      .header-title {
        font-size: 1.5rem;
        text-align: center;
      }
      
      .btn-group {
        flex-direction: column;
        gap: 8px;
      }
      
      .btn {
        width: 100%;
        padding: 12px 15px;
        font-size: 0.9rem;
      }
      
      .modal-content {
        width: 95%;
        margin: 5% auto;
        padding: 15px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .progress-bars {
        flex-direction: column;
      }
    }
    
    /* Mobile Phones (‚â§480px) */
    @media screen and (max-width: 480px) {
      body {
        padding-top: 50px;
        font-size: 14px;
      }
      
      .container {
        padding: 8px;
        margin: 0;
      }
      
      /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ŸÑŸÑŸáÿßÿ™ŸÅ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ */
      .kingdom-dashboard {
        grid-template-columns: 1fr;
        gap: 1rem;
        padding: 0 0.5rem;
        margin-bottom: 2rem;
      }
      
      .realm-card {
        padding: 1.5rem 1rem;
        min-height: 200px;
        margin-bottom: 1rem;
      }
      
      .realm-icon {
        font-size: 2.5rem;
        margin-bottom: 0.75rem;
      }
      
      .realm-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        line-height: 1.4;
      }
      
      .realm-description {
        font-size: 0.8rem;
        line-height: 1.5;
        margin-bottom: 1rem;
      }
      
      .realm-stats {
        font-size: 0.75rem;
        padding: 0.4rem 0.8rem;
        margin-top: 0.75rem;
      }
      
      .challenge-card {
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 12px;
      }
      
      .header-title {
        font-size: 1.2rem;
      }
      
      .btn {
        padding: 10px 12px;
        font-size: 0.85rem;
        min-height: 44px;
      }
      
      .control-button {
        min-height: 44px;
        width: 100%;
        margin-bottom: 8px;
      }
      
      .modal-content {
        width: 98%;
        margin: 2% auto;
        padding: 12px;
        max-height: 95vh;
        overflow-y: auto;
      }
      
      .challenge-text {
        font-size: 0.9rem;
        line-height: 1.4;
      }
      
      .timer-display {
        font-size: 1.5rem;
      }
      
      .score-display {
        font-size: 1rem;
      }
      
      .grid-2-cols {
        grid-template-columns: 1fr;
      }
      
      .flex-wrap {
        flex-wrap: wrap;
      }
      
      .student-grid {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .difficulty-buttons {
        flex-direction: column;
        gap: 8px;
      }
      
      .category-tabs {
        flex-wrap: wrap;
        gap: 5px;
      }
      
      .category-tab {
        flex: 1;
        min-width: 80px;
        padding: 8px 10px;
        font-size: 0.8rem;
      }
    }
    
    /* Small Mobile Phones (‚â§360px) */
    @media screen and (max-width: 360px) {
      body {
        padding-top: 45px;
        font-size: 13px;
      }
      
      .container {
        padding: 5px;
      }
      
      /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿßŸã */
      .kingdom-dashboard {
        grid-template-columns: 1fr;
        gap: 0.75rem;
        padding: 0 0.25rem;
        margin-bottom: 1.5rem;
      }
      
      .realm-card {
        padding: 1rem 0.75rem;
        min-height: 180px;
        margin-bottom: 0.75rem;
        border-radius: 12px;
      }
      
      .realm-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      
      .realm-title {
        font-size: 1rem;
        margin-bottom: 0.4rem;
        line-height: 1.3;
      }
      
      .realm-description {
        font-size: 0.75rem;
        line-height: 1.4;
        margin-bottom: 0.75rem;
      }
      
      .realm-stats {
        font-size: 0.7rem;
        padding: 0.3rem 0.6rem;
        margin-top: 0.5rem;
      }
      
      .challenge-card {
        padding: 10px;
        margin-bottom: 8px;
      }
      
      .header-title {
        font-size: 1.1rem;
      }
      
      .btn {
        padding: 8px 10px;
        font-size: 0.8rem;
        min-height: 44px;
      }
      
      .modal-content {
        width: 100%;
        margin: 0;
        padding: 10px;
        border-radius: 0;
        max-height: 100vh;
      }
      
      .challenge-text {
        font-size: 0.85rem;
      }
      
      .timer-display {
        font-size: 1.3rem;
      }
      
      .score-display {
        font-size: 0.9rem;
      }
    }
    
    /* Landscape Orientation (Low Height) */
    @media screen and (max-height: 500px) and (orientation: landscape) {
      body {
        padding-top: 40px;
      }
      
      .modal-content {
        max-height: 90vh;
        overflow-y: auto;
      }
      
      .challenge-card {
        padding: 8px;
        margin-bottom: 6px;
      }
      
      .header-title {
        font-size: 1rem;
      }
      
      .btn {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      
      .grid-container {
        gap: 8px;
      }
    }
    
    /* Touch Device Optimizations */
    @media (hover: none) and (pointer: coarse) {
      .btn,
      .control-button,
      .challenge-card,
      .student-btn,
      .category-tab,
      .close-btn {
        min-height: 44px;
        min-width: 44px;
      }
      
      .btn:hover {
        transform: none;
      }
      
      .challenge-card:hover {
        transform: none;
      }
      
      /* Remove hover effects on touch devices */
      *:hover {
        -webkit-tap-highlight-color: transparent;
      }
      
      /* Fix iOS font size issues */
      input,
      textarea,
      select {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- Particles Background -->
  <div id="particles-js"></div>

  <!-- Cosmic Loading Screen -->
  <div class="cosmic-loader" id="cosmicLoader">
    <div class="loader-animation"></div>
    <div class="loader-text" id="loaderText">üåå ÿ™ŸáŸäÿ¶ÿ© ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©...</div>
    <div class="loader-progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>

  <!-- Main Application -->
  <div class="glass-container mobile-full-width" id="mainApp" style="display: none;">
    <!-- Class & Student Selection Panel -->
    <div class="selection-panel mobile-block" id="selectionPanel">
      <div class="glass-container mobile-full-width" style="background: rgba(0,0,0,0.8); border: 2px solid rgba(255,215,0,0.5);">
        <!-- ÿπŸÜŸàÿßŸÜ ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑŸàÿ≠ÿ© -->
        <div class="responsive-margin" style="position: relative; margin-bottom: 2rem;">
          <h2 class="mobile-text-center" style="text-align: center; color: #ffd700; font-size: 2.5rem; margin-bottom: 0.5rem;">
            üë• ÿ•ÿπÿØÿßÿØ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™
          </h2>
          <p class="mobile-text-center" style="text-align: center; color: rgba(255,255,255,0.8); font-size: 1.1rem;">
            ‚ö° ÿßÿÆÿ™ÿ± ÿµŸÅŸÉ Ÿàÿ∑ŸÑÿßÿ®ŸÉ ŸÑÿ®ÿØÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑŸÖŸÑÿ≠ŸÖŸäÿ©
          </p>
        </div>
        
        <!-- Class Selection -->
        <div class="class-selection-section" style="margin-bottom: 3rem;">
          <h3 style="color: #00ffff; font-size: 1.8rem; margin-bottom: 1rem; text-align: center;">
            üè´ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ
          </h3>
          <div class="class-grid" id="classGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <!-- Classes will be loaded dynamically -->
          </div>
        </div>

        <!-- Student Selection -->
        <div class="student-selection-section" id="studentSelectionSection" style="display: none;">
          <h3 style="color: #ff6347; font-size: 1.8rem; margin-bottom: 1rem; text-align: center;">
            üéØ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ
          </h3>
          
          <!-- Selection Controls -->
          <div class="mobile-grid-2 responsive-gap" style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <button class="neural-button touch-target mobile-full-width" onclick="selectAllStudents()">‚úÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÉŸÑ</button>
            <button class="neural-button touch-target mobile-full-width" onclick="clearAllStudents()">‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉŸÑ</button>
            <button class="neural-button touch-target mobile-full-width" onclick="selectRandomStudents()">üé≤ ÿßÿÆÿ™Ÿäÿßÿ± ÿπÿ¥Ÿàÿßÿ¶Ÿä</button>
            <button class="neural-button touch-target mobile-full-width" onclick="quickSelectCount()">üî¢ ÿßÿÆÿ™Ÿäÿßÿ± ÿπÿØÿØ ŸÖÿ≠ÿØÿØ</button>
          </div>

          <!-- Student Grid -->
          <div class="students-grid mobile-grid-auto responsive-gap" id="studentsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <!-- Students will be loaded dynamically -->
          </div>

          <!-- Selected Count Display -->
          <div style="text-align: center; margin-bottom: 2rem;">
            <div style="background: rgba(0,255,255,0.2); padding: 1rem; border-radius: 15px; display: inline-block;">
              <span style="color: #00ffff; font-size: 1.2rem; font-weight: 700;">
                ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ: <span id="selectedCount">0</span>
              </span>
            </div>
          </div>

          <!-- Start Game Button -->
          <div class="mobile-text-center" style="text-align: center;">
            <button class="neural-button touch-target mobile-full-width" id="startGameBtn" onclick="startKingdomGame()" style="font-size: 1.3rem; padding: 1.5rem 3rem; background: linear-gradient(45deg, #ffd700, #ff6347);" disabled>
              üöÄ ÿ®ÿØÿ° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Game Interface (initially hidden) -->
    <div class="game-interface mobile-block" id="gameInterface" style="display: none;">
    <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπŸÑŸàŸäÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© -->
    <div class="cosmic-control-header mobile-full-width">
        <div class="control-buttons-container mobile-flex-wrap">
            <div class="app-title-cosmic mobile-text-center">
                <span class="title-icon">üè∞</span>
                <span class="title-text">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©</span>
                <span class="version-badge">v2.0</span>
            </div>
            <div class="control-group-cosmic mobile-flex-wrap">
                <button class="cosmic-control-btn touch-target" id="homeBtn" title="ÿßŸÑÿπŸàÿØÿ© ŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©">
                    <span class="btn-icon">üè†</span>
                    <span class="btn-tooltip">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
                </button>
                <button class="cosmic-control-btn touch-target" id="teacherGuideBtn" title="ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ">
                    <span class="btn-icon">üìñ</span>
                    <span class="btn-tooltip">ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ</span>
                </button>

    <button class="cosmic-control-btn" id="settingsBtn" title="ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©">
                    <span class="btn-icon">‚öôÔ∏è</span>
                    <span class="btn-tooltip">ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                </button>
                <!-- Session button removed -->
                <button class="cosmic-control-btn" id="statsBtn" title="ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©">
                    <span class="btn-icon">üìä</span>
                    <span class="btn-tooltip">ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™</span>
                </button>
                <button class="cosmic-control-btn" id="fullscreenBtn" title="Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©">
                    <span class="btn-icon">‚õ∂</span>
                    <span class="btn-tooltip">ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Kingdom Header -->
    <div id="kingdomContent">
    <header class="main-header mobile-text-center">
      <h1 class="kingdom-title mobile-text-center">üèÜ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©</h1>
      <p class="subtitle mobile-text-center">‚ö° ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿπŸÑŸÖ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ÿ®ÿ™ŸÇŸÜŸäÿ© ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</p>
      
      <!-- Real-time Stats -->
      <div class="mobile-grid-2 responsive-gap" style="display: flex; justify-content: center; gap: 2rem; margin-top: 2rem;">
        <!-- Session time display removed -->
        <div class="mobile-text-center" style="text-align: center; color: white;">
          <div style="font-size: 2rem; font-weight: 900;">üéØ</div>
          <div>ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©</div>
          <div id="completedChallenges" style="font-weight: 700;">0</div>
        </div>
        <div class="mobile-text-center" style="text-align: center; color: white;">
          <div style="font-size: 2rem; font-weight: 900;">‚ö°</div>
          <div>ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∑ÿßŸÇÿ©</div>
          <div id="energyLevel" style="font-weight: 700;">100%</div>
        </div>
      </div>
    </header>

    <!-- Kingdom Dashboard -->
    <div class="kingdom-dashboard" id="kingdomDashboard">
      <!-- Lightning Challenge Realm -->
      <div class="realm-card" onclick="activateRealm('lightning')">
        <div class="realm-icon">‚ö°</div>
        <h3 class="realm-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ</h3>
        <p class="realm-description">ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ© ŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ™ŸÅŸÉŸäÿ± ŸàÿßŸÑÿ∞ŸÉÿßÿ°</p>
        <div class="realm-stats">üèÜ 125 ÿ™ÿ≠ÿØŸä ŸÖÿ™ÿßÿ≠</div>
      </div>

      <!-- Wisdom Challenge Realm -->
      <div class="realm-card touch-target" onclick="activateRealm('wisdom')">
        <div class="realm-icon">üß†</div>
        <h3 class="realm-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©</h3>
        <p class="realm-description">ÿ™ÿ≠ÿØŸäÿßÿ™ ŸÅŸÉÿ±Ÿäÿ© ÿπŸÖŸäŸÇÿ© ŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿ∞ŸÉÿßÿ° ŸàÿßŸÑÿ•ÿ®ÿØÿßÿπ</p>
        <div class="realm-stats">üéØ 88 ÿ™ÿ≠ÿØŸä ŸÖÿ™ÿßÿ≠</div>
      </div>

      <!-- Team Battle Realm -->
      <div class="realm-card touch-target" onclick="activateRealm('battle')">
        <div class="realm-icon">‚öîÔ∏è</div>
        <h3 class="realm-title">ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©</h3>
        <p class="realm-description">ŸÖÿπÿßÿ±ŸÉ ÿ¨ŸÖÿßÿπŸäÿ© ŸÖŸÑÿ≠ŸÖŸäÿ© ÿ®ŸäŸÜ ÿßŸÑŸÅÿ±ŸÇ</p>
        <div class="realm-stats">‚öîÔ∏è 45 ŸÖÿπÿ±ŸÉÿ© ŸÖÿ™ÿßÿ≠ÿ©</div>
      </div>

      <!-- Mystery Realm -->
      <div class="realm-card touch-target" onclick="activateRealm('mystery')">
        <div class="realm-icon">üîÆ</div>
        <h3 class="realm-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤</h3>
        <p class="realm-description">ÿ£ŸÑÿ∫ÿßÿ≤ ÿ∫ÿßŸÖÿ∂ÿ© Ÿàÿ™ÿ≠ÿØŸäÿßÿ™ ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ¶Ÿäÿ©</p>
        <div class="realm-stats">üîç 67 ŸÑÿ∫ÿ≤ ŸÖÿ™ÿßÿ≠</div>
      </div>

      <!-- New Realms -->
      <!-- Creative Challenge Realm -->
      <div class="realm-card" onclick="activateRealm('creative')">
        <div class="realm-icon">üé®</div>
        <h3 class="realm-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ</h3>
        <p class="realm-description">ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ•ÿ®ÿØÿßÿπŸäÿ© ŸàŸÅŸÜŸäÿ© ŸÑÿ™ŸÜŸÖŸäÿ© ÿßŸÑÿÆŸäÿßŸÑ ŸàÿßŸÑÿßÿ®ÿ™ŸÉÿßÿ±</p>
        <div class="realm-stats">üé≠ 52 ŸÜÿ¥ÿßÿ∑ ÿ•ÿ®ÿØÿßÿπŸä</div>
      </div>

      <!-- Science Laboratory Realm -->
      <div class="realm-card" onclick="activateRealm('science')">
        <div class="realm-icon">üî¨</div>
        <h3 class="realm-title">ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ</h3>
        <p class="realm-description">ÿ™ÿ¨ÿßÿ±ÿ® ÿπŸÑŸÖŸäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸàÿßŸÉÿ™ÿ¥ÿßŸÅÿßÿ™ ŸÖÿ∞ŸáŸÑÿ©</p>
        <div class="realm-stats">‚öóÔ∏è 73 ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ©</div>
      </div>

      <!-- Language Masters Realm -->
      <div class="realm-card touch-target" onclick="activateRealm('language')">
        <div class="realm-icon">üìö</div>
        <h3 class="realm-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÑÿ∫ÿ©</h3>
        <p class="realm-description">ÿ™ÿ≠ÿØŸäÿßÿ™ ŸÑÿ∫ŸàŸäÿ© Ÿàÿ£ÿØÿ®Ÿäÿ© ŸÑÿ™ÿ∑ŸàŸäÿ± ŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑÿ™ÿπÿ®Ÿäÿ±</p>
        <div class="realm-stats">üìù 96 ÿ™ÿ≠ÿØŸä ŸÑÿ∫ŸàŸä</div>
      </div>

      <!-- Mathematical Kingdom -->
      <div class="realm-card touch-target" onclick="activateRealm('math')">
        <div class="realm-icon">üî¢</div>
        <h3 class="realm-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ</h3>
        <p class="realm-description">ŸÖÿ∫ÿßŸÖÿ±ÿßÿ™ ÿ±Ÿäÿßÿ∂Ÿäÿ© Ÿàÿ£ŸÑÿπÿßÿ® ÿ≠ÿ≥ÿßÿ®Ÿäÿ© ŸÖŸÖÿ™ÿπÿ©</p>
        <div class="realm-stats">‚ûï 134 ŸÖÿ≥ÿ£ŸÑÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ©</div>
      </div>

      <!-- Time Travel Challenge -->
      <div class="realm-card touch-target" onclick="activateRealm('history')">
        <div class="realm-icon">üï∞Ô∏è</div>
        <h3 class="realm-title">ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ</h3>
        <p class="realm-description">ÿ±ÿ≠ŸÑÿßÿ™ ÿπÿ®ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ Ÿàÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿßŸÑÿ≠ÿ∂ÿßÿ±ÿßÿ™</p>
        <div class="realm-stats">üèõÔ∏è 41 ÿ≠ŸÇÿ®ÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ©</div>
      </div>
    </div>
    </div> <!-- End of kingdomContent -->



    <!-- Battle Arena -->
    <div class="battle-arena" id="battleArena">
      <div class="arena-header">
        <h2 style="color: #ffd700; font-size: 2rem; margin-bottom: 1rem;">‚öîÔ∏è ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ©</h2>
        <div class="challenge-timer" id="challengeTimer">00:00</div>
        <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">ÿßÿ≥ÿ™ÿπÿØ ŸÑŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!</p>
      </div>

      <!-- Teams Hologram Display -->
      <div class="teams-hologram" id="teamsHologram">
        <!-- Teams will be generated dynamically -->
      </div>

      <!-- Battle Controls -->
      <div style="text-align: center; margin-top: 2rem;">
        <button class="neural-button" onclick="startBattle()">üöÄ ÿ®ÿØÿ° ÿßŸÑŸÖÿπÿ±ŸÉÿ©</button>
        <button class="neural-button" onclick="pauseBattle()">‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™</button>
        <button class="neural-button" onclick="endBattle()">üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÖÿπÿ±ŸÉÿ©</button>
        <button class="neural-button" onclick="resetArena()">üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ</button>
      </div>
    </div>

    <!-- Lightning Arena - Enhanced Competitive Version -->
    <div class="battle-arena" id="lightningArena" style="display: none;">
      <!-- Lightning Header with Storm Effects -->
      <div class="arena-header" style="position: relative; overflow: hidden;">
        <div class="lightning-storm-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,255,0,0.1) 0%, transparent 70%); animation: lightningPulse 2s ease-in-out infinite;"></div>
        
    <!-- Wisdom Arena - Intellectual Challenges -->
    <div class="battle-arena" id="wisdomArena" style="display: none;"></div>
    
    <!-- Creative Arena - Imagination Challenges -->
    <div class="battle-arena" id="creativeArena" style="display: none;"></div>
    
    <!-- Science Arena - Laboratory Experiments -->
    <div class="battle-arena" id="scienceArena" style="display: none;"></div>
    
    <!-- Language Arena - Literary Challenges -->
    <div class="battle-arena" id="languageArena" style="display: none;"></div>
    
    <!-- Math Arena - Mathematical Adventures -->
    <div class="battle-arena" id="mathArena" style="display: none;"></div>
    
    <!-- History Arena - Time Travel Adventures -->
    <div class="battle-arena" id="historyArena" style="display: none;"></div>
    
    <!-- Mystery Arena - Puzzle Challenges -->
    <div class="battle-arena" id="mysteryArena" style="display: none;"></div>
    
    <!-- Battle Team Arena - Group Competitions -->
    <div class="battle-arena" id="teamBattleArena" style="display: none;"></div>
        
        <h2 style="color: #ffd700; font-size: 2.5rem; margin-bottom: 1rem; text-shadow: 0 0 20px #ffd700; position: relative; z-index: 10;">
          ‚ö° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ‚ö°
        </h2>
        
        <!-- Dynamic Timer with Electric Effect -->
        <div class="lightning-timer-container" style="position: relative; margin: 1rem 0;">
          <div class="challenge-timer" id="lightningTimer" style="font-size: 4rem; font-weight: 900; background: linear-gradient(45deg, #ffff00, #ff6600, #ff0000); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 15px rgba(255,255,0,0.8)); animation: electricPulse 1s ease-in-out infinite;">30</div>
          <div style="color: rgba(255,255,255,0.9); font-size: 1.2rem; margin-top: 0.5rem;">‚ö° ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿ®ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ®ÿ±ŸÇ! ‚ö°</div>
        </div>

        <!-- Competition Status Display -->
        <div class="competition-status" style="background: rgba(0,0,0,0.6); padding: 1rem; border-radius: 15px; margin: 1rem 0; border: 2px solid rgba(255,255,0,0.5);">
          <div style="color: #ffd700; font-size: 1.1rem; margin-bottom: 0.5rem;">üèÜ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ© ÿßŸÑÿ≠Ÿäÿ©</div>
          <div id="lightningCompetitionStatus" style="color: white;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ± ŸÑŸÑŸÖŸÜÿßŸÅÿ≥ÿ©...</div>
        </div>
      </div>

      <!-- Competitors Lightning Board -->
      <div class="lightning-competitors-board" style="background: linear-gradient(135deg, rgba(255,255,0,0.1), rgba(255,165,0,0.1)); border-radius: 20px; padding: 1.5rem; margin: 2rem 0; border: 2px solid rgba(255,255,0,0.3);">
        <h3 style="color: #ffd700; text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem;">
          ‚ö° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿ≥ÿßÿ®ŸÇŸäŸÜ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ‚ö°
        </h3>
        
        <div id="lightningCompetitorsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          <!-- Competitors will be generated dynamically -->
        </div>
      </div>

      <!-- Teacher Question Panel -->
      <div class="teacher-question-panel" style="background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(25,25,25,0.8)); border-radius: 20px; padding: 2rem; margin: 2rem 0; border: 3px solid #ffd700; box-shadow: 0 0 30px rgba(255,215,0,0.4);">
        <h3 style="color: #ffd700; text-align: center; margin-bottom: 1rem; font-size: 1.8rem;">
          üé§ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ¥ŸÅŸàŸä üé§
        </h3>
        
        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px; margin-bottom: 1rem;">
            <div style="color: #00ffff; font-size: 1.1rem; margin-bottom: 0.5rem;">üì¢ ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÑŸÑŸÖÿπŸÑŸÖ:</div>
            <div style="color: rgba(255,255,255,0.9); font-size: 1rem; line-height: 1.6;">
              ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿ¥ŸÅŸàŸäÿßŸãÿå ÿ´ŸÖ ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ®ÿØÿ° ÿßŸÑÿπÿØÿßÿØ" ŸÑÿ®ÿØÿ° ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ©!<br>
              ÿßŸÑÿ∑ŸÑÿßÿ® ÿ≥Ÿäÿ±ŸÅÿπŸàŸÜ ÿ£ŸäÿØŸäŸáŸÖÿå Ÿàÿ£ŸÜÿ™ ÿ™ÿÆÿ™ÿßÿ± ÿßŸÑŸÅÿßÿ¶ÿ≤ ÿßŸÑÿ£ŸàŸÑ.
            </div>
          </div>
          
          <div class="mobile-grid-auto responsive-gap" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <button class="neural-button touch-target mobile-full-width" id="startLightningQuestion" onclick="startLightningQuestion()" style="background: linear-gradient(45deg, #00ff00, #00aa00); font-size: 1.2rem; padding: 1rem 2rem;">
              üöÄ ÿ®ÿØÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ ŸàÿßŸÑÿπÿØÿßÿØ
            </button>
            <button class="neural-button touch-target mobile-full-width" id="pauseLightningTimer" onclick="pauseLightningTimer()" style="background: linear-gradient(45deg, #ffaa00, #ff6600);" disabled>
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="neural-button touch-target mobile-full-width" id="resetLightningRound" onclick="resetLightningRound()" style="background: linear-gradient(45deg, #ff6600, #cc0000);">
              üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ
            </button>
          </div>
        </div>

        <!-- Quick Answer Selection -->
        <div class="quick-answer-selection" style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 15px; margin-top: 1rem;">
          <h4 style="color: #00ffff; text-align: center; margin-bottom: 1rem;">‚ö° ÿßÿÆÿ™Ÿäÿßÿ± ÿ≥ÿ±Ÿäÿπ ŸÑŸÑŸÅÿßÿ¶ÿ≤ ‚ö°</h4>
          <div id="quickAnswerButtons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.8rem;">
            <!-- Quick selection buttons will be generated -->
          </div>
        </div>
      </div>

      <!-- Live Reactions and Messages -->
      <div class="live-reactions-panel" style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 1.5rem; margin: 2rem 0;">
        <h4 style="color: #ff69b4; text-align: center; margin-bottom: 1rem;">üí¨ ÿ±ÿØŸàÿØ ÿßŸÑÿ£ŸÅÿπÿßŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ©</h4>
        <div id="lightningReactions" style="min-height: 120px; max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 1rem;">
          <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
            ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß ÿ±ÿØŸàÿØ ÿßŸÑÿ£ŸÅÿπÿßŸÑ ŸàÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ©...
          </div>
        </div>
      </div>

      <!-- Control Panel -->
      <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
        <button class="neural-button" onclick="nextLightningRound()">‚ö° ÿ¨ŸàŸÑÿ© ÿ¨ÿØŸäÿØÿ©</button>
        <button class="neural-button" onclick="showLightningLeaderboard()">üèÜ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ</button>
        <button class="neural-button" onclick="endLightningCompetition()">üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ©</button>
        <button class="neural-button secondary" onclick="returnToKingdom()">üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ</button>
      </div>
    </div>

    <!-- Creative Arena -->
    <div class="battle-arena" id="creativeArena" style="display: none;">
      <div class="arena-header">
        <h2 style="color: #32cd32; font-size: 2rem; margin-bottom: 1rem;">üé® ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ</h2>
        <div class="challenge-timer" id="creativeTimer">05:00</div>
        <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">ÿßÿ∑ŸÑŸÇ ÿßŸÑÿπŸÜÿßŸÜ ŸÑÿ•ÿ®ÿØÿßÿπŸÉ!</p>
      </div>

      <div class="creative-workspace" style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 2rem; margin: 2rem 0;">
        <div id="creativePrompt" style="font-size: 1.5rem; color: #32cd32; margin-bottom: 2rem; text-align: center;">
          ŸÖŸáŸÖÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ© ÿ¨ÿØŸäÿØÿ© ŸÇÿßÿØŸÖÿ©...
        </div>
        
        <div class="creative-tools" style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
          <button class="neural-button" onclick="showDrawingCanvas()">üñåÔ∏è ÿßŸÑÿ±ÿ≥ŸÖ</button>
          <button class="neural-button" onclick="showStoryWriter()">üìù ÿßŸÑŸÉÿ™ÿßÿ®ÿ©</button>
          <button class="neural-button" onclick="showMusicComposer()">üéµ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ</button>
          <button class="neural-button" onclick="showIdeaGenerator()">üí° ÿßŸÑÿπÿµŸÅ ÿßŸÑÿ∞ŸáŸÜŸä</button>
          <button class="neural-button secondary" onclick="returnToKingdom()">üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ</button>
        </div>

        <div id="creativeCanvas" style="min-height: 300px; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 1rem;">
          <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 3rem;">
            ÿßÿÆÿ™ÿ± ÿ£ÿØÿßÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ ŸÑŸÑÿ®ÿØÿ°...
          </div>
        </div>
      </div>
    </div>

    <!-- Science Lab Arena -->
    <div class="battle-arena" id="scienceArena" style="display: none;">
      <div class="arena-header">
        <h2 style="color: #9370db; font-size: 2rem; margin-bottom: 1rem;">üî¨ ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ</h2>
        <div class="challenge-timer" id="scienceTimer">10:00</div>
        <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿßŸÑŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä!</p>
      </div>

      <div class="science-lab" style="background: rgba(147,112,219,0.1); border-radius: 15px; padding: 2rem; margin: 2rem 0;">
        <div class="lab-equipment" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
          <div class="equipment-item" onclick="selectEquipment('microscope')" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.3s;">
            <div style="font-size: 2rem;">üî¨</div>
            <div>ÿßŸÑŸÖÿ¨Ÿáÿ±</div>
          </div>
          <div class="equipment-item" onclick="selectEquipment('beaker')" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.3s;">
            <div style="font-size: 2rem;">üß™</div>
            <div>ÿßŸÑÿ£ŸÜÿßÿ®Ÿäÿ®</div>
          </div>
          <div class="equipment-item" onclick="selectEquipment('calculator')" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.3s;">
            <div style="font-size: 2rem;">üßÆ</div>
            <div>ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ©</div>
          </div>
          <div class="equipment-item" onclick="selectEquipment('scales')" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.3s;">
            <div style="font-size: 2rem;">‚öñÔ∏è</div>
            <div>ÿßŸÑŸÖŸäÿ≤ÿßŸÜ</div>
          </div>
        </div>
        
        <div id="experimentArea" style="min-height: 200px; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 2rem; text-align: center; color: white;">
          ÿßÿÆÿ™ÿ± ÿ£ÿØÿßÿ© ŸÖŸÜ ÿßŸÑŸÖÿÆÿ™ÿ®ÿ± ŸÑÿ®ÿØÿ° ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©...
        </div>
        
        <div style="text-align: center; margin-top: 1rem;">
          <button class="neural-button secondary" onclick="returnToKingdom()">üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ</button>
        </div>
      </div>
    </div>

    <!-- Math Kingdom Arena -->
    <div class="battle-arena" id="mathArena" style="display: none;">
      <div class="arena-header">
        <h2 style="color: #20b2aa; font-size: 2rem; margin-bottom: 1rem;">üî¢ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ</h2>
        <div class="challenge-timer" id="mathTimer">03:00</div>
        <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">ÿßŸÑÿπŸÇŸÑ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä ŸÅŸä ÿßŸÑÿπŸÖŸÑ!</p>
      </div>

      <div class="math-workspace" style="background: rgba(32,178,170,0.1); border-radius: 15px; padding: 2rem; margin: 2rem 0;">
        <div id="mathProblem" style="font-size: 2.5rem; color: #20b2aa; text-align: center; margin-bottom: 2rem; padding: 2rem; background: rgba(255,255,255,0.1); border-radius: 15px; min-height: 150px; display: flex; align-items: center; justify-content: center;">
          ŸÖÿ≥ÿ£ŸÑÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ© ŸÇÿßÿØŸÖÿ©...
        </div>
        
        <div class="math-input" style="text-align: center; margin-bottom: 2rem;">
          <input type="text" id="mathAnswer" placeholder="ÿßŸÉÿ™ÿ® ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ŸáŸÜÿß..." style="font-size: 1.5rem; padding: 1rem; border-radius: 10px; border: 2px solid #20b2aa; background: rgba(255,255,255,0.1); color: white; text-align: center; width: 300px;" />
        </div>

        <div style="text-align: center;">
          <button class="neural-button" onclick="checkMathAnswer()">‚úÖ ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©</button>
          <button class="neural-button" onclick="nextMathProblem()">‚û°Ô∏è ÿßŸÑŸÖÿ≥ÿ£ŸÑÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©</button>
          <button class="neural-button" onclick="getMathHint()">üí° ÿ™ŸÑŸÖŸäÿ≠</button>
          <button class="neural-button secondary" onclick="returnToKingdom()">üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ</button>
        </div>
      </div>
    </div>

    <!-- AI Coach Panel -->
    <div class="glass-container mobile-full-width responsive-margin" style="margin-top: 2rem; border: 2px solid rgba(0,255,255,0.3);">
      <h3 class="mobile-text-center" style="color: #00ffff; text-align: center; margin-bottom: 1rem;">ü§ñ ÿßŸÑŸÖÿØÿ±ÿ® ÿßŸÑÿ∞ŸÉŸä ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ±</h3>
      <div id="aiCoachMessages" class="mobile-scroll" style="min-height: 150px; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px; color: white; overflow-y: auto; max-height: 300px;">
        <div class="mobile-text-center" style="opacity: 0.7; text-align: center;">
          <div style="font-size: 2rem; margin-bottom: 0.5rem;">ü§ñ</div>
          <div>ÿßŸÑŸÖÿØÿ±ÿ® ÿßŸÑÿ∞ŸÉŸä ÿ¨ÿßŸáÿ≤ ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿπŸÑŸÖ...</div>
          <div style="font-size: 0.8rem; color: rgba(255,255,255,0.5); margin-top: 0.5rem;">
            ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ£Ÿä ÿ≤ÿ± ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ∞ŸÉŸäÿ©
          </div>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <button class="neural-button" onclick="getAITip()">üí° ŸÜÿµŸäÿ≠ÿ© ÿ∞ŸÉŸäÿ©</button>
        <button class="neural-button" onclick="analyzePerformance()">üìä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿØÿßÿ°</button>
        <button class="neural-button" onclick="getMotivationalMessage()">üåü ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ©</button>
        <button class="neural-button" onclick="suggestStrategy()">üéØ ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿ©</button>
        <button class="neural-button" onclick="showProgress()">üìà ÿßŸÑÿ™ŸÇÿØŸÖ</button>
        <button class="neural-button" onclick="clearAIMessages()">üóëÔ∏è ŸÖÿ≥ÿ≠ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</button>
      </div>
    </div>

    <!-- Achievements Panel -->
    <div class="glass-container mobile-full-width responsive-margin" style="margin-top: 2rem; border: 2px solid rgba(255,215,0,0.3);">
      <h3 class="mobile-text-center" style="color: #ffd700; text-align: center; margin-bottom: 1rem;">üèÜ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™</h3>
      <div id="achievementsContainer" class="mobile-grid-auto responsive-gap" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <!-- Achievements will be generated dynamically -->
      </div>
      <div class="mobile-text-center responsive-margin" style="text-align: center; margin-top: 1rem;">
        <button class="neural-button touch-target mobile-full-width responsive-margin-small" onclick="checkForNewAchievements()">üîç ŸÅÿ≠ÿµ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©</button>
        <button class="neural-button touch-target mobile-full-width responsive-margin-small" onclick="showAllAchievements()">üìú ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™</button>
      </div>
    </div>

    <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© -->
    <div id="achievementsModal" class="achievements-modal">
      <div class="achievements-modal-content">
        <button class="achievements-close" onclick="closeAchievementsModal()">√ó</button>
        <div class="achievements-header">
          <h2>üèÜ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™</h2>
        </div>
        <div id="achievementsGrid" class="achievements-grid">
          <!-- Achievements will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Quick Challenge Panel -->
    <div class="glass-container mobile-full-width responsive-margin" style="margin-top: 2rem; border: 2px solid rgba(255,105,180,0.3);">
      <h3 class="mobile-text-center" style="color: #ff69b4; text-align: center; margin-bottom: 1rem;">‚ö° ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©</h3>
      <div class="mobile-grid-auto responsive-gap" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div class="mobile-block" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; text-align: center;">
          <div style="font-size: 2rem; margin-bottom: 0.5rem;">üî•</div>
          <h4 style="color: #ff6347; margin-bottom: 0.5rem;">ÿ™ÿ≠ÿØŸä ÿßŸÑÿØŸÇŸäŸÇÿ© ÿßŸÑŸàÿßÿ≠ÿØÿ©</h4>
          <p style="font-size: 0.9rem; margin-bottom: 1rem;">ÿ£ÿ¨ÿ® ÿπŸÑŸâ ÿ£ŸÉÿ®ÿ± ÿπÿØÿØ ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸÅŸä ÿØŸÇŸäŸÇÿ© Ÿàÿßÿ≠ÿØÿ©</p>
          <button class="neural-button touch-target mobile-full-width" onclick="startOneMinuteChallenge()">üöÄ ÿßÿ®ÿØÿ£ ÿßŸÑÿ¢ŸÜ</button>
        </div>
        
        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; text-align: center;">
          <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéØ</div>
          <h4 style="color: #00ff00; margin-bottom: 0.5rem;">ÿ™ÿ≠ÿØŸä ÿßŸÑÿØŸÇÿ©</h4>
          <p style="font-size: 0.9rem; margin-bottom: 1rem;">10 ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ®ÿØŸàŸÜ ÿ£ÿÆÿ∑ÿßÿ°</p>
          <button class="neural-button" onclick="startAccuracyChallenge()">üéØ ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≠ÿØŸä</button>
        </div>
        
        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; text-align: center;">
          <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåü</div>
          <h4 style="color: #ffd700; margin-bottom: 0.5rem;">ÿ™ÿ≠ÿØŸä ÿßŸÑŸÜÿ¨ŸàŸÖ</h4>
          <p style="font-size: 0.9rem; margin-bottom: 1rem;">ÿßÿ¨ŸÖÿπ 50 ŸÜŸÇÿ∑ÿ© ŸÅŸä ÿ£ÿ≥ÿ±ÿπ ŸàŸÇÿ™</p>
          <button class="neural-button" onclick="startStarChallenge()">‚≠ê ÿßÿ®ÿØÿ£ ÿßŸÑÿ¨ŸÖÿπ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Teacher Guide Modal -->
  <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© ÿßŸÑÿ¥ÿßŸÖŸÑÿ© -->
  <div class="modal-overlay settings-modal" id="settingsModal">
      <div class="modal-content settings-content">
          <div class="modal-header settings-header">
              <div class="settings-title-container">
                  <div class="settings-icon-main">‚öôÔ∏è</div>
                  <div>
                      <h2 class="settings-title">ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ</h2>
                      <p class="settings-subtitle">ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©</p>
                  </div>
              </div>
              <button class="close-settings" onclick="closeSettingsModal()">
                  <span>‚úï</span>
              </button>
          </div>
          
          <!-- ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ -->
          <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid rgba(255,215,0,0.3);">
              <button class="settings-tab-btn active" data-tab="game-settings">üéÆ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©</button>
              <button class="settings-tab-btn" data-tab="audio-settings">üéµ ÿßŸÑÿµŸàÿ™</button>
              <button class="settings-tab-btn" data-tab="display-settings">üé® ÿßŸÑÿπÿ±ÿ∂</button>
              <button class="settings-tab-btn" data-tab="class-settings">üë• ÿßŸÑÿµŸÅŸàŸÅ</button>
          </div>
          
          <!-- ÿ™ÿ®ŸàŸäÿ® ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ© -->
          <div class="settings-tab-content active" id="game-settings-content">
              <div class="setting-section">
                  <h3 style="color: #ffd700; margin-bottom: 1rem;">üéØ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©</h3>
                  
                  <div class="setting-item">
                      <label>üìö ÿßŸÑÿµŸÅ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ÿßŸÑŸÖÿÆÿ™ÿßÿ±:</label>
                      <select id="selectedClassDisplay" class="setting-select" disabled>
                          <option value="">-- ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸÅ --</option>
                      </select>
                  </div>
                  
                  <div class="setting-item">
                      <label>‚è±Ô∏è ŸÖÿØÿ© ÿßŸÑÿ™ÿ≠ÿØŸä (ÿ®ÿßŸÑÿ´ŸàÿßŸÜŸä):</label>
                      <select id="challengeDurationSelect" class="setting-select">
                          <option value="30">30 ÿ´ÿßŸÜŸäÿ©</option>
                          <option value="60" selected>60 ÿ´ÿßŸÜŸäÿ©</option>
                          <option value="90">90 ÿ´ÿßŸÜŸäÿ©</option>
                          <option value="120">120 ÿ´ÿßŸÜŸäÿ©</option>
                          <option value="180">180 ÿ´ÿßŸÜŸäÿ©</option>
                      </select>
                  </div>
                  
                  <div class="setting-item">
                      <label>üéØ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿµÿπŸàÿ®ÿ©:</label>
                      <select id="difficultySelect" class="setting-select">
                          <option value="easy">ÿ≥ŸáŸÑ üü¢ - ŸÑŸÑŸÖÿ®ÿ™ÿØÿ¶ŸäŸÜ</option>
                          <option value="medium" selected>ŸÖÿ™Ÿàÿ≥ÿ∑ üü° - ÿßŸÑÿ™Ÿàÿßÿ≤ŸÜ ÿßŸÑŸÖÿ´ÿßŸÑŸä</option>
                          <option value="hard">ÿµÿπÿ® üî¥ - ŸÑŸÑÿÆÿ®ÿ±ÿßÿ°</option>
                          <option value="mixed">ŸÖÿÆÿ™ŸÑÿ∑ üåà - ÿ™ŸÜŸàÿπ ÿßŸÑÿµÿπŸàÿ®ÿ©</option>
                      </select>
                  </div>
                  
                  <div class="setting-item">
                      <label>üèÜ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÜŸÇÿßÿ∑:</label>
                      <select id="scoringSystemSelect" class="setting-select">
                          <option value="standard" selected>ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿπÿßÿØŸä</option>
                          <option value="bonus">ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ ÿßŸÑŸÖÿ∂ÿßÿπŸÅÿ©</option>
                          <option value="penalty">ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆÿµŸÖ ÿπŸÑŸâ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°</option>
                          <option value="time-based">ŸÜÿ∏ÿßŸÖ ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿØÿ±ÿ¨</option>
                      </select>
                  </div>
              </div>
          </div>
          
          <!-- ÿ™ÿ®ŸàŸäÿ® ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸàÿ™ -->
          <div class="settings-tab-content" id="audio-settings-content">
              <div class="setting-section">
                  <h3 style="color: #00ffff; margin-bottom: 1rem;">üéµ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©</h3>
                  
                  <div class="setting-item">
                      <label>üîä ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿµŸàÿ™ ÿßŸÑÿπÿßŸÖ:</label>
                      <input type="range" id="masterVolumeSlider" min="0" max="100" value="50" 
                             style="width: 100%; margin-top: 0.5rem;">
                      <div style="text-align: center; color: #ffd700; margin-top: 0.5rem;">
                          <span id="volumeDisplay">50%</span>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>üéº ÿ£ÿµŸàÿßÿ™ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™:</label>
                      <input type="range" id="effectsVolumeSlider" min="0" max="100" value="70" 
                             style="width: 100%; margin-top: 0.5rem;">
                      <div style="text-align: center; color: #00ffff; margin-top: 0.5rem;">
                          <span id="effectsVolumeDisplay">70%</span>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>üéµ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ ÿßŸÑÿÆŸÑŸÅŸäÿ©:</label>
                      <input type="range" id="musicVolumeSlider" min="0" max="100" value="30" 
                             style="width: 100%; margin-top: 0.5rem;">
                      <div style="text-align: center; color: #ff69b4; margin-top: 0.5rem;">
                          <span id="musicVolumeDisplay">30%</span>
                      </div>
                  </div>
                  
                  <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                      <button class="neural-button" onclick="testAllSounds()" style="flex: 1;">
                          üéº ÿßÿÆÿ™ÿ®ÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™
                      </button>
                      <button class="neural-button secondary" onclick="muteAllSounds()" style="flex: 1;">
                          üîá ŸÉÿ™ŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™
                      </button>
                  </div>
              </div>
          </div>
          
          <!-- ÿ™ÿ®ŸàŸäÿ® ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ -->
          <div class="settings-tab-content" id="display-settings-content">
              <div class="setting-section">
                  <h3 style="color: #ff69b4; margin-bottom: 1rem;">üé® ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ ŸàÿßŸÑŸàÿßÿ¨Ÿáÿ©</h3>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="particlesToggle" checked> 
                          üåå ÿ™ŸÅÿπŸäŸÑ ÿÆŸÑŸÅŸäÿ© ÿßŸÑÿ¨ÿ≥ŸäŸÖÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ©
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="animationsToggle" checked> 
                          ‚ú® ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ©
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="notificationsToggle" checked> 
                          üîî ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿ®ÿµÿ±Ÿäÿ©
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="fullscreenModeToggle"> 
                          ‚õ∂ ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>üé® ŸÜŸÖÿ∑ ÿßŸÑÿ£ŸÑŸàÿßŸÜ:</label>
                      <select id="colorThemeSelect" class="setting-select">
                          <option value="cosmic" selected>ÿßŸÑŸÉŸàŸÜŸä (ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä)</option>
                          <option value="ocean">ÿßŸÑŸÖÿ≠Ÿäÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ŸÇ</option>
                          <option value="sunset">ÿ∫ÿ±Ÿàÿ® ÿßŸÑÿ¥ŸÖÿ≥</option>
                          <option value="forest">ÿßŸÑÿ∫ÿßÿ®ÿ© ÿßŸÑÿÆÿ∂ÿ±ÿßÿ°</option>
                          <option value="royal">ÿßŸÑŸÖŸÑŸÉŸä ÿßŸÑÿ∞Ÿáÿ®Ÿä</option>
                      </select>
                  </div>
              </div>
          </div>
          
          <!-- ÿ™ÿ®ŸàŸäÿ® ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ -->
          <div class="settings-tab-content" id="class-settings-content">
              <div class="setting-section">
                  <h3 style="color: #ffd700; margin-bottom: 1rem;">üë• ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅŸàŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ®</h3>
                  
                  <div class="setting-item">
                      <label>üìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÖŸÑÿ©:</label>
                      <div id="dataStatsDisplay" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; margin-top: 0.5rem;">
                          <div>ÿπÿØÿØ ÿßŸÑÿµŸÅŸàŸÅ: <span id="classesCount">--</span></div>
                          <div>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ∑ŸÑÿßÿ®: <span id="totalStudentsCount">--</span></div>
                          <div>ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: <span id="lastUpdateTime">--</span></div>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>üîÑ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:</label>
                      <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                          <button class="neural-button" onclick="loadClassSelection(); closeSettingsModal();" style="flex: 1;">
                              üéØ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸÅ ÿ¨ÿØŸäÿØ
                          </button>
                          <button class="neural-button" onclick="reloadStudentData()" style="flex: 1;">
                              üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                          </button>
                      </div>
                      <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                          <button class="neural-button secondary" onclick="exportClassData()" style="flex: 1;">
                              ÔøΩ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                          </button>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>‚ö° ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ≥ÿ±Ÿäÿπ:</label>
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.5rem;">
                          <label><input type="checkbox" id="autoSelectAllStudents"> ÿßÿÆÿ™Ÿäÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã</label>
                          <label><input type="checkbox" id="randomizeStudentOrder"> ÿ™ÿ±ÿ™Ÿäÿ® ÿπÿ¥Ÿàÿßÿ¶Ÿä ŸÑŸÑÿ∑ŸÑÿßÿ®</label>
                          <label><input type="checkbox" id="enableQuickStart"> ÿ®ÿØÿ° ÿ≥ÿ±Ÿäÿπ ÿ®ÿØŸàŸÜ ÿ•ÿπÿØÿßÿØ</label>
                          <label><input type="checkbox" id="rememberLastSelection"> ÿ™ÿ∞ŸÉÿ± ÿ¢ÿÆÿ± ÿßÿÆÿ™Ÿäÿßÿ±</label>
                      </div>
                  </div>
              </div>
          </div>
          
          <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ≠ŸÅÿ∏ ŸàÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ -->
          <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1rem; border-top: 2px solid rgba(255,215,0,0.3);">
              <button class="neural-button" onclick="saveAllSettings()" style="flex: 2; background: linear-gradient(45deg, #4facfe, #00f2fe);">
                  üíæ ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
              </button>
              <button class="neural-button secondary" onclick="resetAllSettings()" style="flex: 1;">
                  üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÉŸÑ
              </button>
              <button class="neural-button" onclick="exportSettings()" style="flex: 1; background: linear-gradient(45deg, #43e97b, #38f9d7);">
                  üì§ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
              </button>
          </div>
      </div>
  </div>

  <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ -->
  <div class="modal-overlay stats-modal" id="statsModal">
      <div class="modal-content stats-content">
          <div class="modal-header">
              <h2 style="color: #00ffff; font-size: 1.8rem;">
                  <span>üìä</span>
                  ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™
              </h2>
              <button class="close-settings" onclick="closeStatsModal()">‚úï</button>
          </div>
          
          <div id="statsContent">
              <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ° ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã -->
          </div>
      </div>
  </div>

  <div class="teacher-guide-modal" id="teacherGuideModal">
    <div class="guide-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2 style="color: #ffd700; font-size: 2.5rem;">üìñ ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ - ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©</h2>
        <button class="neural-button" onclick="closeTeacherGuide()" style="background: #ff4444;">‚úñÔ∏è ÿ•ÿ∫ŸÑÿßŸÇ</button>
      </div>

      <div class="guide-section">
        <h3>üéØ ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑŸÜÿ¥ÿßÿ∑</h3>
        <p>ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ© ŸáŸä ŸÖŸÜÿµÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÖÿ™ÿ∑Ÿàÿ±ÿ© ÿ™ŸáÿØŸÅ ÿ•ŸÑŸâ ÿ™ÿ≠ŸÅŸäÿ≤ ÿßŸÑÿ∑ŸÑÿßÿ® Ÿàÿ≤ŸäÿßÿØÿ© ŸÖÿ¥ÿßÿ±ŸÉÿ™ŸáŸÖ ŸÅŸä ÿßŸÑÿ™ÿπŸÑŸÖ ŸÖŸÜ ÿÆŸÑÿßŸÑ:</p>
        <ul>
          <li>ŸÜÿ∏ÿßŸÖ ŸÖŸÖÿßŸÑŸäŸÉ ŸÖÿ™ŸÜŸàÿπÿ© (ÿßŸÑÿ®ÿ±ŸÇÿå ÿßŸÑÿ≠ŸÉŸÖÿ©ÿå ÿßŸÑŸÖÿπÿ±ŸÉÿ©ÿå ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤)</li>
          <li>ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÖÿÆÿ™ŸÑŸÅ ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ™ÿπŸÑŸÖ</li>
          <li>ŸÜÿ∏ÿßŸÖ ŸÜŸÇÿßÿ∑ Ÿàÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ŸÖÿ≠ŸÅÿ≤</li>
          <li>ŸÖÿØÿ±ÿ® ÿ∞ŸÉŸä ŸäŸÇÿØŸÖ ÿßŸÑŸÜÿµÿßÿ¶ÿ≠ ŸàÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™</li>
          <li>ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàÿµŸàÿ™Ÿäÿ© ÿ∫ÿßŸÖÿ±ÿ©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>üöÄ ÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ®ÿØÿ°</h3>
        <p><strong>ÿßŸÑÿÆÿ∑Ÿàÿ© 1: ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ</strong></p>
        <ul>
          <li>ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ŸÖŸÜ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</li>
          <li>ÿ≥ÿ™ÿ∏Ÿáÿ± ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿ¨ŸÖŸäÿπ ÿ∑ŸÑÿßÿ® ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿÆÿ™ÿßÿ±</li>
        </ul>
        
        <p><strong>ÿßŸÑÿÆÿ∑Ÿàÿ© 2: ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ</strong></p>
        <ul>
          <li><strong>ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÉŸÑ:</strong> ŸÑÿ•ÿ¥ÿ±ÿßŸÉ ÿ¨ŸÖŸäÿπ ÿ∑ŸÑÿßÿ® ÿßŸÑÿµŸÅ</li>
          <li><strong>ÿßÿÆÿ™Ÿäÿßÿ± ÿπÿ¥Ÿàÿßÿ¶Ÿä:</strong> ŸÑŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿä ÿßŸÑÿ≥ÿ±Ÿäÿπ</li>
          <li><strong>ÿßÿÆÿ™Ÿäÿßÿ± ÿπÿØÿØ ŸÖÿ≠ÿØÿØ:</strong> ŸÑÿ™ÿ≠ÿØŸäÿØ ÿπÿØÿØ ŸÖÿπŸäŸÜ ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿßÿ®</li>
          <li><strong>ÿßÿÆÿ™Ÿäÿßÿ± ŸäÿØŸàŸä:</strong> ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ±ÿ∫Ÿàÿ®ŸäŸÜ</li>
        </ul>

        <p><strong>ÿßŸÑÿÆÿ∑Ÿàÿ© 3: ÿ®ÿØÿ° ÿßŸÑŸÜÿ¥ÿßÿ∑</strong></p>
        <ul>
          <li>ÿßŸÜŸÇÿ± ÿπŸÑŸâ "ÿ®ÿØÿ° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™" ÿ®ÿπÿØ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ®</li>
          <li>ÿ≥ÿ™ÿ∏Ÿáÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÑŸÑŸÜÿ¥ÿßÿ∑</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>‚öîÔ∏è ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h3>
        
        <p><strong>‚ö° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ:</strong></p>
        <ul>
          <li>ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ© ÿ™ÿ±ŸÉÿ≤ ÿπŸÑŸâ ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ™ŸÅŸÉŸäÿ±</li>
          <li>ŸÖÿØÿ© ŸÇÿµŸäÿ±ÿ© (30-60 ÿ´ÿßŸÜŸäÿ©)</li>
          <li>ŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÑÿ•ÿ≠ŸÖÿßÿ° ŸàŸÉÿ≥ÿ± ÿßŸÑÿ¨ŸÑŸäÿØ</li>
        </ul>

        <p><strong>üß† ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©:</strong></p>
        <ul>
          <li>ÿ™ÿ≠ÿØŸäÿßÿ™ ŸÅŸÉÿ±Ÿäÿ© ÿπŸÖŸäŸÇÿ© ÿ™ÿ™ÿ∑ŸÑÿ® ÿßŸÑÿ™ÿ£ŸÖŸÑ</li>
          <li>ÿ™ÿ∑ŸàŸäÿ± ŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑŸÜŸÇÿØŸä</li>
          <li>ŸàŸÇÿ™ ÿ£ÿ∑ŸàŸÑ ŸÑŸÑÿ™ŸÅŸÉŸäÿ± ŸàÿßŸÑŸÖŸÜÿßŸÇÿ¥ÿ©</li>
        </ul>

        <p><strong>‚öîÔ∏è ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©:</strong></p>
        <ul>
          <li>ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ¨ŸÖÿßÿπŸäÿ© ÿ®ŸäŸÜ ÿßŸÑŸÅÿ±ŸÇ</li>
          <li>ÿ™ÿπÿ≤Ÿäÿ≤ ÿ±Ÿàÿ≠ ÿßŸÑÿ™ÿπÿßŸàŸÜ ŸàÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ© ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©</li>
          <li>ŸÜÿ∏ÿßŸÖ ŸÜŸÇÿßÿ∑ Ÿàÿ∑ÿßŸÇÿ© ÿ™ŸÅÿßÿπŸÑŸä</li>
        </ul>

        <p><strong>üîÆ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤:</strong></p>
        <ul>
          <li>ÿ£ŸÑÿ∫ÿßÿ≤ ŸàŸÖÿ¥ÿßŸÉŸÑ ÿ™ÿ™ÿ∑ŸÑÿ® ÿ≠ŸÑŸàŸÑ ÿ•ÿ®ÿØÿßÿπŸäÿ©</li>
          <li>ÿ™ŸÜŸÖŸäÿ© ŸÖŸáÿßÿ±ÿßÿ™ ÿ≠ŸÑ ÿßŸÑŸÖÿ¥ŸÉŸÑÿßÿ™</li>
          <li>ÿ™ÿ≠ÿØŸäÿßÿ™ ŸÖÿ™ÿØÿ±ÿ¨ÿ© ÿßŸÑÿµÿπŸàÿ®ÿ©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>üéÆ ÿ•ÿØÿßÿ±ÿ© ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©</h3>
        <p><strong>ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÅÿ±ŸÇ:</strong></p>
        <ul>
          <li>Ÿäÿ™ŸÖ ÿ™ŸÉŸàŸäŸÜ ÿßŸÑŸÅÿ±ŸÇ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ</li>
          <li>ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸÑŸá ÿßÿ≥ŸÖ Ÿàÿ£ŸäŸÇŸàŸÜÿ© ŸÖŸÖŸäÿ≤ÿ©</li>
          <li>ŸÜÿ∏ÿßŸÖ ÿ∑ÿßŸÇÿ© Ÿàÿµÿ≠ÿ© ŸÑŸÑŸÅÿ±ŸÇ</li>
        </ul>

        <p><strong>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÜŸÇÿßÿ∑:</strong></p>
        <ul>
          <li><strong>ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ© (‚¨ÜÔ∏è):</strong> ÿπŸÜÿØ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ÿ£Ÿà ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©</li>
          <li><strong>ÿÆÿµŸÖ ŸÜŸÇÿ∑ÿ© (‚¨áÔ∏è):</strong> ÿπŸÜÿØ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿÆÿßÿ∑ÿ¶ÿ© ÿ£Ÿà ÿßŸÑÿ≥ŸÑŸàŸÉ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ±ÿ∫Ÿàÿ®</li>
          <li><strong>ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖÿ∂ÿßÿπŸÅÿ©:</strong> ÿ™ÿ≠ÿØÿ´ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÅŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿÆÿßÿµÿ©</li>
        </ul>

        <p><strong>ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©:</strong></p>
        <ul>
          <li>ÿ™ÿ≠ÿØÿ´ ŸÉŸÑ 30 ÿ´ÿßŸÜŸäÿ© ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ©</li>
          <li>ÿ™ÿ∂ŸäŸÅ ÿπŸÜÿµÿ± ÿßŸÑŸÖŸÅÿßÿ¨ÿ£ÿ© ŸàÿßŸÑÿ•ÿ´ÿßÿ±ÿ©</li>
          <li>ÿ™ÿ¥ŸÖŸÑ: ÿ∑ÿßŸÇÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©ÿå ŸÜŸÇÿßÿ∑ ŸÖÿ∂ÿßÿπŸÅÿ©ÿå ŸÖŸÉÿßŸÅÿ¢ÿ™ ÿÆÿßÿµÿ©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ü§ñ ÿßŸÑŸÖÿØÿ±ÿ® ÿßŸÑÿ∞ŸÉŸä</h3>
        <p>ŸäŸÇÿØŸÖ ÿßŸÑŸÖÿØÿ±ÿ® ÿßŸÑÿ∞ŸÉŸä:</p>
        <ul>
          <li><strong>ŸÜÿµÿßÿ¶ÿ≠ ÿ∞ŸÉŸäÿ©:</strong> ÿ™Ÿàÿ¨ŸäŸáÿßÿ™ ŸÖŸÅŸäÿØÿ© ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸÜÿ¥ÿßÿ∑</li>
          <li><strong>ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿØÿßÿ°:</strong> ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÖŸÅÿµŸÑÿ© ÿπŸÜ ÿ£ÿØÿßÿ° ÿßŸÑÿ∑ŸÑÿßÿ®</li>
          <li><strong>ÿ™ÿ≠ŸÅŸäÿ≤ ÿ•Ÿäÿ¨ÿßÿ®Ÿä:</strong> ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÖÿ≠ŸÅÿ≤ÿ© ŸàŸÖÿ¥ÿ¨ÿπÿ©</li>
          <li><strong>ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ÿ™ÿ≠ÿ≥ŸäŸÜ:</strong> ŸÜÿµÿßÿ¶ÿ≠ ŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿ£ÿØÿßÿ°</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>üìä ÿßŸÑÿ™ŸÇŸäŸäŸÖ ŸàÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©</h3>
        <p><strong>ŸÖÿ§ÿ¥ÿ±ÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ°:</strong></p>
        <ul>
          <li>ŸàŸÇÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</li>
          <li>ÿπÿØÿØ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©</li>
          <li>ŸÖÿ≥ÿ™ŸàŸâ ÿ∑ÿßŸÇÿ© ÿßŸÑÿ∑ŸÑÿßÿ®</li>
          <li>ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑŸÉŸÑ ÿØŸÇŸäŸÇÿ©</li>
        </ul>

        <p><strong>ŸÜÿµÿßÿ¶ÿ≠ ŸÑŸÑÿ™ŸÇŸäŸäŸÖ:</strong></p>
        <ul>
          <li>ÿ±ÿßŸÇÿ® ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ∑ŸÑÿßÿ® Ÿàÿ™ŸÅÿßÿπŸÑŸáŸÖ</li>
          <li>ŸÑÿßÿ≠ÿ∏ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ≠ŸÖÿßÿ≥ ŸàÿßŸÑÿßŸÜÿÆÿ±ÿßÿ∑</li>
          <li>ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÉÿ£ÿØÿßÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸàŸÑŸäÿ≥ ÿ™ŸÇŸäŸäŸÖŸäÿ© ŸÅŸÇÿ∑</li>
          <li>ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ÿπÿßŸàŸÜ ŸàÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑŸÖÿ™ÿ®ÿßÿØŸÑÿ©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>üí° ŸÜÿµÿßÿ¶ÿ≠ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ£ŸÖÿ´ŸÑ</h3>
        <ul>
          <li><strong>ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±:</strong> ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπŸÖŸÑ ÿßŸÑÿµŸàÿ™ Ÿàÿ¨ŸàÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ</li>
          <li><strong>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸàŸÇÿ™:</strong> ÿÆÿµÿµ 5-10 ÿØŸÇÿßÿ¶ŸÇ ŸÑŸÉŸÑ ÿ™ÿ≠ÿØŸä</li>
          <li><strong>ÿßŸÑÿ™ŸÜŸàŸäÿπ:</strong> ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÖÿßŸÑŸäŸÉ ŸÖÿÆÿ™ŸÑŸÅÿ© ŸÑÿ™ŸÜŸàŸäÿπ ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©</li>
          <li><strong>ÿßŸÑÿ™ŸÅÿßÿπŸÑ:</strong> ÿ¥ÿßÿ±ŸÉ ŸÖÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ŸàŸÉŸÜ ŸÖÿ™ÿ≠ŸÖÿ≥ÿßŸã</li>
          <li><strong>ÿßŸÑŸÖÿ±ŸàŸÜÿ©:</strong> ŸäŸÖŸÉŸÜ ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÇŸàÿßÿπÿØ ÿ≠ÿ≥ÿ® ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿµŸÅ</li>
          <li><strong>ÿßŸÑÿÆÿ™ÿßŸÖ:</strong> ÿßÿÆÿ™ÿ™ŸÖ ÿ®ÿ™ŸáŸÜÿ¶ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>üîß ÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°</h3>
        <p><strong>ŸÖÿ¥ÿßŸÉŸÑ ÿ¥ÿßÿ¶ÿπÿ© Ÿàÿ≠ŸÑŸàŸÑŸáÿß:</strong></p>
        <ul>
          <li><strong>ÿπÿØŸÖ ÿπŸÖŸÑ ÿßŸÑÿµŸàÿ™:</strong> ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸàÿßŸÑÿµŸàÿ™</li>
          <li><strong>ÿ®ÿ∑ÿ° ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ:</strong> ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™</li>
          <li><strong>ÿπÿØŸÖ ÿ∏ŸáŸàÿ± ÿßŸÑÿ∑ŸÑÿßÿ®:</strong> ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖŸÑŸÅ studentData.json</li>
          <li><strong>ŸÖÿ¥ÿßŸÉŸÑ ŸÅŸä ÿßŸÑÿπÿ±ÿ∂:</strong> ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ™ÿµŸÅÿ≠ ÿ≠ÿØŸäÿ´ (Chrome, Firefox, Edge)</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>üéØ ÿ£ŸáÿØÿßŸÅ ÿ™ÿπŸÑŸäŸÖŸäÿ©</h3>
        <p>Ÿäÿ≥ÿßÿπÿØ Ÿáÿ∞ÿß ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿπŸÑŸâ ÿ™ÿ≠ŸÇŸäŸÇ:</p>
        <ul>
          <li>ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿØÿßŸÅÿπŸäÿ© ŸÑŸÑÿ™ÿπŸÑŸÖ</li>
          <li>ÿ™ÿ∑ŸàŸäÿ± ŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑŸÜŸÇÿØŸä</li>
          <li>ÿ™ÿπÿ≤Ÿäÿ≤ ÿ±Ÿàÿ≠ ÿßŸÑŸÅÿ±ŸäŸÇ ŸàÿßŸÑÿ™ÿπÿßŸàŸÜ</li>
          <li>ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ´ŸÇÿ© ÿ®ÿßŸÑŸÜŸÅÿ≥</li>
          <li>ÿ±ÿ®ÿ∑ ÿßŸÑÿ™ÿπŸÑŸÖ ÿ®ÿßŸÑŸÖÿ™ÿπÿ© ŸàÿßŸÑÿ•ÿ´ÿßÿ±ÿ©</li>
          <li>ÿ™ÿ∑ŸàŸäÿ± ŸÖŸáÿßÿ±ÿßÿ™ ÿ≠ŸÑ ÿßŸÑŸÖÿ¥ŸÉŸÑÿßÿ™</li>
        </ul>
      </div>
    </div>
  </div>

<script>
// ===== GLOBAL VARIABLES =====
let gameState = {
  currentRealm: null,
  isActive: false,
  completedChallenges: 0,
  energyLevel: 100,
  soundEnabled: true,
  teams: [],
  battleTimer: null,
  battleDuration: 0,
  selectedClass: null,
  selectedStudents: [],
  gameStarted: false,
  waitingForAnswer: false,  // ŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ®ÿ±ŸÇ
  // Session functionality removed
};

// ===== TEACHER CONVENIENCE SYSTEM =====
// ŸÜÿ∏ÿßŸÖ ÿ±ÿßÿ≠ÿ© ÿßŸÑŸÖÿπŸÑŸÖ - ÿ≠ŸÅÿ∏ Ÿàÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™
// Session functions removed - previous functionality disabled

// Function placeholders to maintain code structure
function saveTeacherSession() {
  // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑŸÖÿπŸÑŸÖ ŸàÿßŸÑÿ∑ŸÑÿßÿ®
  const sessionData = {
    selectedClass: gameState.selectedClass,
    selectedStudents: gameState.selectedStudents || selectedStudentsList || [],
    timestamp: new Date().toISOString(),
    gameStarted: gameState.gameStarted,
    totalQuestions: gameState.totalQuestions,
    currentLevel: gameState.currentLevel,
    difficulty: gameState.difficulty,
    sessionId: generateSessionId()
  };
  
  // ÿ≠ŸÅÿ∏ ŸÅŸä ÿπÿØÿ© ŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
  localStorage.setItem('kingdomGameState', JSON.stringify(sessionData));
  localStorage.setItem('kingdomSettingsAdvanced', JSON.stringify(sessionData));
  localStorage.setItem('teacherSession', JSON.stringify(sessionData));
  
  console.log('üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿπŸÑŸÖ:', sessionData);
  return sessionData;
}

function generateSessionId() {
  return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

function loadTeacherSession() {
  // Session loading functionality removed  
  return null;
}

function restoreTeacherSession(session) {
  // Session restoration functionality removed
  showQuantumNotification('üîÑ ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©', 
    `ÿßÿ≥ÿ™ŸèÿπŸäÿØÿ™ ÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ŸÉ: ${session.selectedClass} (${session.selectedStudents.length} ÿ∑ŸÑÿßÿ®)`, 
    'info');
}

function clearTeacherSession() {
  // Session clearing functionality removed - no longer needed
  gameState.selectedClass = null;
  selectedStudentsList = [];
  gameState.selectedStudents = [];
  
  showQuantumNotification('üóëÔ∏è ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™', 
    'ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©ÿå ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ', 
    'info');
  
  // Session button update removed
}

// ÿπÿ±ÿ∂ ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÑŸÑŸÖÿπŸÑŸÖ
function showTeacherSessionOptions(savedSession) {
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖÿ≠ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿ£ÿÆÿ±Ÿâ
  document.getElementById('kingdomContent').style.display = 'none';
  document.getElementById('selectionPanel').style.display = 'none';
  
  // ÿ•ŸÜÿ¥ÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
  let sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
  if (!sessionOptionsPanel) {
    sessionOptionsPanel = document.createElement('div');
    sessionOptionsPanel.id = 'sessionOptionsPanel';
    sessionOptionsPanel.className = 'glass-container';
    mainApp.appendChild(sessionOptionsPanel);
  }
  
  sessionOptionsPanel.style.display = 'block';
  sessionOptionsPanel.innerHTML = `
    <div style="text-align: center; padding: 3rem; max-width: 600px; margin: 0 auto;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">üíæ</div>
      <h2 style="color: #ffd700; margin-bottom: 1rem; font-size: 2.5rem;">
        ŸÖÿ±ÿ≠ÿ®ÿßŸã ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ! üëã
      </h2>
      <p style="color: rgba(255,255,255,0.9); font-size: 1.3rem; margin-bottom: 2rem;">
        ŸÑÿØŸäŸÉ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÖŸÜ ŸÇÿ®ŸÑ
      </p>
      
      <!-- ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© -->
      <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.3); 
                  border-radius: 15px; padding: 2rem; margin-bottom: 2rem;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üìö ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©:</h3>
        <div style="display: grid; gap: 1rem; text-align: right;">
          <div>
            <strong style="color: #4facfe;">ÿßŸÑÿµŸÅ:</strong> 
            <span style="color: #ffd700; font-size: 1.2rem;">${savedSession.selectedClass}</span>
          </div>
          <div>
            <strong style="color: #4facfe;">ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®:</strong> 
            <span style="color: #ffd700; font-size: 1.2rem;">${savedSession.selectedStudents.length} ÿ∑ÿßŸÑÿ®</span>
          </div>
          <div>
            <strong style="color: #4facfe;">ÿßŸÑÿ∑ŸÑÿßÿ®:</strong>
            <div style="color: rgba(255,255,255,0.9); margin-top: 0.5rem; 
                        max-height: 120px; overflow-y: auto; font-size: 0.9rem;">
              ${savedSession.selectedStudents.join(' ‚Ä¢ ')}
            </div>
          </div>
        </div>
      </div>
      
      <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ -->
      <div style="display: grid; gap: 1rem; max-width: 400px; margin: 0 auto;">
        <button class="neural-button" onclick="continueWithSavedSession()" 
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
                       font-size: 1.1rem; padding: 1rem;">
          ‚úÖ ŸÖÿ™ÿßÿ®ÿπÿ© ŸÖÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ŸäŸÜ
        </button>
        
        <button class="neural-button" onclick="startFreshSession()" 
                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); 
                       font-size: 1.1rem; padding: 1rem;">
          üÜï ÿ®ÿØÿ° ÿ¨ŸÑÿ≥ÿ© ÿ¨ÿØŸäÿØÿ©
        </button>
        
        <button class="neural-button" onclick="viewSavedStudents()" 
                style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); 
                       font-size: 0.9rem; padding: 0.8rem;">
          üëÄ ÿπÿ±ÿ∂ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ŸäŸÜ
        </button>
      </div>
      
      <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 2rem;">
        üí° ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ ÿ≥ŸäŸèÿ≠ŸÅÿ∏ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÑÿ±ÿßÿ≠ÿ™ŸÉ ŸÅŸä ÿßŸÑŸÖÿ±ÿßÿ™ ÿßŸÑŸÇÿßÿØŸÖÿ©
      </p>
    </div>
  `;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ©
  playCosmicSound('notification-pop');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ®
  setTimeout(() => {
    showQuantumNotification('üíæ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©!', 
      'ŸàŸèÿ¨ÿØÿ™ ÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ŸÉ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©. ÿßÿÆÿ™ÿ± ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿ£Ÿà ÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ', 
      'info');
  }, 500);
}

// ŸÖÿ™ÿßÿ®ÿπÿ© ŸÖÿπ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
function continueWithSavedSession() {
  const savedSession = loadTeacherSession();
  if (savedSession) {
    restoreTeacherSession(savedSession);
    
    // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
    const sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
    if (sessionOptionsPanel) {
      sessionOptionsPanel.style.display = 'none';
    }
    
    // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
    showKingdoms();
    
    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ©
    playCosmicSound('success-chime');
    
    // ÿ•ÿ¥ÿπÿßÿ± ÿ•ÿ∂ÿßŸÅŸä
    setTimeout(() => {
      showQuantumNotification('üöÄ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßŸÜÿ∑ŸÑÿßŸÇ!', 
        'ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿ¨ŸÑÿ≥ÿ™ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠. ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ£Ÿä ŸÖŸÖŸÑŸÉÿ©!', 
        'success');
    }, 1000);
  } else {
    console.error('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©');
    startFreshSession();
  }
}

// ÿ®ÿØÿ° ÿ¨ŸÑÿ≥ÿ© ÿ¨ÿØŸäÿØÿ©
function startFreshSession() {
  // ŸÖÿ≥ÿ≠ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÇÿØŸäŸÖÿ©
  clearTeacherSession();
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
  const sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
  if (sessionOptionsPanel) {
    sessionOptionsPanel.style.display = 'none';
  }
  
  // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ
  proceedToClassSelection();
  
  playCosmicSound('cosmic-click');
}

// ÿπÿ±ÿ∂ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ŸäŸÜ
function viewSavedStudents() {
  const savedSession = loadTeacherSession();
  if (!savedSession) return;
  
  const sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
  
  sessionOptionsPanel.innerHTML = `
    <div style="text-align: center; padding: 3rem; max-width: 700px; margin: 0 auto;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
      <h2 style="color: #ffd700; margin-bottom: 2rem;">
        ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
      </h2>
      
      <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.3); 
                  border-radius: 15px; padding: 2rem; margin-bottom: 2rem; text-align: right;">
        <h3 style="color: #4facfe; margin-bottom: 1rem;">üìö ${savedSession.selectedClass}</h3>
        <div style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">
          ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ≠ŸÅÿ∏: ${new Date(savedSession.timestamp).toLocaleString('ar-SA')}
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                    gap: 1rem; margin-top: 1.5rem;">
          ${savedSession.selectedStudents.map((student, index) => `
            <div style="background: rgba(79, 172, 254, 0.1); border: 1px solid rgba(79, 172, 254, 0.3);
                        border-radius: 10px; padding: 1rem; text-align: center;">
              <div style="font-size: 2rem; margin-bottom: 0.5rem;">üë®‚Äçüéì</div>
              <div style="color: #ffd700; font-weight: bold;">${student}</div>
              <div style="color: rgba(255,255,255,0.6); font-size: 0.8rem;">ÿßŸÑÿ∑ÿßŸÑÿ® ÿ±ŸÇŸÖ ${index + 1}</div>
            </div>
          `).join('')}
        </div>
      </div>
      
      <div style="display: grid; gap: 1rem; max-width: 400px; margin: 0 auto;">
        <button class="neural-button" onclick="continueWithSavedSession()" 
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          ‚úÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Ÿáÿ§ŸÑÿßÿ° ÿßŸÑÿ∑ŸÑÿßÿ®
        </button>
        
        <button class="neural-button" onclick="showTeacherSessionOptions(loadTeacherSession())" 
                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          ‚Ü©Ô∏è ÿ±ÿ¨Ÿàÿπ ŸÑŸÑÿÆŸäÿßÿ±ÿßÿ™
        </button>
      </div>
    </div>
  `;
  
  playCosmicSound('cosmic-click');
}

// ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ (ÿßŸÑÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ©)
function proceedToClassSelection() {
  // Show main app container
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä');
  }
  
  // Hide main dashboard
  document.getElementById('kingdomContent').style.display = 'none';
  
  // Show selection panel
  document.getElementById('selectionPanel').style.display = 'block';
  
  const classGrid = document.getElementById('classGrid');
  if (!classGrid) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ classGrid');
    return;
  }
  
  classGrid.innerHTML = '';
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
  if (!studentData || Object.keys(studentData).length === 0) {
    console.warn('‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∑ŸÑÿßÿ®');
    classGrid.innerHTML = `
      <div style="text-align: center; color: #ff6b6b; padding: 2rem; grid-column: 1 / -1;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
        <h3>ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®</h3>
        <p>ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
        <button class="neural-button" onclick="reloadStudentData()" style="margin-top: 1rem;">
          üîÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        </button>
      </div>
    `;
    
    // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    setTimeout(() => {
      initializeEmbeddedStudentData();
      if (Object.keys(studentData).length > 0) {
        proceedToClassSelection(); // ÿ•ÿπÿßÿØÿ© ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ© ÿ®ÿπÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
      }
    }, 1000);
    return;
  }
  
  // ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅŸàŸÅ
  Object.keys(studentData).forEach(className => {
    const classCard = document.createElement('div');
    classCard.className = 'class-card';
    classCard.onclick = () => selectClass(className);
    
    classCard.innerHTML = `
      <div class="class-icon">üìö</div>
      <h3>${className}</h3>
      <p>${studentData[className].length} ÿ∑ÿßŸÑÿ®</p>
      <div class="class-hover-effect"></div>
    `;
    
    classGrid.appendChild(classCard);
  });
  
  playCosmicSound('panel-slide');
}

let studentData = {};
let selectedStudentsList = [];

// ===== ENHANCED STUDENT MANAGEMENT SYSTEM =====
function loadClassSelection() {
  console.log('üéì ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅŸàŸÅ');
  console.log('üìä ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©:', Object.keys(studentData));
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸäŸÜ ŸÖÿ≥ÿ®ŸÇÿßŸã
  if (selectedStudentsList && selectedStudentsList.length > 0) {
    console.log('üìã ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸàŸÜ ŸÖÿ≥ÿ®ŸÇÿßŸã:', selectedStudentsList);
    gameState.selectedStudents = [...selectedStudentsList];
  }
  
  // Show main app container
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä');
  }
  
  // Hide main dashboard
  document.getElementById('kingdomContent').style.display = 'none';
  
  // Show selection panel
  document.getElementById('selectionPanel').style.display = 'block';
  
  const classGrid = document.getElementById('classGrid');
  if (!classGrid) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ classGrid');
    return;
  }
  
  classGrid.innerHTML = '';
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
  if (!studentData || Object.keys(studentData).length === 0) {
    console.warn('‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∑ŸÑÿßÿ®');
    classGrid.innerHTML = `
      <div style="text-align: center; color: #ff6b6b; padding: 2rem; grid-column: 1 / -1;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
        <h3>ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®</h3>
        <p>ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
        <button class="neural-button" onclick="reloadStudentData()" style="margin-top: 1rem;">
          üîÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        </button>
      </div>
    `;
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    loadStudentData().then(() => {
      loadClassSelection(); // ÿ•ÿπÿßÿØÿ© ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ© ÿ®ÿπÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    }).catch(error => {
      console.error('‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
    });
    return;
  }
  
  const classNames = Object.keys(studentData);
  console.log(`üìö ÿ™ÿ≠ŸÖŸäŸÑ ${classNames.length} ÿµŸÅŸàŸÅ:`, classNames);
  
  classNames.forEach(className => {
    const classCard = document.createElement('div');
    classCard.className = 'class-card';
    classCard.style.cursor = 'pointer';
    
    // ÿ±ÿ®ÿ∑ ÿßŸÑÿ≠ÿØÿ´ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©
    classCard.addEventListener('click', function() {
      console.log('üñ±Ô∏è ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿµŸÅ:', className);
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä ŸÅŸàÿ±Ÿä
      this.style.transform = 'scale(0.95)';
      setTimeout(() => {
        this.style.transform = '';
      }, 150);
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿµŸàÿ™Ÿä
      playCosmicSound('button-click', { volume: 0.3 });
      
      // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿØÿßŸÑÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
      selectClass(className);
    });
    
    const studentCount = studentData[className].length;
    
    classCard.innerHTML = `
      <div style="font-size: 3rem; margin-bottom: 1rem;">üè´</div>
      <h4 style="margin: 0; color: #ffd700;">${className}</h4>
      <div class="student-count" style="color: #00ffff; margin-top: 0.5rem;">${studentCount} ÿ∑ÿßŸÑÿ®</div>
    `;
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ hover
    classCard.addEventListener('mouseenter', () => {
      playCosmicSound('button-hover', { volume: 0.2 });
    });
    
    classGrid.appendChild(classCard);
  });
  
  playCosmicSound('panel-slide');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ£ŸÉŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅŸàŸÅ
  showQuantumNotification(
    `üìö ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${Object.keys(studentData).length} ÿµŸÅŸàŸÅ`,
    'ÿßÿÆÿ™ÿ± ÿµŸÅŸÉ ŸÑÿ®ÿØÿ° ÿßŸÑŸÖÿ∫ÿßŸÖÿ±ÿ©',
    'success'
  );
  
  console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®
async function reloadStudentData() {
  showQuantumNotification('üîÑ ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...', '', 'info');
  
  try {
    await loadStudentData();
    loadClassSelection();
    showQuantumNotification('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠', '', 'success');
  } catch (error) {
    showQuantumNotification('‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©', 'error');
  }
}

function selectClass(className) {
  gameState.selectedClass = className;
  
  console.log('üéì ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ:', className);
  
  // Update visual selection
  document.querySelectorAll('.class-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  // Find and select the clicked card
  const clickedCard = Array.from(document.querySelectorAll('.class-card')).find(card => 
    card.textContent.includes(className)
  );
  if (clickedCard) {
    clickedCard.classList.add('selected');
  }
  
  // Load students for selected class
  loadStudentSelection(className);
  
  // Show student selection section
  const studentSection = document.getElementById('studentSelectionSection');
  if (studentSection) {
    studentSection.style.display = 'block';
    
    // Scroll to student selection
    studentSection.scrollIntoView({ 
      behavior: 'smooth' 
    });
  }
  
  // Play selection sound
  playCosmicSound('cosmic-click');
  
  // Show success notification
  showQuantumNotification(
    `‚úÖ ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸÅ ${className}`,
    `${studentData[className]?.length || 0} ÿ∑ÿßŸÑÿ® ŸÖÿ™ÿßÿ≠`,
    'success'
  );
}

function loadStudentSelection(className) {
  console.log('üìö ÿ™ÿ≠ŸÖŸäŸÑ ÿ∑ŸÑÿßÿ® ÿßŸÑÿµŸÅ:', className);
  console.log('üìä ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®:', studentData[className]);
  
  const studentsGrid = document.getElementById('studentsGrid');
  if (!studentsGrid) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ studentsGrid');
    return;
  }
  
  studentsGrid.innerHTML = '';
  
  selectedStudentsList = []; // Reset selection
  updateSelectedCount();
  
  const students = studentData[className] || [];
  
  if (students.length === 0) {
    studentsGrid.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; color: #ff6b6b; padding: 2rem;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
        <h3>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∑ŸÑÿßÿ® ŸÑŸáÿ∞ÿß ÿßŸÑÿµŸÅ</h3>
        <p>ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖŸÑŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</p>
      </div>
    `;
    return;
  }
  
  console.log(`üë• ÿ™ÿ≠ŸÖŸäŸÑ ${students.length} ÿ∑ÿßŸÑÿ®`);
  
  students.forEach((studentName, index) => {
    console.log(`üë§ ÿ•ŸÜÿ¥ÿßÿ° ÿ®ÿ∑ÿßŸÇÿ© ŸÑŸÑÿ∑ÿßŸÑÿ®: ${studentName} (ÿßŸÑŸÅŸáÿ±ÿ≥: ${index})`);
    
    const studentCard = document.createElement('div');
    studentCard.className = 'student-card';
    studentCard.dataset.studentName = studentName;
    studentCard.dataset.studentIndex = index;
    
    // ÿ±ÿ®ÿ∑ ÿßŸÑÿ≠ÿØÿ´ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ© ŸàŸÖŸÅÿµŸÑÿ©
    studentCard.addEventListener('click', function(event) {
      console.log('üñ±Ô∏è ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ∑ÿßŸÑÿ®:', studentName);
      console.log('üéØ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑŸÖŸÜŸÇŸàÿ±:', this);
      event.preventDefault();
      event.stopPropagation();
      toggleStudentSelection(this, studentName);
    });
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± hover
    studentCard.addEventListener('mouseenter', function() {
      console.log('üé≠ ŸÖÿ±Ÿàÿ± ÿßŸÑŸÖÿßŸàÿ≥ ÿπŸÑŸâ ÿ®ÿ∑ÿßŸÇÿ©:', studentName);
      playCosmicSound('button-hover', { volume: 0.1 });
    });
    
    studentCard.innerHTML = `
      <div class="selection-indicator">‚óã</div>
      <div class="student-name">${studentName}</div>
    `;
    
    console.log('‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ∑ÿßŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠');
    studentsGrid.appendChild(studentCard);
  });
  
  playCosmicSound('magic-sparkle');
  console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠');
}

function toggleStudentSelection(cardElement, studentName) {
  console.log('üéØ ÿ®ÿØÿ° ÿ™ÿ®ÿØŸäŸÑ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ÿßŸÑÿ®:', studentName);
  console.log('üìã ÿπŸÜÿµÿ± ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©:', cardElement);
  
  if (!cardElement) {
    console.error('‚ùå ÿπŸÜÿµÿ± ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ');
    return;
  }
  
  if (!studentName) {
    console.error('‚ùå ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ');
    return;
  }
  
  const isSelected = cardElement.classList.contains('selected');
  console.log('üîç ŸáŸÑ ÿßŸÑÿ∑ÿßŸÑÿ® ŸÖÿ≠ÿØÿØ ÿ≠ÿßŸÑŸäÿßŸãÿü', isSelected);
  
  const selectionIndicator = cardElement.querySelector('.selection-indicator');
  if (!selectionIndicator) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±');
    return;
  }
  
  if (isSelected) {
    // Deselect
    console.log('‚ûñ ÿ•ŸÑÿ∫ÿßÿ° ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ∑ÿßŸÑÿ®');
    cardElement.classList.remove('selected');
    selectionIndicator.textContent = '‚óã';
    selectedStudentsList = selectedStudentsList.filter(name => name !== studentName);
    playCosmicSound('button-hover');
  } else {
    // Select
    console.log('‚ûï ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ∑ÿßŸÑÿ®');
    cardElement.classList.add('selected');
    selectionIndicator.textContent = '‚úì';
    selectedStudentsList.push(studentName);
    playCosmicSound('point-earn');
  }
  
  console.log('üìä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ŸÑŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿØÿØŸäŸÜ:', selectedStudentsList);
  updateSelectedCount();
  
  // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ
  cardElement.style.transform = 'scale(1.05)';
  setTimeout(() => {
    cardElement.style.transform = '';
  }, 200);
}

function selectAllStudents() {
  const studentCards = document.querySelectorAll('.student-card');
  selectedStudentsList = [];
  
  studentCards.forEach(card => {
    card.classList.add('selected');
    card.querySelector('.selection-indicator').textContent = '‚úì';
    selectedStudentsList.push(card.dataset.studentName);
  });
  
  updateSelectedCount();
  playCosmicSound('achievement-unlock');
}

function clearAllStudents() {
  const studentCards = document.querySelectorAll('.student-card');
  selectedStudentsList = [];
  
  studentCards.forEach(card => {
    card.classList.remove('selected');
    card.querySelector('.selection-indicator').textContent = '‚óã';
  });
  
  updateSelectedCount();
  playCosmicSound('cosmic-click');
}

function selectRandomStudents() {
  clearAllStudents();
  
  const studentCards = Array.from(document.querySelectorAll('.student-card'));
  const randomCount = Math.min(8, Math.max(4, Math.floor(studentCards.length * 0.4)));
  
  // Shuffle and select random students
  const shuffled = studentCards.sort(() => 0.5 - Math.random());
  const selected = shuffled.slice(0, randomCount);
  
  selected.forEach(card => {
    card.classList.add('selected');
    card.querySelector('.selection-indicator').textContent = '‚úì';
    selectedStudentsList.push(card.dataset.studentName);
  });
  
  updateSelectedCount();
  playSoundSequence(['cosmic-explosion', 'point-earn'], 300);
}

function quickSelectCount() {
  const studentCards = document.querySelectorAll('.student-card');
  const maxCount = studentCards.length;
  
  const count = parseInt(prompt(`ŸÉŸÖ ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿÆÿ™Ÿäÿßÿ±ŸáŸÖÿü (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ: ${maxCount})`, '6'));
  
  if (count && count > 0 && count <= maxCount) {
    clearAllStudents();
    
    const shuffled = Array.from(studentCards).sort(() => 0.5 - Math.random());
    const selected = shuffled.slice(0, count);
    
    selected.forEach(card => {
      card.classList.add('selected');
      card.querySelector('.selection-indicator').textContent = '‚úì';
      selectedStudentsList.push(card.dataset.studentName);
    });
    
    updateSelectedCount();
    playCosmicSound('level-up');
  }
}

function updateSelectedCount() {
  console.log('üî¢ ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿØÿØŸäŸÜ...');
  
  const countElement = document.getElementById('selectedCount');
  const startBtn = document.getElementById('startGameBtn');
  
  if (!countElement) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿπŸÜÿµÿ± ÿßŸÑÿπÿØ selectedCount');
    return;
  }
  
  if (!startBtn) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ° startGameBtn');
    return;
  }
  
  const selectedCount = selectedStudentsList.length;
  console.log(`üë• ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ: ${selectedCount}`);
  console.log('üìã ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ:', selectedStudentsList);
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä
  countElement.textContent = selectedCount;
  countElement.style.transform = 'scale(1.2)';
  countElement.style.color = selectedCount > 0 ? '#00ffff' : '#ffffff';
  
  setTimeout(() => {
    countElement.style.transform = 'scale(1)';
  }, 200);
  
  // Enable/disable start button
  if (selectedCount >= 2) {
    console.log('‚úÖ ÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ° - ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿπÿØÿØ ŸÉÿßŸÅŸä ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿßÿ®');
    startBtn.disabled = false;
    startBtn.style.opacity = '1';
    startBtn.style.cursor = 'pointer';
    startBtn.style.transform = 'scale(1.05)';
    
    // ÿ•ÿ¥ÿπÿßÿ± ÿ®ÿµÿ±Ÿä ŸÑŸÑÿßÿ≥ÿ™ÿπÿØÿßÿØ
    showQuantumNotification(
      'üéØ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ®ÿØÿ°!',
      `ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ${selectedCount} ÿ∑ÿßŸÑÿ®`,
      'success'
    );
  } else {
    console.log('‚ö†Ô∏è ÿ™ÿπÿ∑ŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ° - ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä');
    startBtn.disabled = true;
    startBtn.style.opacity = '0.5';
    startBtn.style.cursor = 'not-allowed';
    startBtn.style.transform = 'scale(1)';
    
    if (selectedCount === 1) {
      showQuantumNotification(
        '‚è≥ ÿßÿÆÿ™ÿ± ÿ∑ÿßŸÑÿ® ÿ¢ÿÆÿ±',
        'Ÿäÿ≠ÿ™ÿßÿ¨ ÿßŸÑŸÑÿπÿ®ÿ© ÿ•ŸÑŸâ ÿ∑ÿßŸÑÿ®ŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ',
        'info'
      );
    }
  }
  
  console.log(`üéÆ ÿ≠ÿßŸÑÿ© ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ°: ${startBtn.disabled ? 'ŸÖÿπÿ∑ŸÑ' : 'ŸÖŸÅÿπŸÑ'}`);
}

function startKingdomGame() {
  if (selectedStudentsList.length < 2) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±', 'Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÑÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©', 'warning');
    return;
  }
  
  gameState.selectedStudents = [...selectedStudentsList];
  gameState.gameStarted = true;
  
  // üíæ ÿ≠ŸÅÿ∏ ÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿπŸÑŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
  const sessionData = saveTeacherSession();
  
  // üéµ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÖÿ™ÿ™ÿßŸÑŸäÿ©
  playSoundSequence([
    'achievement-unlock',
    'crown-ceremony', 
    'epic-victory'
  ]);
  
  // üöÄ ÿßŸÑÿ™Ÿàÿ¨Ÿá ÿ•ŸÑŸâ ŸÖÿ±ŸÉÿ≤ ÿßŸÑŸÖŸÖÿßŸÑŸÉ
  showQuantumNotification('üöÄ ÿßŸÜÿ∑ŸÑÿßŸÇ!', 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™Ÿàÿ¨Ÿá ÿ•ŸÑŸâ ŸÖÿ±ŸÉÿ≤ ÿßŸÑŸÖŸÖÿßŸÑŸÉ ÿßŸÑÿ∞ŸÉŸäÿ©...', 'success');
  
  // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ©
  if (typeof confetti !== 'undefined') {
    confetti({
      particleCount: 150,
      spread: 120,
      origin: { y: 0.6 },
      colors: ['#FFD700', '#FF6B35', '#9B59B6', '#3498DB']
    });
  }
  
  setTimeout(() => {
    // ŸÜŸÇŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ§ŸÉÿØÿ©
    const transferData = {
      ...sessionData,
      transferTime: new Date().toISOString(),
      fromPage: 'challenges-ultimate',
      toPage: 'kingdoms-center'
    };
    
    localStorage.setItem('kingdomTransferData', JSON.stringify(transferData));
    console.log('üöÄ ŸÜŸÇŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑŸÖŸÖÿßŸÑŸÉ:', transferData);
    
    window.location.href = 'kingdoms-center.html';
  }, 2000);
}

// ÿØÿßŸÑÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑÿ™ŸàŸÑŸäÿØ ÿßŸÑŸÅÿ±ŸÇ (ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖÿ∑ŸÑŸàÿ®ÿ© ŸÅŸä ŸÖŸÉÿßŸÜ ÿ¢ÿÆÿ±)
function generateTeamsFromStudents() {
  
  // Play epic start sequence
  playSoundSequence([
    'royal-fanfare',
    'kingdom-enter',
    'epic-charge'
  ], 1000);
  
  showQuantumNotification(
    'üèÜ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ®ÿØÿ£ÿ™!', 
    `ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ${selectedStudentsList.length} ŸÖÿ¥ÿßÿ±ŸÉ ŸÖŸÜ ${gameState.selectedClass}`, 
    'success'
  );
  
  // Show welcome message after selection
  setTimeout(() => {
    showWelcomeMessage();
  }, 2000);
}

function generateTeamsFromStudents() {
  const studentsCount = selectedStudentsList.length;
  const teamCount = Math.min(4, Math.max(2, Math.ceil(studentsCount / 3)));
  
  gameState.teams = [];
  const teamIcons = ['ü¶Å', 'üêâ', 'ü¶Ö', 'üê∫', 'ü¶Ñ', 'üî•'];
  const teamNames = ['ŸÖÿ≠ÿßÿ±ÿ®Ÿà ÿßŸÑŸÜŸàÿ±', 'ŸÅÿ±ÿ≥ÿßŸÜ ÿßŸÑÿ∏ŸÑÿßŸÖ', 'ÿ≠ŸÖÿßÿ© ÿßŸÑÿ≥ŸÖÿßÿ°', 'ÿ£ÿ≥ŸäÿßÿØ ÿßŸÑÿ£ÿ±ÿ∂', 'ÿ≥ÿ≠ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜ', 'ÿπŸÖÿßŸÑŸÇÿ© ÿßŸÑŸÇŸàÿ©'];
  
  // Shuffle students for random team assignment
  const shuffledStudents = [...selectedStudentsList].sort(() => 0.5 - Math.random());
  
  for (let i = 0; i < teamCount; i++) {
    const team = {
      id: i + 1,
      name: teamNames[i] || `ÿßŸÑŸÅÿ±ŸäŸÇ ${i + 1}`,
      icon: teamIcons[i] || '‚≠ê',
      score: 0,
      energy: 100,
      members: []
    };
    
    // Assign students to teams (round robin)
    for (let j = i; j < shuffledStudents.length; j += teamCount) {
      team.members.push(shuffledStudents[j]);
    }
    
    gameState.teams.push(team);
  }
  
  console.log('Generated teams:', gameState.teams);
}

function backToSetup() {
  if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿπŸàÿØÿ© ŸÑÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿ¥ÿßÿ∑ÿü ÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä.')) {
    gameState.gameStarted = false;
    gameState.isActive = false;
    
    // Reset game state
    if (gameState.battleTimer) {
      clearInterval(gameState.battleTimer);
      gameState.battleTimer = null;
    }
    
    // Show selection panel and hide game interface
    document.getElementById('selectionPanel').style.display = 'block';
    document.getElementById('gameInterface').style.display = 'none';
    document.getElementById('battleArena').style.display = 'none';
    
    playCosmicSound('panel-slide');
  }
}

// ===== TEACHER GUIDE FUNCTIONS =====
function openTeacherGuide() {
  document.getElementById('teacherGuideModal').style.display = 'block';
  playCosmicSound('menu-open');
}

function showTeacherGuide() {
  openTeacherGuide();
}

function closeTeacherGuide() {
  document.getElementById('teacherGuideModal').style.display = 'none';
  playCosmicSound('cosmic-click');
}
let aiCoachMessages = [
  "üåü ŸÖŸÖÿ™ÿßÿ≤! ÿßÿ≥ÿ™ŸÖÿ± ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑŸÖÿ™ŸÖŸäÿ≤",
  "üí™ ŸÇŸàÿ© ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ŸáŸä ÿ≥ŸÑÿßÿ≠ŸÉ ÿßŸÑÿ≥ÿ±Ÿä",
  "üß† ŸÅŸÉÿ± ÿÆÿßÿ±ÿ¨ ÿßŸÑÿµŸÜÿØŸàŸÇ ŸÑÿ™ÿ¨ÿØ ÿßŸÑÿ≠ŸÑ",
  "‚ö° ÿßŸÑÿ≥ÿ±ÿπÿ© ŸÖŸáŸÖÿ©ÿå ŸÑŸÉŸÜ ÿßŸÑÿØŸÇÿ© ÿ£ŸáŸÖ",
  "üéØ ÿ±ŸÉÿ≤ ÿπŸÑŸâ ÿßŸÑŸáÿØŸÅ ŸàŸÑÿß ÿ™ÿØÿπ ÿ¥Ÿäÿ¶ÿßŸã Ÿäÿ¥ÿ™ÿ™ ÿßŸÜÿ™ÿ®ÿßŸáŸÉ",
  "üöÄ ÿ£ŸÜÿ™ ÿ™ÿ™ŸÇÿØŸÖ ÿ®ÿ≥ÿ±ÿπÿ© ŸÜÿ≠Ÿà ÿßŸÑŸÜÿµÿ±",
  "üíé ŸÉŸÑ ÿ™ÿ≠ÿØŸç ÿ™ÿ™ÿ∫ŸÑÿ® ÿπŸÑŸäŸá Ÿäÿ¨ÿπŸÑŸÉ ÿ£ŸÇŸàŸâ",
  "üî• ÿßŸÑÿ≠ŸÖÿßÿ≥ ŸáŸà ŸàŸÇŸàÿØ ÿßŸÑŸÜÿ¨ÿßÿ≠"
];

// ===== INITIALIZATION =====
window.addEventListener('load', async () => {
  await initializeKingdom();
});

function initParticles() {
  particlesJS('particles-js', {
    particles: {
      number: { value: 100 },
      color: { value: ['#00ffff', '#ff00ff', '#ffd700'] },
      shape: { type: 'circle' },
      opacity: { value: 0.6, random: true },
      size: { value: 3, random: true },
      line_linked: { enable: true, distance: 150, color: '#ffffff', opacity: 0.4, width: 1 },
      move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
    },
    interactivity: {
      detect_on: 'canvas',
      events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
      modes: { grab: { distance: 400, line_linked: { opacity: 1 } }, bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 }, repulse: { distance: 200, duration: 0.4 }, push: { particles_nb: 4 }, remove: { particles_nb: 2 } }
    },
    retina_detect: true
  });
}

async function loadStudentData() {
  try {
    const response = await fetch('../data/studentData.json');
    if (response.ok) {
      studentData = await response.json();
      console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠:', Object.keys(studentData));
    } else {
      throw new Error('ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©:', error);
    // ÿ®ŸäÿßŸÜÿßÿ™ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ£ŸÉÿ´ÿ± ÿ™ŸÅÿµŸäŸÑÿßŸã
    studentData = {
      "ÿÆÿßŸÖÿ≥ 1": [
        "ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ≥Ÿäÿßÿ®Ÿä", "ŸÅÿßÿ∑ŸÖÿ© ÿπŸÑŸä ÿßŸÑÿ≠ÿßÿ±ÿ´Ÿä", "ÿπÿ®ÿØÿßŸÑŸÑŸá ÿ≥ÿßŸÑŸÖ ÿßŸÑÿ¨ÿßÿ®ÿ±Ÿä", 
        "ŸÖÿ±ŸäŸÖ ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿ®ŸÑŸàÿ¥Ÿä", "ÿ≥ÿπŸäÿØ ŸäŸàÿ≥ŸÅ ÿßŸÑŸÖÿ≠ÿ±ŸÖŸä", "ŸÜŸàÿ± ÿ≠ÿ≥ŸÜ ÿßŸÑÿ±Ÿàÿßÿ≠Ÿä",
        "ÿÆÿßŸÑÿØ ÿ∑ÿßÿ±ŸÇ ÿßŸÑÿ®Ÿàÿ≥ÿπŸäÿØŸä", "ÿπÿßÿ¶ÿ¥ÿ© ÿ≥ŸÑŸäŸÖÿßŸÜ ÿßŸÑŸÅÿßÿ±ÿ≥Ÿä"
      ],
      "ÿÆÿßŸÖÿ≥ 2": [
        "ÿ≥ÿßÿ±ÿ© ÿ≠ÿ≥ŸÜ ÿßŸÑŸäÿ≠Ÿäÿßÿ¶Ÿä", "ŸÖÿ≠ŸÖÿØ ÿπŸÖÿ± ÿßŸÑÿ≠ÿØŸäÿØŸä", "ŸÜŸàÿ± ÿßŸÑÿØŸäŸÜ ÿßŸÑŸÖÿ≥ÿßŸÅÿ±", 
        "ÿπÿßÿ¶ÿ¥ÿ© ÿÆÿßŸÑÿØ ÿßŸÑÿ∂ÿßŸÖÿ±Ÿä", "ÿ±ÿßÿ¥ÿØ ÿ≥ÿßŸÑŸÖ ÿßŸÑŸàŸáŸäÿ®Ÿä", "ÿ≤ŸäŸÜÿ® ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿ≠ÿ®ÿ≥Ÿä",
        "ÿπÿ®ÿØÿßŸÑÿ±ÿ≠ŸÖŸÜ ŸÜÿßÿµÿ± ÿßŸÑÿ®ÿ±ŸäŸÉŸä", "ŸÑÿ∑ŸäŸÅÿ© ŸÖÿ≠ŸÖÿØ ÿßŸÑÿµÿ®ÿ≠Ÿä"
      ],
      "ÿ≥ÿßÿØÿ≥ 1": [
        "ÿπŸÑŸä ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ≤ÿØÿ¨ÿßŸÑŸä", "ÿ≠ŸÑŸäŸÖÿ© ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿπŸÖÿ±Ÿä", "ŸäŸàÿ≥ŸÅ ÿ≥ÿπŸäÿØ ÿßŸÑÿÆÿ±ÿ®Ÿàÿ¥Ÿä",
        "ÿÆÿØŸäÿ¨ÿ© ÿπŸÑŸä ÿßŸÑÿ≠Ÿàÿ≥ŸÜŸä", "ÿ∑ÿßÿ±ŸÇ ÿÆŸÑŸäŸÑ ÿßŸÑÿ®ŸÑŸàÿ¥Ÿä", "ÿ¢ŸÖŸÜÿ© ÿ≠ŸÖŸàÿØ ÿßŸÑÿ≠ÿ∂ÿ±ŸÖŸä"
      ],
      "ÿ≥ÿßÿØÿ≥ 2": [
        "ÿ•ÿ®ÿ±ÿßŸáŸäŸÖ ÿ≥ÿßŸÑŸÖ ÿßŸÑŸÑŸäÿ´Ÿä", "ÿ±ŸÇŸäÿ© ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ±ŸÖÿ∂ÿßŸÜŸä", "ÿ≠ŸÖÿ≤ÿ© ÿ£ÿ≠ŸÖÿØ ÿßŸÑŸäŸàÿ≥ŸÅŸä",
        "ŸÅÿßÿ∑ŸÖÿ© ÿ≥ŸäŸÅ ÿßŸÑÿ≥ÿπŸäÿØŸä", "ÿπÿ´ŸÖÿßŸÜ ŸÜÿßÿµÿ± ÿßŸÑŸáÿ∑ÿßŸÑŸä", "ÿÆŸàŸÑÿ© ÿπÿ®ÿØÿßŸÑŸÑŸá ÿßŸÑŸÖÿ≥ŸÑŸÖŸä"
      ]
    };
    console.log('üìö ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©:', Object.keys(studentData));
  }
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ©
async function reloadStudentData() {
  console.log('üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...');
  
  try {
    showQuantumNotification('‚è≥ ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...', 'Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±', 'info');
    
    const response = await fetch('../data/studentData.json?' + new Date().getTime());
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    console.log('üìä ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©:', Object.keys(data));
    
    studentData = data;
    
    showQuantumNotification(
      '‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸÜÿ¨ÿßÿ≠',
      `ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${Object.keys(data).length} ÿµŸÅŸàŸÅ`,
      'success'
    );
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅŸàŸÅ
    setTimeout(() => {
      loadClassSelection();
    }, 1000);
    
  } catch (error) {
    console.error('‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ:', error);
    showQuantumNotification(
      '‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ',
      'Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖŸÑŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
      'error'
    );
  }
}

// ÿØÿßŸÑÿ© ÿßÿÆÿ™ÿ®ÿßÿ± ŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± (ŸÑŸÑÿ™ÿ∑ŸàŸäÿ± ŸàÿßŸÑÿ™ÿ¥ÿÆŸäÿµ)
function testSelectionSystem() {
  console.log('üß™ ÿßÿÆÿ™ÿ®ÿßÿ± ŸÜÿ∏ÿßŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±...');
  
  const studentCards = document.querySelectorAll('.student-card');
  console.log(`üîç ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${studentCards.length} ÿ®ÿ∑ÿßŸÇÿ© ÿ∑ÿßŸÑÿ®`);
  
  if (studentCards.length === 0) {
    console.error('‚ùå ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿ∑ŸÑÿßÿ® ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±');
    showQuantumNotification(
      '‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±',
      'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿ∑ŸÑÿßÿ®',
      'error'
    );
    return;
  }
  
  // ÿßÿÆÿ™ÿ®ÿßÿ± ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ£ŸàŸÑ
  const firstCard = studentCards[0];
  const studentName = firstCard.dataset.studentName;
  
  console.log(`üéØ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ÿßŸÑÿ®: ${studentName}`);
  
  // ŸÖÿ≠ÿßŸÉÿßÿ© ÿßŸÑŸÜŸÇÿ±
  firstCard.click();
  
  setTimeout(() => {
    console.log('üìä ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±:');
    console.log('- ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿØÿØŸäŸÜ:', selectedStudentsList.length);
    console.log('- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ®:', selectedStudentsList);
    console.log('- ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©:', firstCard.classList.contains('selected') ? 'ŸÖÿ≠ÿØÿØÿ©' : 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØÿ©');
    
    const indicator = firstCard.querySelector('.selection-indicator');
    console.log('- ŸÜÿµ ÿßŸÑŸÖÿ§ÿ¥ÿ±:', indicator ? indicator.textContent : 'ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ');
    
    if (selectedStudentsList.length > 0 && firstCard.classList.contains('selected')) {
      showQuantumNotification(
        '‚úÖ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ŸäÿπŸÖŸÑ',
        'ÿ™ŸÖ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ®ŸÜÿ¨ÿßÿ≠',
        'success'
      );
    } else {
      showQuantumNotification(
        '‚ùå ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ',
        'ŸÅÿ¥ŸÑ ÿßÿÆÿ™ÿ®ÿßÿ± ŸÜÿ∏ÿßŸÖ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±',
        'error'
      );
    }
  }, 500);
}

// ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØÿßŸÑÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπÿßŸÖÿ© (ŸÑŸÑŸÖÿ∑Ÿàÿ±ŸäŸÜ)
window.testSelectionSystem = testSelectionSystem;

// ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ∏ŸáŸàÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
function ensureControlHeaderVisible() {
  console.log('üîß ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ∏ŸáŸàÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ...');
  
  const controlHeader = document.querySelector('.cosmic-control-header');
  if (!controlHeader) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ header ÿßŸÑÿ™ÿ≠ŸÉŸÖ');
    return;
  }
  
  // ŸÅÿ±ÿ∂ ÿ∏ŸáŸàÿ± ÿßŸÑÿπŸÜÿµÿ±
  controlHeader.style.display = 'flex';
  controlHeader.style.visibility = 'visible';
  controlHeader.style.opacity = '1';
  controlHeader.style.zIndex = '99999';
  controlHeader.style.position = 'fixed';
  controlHeader.style.top = '0';
  controlHeader.style.left = '0';
  controlHeader.style.right = '0';
  
  // ŸÅÿ≠ÿµ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÅÿ±ÿØŸäÿ©
  const buttons = controlHeader.querySelectorAll('.cosmic-control-btn');
  console.log(`üéÆ ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${buttons.length} ÿ£ÿ≤ÿ±ÿßÿ± ÿ™ÿ≠ŸÉŸÖ`);
  
  buttons.forEach((btn, index) => {
    btn.style.display = 'flex';
    btn.style.visibility = 'visible';
    btn.style.opacity = '1';
    console.log(`‚úÖ ÿ≤ÿ± ${index + 1} ŸÖÿ±ÿ¶Ÿä:`, btn.id || btn.textContent);
  });
  
  // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿßÿ≠ÿ© ŸÑŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ™ÿ≠ÿ™ ÿßŸÑÿ¥ÿ±Ÿäÿ∑
  document.body.style.paddingTop = '80px';
  
  console.log('‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ∏ŸáŸàÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ');
}

// ===== REALM ACTIVATION =====
function activateRealm(realmType) {
  console.log('üè∞ ŸÖÿ≠ÿßŸàŸÑÿ© ÿØÿÆŸàŸÑ ÿßŸÑŸÖŸÖŸÑŸÉÿ©:', realmType);
  console.log('üìä ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸàŸÜ:', selectedStudentsList);
  console.log('üìä ÿ≠ÿßŸÑÿ© gameState.selectedStudents:', gameState.selectedStudents);
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ÿ∑ÿ±ŸÇ ŸÖÿ™ÿπÿØÿØÿ©
  const hasSelectedStudents = (selectedStudentsList && selectedStudentsList.length > 0) || 
                              (gameState.selectedStudents && gameState.selectedStudents.length > 0);
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÑÿπÿ®ÿ© ÿ®ÿØÿ£ÿ™
  if (!gameState.gameStarted) {
    console.log('‚ùå ÿßŸÑŸÑÿπÿ®ÿ© ŸÑŸÖ ÿ™ÿ®ÿØÿ£ ÿ®ÿπÿØ');
    showQuantumNotification(
      '‚ö†Ô∏è Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ© ÿ£ŸàŸÑÿßŸã', 
      'ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ÿ´ŸÖ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ≤ÿ± "ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©" ŸÖŸÜ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©', 
      'warning'
    );
    
    // ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑÿ¥ÿßÿ¥ÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ®ÿØÿ£ ÿßŸÑŸÑÿπÿ®ÿ©
    document.getElementById('kingdomContent').style.display = 'none';
    document.getElementById('selectionPanel').style.display = 'block';
    
    playCosmicSound('wrong_answer');
    return;
  }
  
  if (!hasSelectedStudents) {
    console.log('‚ùå ŸÑÿß ŸäŸàÿ¨ÿØ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸàŸÜ');
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    if (!studentData || Object.keys(studentData).length === 0) {
      showQuantumNotification(
        '‚ö†Ô∏è ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 
        'ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...', 
        'warning'
      );
      // ÿ•ÿπÿßÿØÿ© ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
      loadStudentData().then(() => {
        loadClassSelection();
        showQuantumNotification('‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´', 'ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ÿ´ŸÖ ÿØÿÆŸàŸÑ ÿßŸÑŸÖŸÖŸÑŸÉÿ©', 'success');
      });
      return;
    }
    
    showQuantumNotification(
      '‚ö†Ô∏è Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ÿ£ŸàŸÑÿßŸã', 
      'ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ŸÖŸÜ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÇÿ®ŸÑ ÿØÿÆŸàŸÑ ÿ£Ÿä ŸÖŸÖŸÑŸÉÿ©!', 
      'warning'
    );
    playCosmicSound('wrong_answer');
    return; // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞
  }

  console.log('‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿßÿ®ÿå ÿ¨ÿßÿ±Ÿä ÿßŸÑÿØÿÆŸàŸÑ ŸÑŸÑŸÖŸÖŸÑŸÉÿ©...');
  
  // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©
  const currentStudents = selectedStudentsList.length > 0 ? selectedStudentsList : gameState.selectedStudents;
  
  gameState.currentRealm = realmType;
  gameState.selectedStudents = [...currentStudents]; // ŸÜÿ≥ÿÆ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ®
  
  // ÿ™ÿ≠ÿØŸäÿ´ selectedStudentsList ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÅÿßÿ±ÿ∫ÿ©
  if (!selectedStudentsList || selectedStudentsList.length === 0) {
    selectedStudentsList = [...currentStudents];
  }
  
  // ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÖŸÖÿßŸÑŸÉ ÿßŸÑŸÖÿ≤ÿßÿ±ÿ© ŸÑŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™
  if (!gameState.visitedRealms.includes(realmType)) {
    gameState.visitedRealms.push(realmType);
    
    // ŸÅÿ≠ÿµ ÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑŸÖÿ≥ÿ™ŸÉÿ¥ŸÅ
    if (gameState.visitedRealms.length >= 4) {
      setTimeout(() => checkAchievement('explorer'), 1000);
    }
  }
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÖŸäŸÑ
  showQuantumNotification(
    'üè∞ ÿ¨ÿßÿ±Ÿä ÿßŸÑÿØÿÆŸàŸÑ ŸÑŸÑŸÖŸÖŸÑŸÉÿ©...', 
    `ÿØÿÆŸàŸÑ ${currentStudents.length} ÿ∑ŸÑÿßÿ® ŸÑŸÑŸÖŸÖŸÑŸÉÿ©`, 
    'info'
  );
  
  // ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä ŸÑŸÑÿØÿÆŸàŸÑ (ÿ®ÿØŸàŸÜ event.target)
  createCosmicStars();
  
  // Enhanced realm-specific sound effects
  switch(realmType) {
    case 'lightning':
      playSoundSequence(['cosmic-portal', 'lightning-strike'], 300);
      break;
    case 'wisdom':
      playSoundSequence(['cosmic-portal', 'wisdom-chime'], 300);
      break;
    case 'battle':
      playSoundSequence(['cosmic-portal', 'war-drum'], 300);
      break;
    case 'mystery':
      playSoundSequence(['cosmic-portal', 'mystery-whisper'], 300);
      break;
    case 'creative':
      playSoundSequence(['cosmic-portal', 'ai-notification'], 300);
      break;
    case 'science':
      playSoundSequence(['cosmic-portal', 'brain-activate'], 300);
      break;
    case 'language':
      playSoundSequence(['cosmic-portal', 'achievement-unlock'], 300);
      break;
    case 'math':
      playSoundSequence(['cosmic-portal', 'crystal-ping'], 300);
      break;
    case 'history':
      playSoundSequence(['cosmic-portal', 'ancient-bell'], 300);
      break;
  }
  
  setTimeout(() => {
    switch(realmType) {
      case 'lightning':
        // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ±ÿ≠Ÿäÿ®Ÿäÿ© ÿÆÿßÿµÿ© ÿ®ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ
        const lightningWelcomeMessages = [
          '‚ö° ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿπÿßŸÑŸÖ ÿßŸÑÿµŸàÿßÿπŸÇ ŸàÿßŸÑÿ®ÿ±ŸÇ!',
          'üå©Ô∏è ÿ≥ÿ™ÿÆÿ™ÿ®ÿ±ŸàŸÜ ŸÇŸàÿ© ÿßŸÑÿπŸÇŸàŸÑ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©!',
          'üí´ ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑÿ±ÿ≠ŸÑÿ© ÿπÿ®ÿ± ÿπÿßŸÑŸÖ ÿßŸÑÿ∑ÿßŸÇÿ©!',
          'üî•‚ö° ÿßŸÑŸÜŸäÿ±ÿßŸÜ ŸàÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ° ÿ™ŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!',
          '‚ö°üß† ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ÿ∞ŸÉŸäÿßÿ° ÿßŸÑÿÆÿßÿ±ŸÇŸäŸÜ!'
        ];
        const randomLightningWelcome = lightningWelcomeMessages[Math.floor(Math.random() * lightningWelcomeMessages.length)];
        showQuantumNotification('‚ö° ÿØÿÆŸàŸÑ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ', randomLightningWelcome, 'battle');
        setTimeout(() => startLightningChallenge(), 1000);
        break;
      case 'wisdom':
        showQuantumNotification('üß† ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©', 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿπÿßŸÑŸÖ ÿßŸÑÿ≠ŸÉŸÖÿ© ŸàÿßŸÑŸÖÿπÿ±ŸÅÿ©!', 'info');
        setTimeout(() => startWisdomChallenge(), 1000);
        break;
      case 'battle':
        showQuantumNotification('‚öîÔ∏è ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©', 'ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!', 'warning');
        setTimeout(() => startTeamBattleChallenge(), 1000);
        break;
      case 'mystery':
        showQuantumNotification('üîÆ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤', 'ÿßÿØÿÆŸÑŸàÿß ÿπÿßŸÑŸÖ ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤ ÿßŸÑÿ∫ÿßŸÖÿ∂ÿ©!', 'mystery');
        setTimeout(() => startMysteryChallenge(), 1000);
        break;
      case 'creative':
        showQuantumNotification('üé® ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ', 'ÿßÿ∑ŸÑŸÇŸàÿß ÿßŸÑÿπŸÜÿßŸÜ ŸÑÿÆŸäÿßŸÑŸÉŸÖ Ÿàÿ•ÿ®ÿØÿßÿπŸÉŸÖ!', 'success');
        setTimeout(() => startCreativeChallenge(), 1000);
        break;
      case 'science':
        showQuantumNotification('üî¨ ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ', 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿßŸÑŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä!', 'info');
        setTimeout(() => startScienceChallenge(), 1000);
        break;
      case 'language':
        showQuantumNotification('üìö ŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÑÿ∫ÿ©', 'ÿ±ÿ≠ŸÑÿ© ŸÖŸÖÿ™ÿπÿ© ŸÅŸä ÿπÿßŸÑŸÖ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ŸàÿßŸÑÿ™ÿπÿ®Ÿäÿ±!', 'info');
        setTimeout(() => startLanguageChallenge(), 1000);
        break;
      case 'math':
        showQuantumNotification('üî¢ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ', 'ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ© ŸÖÿ´Ÿäÿ±ÿ©!', 'success');
        setTimeout(() => startMathChallenge(), 1000);
        break;
      case 'history':
        showQuantumNotification('üï∞Ô∏è ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ', 'ÿ±ÿ≠ŸÑÿ© ÿπÿ®ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑÿ≠ÿ∂ÿßÿ±ÿßÿ™!', 'mystery');
        setTimeout(() => startHistoryChallenge(), 1000);
        break;
    }
  }, 500);
}

function enterBattleArena() {
  document.getElementById('kingdomDashboard').style.display = 'none';
  document.getElementById('battleArena').style.display = 'block';
  
  // Epic battle arena entrance
  playCosmicSound('battle-horn', { volume: 0.8 });
  setTimeout(() => playCosmicSound('epic-charge'), 1000);
  
  showQuantumNotification('‚öîÔ∏è ÿØÿÆŸàŸÑ ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©', 'ÿßÿ≥ÿ™ÿπÿØ ŸÑŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!', 'battle');
  generateTeams();
}

function generateTeams() {
  const teamsContainer = document.getElementById('teamsHologram');
  teamsContainer.innerHTML = '';
  
  // If no teams generated yet, generate from selected students
  if (gameState.teams.length === 0) {
    generateTeamsFromStudents();
  }
  
  gameState.teams.forEach(team => {
    const teamElement = document.createElement('div');
    teamElement.className = 'team-hologram';
    
    // Create members list display
    const membersDisplay = team.members.length > 0 
      ? `<div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
           ÿßŸÑÿ£ÿπÿ∂ÿßÿ°: ${team.members.slice(0, 2).join(', ')}${team.members.length > 2 ? '...' : ''}
         </div>`
      : '';
    
    teamElement.innerHTML = `
      <div class="team-avatar-3d">${team.icon}</div>
      <div class="team-name-glow">${team.name}</div>
      <div class="score-crystal" id="score-${team.id}">${team.score}</div>
      ${membersDisplay}
      <div style="margin-top: 1rem;">
        <button class="neural-button" onclick="addPointToTeam(${team.id})">‚¨ÜÔ∏è ŸÜŸÇÿ∑ÿ©</button>
        <button class="neural-button" onclick="removePointFromTeam(${team.id})">‚¨áÔ∏è ÿÆÿµŸÖ</button>
      </div>
      <div style="margin-top: 0.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
        ÿßŸÑÿ∑ÿßŸÇÿ©: <span id="energy-${team.id}">${team.energy}%</span>
      </div>
    `;
    
    teamsContainer.appendChild(teamElement);
  });
}

// ===== BATTLE SYSTEM =====
function startBattle() {
  if (gameState.isActive) return;
  
  gameState.isActive = true;
  gameState.battleDuration = 0;
  
  // Epic battle start sequence
  playSoundSequence([
    'battle-horn',
    { type: 'timer-start', options: { volume: 0.6 } },
    { type: 'epic-charge', options: { volume: 0.8 } }
  ], 800);
  
  showQuantumNotification('üöÄ ÿ®ÿØÿ° ÿßŸÑŸÖÿπÿ±ŸÉÿ©!', 'ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ© ÿ®ÿØÿ£ÿ™ ÿßŸÑÿ¢ŸÜ!', 'success');
  
  gameState.battleTimer = setInterval(() => {
    gameState.battleDuration++;
    updateBattleTimer();
    
    // Random events during battle
    if (gameState.battleDuration % 30 === 0) {
      triggerRandomEvent();
    }
    
    // Countdown warning sounds
    if (gameState.battleDuration > 0 && gameState.battleDuration % 60 === 50) {
      playCosmicSound('time-warning');
    }
  }, 1000);
  
  // Start cosmic rain
  startCosmicRain();
}

function pauseBattle() {
  if (!gameState.isActive) return;
  
  gameState.isActive = false;
  clearInterval(gameState.battleTimer);
  
  playCosmicSound('timer-pause');
  showQuantumNotification('‚è∏Ô∏è ŸÖÿπÿ±ŸÉÿ© ŸÖÿ™ŸàŸÇŸÅÿ©', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿπÿ±ŸÉÿ© ŸÖÿ§ŸÇÿ™ÿßŸã', 'warning');
}

function endBattle() {
  gameState.isActive = false;
  clearInterval(gameState.battleTimer);
  
  const winner = findWinner();
  
  // Victory sound sequence
  playSoundSequence([
    'battle-victory',
    'crown-ceremony',
    'crowd-cheer'
  ], 1000);
  
  celebrateVictory(winner);
  
  gameState.completedChallenges++;
  updateStats();
}

function resetArena() {
  gameState.isActive = false;
  clearInterval(gameState.battleTimer);
  gameState.battleDuration = 0;
  
  // Reset all teams
  gameState.teams.forEach(team => {
    team.score = 0;
    team.energy = 100;
    document.getElementById(`score-${team.id}`).textContent = '0';
    document.getElementById(`energy-${team.id}`).textContent = '100%';
  });
  
  updateBattleTimer();
  playCosmicSound('cosmic-click');
  showQuantumNotification('üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ', 'ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©', 'info');
}

// ===== TEAM MANAGEMENT =====
function addPointToTeam(teamId) {
  const team = gameState.teams.find(t => t.id === teamId);
  if (team) {
    team.score++;
    document.getElementById(`score-${team.id}`).textContent = team.score;
    
    // Energy boost
    team.energy = Math.min(100, team.energy + 5);
    document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
    
    createCosmicStars();
    
    // Enhanced point sound effects
    if (team.score % 10 === 0) {
      playCosmicSound('perfect-score');
    } else if (team.score % 5 === 0) {
      playCosmicSound('achievement-unlock');
    } else {
      playCosmicSound('point-earn');
    }
    
    // Combo system
    const comboCount = getTeamCombo(teamId);
    if (comboCount >= 3) {
      playCosmicSound('combo-hit');
      setTimeout(() => playCosmicSound('energy-boost'), 200);
    }
    
    // Check for achievement
    if (team.score % 5 === 0) {
      showQuantumNotification('üèÜ ÿ•ŸÜÿ¨ÿßÿ≤!', `${team.name} ÿ≠ŸÇŸÇ ${team.score} ŸÜŸÇÿßÿ∑!`, 'achievement');
      playCosmicSound('level-up');
    }
  }
}

function removePointFromTeam(teamId) {
  const team = gameState.teams.find(t => t.id === teamId);
  if (team && team.score > 0) {
    team.score--;
    document.getElementById(`score-${team.id}`).textContent = team.score;
    
    // Energy drain
    team.energy = Math.max(0, team.energy - 3);
    document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
    
    playCosmicSound('point-lose');
  }
}

// Helper function for combo system
function getTeamCombo(teamId) {
  // Simple combo tracking (can be enhanced)
  if (!gameState.teamCombos) gameState.teamCombos = {};
  if (!gameState.teamCombos[teamId]) gameState.teamCombos[teamId] = 0;
  gameState.teamCombos[teamId]++;
  
  // Reset combo after 5 seconds
  setTimeout(() => {
    if (gameState.teamCombos[teamId]) gameState.teamCombos[teamId] = 0;
  }, 5000);
  
  return gameState.teamCombos[teamId];
}

// ===== SPECIAL EFFECTS =====
function createCosmicExplosion(element) {
  const rect = element.getBoundingClientRect();
  const explosion = document.createElement('div');
  explosion.className = 'cosmic-explosion';
  explosion.style.left = (rect.left + rect.width / 2 - 100) + 'px';
  explosion.style.top = (rect.top + rect.height / 2 - 100) + 'px';
  document.body.appendChild(explosion);
  
  setTimeout(() => explosion.remove(), 1000);
}

function createCosmicStars() {
  for (let i = 0; i < 10; i++) {
    setTimeout(() => {
      const star = document.createElement('div');
      star.className = 'cosmic-star';
      star.textContent = ['‚≠ê', '‚ú®', 'üí´', 'üåü'][Math.floor(Math.random() * 4)];
      star.style.left = Math.random() * window.innerWidth + 'px';
      star.style.top = '-50px';
      document.body.appendChild(star);
      
      setTimeout(() => star.remove(), 4000);
    }, i * 100);
  }
}

function startCosmicRain() {
  const rainInterval = setInterval(() => {
    if (!gameState.isActive) {
      clearInterval(rainInterval);
      return;
    }
    
    createCosmicStars();
  }, 2000);
}

// ===== AI COACH SYSTEM =====
function getAITip() {
  const tip = aiCoachMessages[Math.floor(Math.random() * aiCoachMessages.length)];
  const messagesContainer = document.getElementById('aiCoachMessages');
  
  const tipElement = document.createElement('div');
  tipElement.style.cssText = `
    background: linear-gradient(45deg, rgba(0,255,255,0.2), rgba(255,0,255,0.2));
    padding: 1rem;
    border-radius: 10px;
    margin: 0.5rem 0;
    border: 1px solid rgba(0,255,255,0.5);
    animation: fadeInUp 0.5s ease;
  `;
  tipElement.textContent = tip;
  
  messagesContainer.appendChild(tipElement);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Enhanced AI coach sounds
  playSoundSequence([
    'ai-beep',
    'ai-notification'
  ], 300);
}

function analyzePerformance() {
  const analysis = generatePerformanceAnalysis();
  const messagesContainer = document.getElementById('aiCoachMessages');
  
  const analysisElement = document.createElement('div');
  analysisElement.style.cssText = `
    background: linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,105,180,0.2));
    padding: 1rem;
    border-radius: 10px;
    margin: 0.5rem 0;
    border: 1px solid rgba(255,215,0,0.5);
    animation: fadeInUp 0.5s ease;
  `;
  analysisElement.innerHTML = analysis;
  
  messagesContainer.appendChild(analysisElement);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Data processing sound sequence
  playSoundSequence([
    'scanner-beep',
    'data-process',
    'ai-notification'
  ], 500);
}

function generatePerformanceAnalysis() {
  // Session timing removed - using completed challenges for performance analysis
  const avgPointsPerMinute = 0; // Simplified - removed session timing
  
  return `
    üìä <strong>ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿØÿßÿ°:</strong><br>
    üéØ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©: ${gameState.completedChallenges}<br>
    üí™ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ£ÿØÿßÿ°: ${getPerformanceRating(getTotalPoints())}
  `;
}

function getPerformanceRating(totalPoints) {
  if (totalPoints >= 100) return "üî• ŸÖŸÖÿ™ÿßÿ≤";
  if (totalPoints >= 75) return "‚≠ê ÿ¨ŸäÿØ ÿ¨ÿØÿßŸã";
  if (totalPoints >= 50) return "üëç ÿ¨ŸäÿØ";
  return "üí™ ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ™ÿ≠ÿ≥ŸÜ";
}

// ===== ENHANCED AI COACH FUNCTIONS =====
function getMotivationalMessage() {
  const motivationalMessages = [
    "üåü ŸÉŸÑ ÿ™ÿ≠ÿØŸç ÿ™Ÿàÿßÿ¨ŸáŸá Ÿäÿ¨ÿπŸÑŸÉ ÿ£ŸÇŸàŸâ Ÿàÿ£ÿ∞ŸÉŸâ!",
    "üí´ ÿßŸÑŸÜÿ¨ÿßÿ≠ Ÿäÿ®ÿØÿ£ ÿ®ÿÆÿ∑Ÿàÿ© Ÿàÿßÿ≠ÿØÿ©ÿå Ÿàÿ£ŸÜÿ™ ÿ™ÿ™ŸÇÿØŸÖ ÿ®ÿ´ÿ®ÿßÿ™!",
    "üöÄ ÿπŸÇŸÑŸÉ ŸÖÿ´ŸÑ ÿßŸÑÿπÿ∂ŸÑÿ©ÿå ŸÉŸÑŸÖÿß ÿØÿ±Ÿëÿ®ÿ™Ÿá ÿ£ÿµÿ®ÿ≠ ÿ£ŸÇŸàŸâ!",
    "‚≠ê ŸÑÿß ÿ™ÿÆŸÅ ŸÖŸÜ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°ÿå ŸÅŸáŸä ÿÆÿ∑Ÿàÿßÿ™ ŸÜÿ≠Ÿà ÿßŸÑŸÜÿ¨ÿßÿ≠!",
    "üéØ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ŸàÿßŸÑŸÖÿ´ÿßÿ®ÿ±ÿ© ŸÖŸÅÿ™ÿßÿ≠ ŸÉŸÑ ÿ•ŸÜÿ¨ÿßÿ≤ ÿπÿ∏ŸäŸÖ!",
    "üî• ÿ£ŸÜÿ™ ÿ£ŸÇŸàŸâ ŸÖŸÖÿß ÿ™ÿ™ÿÆŸäŸÑ Ÿàÿ£ÿ∞ŸÉŸâ ŸÖŸÖÿß ÿ™ÿπÿ™ŸÇÿØ!",
    "üíé ŸÉŸÑ ŸÑÿ≠ÿ∏ÿ© ÿ™ÿπŸÑŸÖ ŸáŸä ÿßÿ≥ÿ™ÿ´ŸÖÿßÿ± ŸÅŸä ŸÖÿ≥ÿ™ŸÇÿ®ŸÑŸÉ ÿßŸÑÿ®ÿßŸáÿ±!",
    "üåà ÿ™ÿ∞ŸÉÿ±: ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿ£ŸáŸÖ ŸÖŸÜ ÿßŸÑŸàÿ¨Ÿáÿ©ÿå ÿßÿ≥ÿ™ŸÖÿ™ÿπ ÿ®ÿßŸÑÿ™ÿπŸÑŸÖ!"
  ];
  
  const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
  displayAIMessage(randomMessage, 'motivational');
  playCosmicSound('achievement-unlock');
}

function suggestStrategy() {
  const strategies = [
    "üéØ ÿ±ŸÉÿ≤ ÿπŸÑŸâ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ≥ŸáŸÑÿ© ÿ£ŸàŸÑÿßŸã ŸÑÿ®ŸÜÿßÿ° ÿßŸÑÿ´ŸÇÿ©",
    "‚è∞ ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ™ŸÇŸÜŸäÿ© ÿßŸÑÿ®ŸàŸÖŸàÿØŸàÿ±Ÿà: 25 ÿØŸÇŸäŸÇÿ© ÿπŸÖŸÑÿå 5 ÿØŸÇÿßÿ¶ŸÇ ÿ±ÿßÿ≠ÿ©",
    "üß† ÿßŸÇÿ±ÿ£ ÿßŸÑÿ≥ÿ§ÿßŸÑ ŸÖÿ±ÿ™ŸäŸÜ ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©",
    "üìù ÿßŸÉÿ™ÿ® ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©",
    "ü§ù ÿ™ÿπÿßŸàŸÜ ŸÖÿπ ÿ≤ŸÖŸÑÿßÿ¶ŸÉ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ©",
    "üí° ŸÑÿß ÿ™ÿ™ÿ±ÿØÿØ ŸÅŸä ÿ∑ŸÑÿ® ÿßŸÑÿ™ŸÑŸÖŸäÿ≠ÿßÿ™ ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ©",
    "üîÑ ÿ±ÿßÿ¨ÿπ ÿ•ÿ¨ÿßÿ®ÿßÿ™ŸÉ ŸÇÿ®ŸÑ ÿßŸÑÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸÜŸáÿßÿ¶Ÿä",
    "üé® ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ±ÿ≥ŸÖ ŸàÿßŸÑŸÖÿÆÿ∑ÿ∑ÿßÿ™ ŸÑÿ™Ÿàÿ∂Ÿäÿ≠ ÿ£ŸÅŸÉÿßÿ±ŸÉ"
  ];
  
  const randomStrategy = strategies[Math.floor(Math.random() * strategies.length)];
  displayAIMessage("üìà ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿ© ŸÖŸÇÿ™ÿ±ÿ≠ÿ©: " + randomStrategy, 'strategy');
  playCosmicSound('brain-activate');
}

function showProgress() {
  const progressData = calculateProgress();
  displayAIMessage(progressData, 'progress');
  playCosmicSound('level-up');
}

function clearAIMessages() {
  const messagesContainer = document.getElementById('aiCoachMessages');
  messagesContainer.innerHTML = `
    <div style="opacity: 0.7; text-align: center;">
      <div style="font-size: 2rem; margin-bottom: 0.5rem;">ü§ñ</div>
      <div>ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ. ÿßŸÑŸÖÿØÿ±ÿ® ÿßŸÑÿ∞ŸÉŸä ÿ¨ÿßŸáÿ≤ ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ...</div>
    </div>
  `;
  playCosmicSound('ui-back');
}

function displayAIMessage(message, type) {
  const messagesContainer = document.getElementById('aiCoachMessages');
  
  // ÿ•ÿ≤ÿßŸÑÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ™ÿ±ÿ≠Ÿäÿ® ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
  if (messagesContainer.children.length === 1 && messagesContainer.textContent.includes('ÿ¨ÿßŸáÿ≤ ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ')) {
    messagesContainer.innerHTML = '';
  }
  
  const messageElement = document.createElement('div');
  
  // ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
  let bgGradient, borderColor;
  switch(type) {
    case 'motivational':
      bgGradient = 'linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2))';
      borderColor = 'rgba(255,215,0,0.5)';
      break;
    case 'strategy':
      bgGradient = 'linear-gradient(45deg, rgba(0,255,0,0.2), rgba(0,255,255,0.2))';
      borderColor = 'rgba(0,255,255,0.5)';
      break;
    case 'progress':
      bgGradient = 'linear-gradient(45deg, rgba(255,105,180,0.2), rgba(147,112,219,0.2))';
      borderColor = 'rgba(255,105,180,0.5)';
      break;
    default:
      bgGradient = 'linear-gradient(45deg, rgba(0,255,255,0.2), rgba(255,0,255,0.2))';
      borderColor = 'rgba(0,255,255,0.5)';
  }
  
  messageElement.style.cssText = `
    background: ${bgGradient};
    padding: 1rem;
    border-radius: 10px;
    margin: 0.5rem 0;
    border: 1px solid ${borderColor};
    animation: fadeInUp 0.5s ease;
    font-size: 0.95rem;
    line-height: 1.4;
  `;
  messageElement.innerHTML = message;
  
  messagesContainer.appendChild(messageElement);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä ÿπŸÜÿØ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
  messageElement.style.transform = 'scale(0.95)';
  setTimeout(() => {
    messageElement.style.transform = 'scale(1)';
    messageElement.style.transition = 'transform 0.3s ease';
  }, 100);
}

function calculateProgress() {
  // Session timing removed - using total points and challenges for progress calculation
  const totalPoints = getTotalPoints();
  const challengesCompleted = gameState.completedChallenges || 0;
  
  let progressLevel = "ŸÖÿ®ÿ™ÿØÿ¶";
  let progressEmoji = "üå±";
  
  if (totalPoints >= 100) {
    progressLevel = "ÿÆÿ®Ÿäÿ±";
    progressEmoji = "üèÜ";
  } else if (totalPoints >= 50) {
    progressLevel = "ŸÖÿ™ŸÇÿØŸÖ";
    progressEmoji = "‚≠ê";
  } else if (totalPoints >= 20) {
    progressLevel = "ŸÖÿ™Ÿàÿ≥ÿ∑";
    progressEmoji = "üöÄ";
  }
  
  return `
    üìä <strong>ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä:</strong><br>
    ${progressEmoji} <strong>ŸÖÿ≥ÿ™ŸàÿßŸÉ:</strong> ${progressLevel}<br>
    üéØ <strong>ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©:</strong> ${totalPoints}<br>
    ‚úÖ <strong>ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©:</strong> ${challengesCompleted}<br>
    ‚è±Ô∏è <strong>ŸàŸÇÿ™ ÿßŸÑŸÑÿπÿ®:</strong> ${sessionMinutes} ÿØŸÇŸäŸÇÿ©<br>
    üìà <strong>ŸÖÿπÿØŸÑ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤:</strong> ${sessionMinutes > 0 ? (challengesCompleted / sessionMinutes * 10).toFixed(1) : 0} ÿ™ÿ≠ÿØŸä/10ÿØŸÇÿßÿ¶ŸÇ
  `;
}

// ===== UTILITY FUNCTIONS =====
function updateBattleTimer() {
  const minutes = Math.floor(gameState.battleDuration / 60);
  const seconds = gameState.battleDuration % 60;
  document.getElementById('challengeTimer').textContent = 
    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// ÿØÿßŸÑÿ© ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿ™ŸÖ ÿ≠ÿ∞ŸÅŸáÿß ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿØÿßÿ°

function showKingdoms() {
  console.log('üëë ÿ•ÿ∏Ÿáÿßÿ± ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖŸÖÿßŸÑŸÉ...');
  
  // Show main app container first
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä');
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ£ÿÆÿ±Ÿâ ÿ£ŸàŸÑÿßŸã
  const elementsToHide = [
    'selectionPanel', 'lightningArena', 'battleArena', 
    'wisdomArena', 'creativeArena', 'scienceArena', 
    'languageArena', 'mathArena', 'historyArena', 
    'mysteryArena', 'teamBattleArena'
  ];
  
  elementsToHide.forEach(elementId => {
    const element = document.getElementById(elementId);
    if (element) {
      element.style.display = 'none';
      console.log(`‚úÖ ÿ™ŸÖ ÿ•ÿÆŸÅÿßÿ° ${elementId}`);
    }
  });
  
  // ÿ•ÿ∏Ÿáÿßÿ± ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÖÿßŸÑŸÉ ÿ®ŸÇŸàÿ©
  const kingdomContent = document.getElementById('kingdomContent');
  if (kingdomContent) {
    kingdomContent.style.display = 'block';
    kingdomContent.style.visibility = 'visible';
    kingdomContent.style.opacity = '1';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ kingdomContent');
  }
  
  // ÿ•ÿ∏Ÿáÿßÿ± ŸÑŸàÿ≠ÿ© ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÖÿßŸÑŸÉ
  const kingdomDashboard = document.getElementById('kingdomDashboard');
  if (kingdomDashboard) {
    kingdomDashboard.style.display = 'grid';
    kingdomDashboard.style.visibility = 'visible';
    kingdomDashboard.style.opacity = '1';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ŸÑŸàÿ≠ÿ© ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ kingdomDashboard');
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
  updateStats();
  console.log('üìä ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  
  // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ£Ÿä ÿ™ÿ≠ŸàŸÑÿßÿ™ CSS
  document.body.style.overflow = 'auto';
}

function updateStats() {
  console.log('üìä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™...');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©
  const challengesElement = document.getElementById('completedChallenges');
  if (challengesElement) {
    challengesElement.textContent = gameState.completedChallenges;
    console.log('‚úÖ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©:', gameState.completedChallenges);
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿπŸÜÿµÿ± completedChallenges');
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∑ÿßŸÇÿ©
  gameState.energyLevel = Math.max(50, gameState.energyLevel - 5);
  const energyElement = document.getElementById('energyLevel');
  if (energyElement) {
    energyElement.textContent = gameState.energyLevel + '%';
    console.log('‚úÖ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∑ÿßŸÇÿ©:', gameState.energyLevel + '%');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿπŸÜÿµÿ± energyLevel');
  }
  
  console.log('üìä ÿßŸÜÿ™Ÿáÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™');
}

function getTotalPoints() {
  return gameState.teams.reduce((total, team) => total + team.score, 0);
}

function findWinner() {
  return gameState.teams.reduce((winner, team) => 
    team.score > winner.score ? team : winner
  );
}

function celebrateVictory(winner) {
  // Massive confetti celebration
  confetti({
    particleCount: 200,
    spread: 100,
    origin: { y: 0.6 },
    colors: ['#FFD700', '#FF6347', '#00FFFF', '#FF00FF']
  });
  
  setTimeout(() => {
    confetti({
      particleCount: 150,
      spread: 120,
      origin: { x: 0.1, y: 0.7 }
    });
  }, 300);
  
  setTimeout(() => {
    confetti({
      particleCount: 150,
      spread: 120,
      origin: { x: 0.9, y: 0.7 }
    });
  }, 600);
  
  showQuantumNotification('üëë ÿßŸÑŸÜÿµÿ±!', `${winner.name} ŸÅÿßÿ≤ ÿ®ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!`, 'victory');
  
  // Ultimate victory sound sequence
  playSoundSequence([
    'ultimate-triumph',
    'fireworks-burst',
    'golden-confetti'
  ], 1500);
  
  createCosmicStars();
}

function triggerRandomEvent() {
  const events = [
    { 
      text: '‚ö° ÿπÿßÿµŸÅÿ© ŸÉŸàŸÜŸäÿ©! ÿ¨ŸÖŸäÿπ ÿßŸÑŸÅÿ±ŸÇ ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ∑ÿßŸÇÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©', 
      effect: 'energy_boost',
      sound: ['cosmic-explosion', 'energy-boost']
    },
    { 
      text: 'üåü ŸÜÿ¨ŸÖ ÿ≥ÿßŸÇÿ∑! ŸÜŸÇÿ∑ÿ© ŸÖÿ∂ÿßÿπŸÅÿ© ŸÑŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ™ÿßŸÑŸä', 
      effect: 'double_points',
      sound: ['star-fall', 'bonus-collect']
    },
    { 
      text: 'üåÄ ÿØŸàÿßŸÖÿ© ÿ≤ŸÖŸÜŸäÿ©! ÿßŸÑŸàŸÇÿ™ Ÿäÿ™ÿ®ÿßÿ∑ÿ£', 
      effect: 'time_slow',
      sound: ['time-warp', 'mystic-wind']
    },
    { 
      text: 'üíé ŸÉÿ±Ÿäÿ≥ÿ™ÿßŸÑ ÿ≥ÿ≠ÿ±Ÿä ÿ∏Ÿáÿ±! ŸÖŸÉÿßŸÅÿ£ÿ© ÿÆÿßÿµÿ©', 
      effect: 'bonus_crystal',
      sound: ['crystal-ping', 'crystal-bonus']
    },
    {
      text: 'üîÆ ÿ®Ÿàÿßÿ®ÿ© ÿ®ŸèÿπÿØŸäÿ© ŸÅŸèÿ™ÿ≠ÿ™! ÿ∑ÿßŸÇÿ© ÿ≥ÿ≠ÿ±Ÿäÿ© ÿ™ŸÖŸÑÿ£ ÿßŸÑÿ≥ÿßÿ≠ÿ©',
      effect: 'portal_magic',
      sound: ['portal-open', 'spell-cast']
    },
    {
      text: 'üèÜ ÿ•ŸÜÿ¨ÿßÿ≤ ŸÖŸÑŸÉŸä! ÿ¨ŸÖŸäÿπ ÿßŸÑŸÅÿ±ŸÇ ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ŸÜŸÇÿßÿ∑ ÿ•ÿ∂ÿßŸÅŸäÿ©',
      effect: 'royal_bonus',
      sound: ['royal-fanfare', 'achievement-unlock']
    }
  ];
  
  const event = events[Math.floor(Math.random() * events.length)];
  showQuantumNotification('üéÜ ÿ≠ÿØÿ´ ÿÆÿßÿµ!', event.text, 'special');
  
  // Play event sound sequence
  if (event.sound) {
    playSoundSequence(event.sound, 800);
  }
  
  // Apply event effect
  switch(event.effect) {
    case 'energy_boost':
      gameState.teams.forEach(team => {
        team.energy = Math.min(100, team.energy + 20);
        document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
      });
      break;
      
    case 'double_points':
      gameState.doublePointsNext = true;
      setTimeout(() => gameState.doublePointsNext = false, 10000);
      break;
      
    case 'bonus_crystal':
      gameState.teams.forEach(team => {
        team.score += 2;
        document.getElementById(`score-${team.id}`).textContent = team.score;
      });
      break;
      
    case 'portal_magic':
      gameState.teams.forEach(team => {
        team.energy = 100;
        document.getElementById(`energy-${team.id}`).textContent = '100%';
      });
      break;
      
    case 'royal_bonus':
      gameState.teams.forEach(team => {
        team.score += 1;
        document.getElementById(`score-${team.id}`).textContent = team.score;
      });
      break;
  }
}

// ===== ADVANCED SOUND SYSTEM =====
let audioContext = null;
let masterVolume = 0.7;
let soundQueue = [];
let activeSounds = new Map();

// Initialize Web Audio Context for better sound control
function initAudioSystem() {
  try {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    console.log('üéµ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ÿ¨ÿßŸáÿ≤!');
  } catch (error) {
    console.warn('‚ö†Ô∏è ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿå ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÇŸÑŸäÿØŸä');
  }
}

function playCosmicSound(soundType, options = {}) {
  if (!gameState.soundEnabled) return;
  
  // Enhanced sound library with all kingdom sounds
  const sounds = {
    // Kingdom Core Sounds
    'kingdom-enter': '../assets/media/sounds/kingdom-sounds/kingdom-enter.mp3',
    'cosmic-portal': '../assets/media/sounds/kingdom-sounds/cosmic-portal.mp3',
    'magic-sparkle': '../assets/media/sounds/kingdom-sounds/magic-sparkle.mp3',
    'royal-fanfare': '../assets/media/sounds/kingdom-sounds/royal-fanfare.mp3',
    
    // Lightning Realm Sounds
    'lightning-strike': '../assets/media/sounds/kingdom-sounds/lightning-strike.mp3',
    'electric-charge': '../assets/media/sounds/kingdom-sounds/electric-charge.mp3',
    'thunder-rumble': '../assets/media/sounds/kingdom-sounds/thunder-rumble.mp3',
    'lightning-whoosh': '../assets/media/sounds/kingdom-sounds/lightning-whoosh.mp3',
    
    // Wisdom Realm Sounds
    'wisdom-chime': '../assets/media/sounds/kingdom-sounds/wisdom-chime.mp3',
    'brain-activate': '../assets/media/sounds/kingdom-sounds/brain-activate.mp3',
    'ancient-bell': '../assets/media/sounds/kingdom-sounds/ancient-bell.mp3',
    'knowledge-unlock': '../assets/media/sounds/kingdom-sounds/knowledge-unlock.mp3',
    
    // Battle Arena Sounds
    'battle-horn': '../assets/media/sounds/kingdom-sounds/battle-horn.mp3',
    'sword-clash': '../assets/media/sounds/kingdom-sounds/sword-clash.mp3',
    'armor-clank': '../assets/media/sounds/kingdom-sounds/armor-clank.mp3',
    'war-drum': '../assets/media/sounds/kingdom-sounds/war-drum.mp3',
    'epic-charge': '../assets/media/sounds/kingdom-sounds/epic-charge.mp3',
    'shield-block': '../assets/media/sounds/kingdom-sounds/shield-block.mp3',
    'battle-victory': '../assets/media/sounds/kingdom-sounds/battle-victory.mp3',
    
    // Mystery Realm Sounds
    'mystery-whisper': '../assets/media/sounds/kingdom-sounds/mystery-whisper.mp3',
    'crystal-ping': '../assets/media/sounds/kingdom-sounds/crystal-ping.mp3',
    'mystic-wind': '../assets/media/sounds/kingdom-sounds/mystic-wind.mp3',
    'spell-cast': '../assets/media/sounds/kingdom-sounds/spell-cast.mp3',
    'riddle-solved': '../assets/media/sounds/kingdom-sounds/riddle-solved.mp3',
    
    // AI Coach Sounds
    'ai-beep': '../assets/media/sounds/kingdom-sounds/ai-beep.mp3',
    'robot-voice': '../assets/media/sounds/kingdom-sounds/robot-voice.mp3',
    'data-process': '../assets/media/sounds/kingdom-sounds/data-process.mp3',
    'ai-notification': '../assets/media/sounds/kingdom-sounds/ai-notification.mp3',
    'scanner-beep': '../assets/media/sounds/kingdom-sounds/scanner-beep.mp3',
    
    // Points & Achievements
    'point-earn': '../assets/media/sounds/kingdom-sounds/point-earn.mp3',
    'point-lose': '../assets/media/sounds/kingdom-sounds/point-lose.mp3',
    'combo-hit': '../assets/media/sounds/kingdom-sounds/combo-hit.mp3',
    'achievement-unlock': '../assets/media/sounds/kingdom-sounds/achievement-unlock.mp3',
    'level-up': '../assets/media/sounds/kingdom-sounds/level-up.mp3',
    'bonus-collect': '../assets/media/sounds/kingdom-sounds/bonus-collect.mp3',
    'perfect-score': '../assets/media/sounds/kingdom-sounds/perfect-score.mp3',
    
    // Special Effects & Random Events
    'cosmic-explosion': '../assets/media/sounds/kingdom-sounds/cosmic-explosion.mp3',
    'star-fall': '../assets/media/sounds/kingdom-sounds/star-fall.mp3',
    'time-warp': '../assets/media/sounds/kingdom-sounds/time-warp.mp3',
    'energy-boost': '../assets/media/sounds/kingdom-sounds/energy-boost.mp3',
    'crystal-bonus': '../assets/media/sounds/kingdom-sounds/crystal-bonus.mp3',
    'portal-open': '../assets/media/sounds/kingdom-sounds/portal-open.mp3',
    'dimensional-shift': '../assets/media/sounds/kingdom-sounds/dimensional-shift.mp3',
    
    // Celebration & Victory
    'epic-victory': '../assets/media/sounds/kingdom-sounds/epic-victory.mp3',
    'crown-ceremony': '../assets/media/sounds/kingdom-sounds/crown-ceremony.mp3',
    'fireworks-burst': '../assets/media/sounds/kingdom-sounds/fireworks-burst.mp3',
    'crowd-cheer': '../assets/media/sounds/kingdom-sounds/crowd-cheer.mp3',
    'golden-confetti': '../assets/media/sounds/kingdom-sounds/golden-confetti.mp3',
    'ultimate-triumph': '../assets/media/sounds/kingdom-sounds/ultimate-triumph.mp3',
    
    // UI & Control Sounds
    'button-hover': '../assets/media/sounds/kingdom-sounds/button-hover.mp3',
    'panel-slide': '../assets/media/sounds/kingdom-sounds/panel-slide.mp3',
    'menu-open': '../assets/media/sounds/kingdom-sounds/menu-open.mp3',
    'setting-change': '../assets/media/sounds/kingdom-sounds/setting-change.mp3',
    'notification-pop': '../assets/media/sounds/kingdom-sounds/notification-pop.mp3',
    'cosmic-click': '../assets/media/sounds/kingdom-sounds/cosmic-click.mp3',
    
    // Timer & Countdown
    'countdown-tick': '../assets/media/sounds/kingdom-sounds/countdown-tick.mp3',
    'final-countdown': '../assets/media/sounds/kingdom-sounds/final-countdown.mp3',
    'time-warning': '../assets/media/sounds/kingdom-sounds/time-warning.mp3',
    'time-up': '../assets/media/sounds/kingdom-sounds/time-up.mp3',
    'timer-start': '../assets/media/sounds/kingdom-sounds/timer-start.mp3',
    'timer-pause': '../assets/media/sounds/kingdom-sounds/timer-pause.mp3',
    
    // Legacy sounds fallback
    'realm-activate': '../assets/media/sounds/kingdom-sounds/cosmic-portal.mp3',
    'battle-start': '../assets/media/sounds/kingdom-sounds/battle-horn.mp3',
    'battle-pause': '../assets/media/sounds/kingdom-sounds/timer-pause.mp3',
    'point-gained': '../assets/media/sounds/kingdom-sounds/point-earn.mp3',
    'point-lost': '../assets/media/sounds/kingdom-sounds/point-lose.mp3',
    'victory': '../assets/media/sounds/kingdom-sounds/epic-victory.mp3',
    'ai-tip': '../assets/media/sounds/kingdom-sounds/ai-notification.mp3',
    'analysis': '../assets/media/sounds/kingdom-sounds/data-process.mp3',
    'reset': '../assets/media/sounds/kingdom-sounds/cosmic-click.mp3'
  };
  
  const soundPath = sounds[soundType];
  if (soundPath) {
    const audio = new Audio(soundPath);
    
    // Apply options
    audio.volume = (options.volume || masterVolume) * (gameState.soundEnabled ? 1 : 0);
    
    // Advanced sound controls
    if (options.loop) audio.loop = true;
    if (options.delay) {
      setTimeout(() => audio.play().catch(e => console.log('Sound play failed:', e)), options.delay);
    } else {
      audio.play().catch(e => console.log('Sound play failed:', e));
    }
    
    // Track active sounds
    if (options.id) {
      activeSounds.set(options.id, audio);
    }
    
    // Auto cleanup
    audio.addEventListener('ended', () => {
      if (options.id) activeSounds.delete(options.id);
    });
    
    return audio;
  }
}

// Enhanced sound control functions
function stopSound(soundId) {
  const audio = activeSounds.get(soundId);
  if (audio) {
    audio.pause();
    audio.currentTime = 0;
    activeSounds.delete(soundId);
  }
}

function fadeOutSound(soundId, duration = 1000) {
  const audio = activeSounds.get(soundId);
  if (audio) {
    const startVolume = audio.volume;
    const fadeStep = startVolume / (duration / 50);
    
    const fadeInterval = setInterval(() => {
      audio.volume = Math.max(0, audio.volume - fadeStep);
      if (audio.volume <= 0) {
        clearInterval(fadeInterval);
        audio.pause();
        activeSounds.delete(soundId);
      }
    }, 50);
  }
}

function setMasterVolume(volume) {
  masterVolume = Math.max(0, Math.min(1, volume));
  activeSounds.forEach(audio => {
    audio.volume = masterVolume * (gameState.soundEnabled ? 1 : 0);
  });
}

// Play sound sequences
function playSoundSequence(sounds, interval = 500) {
  sounds.forEach((sound, index) => {
    setTimeout(() => {
      if (typeof sound === 'string') {
        playCosmicSound(sound);
      } else {
        playCosmicSound(sound.type, sound.options);
      }
    }, index * interval);
  });
}

function toggleSound() {
  gameState.soundEnabled = !gameState.soundEnabled;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ÿ≠ŸÉŸÖ
  updateSoundButton();
  
  // Play sound toggle feedback
  if (gameState.soundEnabled) {
    setTimeout(() => playCosmicSound('setting-change'), 100);
  }
}

// ===== NOTIFICATIONS SYSTEM =====
function showQuantumNotification(title, message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = 'quantum-notification';
  
  const icons = {
    info: 'üí´',
    success: '‚úÖ',
    warning: '‚ö†Ô∏è',
    error: '‚ùå',
    battle: '‚öîÔ∏è',
    victory: 'üëë',
    achievement: 'üèÜ',
    special: 'üéÜ'
  };
  
  // Enhanced notification sounds
  const notificationSounds = {
    info: 'notification-pop',
    success: ['notification-pop', 'magic-sparkle'],
    warning: 'time-warning',
    error: 'cosmic-click',
    battle: ['notification-pop', 'war-drum'],
    victory: ['notification-pop', 'crown-ceremony'],
    achievement: ['notification-pop', 'achievement-unlock'],
    special: ['notification-pop', 'cosmic-explosion']
  };
  
  notification.innerHTML = `
    <div class="notification-header">
      <span class="notification-icon">${icons[type] || 'üí´'}</span>
      <strong>${title}</strong>
      <button onclick="this.parentElement.parentElement.remove()" style="background:none;border:none;color:white;font-size:1.2rem;cursor:pointer;">√ó</button>
    </div>
    <div>${message}</div>
  `;
  
  document.body.appendChild(notification);
  
  // Play notification sound
  const sound = notificationSounds[type];
  if (Array.isArray(sound)) {
    playSoundSequence(sound, 300);
  } else {
    playCosmicSound(sound || 'notification-pop');
  }
  
  // Show animation
  setTimeout(() => notification.classList.add('show'), 100);
  
  // Auto remove
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 500);
  }, 5000);
}

function showWelcomeMessage() {
  // Welcome sequence with royal fanfare
  playSoundSequence([
    'kingdom-enter',
    'royal-fanfare',
    'magic-sparkle'
  ], 1000);
  
  showQuantumNotification(
    'üåü ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™!',
    'ÿßÿ≥ÿ™ÿπÿØ ŸÑÿÆŸàÿ∂ ÿ£ÿπÿ∏ŸÖ ÿßŸÑŸÖÿ∫ÿßŸÖÿ±ÿßÿ™ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸäÿ© ŸÅŸä ÿßŸÑŸÉŸàŸÜ!',
    'success'
  );
}

// ===== CHALLENGE TYPES =====
function startLightningChallenge() {
  console.log('‚ö° ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ!');
  
  // Lightning realm entrance effects
  playSoundSequence([
    'lightning-strike',
    'electric-charge',
    'thunder-rumble'
  ], 600);
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ© Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿØÿ±ÿßŸÖŸäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  const enterMessages = [
    '‚ö° ÿßŸÜŸÅÿ™ÿ≠ÿ™ ÿ£ÿ®Ÿàÿßÿ® ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!',
    'üå©Ô∏è ÿßŸÑÿπŸàÿßÿµŸÅ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ÿ™ÿ≠Ÿäÿ∑ ÿ®ŸÉŸÖ ŸÖŸÜ ŸÉŸÑ ÿ¨ÿßŸÜÿ®!',
    'üí´ ÿ∑ÿßŸÇÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ™ÿ™ÿØŸÅŸÇ ŸÅŸä ÿßŸÑŸáŸàÿßÿ° ÿ≠ŸàŸÑŸÉŸÖ!',
    '‚ö° ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ÿßŸÑÿ£ÿπÿ∏ŸÖ!',
    'üî• ÿßŸÑŸÜŸäÿ±ÿßŸÜ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ÿ™ÿ¥ÿ™ÿπŸÑ ŸÅŸä ÿ£ÿπŸäŸÜŸÉŸÖ!'
  ];
  
  const randomEnterMessage = enterMessages[Math.floor(Math.random() * enterMessages.length)];
  
  // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿ™ÿ≠ÿØŸä ÿßŸÑÿ®ÿ±ŸÇ
  createLightningArena();
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  createLightningStorm();
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿØÿÆŸàŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÖÿπ ÿ•ÿ∏Ÿáÿßÿ± ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('‚ö° ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ!', `${randomEnterMessage} (${studentsCount} ÿ∑ŸÑÿßÿ® ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'battle');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
  setTimeout(() => {
    showQuantumNotification('üß†‚ö° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ∞ŸáŸÜŸä ÿßŸÑÿ®ÿ±ŸÇŸä!', 'ÿßŸÑÿ£ÿ≥ÿ±ÿπ ŸÅŸä ÿßŸÑÿ™ŸÅŸÉŸäÿ± Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸàÿ© ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©!', 'info');
  }, 2000);
  
  setTimeout(() => {
    showQuantumNotification('üéØ ÿßŸÜÿ™ÿ®ŸáŸàÿß ÿ¨ŸäÿØÿßŸã!', 'ŸÉŸÑ ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ© = ÿµÿßÿπŸÇÿ© ÿ®ÿ±ŸÇ ŸÇŸàŸäÿ©! ‚ö°', 'warning');
  }, 4000);
}

// ===== WISDOM CHALLENGE =====
function startWisdomChallenge() {
  console.log('üß† ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!');
  
  playSoundSequence(['brain-activate', 'wisdom-chime', 'cosmic-meditation'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const wisdomMessages = [
    'üß† ÿ£ÿ®Ÿàÿßÿ® ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÜŸÅÿ™ÿ≠ ÿ£ŸÖÿßŸÖ ÿπŸÇŸàŸÑŸÉŸÖ ÿßŸÑŸÜŸäÿ±ÿ©!',
    'üí≠ ÿ±ÿ≠ŸÑÿ© ŸÅŸä ÿ£ÿπŸÖÿßŸÇ ÿßŸÑŸÅŸÉÿ± ŸàÿßŸÑÿ™ÿ£ŸÖŸÑ!',
    'üåü ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ŸäŸàŸÑÿØŸàŸÜ ŸÖŸÜ ÿ±ÿ≠ŸÖ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ!',
    'üîÆ ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿÆÿ®ÿßŸäÿß ÿßŸÑÿπŸÇŸÑ!'
  ];
  
  const randomWisdomMessage = wisdomMessages[Math.floor(Math.random() * wisdomMessages.length)];
  
  createWisdomArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üß† ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', `${randomWisdomMessage} (${studentsCount} ŸÖŸÅŸÉÿ±ŸäŸÜ ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'info');
  
  setTimeout(() => {
    showQuantumNotification('ü§î ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ!', 'ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ™ÿ≠ÿ™ÿßÿ¨ ÿµÿ®ÿ± Ÿàÿ™ÿ£ŸÖŸÑ... ÿÆÿ∞Ÿàÿß ŸàŸÇÿ™ŸÉŸÖ!', 'info');
  }, 2000);
}

// ===== CREATIVE CHALLENGE =====
function startCreativeChallenge() {
  console.log('üé® ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ!');
  
  playSoundSequence(['magic-sparkle', 'creative-flow', 'inspiration-bell'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const creativeMessages = [
    'üé® ÿ£ÿ∑ŸÑŸÇŸàÿß ÿßŸÑÿπŸÜÿßŸÜ ŸÑÿÆŸäÿßŸÑŸÉŸÖ ÿßŸÑŸÑÿßŸÖÿ≠ÿØŸàÿØ!',
    'üåà ÿπÿßŸÑŸÖ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ŸàÿßŸÑÿ•ÿ®ÿØÿßÿπ Ÿäÿ±ÿ≠ÿ® ÿ®ŸÉŸÖ!',
    '‚ú® ÿßŸÑÿ•ÿ®ÿØÿßÿπ ŸÑÿß Ÿäÿπÿ±ŸÅ ÿ≠ÿØŸàÿØ... ÿßÿ®ÿØÿπŸàÿß!',
    'üé≠ ŸÖÿ≥ÿ±ÿ≠ ÿßŸÑÿÆŸäÿßŸÑ ŸÖŸÅÿ™Ÿàÿ≠ ŸÑŸÉŸÖ!'
  ];
  
  const randomCreativeMessage = creativeMessages[Math.floor(Math.random() * creativeMessages.length)];
  
  createCreativeArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üé® ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ!', `${randomCreativeMessage} (${studentsCount} ŸÖÿ®ÿØÿπŸäŸÜ ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'success');
  
  setTimeout(() => {
    showQuantumNotification('üåü ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©!', 'ŸÅŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπÿå ŸÉŸÑ ŸÅŸÉÿ±ÿ© ŸÇŸäŸÖÿ©... ÿ¥ÿßÿ±ŸÉŸàÿß ÿ•ÿ®ÿØÿßÿπŸÉŸÖ!', 'info');
  }, 2000);
}

// ===== SCIENCE CHALLENGE =====
function startScienceChallenge() {
  console.log('üî¨ ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ!');
  
  playSoundSequence(['laboratory-beep', 'chemical-reaction', 'discovery-chime'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const scienceMessages = [
    'üî¨ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿßŸÑŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸÖŸä ÿßŸÑÿ±ŸÇŸÖŸä!',
    '‚öóÔ∏è ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑÿßŸÉÿ™ÿ¥ÿßŸÅÿßÿ™ ÿπŸÑŸÖŸäÿ© ŸÖÿ∞ŸáŸÑÿ©!',
    'üß™ ÿßŸÑÿπŸÑŸÖ Ÿäÿ®ÿØÿ£ ÿ®ŸÅÿ∂ŸàŸÑ... ŸÅÿ∂ŸàŸÑŸÉŸÖ ÿ≥ŸäŸÇŸàÿØŸÉŸÖ!',
    'üåå ÿ±ÿ≠ŸÑÿ© ŸÅŸä ÿπÿ¨ÿßÿ¶ÿ® ÿßŸÑŸÉŸàŸÜ ÿßŸÑÿπŸÑŸÖŸäÿ©!'
  ];
  
  const randomScienceMessage = scienceMessages[Math.floor(Math.random() * scienceMessages.length)];
  
  createScienceArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üî¨ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ!', `${randomScienceMessage} (${studentsCount} ÿπŸÑŸÖÿßÿ° ÿµÿ∫ÿßÿ± ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'info');
  
  setTimeout(() => {
    showQuantumNotification('üß†‚öóÔ∏è ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÑŸÖŸä!', 'ÿ±ÿßŸÇÿ®Ÿàÿßÿå ŸÅŸÉÿ±Ÿàÿßÿå ÿßŸÉÿ™ÿ¥ŸÅŸàÿß... Ÿáÿ∞ÿß ŸáŸà ÿßŸÑÿπŸÑŸÖ!', 'info');
  }, 2000);
}

// ===== LANGUAGE CHALLENGE =====
function startLanguageChallenge() {
  console.log('üìö ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÑÿ∫ÿ©!');
  
  playSoundSequence(['page-turn', 'literary-bell', 'eloquence-chime'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const languageMessages = [
    'üìö ÿ£ŸáŸÑÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿπÿßŸÑŸÖ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ¨ŸÖŸäŸÑÿ©!',
    'üìñ ÿ±ÿ≠ŸÑÿ© ŸÅŸä ÿ®ÿ≠Ÿàÿ± ÿßŸÑŸÑÿ∫ÿ© ŸàÿßŸÑÿ£ÿØÿ®!',
    '‚úíÔ∏è ÿßŸÑŸÇŸÑŸÖ ÿ£ŸÇŸàŸâ ŸÖŸÜ ÿßŸÑÿ≥ŸäŸÅ... ÿßÿ≥ÿ™ÿÆÿØŸÖŸàŸá!',
    'üó£Ô∏è ÿßŸÑŸÅÿµÿßÿ≠ÿ© ÿ™ÿßÿ¨ ÿπŸÑŸâ ÿ±ÿ§Ÿàÿ≥ ÿßŸÑÿ£ÿ∞ŸÉŸäÿßÿ°!'
  ];
  
  const randomLanguageMessage = languageMessages[Math.floor(Math.random() * languageMessages.length)];
  
  createLanguageArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üìö ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÑÿ∫ÿ©!', `${randomLanguageMessage} (${studentsCount} ÿ£ÿØÿ®ÿßÿ° ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'info');
  
  setTimeout(() => {
    showQuantumNotification('üíé ÿ¨ŸÖÿßŸÑ ÿßŸÑÿ™ÿπÿ®Ÿäÿ±!', 'ÿ£ÿ¨ŸÖŸÑ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ÿ£ÿπŸÖŸÇ ÿßŸÑÿ£ŸÅŸÉÿßÿ±!', 'info');
  }, 2000);
}

// ===== MATH CHALLENGE =====
function startMathChallenge() {
  console.log('üî¢ ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ!');
  
  playSoundSequence(['calculator-beep', 'equation-solve', 'math-victory'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const mathMessages = [
    'üî¢ ÿ£ŸáŸÑÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿπÿßŸÑŸÖ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿ≥ÿ≠ÿ±Ÿä!',
    '‚ûï ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™ ŸÑÿ∫ÿ© ÿßŸÑŸÉŸàŸÜ... ÿ™ÿ≠ÿØÿ´Ÿàÿß ÿ®Ÿáÿß!',
    'üßÆ ÿßŸÑÿπŸÇŸÑ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä ŸáŸà ÿßŸÑÿπŸÇŸÑ ÿßŸÑŸÖŸÜÿ∑ŸÇŸä!',
    'üìä ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿ™ÿ±ŸàŸä ŸÇÿµÿµ ÿ¨ŸÖŸäŸÑÿ©!'
  ];
  
  const randomMathMessage = mathMessages[Math.floor(Math.random() * mathMessages.length)];
  
  createMathArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üî¢ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ!', `${randomMathMessage} (${studentsCount} ÿ±Ÿäÿßÿ∂ŸäŸäŸÜ ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'success');
  
  setTimeout(() => {
    showQuantumNotification('‚ö°üî¢ ÿßŸÑÿ≥ÿ±ÿπÿ© ŸàÿßŸÑÿØŸÇÿ©!', 'ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™ ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ™ŸÅŸÉŸäÿ± ÿ≥ÿ±Ÿäÿπ ŸàÿØŸÇŸäŸÇ!', 'warning');
  }, 2000);
}

// ===== HISTORY CHALLENGE =====
function startHistoryChallenge() {
  console.log('üï∞Ô∏è ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ!');
  
  playSoundSequence(['ancient-bell', 'time-travel', 'historical-fanfare'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const historyMessages = [
    'üï∞Ô∏è ÿ£ŸáŸÑÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©!',
    'üèõÔ∏è ÿ±ÿ≠ŸÑÿ© ÿπÿ®ÿ± ÿßŸÑÿ≠ÿ∂ÿßÿ±ÿßÿ™ ÿßŸÑÿπÿ∏ŸäŸÖÿ©!',
    'üìú ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸäÿπŸäÿØ ŸÜŸÅÿ≥Ÿá... ÿ™ÿπŸÑŸÖŸàÿß ŸÖŸÜŸá!',
    'üëë ŸÇÿµÿµ ÿßŸÑŸÖŸÑŸàŸÉ ŸàÿßŸÑÿ®ÿ∑ŸàŸÑÿßÿ™ ÿ™ŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!'
  ];
  
  const randomHistoryMessage = historyMessages[Math.floor(Math.random() * historyMessages.length)];
  
  createHistoryArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üï∞Ô∏è ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ!', `${randomHistoryMessage} (${studentsCount} ŸÖÿ§ÿ±ÿÆŸäŸÜ ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'mystery');
  
  setTimeout(() => {
    showQuantumNotification('üìöüï∞Ô∏è ÿØÿ±Ÿàÿ≥ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ!', 'ŸÖŸÜ ŸÑÿß Ÿäÿπÿ±ŸÅ ÿ™ÿßÿ±ŸäÿÆŸá ŸÑÿß Ÿäÿ≥ÿ™ÿ∑Ÿäÿπ ÿµŸÜÿπ ŸÖÿ≥ÿ™ŸÇÿ®ŸÑŸá!', 'info');
  }, 2000);
}

// ===== MYSTERY CHALLENGE =====
function startMysteryChallenge() {
  console.log('üîÆ ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤!');
  
  playSoundSequence(['mystery-whisper', 'puzzle-click', 'revelation-chime'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const mysteryMessages = [
    'üîÆ ÿ£ŸáŸÑÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿπÿßŸÑŸÖ ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤ ÿßŸÑÿ∫ÿßŸÖÿ∂ÿ©!',
    'üß© ŸÉŸÑ ŸÑÿ∫ÿ≤ ŸÑŸá ÿ≠ŸÑ... ÿßÿ®ÿ≠ÿ´Ÿàÿß ÿπŸÜŸá!',
    'üïµÔ∏è ÿßŸÑŸÖÿ≠ŸÇŸÇŸàŸÜ ÿßŸÑÿµÿ∫ÿßÿ± ŸÅŸä ÿßŸÑŸÖŸáŸÖÿ©!',
    'üíé ÿßŸÑÿ≠ŸÑŸàŸÑ ŸÖÿÆŸÅŸäÿ© ÿÆŸÑŸÅ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ!'
  ];
  
  const randomMysteryMessage = mysteryMessages[Math.floor(Math.random() * mysteryMessages.length)];
  
  createMysteryArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üîÆ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤!', `${randomMysteryMessage} (${studentsCount} ŸÖÿ≠ŸÇŸÇŸäŸÜ ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'mystery');
  
  setTimeout(() => {
    showQuantumNotification('üß†üîç ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑŸÜŸÇÿØŸä!', 'ŸÅŸÉÿ±Ÿàÿß ÿÆÿßÿ±ÿ¨ ÿßŸÑÿµŸÜÿØŸàŸÇ... ÿßŸÑÿ≠ŸÑŸàŸÑ ÿ£ŸÇÿ±ÿ® ŸÖŸÖÿß ÿ™ÿ™ÿÆŸäŸÑŸàŸÜ!', 'info');
  }, 2000);
}

// ===== TEAM BATTLE CHALLENGE =====
function startTeamBattleChallenge() {
  console.log('‚öîÔ∏è ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©!');
  
  playSoundSequence(['battle-horn', 'war-drums', 'epic-charge'], 600);
  
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  const battleMessages = [
    '‚öîÔ∏è ÿ£ŸáŸÑÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸÅŸÉÿ±Ÿäÿ©!',
    'üõ°Ô∏è ÿßŸÑŸÅÿ±ŸÇ ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑŸÇÿ™ÿßŸÑ ÿßŸÑÿπŸÇŸÑŸä!',
    'üèÜ ŸÖŸÜ ÿ≥Ÿäÿ≠ŸÖŸÑ ŸÑŸàÿßÿ° ÿßŸÑŸÜÿµÿ±ÿü',
    'üí• ŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ£ÿ∞ŸÉŸäÿßÿ° ÿπŸÑŸâ Ÿàÿ¥ŸÉ ÿßŸÑÿ®ÿØÿßŸäÿ©!'
  ];
  
  const randomBattleMessage = battleMessages[Math.floor(Math.random() * battleMessages.length)];
  
  createTeamBattleArena();
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('‚öîÔ∏è ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©!', `${randomBattleMessage} (${studentsCount} ŸÖÿ≠ÿßÿ±ÿ®ŸäŸÜ ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'battle');
  
  setTimeout(() => {
    showQuantumNotification('ü§ù‚öîÔ∏è ÿ±Ÿàÿ≠ ÿßŸÑŸÅÿ±ŸäŸÇ!', 'ÿßŸÑŸÜÿµÿ± Ÿäÿ™ÿ∑ŸÑÿ® ÿ™ÿπÿßŸàŸÜ ÿßŸÑŸÅÿ±ŸäŸÇ... ÿßÿπŸÖŸÑŸàÿß ŸÖÿπÿßŸã!', 'warning');
  }, 2000);
}

function createLightningArena() {
  const mainApp = document.getElementById('mainApp');
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ŸÖÿ≥ÿ®ŸÇÿßŸã
  let lightningArena = document.getElementById('lightningArena');
  
  if (lightningArena) {
    // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©ÿå ŸÅŸÇÿ∑ ÿ£ÿ∏Ÿáÿ±Ÿáÿß Ÿàÿ£ÿπÿØ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
    lightningArena.style.display = 'block';
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÇÿßÿ∑ ŸàÿßŸÑŸÖÿ§ŸÇÿ™
    resetLightningArena();
  } else {
    // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ¨ÿØŸäÿØÿ©
    lightningArena = document.createElement('div');
    lightningArena.id = 'lightningArena';
    lightningArena.className = 'lightning-arena';
    
    lightningArena.innerHTML = `
      <div class="lightning-arena-container">
        <!-- ÿ±ÿ£ÿ≥ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ -->
        <div class="lightning-header">
          <div class="lightning-title-container">
            <div class="lightning-icon">‚ö°</div>
            <div>
              <h1 class="lightning-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ</h1>
              <p class="lightning-subtitle">ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≥ÿ±ÿπÿ© ŸàÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿ®ÿ±ŸÇŸä</p>
            </div>
          </div>
          
          <!-- ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä - 5 ÿØŸÇÿßÿ¶ŸÇ -->
          <div class="lightning-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="lightningTimer">5:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
          <div class="lightning-controls">
            <button class="lightning-btn" id="startQuestionBtn" onclick="startNewQuestion()">
              ‚ö° ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
            </button>
            <button class="lightning-btn secondary" onclick="pauseLightningChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="lightning-btn danger" onclick="endLightningChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
            </button>
          </div>
        </div>
        
        <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ¥ŸÅŸàŸä (ÿ™ŸÖ ŸÜŸÇŸÑŸáÿß ŸÑŸÑÿ£ÿπŸÑŸâ) -->
        <div class="question-zone">
          <div class="zone-title">ÔøΩ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ¥ŸÅŸàŸä</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∂ÿ∫ÿ∑ "‚ö° ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ¥ŸÅŸàŸäÿßŸã</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿπŸÑŸâ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ÿµŸàÿ™ Ÿàÿßÿ∂ÿ≠ ŸàŸÖÿ≥ŸÖŸàÿπ</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ÿßŸÜÿ™ÿ∏ÿ± ÿ±ŸÅÿπ ÿßŸÑÿ£ŸäÿØŸä ÿ£Ÿà ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿßÿ®</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ∞Ÿä ÿ£ÿ¨ÿßÿ® ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">5</span>
                <span>ÿßŸÑÿ∑ÿßŸÑÿ® Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ŸÜŸÇÿßÿ∑ ÿ≠ÿ≥ÿ® ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="questionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">‚ö°</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ¥ŸÅŸàŸäÿßŸã</p>
            </div>
          </div>
        </div>
        
        <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ -->
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸàŸÜ</div>
          <div class="competitors-grid" id="competitorsGrid">
            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ -->
          </div>
        </div>
        
        <!-- ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ -->
        <div class="lightning-scoreboard">
          <div class="scoreboard-title">‚ö° ŸÑŸàÿ≠ÿ© ÿßŸÑÿµŸàÿßÿπŸÇ</div>
          <div class="scores-container" id="lightningScores">
            <!-- ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß -->
          </div>
        </div>
        
        <!-- ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÇ -->
        <div class="lightning-effects" id="lightningEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(lightningArena);
  }
  
  // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
  initializeCompetitors();
  
  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
  startLightningTimer();
}

// ===== WISDOM ARENA =====
function createWisdomArena() {
  const mainApp = document.getElementById('mainApp');
  let wisdomArena = document.getElementById('wisdomArena');
  
  if (wisdomArena) {
    wisdomArena.style.display = 'block';
    resetWisdomArena();
  } else {
    wisdomArena = document.createElement('div');
    wisdomArena.id = 'wisdomArena';
    wisdomArena.className = 'wisdom-arena';
    
    wisdomArena.innerHTML = `
      <div class="wisdom-arena-container">
        <div class="wisdom-header">
          <div class="wisdom-title-container">
            <div class="wisdom-icon">üß†</div>
            <div>
              <h1 class="wisdom-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©</h1>
              <p class="wisdom-subtitle">ÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿπŸÇŸÑ ŸàÿßŸÑŸÅŸÉÿ± ÿßŸÑÿπŸÖŸäŸÇ</p>
            </div>
          </div>
          
          <div class="wisdom-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="wisdomTimer">10:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="wisdom-controls">
            <button class="wisdom-btn" id="startWisdomQuestionBtn" onclick="startNewWisdomQuestion()">
              üß† ÿ≥ÿ§ÿßŸÑ ÿ™ÿ£ŸÖŸÑŸä
            </button>
            <button class="wisdom-btn secondary" onclick="pauseWisdomChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="wisdom-btn danger" onclick="endWisdomChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">ü§î ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ™ÿ£ŸÖŸÑ ÿßŸÑŸÅŸÉÿ±Ÿä</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ™ŸÅŸÉŸäÿ± ÿπŸÖŸäŸÇ ŸàŸàŸÇÿ™ ÿ£ÿ∑ŸàŸÑ ŸÑŸÑÿ•ÿ¨ÿßÿ®ÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿßŸÖŸÜÿ≠ ÿßŸÑÿ∑ŸÑÿßÿ® ŸàŸÇÿ™ÿßŸã ŸÑŸÑÿ™ŸÅŸÉŸäÿ± ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ÿ¥ÿ¨ÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ÿπŸÑŸâ ÿ¥ÿ±ÿ≠ ÿ™ŸÅŸÉŸäÿ±ŸáŸÖ</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ∑ÿßŸÑÿ® ÿµÿßÿ≠ÿ® ÿ£ŸÅÿ∂ŸÑ ÿ•ÿ¨ÿßÿ®ÿ© ŸÖÿØÿ±Ÿàÿ≥ÿ©</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="wisdomQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üß†</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ£ŸÖŸÑ ÿßŸÑŸÅŸÉÿ±Ÿä</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ™ÿ£ŸÖŸÑŸä" ŸÑÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ Ÿäÿ≠ÿ™ÿßÿ¨ ÿ™ŸÅŸÉŸäÿ± ÿπŸÖŸäŸÇ</p>
            </div>
          </div>
        </div>
        
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ÿßŸÑŸÖŸÅŸÉÿ±ŸàŸÜ</div>
          <div class="competitors-grid" id="wisdomCompetitorsGrid"></div>
        </div>
        
        <div class="wisdom-scoreboard">
          <div class="scoreboard-title">üß† ŸÑŸàÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ°</div>
          <div class="scores-container" id="wisdomScores"></div>
        </div>
        
        <div class="wisdom-effects" id="wisdomEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(wisdomArena);
  }
  
  initializeWisdomCompetitors();
  startWisdomTimer();
}

// ===== CREATIVE ARENA =====
function createCreativeArena() {
  const mainApp = document.getElementById('mainApp');
  let creativeArena = document.getElementById('creativeArena');
  
  if (creativeArena) {
    creativeArena.style.display = 'block';
    resetCreativeArena();
  } else {
    creativeArena = document.createElement('div');
    creativeArena.id = 'creativeArena';
    creativeArena.className = 'creative-arena';
    
    creativeArena.innerHTML = `
      <div class="creative-arena-container">
        <div class="creative-header">
          <div class="creative-title-container">
            <div class="creative-icon">üé®</div>
            <div>
              <h1 class="creative-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ</h1>
              <p class="creative-subtitle">ÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿÆŸäÿßŸÑ ŸàÿßŸÑÿßÿ®ÿ™ŸÉÿßÿ±</p>
            </div>
          </div>
          
          <div class="creative-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="creativeTimer">8:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="creative-controls">
            <button class="creative-btn" onclick="startNewCreativeQuestion()">
              üé® ÿ™ÿ≠ÿØŸä ÿ•ÿ®ÿØÿßÿπŸä
            </button>
            <button class="creative-btn secondary" onclick="pauseCreativeChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="creative-btn danger" onclick="endCreativeChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">üåà ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ•ÿ®ÿØÿßÿπŸäÿ© Ÿàÿ£ÿ≥ÿ¶ŸÑÿ© ÿ™ÿ™ÿ∑ŸÑÿ® ÿÆŸäÿßŸÑ</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿ¥ÿ¨ÿπ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© ŸàÿßŸÑŸÖÿ®ÿØÿπÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ© ŸÅŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπ!</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿÆÿ™ÿ± ÿ£ŸÉÿ´ÿ± ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ•ÿ®ÿØÿßÿπÿßŸã Ÿàÿ£ÿµÿßŸÑÿ©</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="creativeQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üé®</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ•ÿ®ÿØÿßÿπ</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ≠ÿØŸä ÿ•ÿ®ÿØÿßÿπŸä" ŸÑÿ•ÿ∑ŸÑÿßŸÇ ÿÆŸäÿßŸÑ ÿßŸÑÿ∑ŸÑÿßÿ®</p>
            </div>
          </div>
        </div>
        
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ÿßŸÑŸÖÿ®ÿØÿπŸàŸÜ</div>
          <div class="competitors-grid" id="creativeCompetitorsGrid"></div>
        </div>
        
        <div class="creative-scoreboard">
          <div class="scoreboard-title">üé® ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ®ÿØÿπŸäŸÜ</div>
          <div class="scores-container" id="creativeScores"></div>
        </div>
        
        <div class="creative-effects" id="creativeEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(creativeArena);
  }
  
  initializeCreativeCompetitors();
  startCreativeTimer();
}

// ===== SCIENCE ARENA =====
function createScienceArena() {
  const mainApp = document.getElementById('mainApp');
  let scienceArena = document.getElementById('scienceArena');
  
  if (scienceArena) {
    scienceArena.style.display = 'block';
    resetScienceArena();
  } else {
    scienceArena = document.createElement('div');
    scienceArena.id = 'scienceArena';
    scienceArena.className = 'science-arena';
    
    scienceArena.innerHTML = `
      <div class="science-arena-container">
        <div class="science-header">
          <div class="science-title-container">
            <div class="science-icon">üî¨</div>
            <div>
              <h1 class="science-title">ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ</h1>
              <p class="science-subtitle">ÿ™ÿ¨ÿßÿ±ÿ® ÿπŸÑŸÖŸäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ©</p>
            </div>
          </div>
          
          <div class="science-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="scienceTimer">7:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="science-controls">
            <button class="science-btn" onclick="startNewScienceQuestion()">
              üî¨ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ©
            </button>
            <button class="science-btn secondary" onclick="pauseScienceChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="science-btn danger" onclick="endScienceChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">‚öóÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ™ÿ¨ÿßÿ±ÿ®</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿπŸÑŸÖŸäÿ© Ÿàÿ™ÿ¨ÿßÿ±ÿ® ŸÜÿ∏ÿ±Ÿäÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÑŸÖŸä ŸàÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ŸÜÿßŸÇÿ¥ ÿßŸÑÿ∏ŸàÿßŸáÿ± ÿßŸÑÿπŸÑŸÖŸäÿ© ŸÖÿπ ÿßŸÑÿ∑ŸÑÿßÿ®</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿÆÿ™ÿ± ÿ£ÿØŸÇ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿπŸÑŸÖŸäÿ©</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="scienceQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üî¨</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ¨ÿ±ÿ®ÿ©</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿßŸÑÿπŸÑŸÖŸä</p>
            </div>
          </div>
        </div>
        
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ÿßŸÑÿπŸÑŸÖÿßÿ° ÿßŸÑÿµÿ∫ÿßÿ±</div>
          <div class="competitors-grid" id="scienceCompetitorsGrid"></div>
        </div>
        
        <div class="science-scoreboard">
          <div class="scoreboard-title">üî¨ ŸÑŸàÿ≠ÿ© ÿßŸÑÿπŸÑŸÖÿßÿ°</div>
          <div class="scores-container" id="scienceScores"></div>
        </div>
        
        <div class="science-effects" id="scienceEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(scienceArena);
  }
  
  initializeScienceCompetitors();
  startScienceTimer();
}

// ===== LANGUAGE ARENA =====
function createLanguageArena() {
  const mainApp = document.getElementById('mainApp');
  let languageArena = document.getElementById('languageArena');
  
  if (languageArena) {
    languageArena.style.display = 'block';
    resetLanguageArena();
  } else {
    languageArena = document.createElement('div');
    languageArena.id = 'languageArena';
    languageArena.className = 'language-arena';
    
    languageArena.innerHTML = `
      <div class="language-arena-container">
        <div class="language-header">
          <div class="language-title-container">
            <div class="language-icon">üìö</div>
            <div>
              <h1 class="language-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÑÿ∫ÿ©</h1>
              <p class="language-subtitle">ÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ£ÿØÿ® ŸàÿßŸÑÿ®ŸÑÿßÿ∫ÿ©</p>
            </div>
          </div>
          
          <div class="language-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="languageTimer">8:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="language-controls">
            <button class="language-btn" onclick="startNewLanguageQuestion()">
              üìö ÿ™ÿ≠ÿØŸä ŸÑÿ∫ŸàŸä
            </button>
            <button class="language-btn secondary" onclick="pauseLanguageChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="language-btn danger" onclick="endLanguageChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">üìñ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ£ÿØÿ®</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÜÿ≠ŸàŸäÿ©ÿå ÿ®ŸÑÿßÿ∫Ÿäÿ©ÿå ÿ£Ÿà ÿ£ÿØÿ®Ÿäÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿ¥ÿ¨ÿπ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ ÿßŸÑÿ¨ŸÖŸäŸÑÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ÿßŸÖŸÜÿ≠ ŸÜŸÇÿßÿ∑ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ™ÿπÿ®Ÿäÿ± ÿßŸÑÿ±ÿßŸÇŸä</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿÆÿ™ÿ± ÿ£ŸÅÿµÿ≠ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ Ÿàÿ£ÿ¨ŸÖŸÑŸáÿß</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="languageQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üìö</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÑÿ∫ŸàŸä</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ≠ÿØŸä ŸÑÿ∫ŸàŸä" ŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿ¨ŸÖÿßŸÑ ÿßŸÑŸÑÿ∫ÿ©</p>
            </div>
          </div>
        </div>
        
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ÿπÿ¥ÿßŸÇ ÿßŸÑŸÑÿ∫ÿ©</div>
          <div class="competitors-grid" id="languageCompetitorsGrid"></div>
        </div>
        
        <div class="language-scoreboard">
          <div class="scoreboard-title">üìö ŸÑŸàÿ≠ÿ© ÿßŸÑÿ£ÿØÿ®ÿßÿ°</div>
          <div class="scores-container" id="languageScores"></div>
        </div>
        
        <div class="language-effects" id="languageEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(languageArena);
  }
  
  initializeLanguageCompetitors();
  startLanguageTimer();
}

// ===== MATH ARENA =====
function createMathArena() {
  const mainApp = document.getElementById('mainApp');
  let mathArena = document.getElementById('mathArena');
  
  if (mathArena) {
    mathArena.style.display = 'block';
    resetMathArena();
  } else {
    mathArena = document.createElement('div');
    mathArena.id = 'mathArena';
    mathArena.className = 'math-arena';
    
    mathArena.innerHTML = `
      <div class="math-arena-container">
        <div class="math-header">
          <div class="math-title-container">
            <div class="math-icon">üî¢</div>
            <div>
              <h1 class="math-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ</h1>
              <p class="math-subtitle">ŸÖÿ∫ÿßŸÖÿ±ÿßÿ™ ÿ±Ÿäÿßÿ∂Ÿäÿ© ŸÖŸÖÿ™ÿπÿ©</p>
            </div>
          </div>
          
          <div class="math-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="mathTimer">6:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="math-controls">
            <button class="math-btn" onclick="startNewMathQuestion()">
              üî¢ ÿ™ÿ≠ÿØŸä ÿ±Ÿäÿßÿ∂Ÿä
            </button>
            <button class="math-btn secondary" onclick="pauseMathChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="math-btn danger" onclick="endMathChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">‚ûï ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿπŸÖŸÑŸäÿßÿ™</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ŸÖÿ≥ÿßÿ¶ŸÑ ÿ±Ÿäÿßÿ∂Ÿäÿ© ŸÖÿ™ŸÜŸàÿπÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿ¥ÿ¨ÿπ ÿßŸÑÿ∑ÿ±ŸÇ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© ŸÑŸÑÿ≠ŸÑ</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ÿßŸÖŸÜÿ≠ ŸÜŸÇÿßÿ∑ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ∑ÿ±ŸÇ ÿßŸÑÿ∞ŸÉŸäÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿÆÿ™ÿ± ÿ£ÿ≥ÿ±ÿπ Ÿàÿ£ÿØŸÇ ÿßŸÑÿ≠ŸÑŸàŸÑ</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="mathQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üî¢</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ≠ÿØŸä ÿ±Ÿäÿßÿ∂Ÿä" ŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿπÿßŸÑŸÖ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ</p>
            </div>
          </div>
        </div>
        
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ÿπÿ®ÿßŸÇÿ±ÿ© ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™</div>
          <div class="competitors-grid" id="mathCompetitorsGrid"></div>
        </div>
        
        <div class="math-scoreboard">
          <div class="scoreboard-title">üî¢ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ±Ÿäÿßÿ∂ŸäŸäŸÜ</div>
          <div class="scores-container" id="mathScores"></div>
        </div>
        
        <div class="math-effects" id="mathEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(mathArena);
  }
  
  initializeMathCompetitors();
  startMathTimer();
}

// ===== HISTORY ARENA =====
function createHistoryArena() {
  const mainApp = document.getElementById('mainApp');
  let historyArena = document.getElementById('historyArena');
  
  if (historyArena) {
    historyArena.style.display = 'block';
    resetHistoryArena();
  } else {
    historyArena = document.createElement('div');
    historyArena.id = 'historyArena';
    historyArena.className = 'history-arena';
    
    historyArena.innerHTML = `
      <div class="history-arena-container">
        <div class="history-header">
          <div class="history-title-container">
            <div class="history-icon">üï∞Ô∏è</div>
            <div>
              <h1 class="history-title">ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ</h1>
              <p class="history-subtitle">ÿ±ÿ≠ŸÑÿßÿ™ ÿπÿ®ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</p>
            </div>
          </div>
          
          <div class="history-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="historyTimer">9:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="history-controls">
            <button class="history-btn" onclick="startNewHistoryQuestion()">
              üï∞Ô∏è ÿ±ÿ≠ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ©
            </button>
            <button class="history-btn secondary" onclick="pauseHistoryChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="history-btn danger" onclick="endHistoryChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ©
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">üèõÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≠ÿ∂ÿßÿ±ÿßÿ™</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ© Ÿàÿ≠ÿ∂ÿßÿ±Ÿäÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿßÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿßÿ∂Ÿä ÿ®ÿßŸÑÿ≠ÿßÿ∂ÿ±</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑŸÜŸÇÿØŸä ŸÅŸä ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿÆÿ™ÿ± ÿ£ÿπŸÖŸÇ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿ™ÿßÿ±ŸäÿÆŸäÿßŸã</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="historyQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üï∞Ô∏è</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ±ÿ≠ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ©" ŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿßŸÑŸÖÿßÿ∂Ÿä</p>
            </div>
          </div>
        </div>
        
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ŸÖÿ§ÿ±ÿÆŸà ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ</div>
          <div class="competitors-grid" id="historyCompetitorsGrid"></div>
        </div>
        
        <div class="history-scoreboard">
          <div class="scoreboard-title">üï∞Ô∏è ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ§ÿ±ÿÆŸäŸÜ</div>
          <div class="scores-container" id="historyScores"></div>
        </div>
        
        <div class="history-effects" id="historyEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(historyArena);
  }
  
  initializeHistoryCompetitors();
  startHistoryTimer();
}

// ===== MYSTERY ARENA =====
function createMysteryArena() {
  const mainApp = document.getElementById('mainApp');
  let mysteryArena = document.getElementById('mysteryArena');
  
  if (mysteryArena) {
    mysteryArena.style.display = 'block';
    resetMysteryArena();
  } else {
    mysteryArena = document.createElement('div');
    mysteryArena.id = 'mysteryArena';
    mysteryArena.className = 'mystery-arena';
    
    mysteryArena.innerHTML = `
      <div class="mystery-arena-container">
        <div class="mystery-header">
          <div class="mystery-title-container">
            <div class="mystery-icon">üîÆ</div>
            <div>
              <h1 class="mystery-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤</h1>
              <p class="mystery-subtitle">ÿ£ŸÑÿ∫ÿßÿ≤ ÿ∫ÿßŸÖÿ∂ÿ© ŸàŸÖÿ≠Ÿäÿ±ÿ©</p>
            </div>
          </div>
          
          <div class="mystery-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="mysteryTimer">10:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="mystery-controls">
            <button class="mystery-btn" onclick="startNewMysteryQuestion()">
              üîÆ ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂
            </button>
            <button class="mystery-btn secondary" onclick="pauseMysteryChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="mystery-btn danger" onclick="endMysteryChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">üß© ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßÿ∑ÿ±ÿ≠ ÿ£ŸÑÿ∫ÿßÿ≤ ŸàŸÖÿπÿ∂ŸÑÿßÿ™ ÿ∞ŸÉŸäÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿÆÿßÿ±ÿ¨ ÿßŸÑÿµŸÜÿØŸàŸÇ</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ÿßŸÖŸÜÿ≠ ŸàŸÇÿ™ ŸÉÿßŸÅŸä ŸÑŸÑÿ™ŸÅŸÉŸäÿ±</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿÆÿ™ÿ± ÿ£ÿ∞ŸÉŸâ ÿßŸÑÿ≠ŸÑŸàŸÑ Ÿàÿ£ŸÉÿ´ÿ±Ÿáÿß ÿ•ÿ®ÿØÿßÿπÿßŸã</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="mysteryQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üîÆ</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ∫ÿ≤ ÿßŸÑÿ∫ÿßŸÖÿ∂</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂" ŸÑÿ™ÿ≠ÿØŸä ÿπŸÇŸàŸÑ ÿßŸÑÿ∑ŸÑÿßÿ®</p>
            </div>
          </div>
        </div>
        
        <div class="competitors-zone">
          <div class="zone-title">üèÜ ŸÖÿ≠ŸÇŸÇŸà ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤</div>
          <div class="competitors-grid" id="mysteryCompetitorsGrid"></div>
        </div>
        
        <div class="mystery-scoreboard">
          <div class="scoreboard-title">üîÆ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ≠ŸÇŸÇŸäŸÜ</div>
          <div class="scores-container" id="mysteryScores"></div>
        </div>
        
        <div class="mystery-effects" id="mysteryEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(mysteryArena);
  }
  
  initializeMysteryCompetitors();
  startMysteryTimer();
}

// ===== TEAM BATTLE ARENA =====
function createTeamBattleArena() {
  const mainApp = document.getElementById('mainApp');
  let teamBattleArena = document.getElementById('teamBattleArena');
  
  if (teamBattleArena) {
    teamBattleArena.style.display = 'block';
    resetTeamBattleArena();
  } else {
    teamBattleArena = document.createElement('div');
    teamBattleArena.id = 'teamBattleArena';
    teamBattleArena.className = 'team-battle-arena';
    
    teamBattleArena.innerHTML = `
      <div class="team-battle-arena-container">
        <div class="team-battle-header">
          <div class="team-battle-title-container">
            <div class="team-battle-icon">‚öîÔ∏è</div>
            <div>
              <h1 class="team-battle-title">ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©</h1>
              <p class="team-battle-subtitle">ŸÖÿπÿßÿ±ŸÉ ÿ¨ŸÖÿßÿπŸäÿ© ŸÖŸÑÿ≠ŸÖŸäÿ©</p>
            </div>
          </div>
          
          <div class="team-battle-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="teamBattleTimer">12:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <div class="team-battle-controls">
            <button class="team-battle-btn" onclick="startNewTeamBattleQuestion()">
              ‚öîÔ∏è ÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÖÿπÿ±ŸÉÿ©
            </button>
            <button class="team-battle-btn secondary" onclick="pauseTeamBattleChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="team-battle-btn danger" onclick="endTeamBattleChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÖÿπÿ±ŸÉÿ©
            </button>
          </div>
        </div>
        
        <div class="question-zone">
          <div class="zone-title">‚öîÔ∏è ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÇÿ™ÿßŸÑ</div>
          <div class="gameplay-instructions">
            <h4>üìã ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑŸÑÿπÿ®:</h4>
            <div class="instructions-list">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <span>ÿßŸÑÿ∑ŸÑÿßÿ® ŸÖŸÇÿ≥ŸÖŸàŸÜ ÿ•ŸÑŸâ ŸÅÿ±ŸÇ ŸÖÿ™ŸÜÿßŸÅÿ≥ÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <span>ŸÉŸÑ ŸÅÿ±ŸäŸÇ Ÿäÿ™ÿ¥ÿßŸàÿ± ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <span>ÿßŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ£ÿ≥ÿ±ÿπ Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑŸÜŸÇÿßÿ∑</span>
              </div>
              <div class="instruction-item">
                <span class="step-number">4</span>
                <span>ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑŸÅÿ±ŸäŸÇ ÿµÿßÿ≠ÿ® ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©</span>
              </div>
            </div>
          </div>
          <div class="question-display" id="teamBattleQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">‚öîÔ∏è</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ©</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÖÿπÿ±ŸÉÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑŸÇÿ™ÿßŸÑ ÿßŸÑŸÅŸÉÿ±Ÿä</p>
            </div>
          </div>
        </div>
        
        <div class="teams-zone">
          <div class="zone-title">üèÜ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿ≠ÿßÿ±ÿ®ÿ©</div>
          <div class="teams-grid" id="teamBattleTeamsGrid"></div>
        </div>
        
        <div class="team-battle-scoreboard">
          <div class="scoreboard-title">‚öîÔ∏è ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ≠ÿßÿ±ÿ®ŸäŸÜ</div>
          <div class="scores-container" id="teamBattleScores"></div>
        </div>
        
        <div class="team-battle-effects" id="teamBattleEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(teamBattleArena);
  }
  
  initializeTeamBattleTeams();
  startTeamBattleTimer();
}

// ===== ARENA SUPPORT FUNCTIONS =====

// Wisdom Arena Functions
function resetWisdomArena() {
  wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
    wisdomTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
  selectedStudentsList.forEach((studentName, index) => {
    const scoreElement = document.getElementById(`wisdom-score-${index}`);
    if (scoreElement) scoreElement.textContent = '0';
  });
}

function initializeWisdomCompetitors() {
  const competitorsGrid = document.getElementById('wisdomCompetitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card wisdom-card';
    competitorCard.id = `wisdom-competitor-${index}`;
    competitorCard.onclick = () => selectWisdomCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="wisdom-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿ≠ŸÉŸÖÿ©</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
}

let wisdomTimerInterval;
let wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ

function startWisdomTimer() {
  const timerElement = document.getElementById('wisdomTimer');
  if (wisdomTimerInterval) clearInterval(wisdomTimerInterval);
  
  wisdomTimerInterval = setInterval(() => {
    wisdomTimeLeft--;
    const minutes = Math.floor(wisdomTimeLeft / 60);
    const seconds = wisdomTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (wisdomTimeLeft <= 0) {
      endWisdomChallengeWithLeaderboard();
    }
  }, 1000);
}

// Creative Arena Functions
function resetCreativeArena() {
  creativeTimeLeft = 480; // 8 ÿØŸÇÿßÿ¶ŸÇ
  if (creativeTimerInterval) {
    clearInterval(creativeTimerInterval);
    creativeTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
}

function initializeCreativeCompetitors() {
  const competitorsGrid = document.getElementById('creativeCompetitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card creative-card';
    competitorCard.id = `creative-competitor-${index}`;
    competitorCard.onclick = () => selectCreativeCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="creative-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿ•ÿ®ÿØÿßÿπ</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
}

let creativeTimerInterval;
let creativeTimeLeft = 480; // 8 ÿØŸÇÿßÿ¶ŸÇ

function startCreativeTimer() {
  const timerElement = document.getElementById('creativeTimer');
  if (creativeTimerInterval) clearInterval(creativeTimerInterval);
  
  creativeTimerInterval = setInterval(() => {
    creativeTimeLeft--;
    const minutes = Math.floor(creativeTimeLeft / 60);
    const seconds = creativeTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (creativeTimeLeft <= 0) {
      endCreativeChallengeWithLeaderboard();
    }
  }, 1000);
}

// Science Arena Functions
function resetScienceArena() {
  scienceTimeLeft = 420; // 7 ÿØŸÇÿßÿ¶ŸÇ
  if (scienceTimerInterval) {
    clearInterval(scienceTimerInterval);
    scienceTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
}

function initializeScienceCompetitors() {
  const competitorsGrid = document.getElementById('scienceCompetitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card science-card';
    competitorCard.id = `science-competitor-${index}`;
    competitorCard.onclick = () => selectScienceCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="science-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿ™ÿ¨ÿßÿ±ÿ®</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
}

let scienceTimerInterval;
let scienceTimeLeft = 420; // 7 ÿØŸÇÿßÿ¶ŸÇ

function startScienceTimer() {
  const timerElement = document.getElementById('scienceTimer');
  if (scienceTimerInterval) clearInterval(scienceTimerInterval);
  
  scienceTimerInterval = setInterval(() => {
    scienceTimeLeft--;
    const minutes = Math.floor(scienceTimeLeft / 60);
    const seconds = scienceTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (scienceTimeLeft <= 0) {
      endScienceChallengeWithLeaderboard();
    }
  }, 1000);
}

// Language Arena Functions
function resetLanguageArena() {
  languageTimeLeft = 480; // 8 ÿØŸÇÿßÿ¶ŸÇ
  if (languageTimerInterval) {
    clearInterval(languageTimerInterval);
    languageTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
}

function initializeLanguageCompetitors() {
  const competitorsGrid = document.getElementById('languageCompetitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card language-card';
    competitorCard.id = `language-competitor-${index}`;
    competitorCard.onclick = () => selectLanguageCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="language-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿ®ŸÑÿßÿ∫ÿ©</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
}

let languageTimerInterval;
let languageTimeLeft = 480; // 8 ÿØŸÇÿßÿ¶ŸÇ

function startLanguageTimer() {
  const timerElement = document.getElementById('languageTimer');
  if (languageTimerInterval) clearInterval(languageTimerInterval);
  
  languageTimerInterval = setInterval(() => {
    languageTimeLeft--;
    const minutes = Math.floor(languageTimeLeft / 60);
    const seconds = languageTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (languageTimeLeft <= 0) {
      endLanguageChallengeWithLeaderboard();
    }
  }, 1000);
}

// Math Arena Functions
function resetMathArena() {
  mathTimeLeft = 360; // 6 ÿØŸÇÿßÿ¶ŸÇ
  if (mathTimerInterval) {
    clearInterval(mathTimerInterval);
    mathTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
}

function initializeMathCompetitors() {
  const competitorsGrid = document.getElementById('mathCompetitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card math-card';
    competitorCard.id = `math-competitor-${index}`;
    competitorCard.onclick = () => selectMathCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="math-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿ≠ÿ≥ÿßÿ®ÿßÿ™</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
}

let mathTimerInterval;
let mathTimeLeft = 360; // 6 ÿØŸÇÿßÿ¶ŸÇ

function startMathTimer() {
  const timerElement = document.getElementById('mathTimer');
  if (mathTimerInterval) clearInterval(mathTimerInterval);
  
  mathTimerInterval = setInterval(() => {
    mathTimeLeft--;
    const minutes = Math.floor(mathTimeLeft / 60);
    const seconds = mathTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (mathTimeLeft <= 0) {
      endMathChallengeWithLeaderboard();
    }
  }, 1000);
}

// History Arena Functions
function resetHistoryArena() {
  historyTimeLeft = 540; // 9 ÿØŸÇÿßÿ¶ŸÇ
  if (historyTimerInterval) {
    clearInterval(historyTimerInterval);
    historyTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
}

function initializeHistoryCompetitors() {
  const competitorsGrid = document.getElementById('historyCompetitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card history-card';
    competitorCard.id = `history-competitor-${index}`;
    competitorCard.onclick = () => selectHistoryCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="history-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿ≠ÿ∂ÿßÿ±ÿ©</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
}

let historyTimerInterval;
let historyTimeLeft = 540; // 9 ÿØŸÇÿßÿ¶ŸÇ

function startHistoryTimer() {
  const timerElement = document.getElementById('historyTimer');
  if (historyTimerInterval) clearInterval(historyTimerInterval);
  
  historyTimerInterval = setInterval(() => {
    historyTimeLeft--;
    const minutes = Math.floor(historyTimeLeft / 60);
    const seconds = historyTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (historyTimeLeft <= 0) {
      endHistoryChallengeWithLeaderboard();
    }
  }, 1000);
}

// Mystery Arena Functions
function resetMysteryArena() {
  mysteryTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ
  if (mysteryTimerInterval) {
    clearInterval(mysteryTimerInterval);
    mysteryTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
}

function initializeMysteryCompetitors() {
  const competitorsGrid = document.getElementById('mysteryCompetitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card mystery-card';
    competitorCard.id = `mystery-competitor-${index}`;
    competitorCard.onclick = () => selectMysteryCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="mystery-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿ≠ŸÑŸàŸÑ</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
}

let mysteryTimerInterval;
let mysteryTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ

function startMysteryTimer() {
  const timerElement = document.getElementById('mysteryTimer');
  if (mysteryTimerInterval) clearInterval(mysteryTimerInterval);
  
  mysteryTimerInterval = setInterval(() => {
    mysteryTimeLeft--;
    const minutes = Math.floor(mysteryTimeLeft / 60);
    const seconds = mysteryTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (mysteryTimeLeft <= 0) {
      endMysteryChallengeWithLeaderboard();
    }
  }, 1000);
}

// Team Battle Arena Functions
function resetTeamBattleArena() {
  teamBattleTimeLeft = 720; // 12 ÿØŸÇÿßÿ¶ŸÇ
  if (teamBattleTimerInterval) {
    clearInterval(teamBattleTimerInterval);
    teamBattleTimerInterval = null;
  }
  gameState.waitingForAnswer = false;
}

function initializeTeamBattleTeams() {
  const teamsGrid = document.getElementById('teamBattleTeamsGrid');
  teamsGrid.innerHTML = '';
  
  // ÿ™ŸÇÿ≥ŸäŸÖ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ•ŸÑŸâ ŸÅÿ±ŸÇ
  const teams = divideStudentsIntoTeams(selectedStudentsList);
  
  teams.forEach((team, teamIndex) => {
    const teamCard = document.createElement('div');
    teamCard.className = 'team-card battle-team';
    teamCard.id = `team-${teamIndex}`;
    teamCard.onclick = () => selectBattleTeam(teamIndex, team);
    
    teamCard.innerHTML = `
      <div class="team-name">ŸÅÿ±ŸäŸÇ ${team.name}</div>
      <div class="team-members">${team.members.join(', ')}</div>
      <div class="team-score" id="team-score-${teamIndex}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™</div>
    `;
    
    teamsGrid.appendChild(teamCard);
  });
}

let teamBattleTimerInterval;
let teamBattleTimeLeft = 720; // 12 ÿØŸÇŸäŸÇÿ©

function startTeamBattleTimer() {
  const timerElement = document.getElementById('teamBattleTimer');
  if (teamBattleTimerInterval) clearInterval(teamBattleTimerInterval);
  
  teamBattleTimerInterval = setInterval(() => {
    teamBattleTimeLeft--;
    const minutes = Math.floor(teamBattleTimeLeft / 60);
    const seconds = teamBattleTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (teamBattleTimeLeft <= 0) {
      endTeamBattleChallengeWithLeaderboard();
    }
  }, 1000);
}

function divideStudentsIntoTeams(students) {
  const teamNames = ['ÿßŸÑÿµŸÇŸàÿ±', 'ÿßŸÑÿ£ÿ≥ŸàÿØ', 'ÿßŸÑŸÜÿ≥Ÿàÿ±', 'ÿßŸÑÿ∞ÿ¶ÿßÿ®', 'ÿßŸÑŸÅŸáŸàÿØ'];
  const teams = [];
  const studentsPerTeam = Math.ceil(students.length / Math.min(4, students.length));
  
  for (let i = 0; i < students.length; i += studentsPerTeam) {
    const teamMembers = students.slice(i, i + studentsPerTeam);
    const teamIndex = Math.floor(i / studentsPerTeam);
    teams.push({
      name: teamNames[teamIndex] || `ÿßŸÑŸÅÿ±ŸäŸÇ ${teamIndex + 1}`,
      members: teamMembers,
      score: 0
    });
  }
  
  return teams;
}

// ===== QUESTION MANAGEMENT FOR ALL ARENAS =====

// Wisdom Arena Questions
function startNewWisdomQuestion() {
  playCosmicSound('brain-activate');
  
  const wisdomQuestions = [
    'ü§î ÿ≥ÿ§ÿßŸÑ ÿ™ÿ£ŸÖŸÑŸä ÿπŸÖŸäŸÇ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ∑ÿ±ÿ≠!',
    'üí≠ ŸÅŸÉÿ±Ÿàÿß ÿ®ŸáÿØŸàÿ° ŸàÿπŸÖŸÇ ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑ...',
    'üß† ŸàŸÇÿ™ ÿßŸÑÿ™ÿ£ŸÖŸÑ ŸàÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ!',
    'üåü ÿßÿ™ÿ±ŸÉŸàÿß ÿπŸÇŸàŸÑŸÉŸÖ ÿ™ÿ™ÿ¨ŸàŸÑ ŸÅŸä ÿ£ÿπŸÖÿßŸÇ ÿßŸÑÿ≠ŸÉŸÖÿ©!'
  ];
  
  const randomMessage = wisdomQuestions[Math.floor(Math.random() * wisdomQuestions.length)];
  
  const questionDisplay = document.getElementById('wisdomQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">ü§î</div>
      <h2>ÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿßŸÑÿ™ÿ£ŸÖŸÑŸä ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿßŸÖŸÜÿ≠ ÿßŸÑÿ∑ŸÑÿßÿ® ŸàŸÇÿ™ÿßŸã ŸÉÿßŸÅŸäÿßŸã ŸÑŸÑÿ™ŸÅŸÉŸäÿ±ÿå ÿ´ŸÖ ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ£ŸÅÿ∂ŸÑ ÿ•ÿ¨ÿßÿ®ÿ© ŸÖÿØÿ±Ÿàÿ≥ÿ©
      </div>
      <button class="wisdom-btn" onclick="cancelWisdomQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('ü§î ÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÜÿ¥ÿ∑', randomMessage, 'info');
}

function selectWisdomCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const wisdomMessages = [
    `üß†üíé ${studentName} ÿ£ÿ∏Ÿáÿ± ÿ≠ŸÉŸÖÿ© ÿ±ÿßÿ¶ÿπÿ©!`,
    `üåüü§î ${studentName} ŸÅŸÉÿ± ÿ®ÿπŸÖŸÇ Ÿàÿ£ÿ®ÿØÿπ!`,
    `üí´üìö ${studentName} ŸàÿµŸÑ ŸÑÿ£ÿπŸÖÿßŸÇ ÿßŸÑÿ≠ŸÉŸÖÿ©!`,
    `üîÆüí≠ ${studentName} ÿ≠ŸÉŸäŸÖ ÿµÿ∫Ÿäÿ±!`
  ];
  
  const randomMessage = wisdomMessages[Math.floor(Math.random() * wisdomMessages.length)];
  
  const scoreElement = document.getElementById(`wisdom-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  const competitorCard = document.getElementById(`wisdom-competitor-${index}`);
  competitorCard.classList.add('answered-correct');
  setTimeout(() => competitorCard.classList.remove('answered-correct'), 1000);
  
  playSoundSequence(['wisdom-chime', 'achievement-unlock'], 200);
  
  resetWisdomQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('üß† ÿ≠ŸÉŸÖÿ© ÿ±ÿßÿ¶ÿπÿ©!', randomMessage, 'success');
}

function cancelWisdomQuestion() {
  resetWisdomQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ', 'ü§î ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØ ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ±ŸÉŸÖ!', 'info');
}

function resetWisdomQuestionZone() {
  const questionDisplay = document.getElementById('wisdomQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üß†</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ£ŸÖŸÑ ÿßŸÑŸÅŸÉÿ±Ÿä</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ™ÿ£ŸÖŸÑŸä" ŸÑÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ Ÿäÿ≠ÿ™ÿßÿ¨ ÿ™ŸÅŸÉŸäÿ± ÿπŸÖŸäŸÇ</p>
    </div>
  `;
}

function endWisdomChallengeWithLeaderboard() {
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
    wisdomTimerInterval = null;
  }
  
  playCosmicSound('epic-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™ŸáŸâ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'üß† ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑÿ≠ŸÇŸäŸÇŸäŸàŸÜ...', 'success');
  
  setTimeout(() => {
    showArenaLeaderboard('wisdom', 'ÿ≠ŸÉŸÖÿßÿ°', 'üß†');
  }, 2000);
}

// Creative Arena Questions
function startNewCreativeQuestion() {
  playCosmicSound('magic-sparkle');
  
  const creativePrompts = [
    'üé® ÿ≠ÿ±ÿ±Ÿàÿß ÿÆŸäÿßŸÑŸÉŸÖ ÿ®ŸÑÿß ÿ≠ÿØŸàÿØ!',
    'üåà ÿ£ÿ®ÿØÿπŸàÿß ÿ¥Ÿäÿ¶ÿßŸã ŸÑŸÖ ŸäŸÅŸÉÿ± ÿ®Ÿá ÿ£ÿ≠ÿØ ŸÖŸÜ ŸÇÿ®ŸÑ!',
    '‚ú® ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ© ŸÅŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπ!',
    'üé≠ ÿßÿ¨ÿπŸÑŸàÿß ÿÆŸäÿßŸÑŸÉŸÖ Ÿäÿ∑Ÿäÿ± ÿπÿßŸÑŸäÿßŸã!'
  ];
  
  const randomPrompt = creativePrompts[Math.floor(Math.random() * creativePrompts.length)];
  
  const questionDisplay = document.getElementById('creativeQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">üé®</div>
      <h2>ÿ™ÿ≠ÿØŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπ ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ™ÿ≠ÿØŸäŸÉ ÿßŸÑÿ•ÿ®ÿØÿßÿπŸä ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿ¥ÿ¨ÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ŸàÿßÿÆÿ™ÿ± ÿ£ŸÉÿ´ÿ±Ÿáÿß ÿ•ÿ®ÿØÿßÿπÿßŸã Ÿàÿ£ÿµÿßŸÑÿ©
      </div>
      <button class="creative-btn" onclick="cancelCreativeQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('üé® ÿ™ÿ≠ÿØŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπ ŸÜÿ¥ÿ∑', randomPrompt, 'success');
}

function selectCreativeCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ÿ•ÿ®ÿØÿßÿπŸä ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const creativeMessages = [
    `üé®üåü ${studentName} ÿ£ÿ®ÿØÿπ ÿ•ÿ®ÿØÿßÿπÿßŸã ŸÖÿ∞ŸáŸÑÿßŸã!`,
    `üåà‚ú® ${studentName} ŸÅŸÜÿßŸÜ ÿ≠ŸÇŸäŸÇŸä!`,
    `üé≠üí´ ${studentName} ÿÆŸäÿßŸÑŸá ŸÑÿß ŸÖÿ≠ÿØŸàÿØ!`,
    `ü¶Ñüé® ${studentName} ŸÖÿ®ÿØÿπ ŸÖŸÜ ÿ∑ÿ±ÿßÿ≤ ÿÆÿßÿµ!`
  ];
  
  const randomMessage = creativeMessages[Math.floor(Math.random() * creativeMessages.length)];
  
  const scoreElement = document.getElementById(`creative-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  playSoundSequence(['magic-sparkle', 'creative-chime'], 200);
  
  resetCreativeQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('üé® ÿ•ÿ®ÿØÿßÿπ ÿ±ÿßÿ¶ÿπ!', randomMessage, 'success');
}

function cancelCreativeQuestion() {
  resetCreativeQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä', 'üé® ÿ™ÿ≠ÿØŸä ÿ•ÿ®ÿØÿßÿπŸä ÿ¨ÿØŸäÿØ ŸäŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!', 'info');
}

function resetCreativeQuestionZone() {
  const questionDisplay = document.getElementById('creativeQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üé®</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ•ÿ®ÿØÿßÿπ</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ≠ÿØŸä ÿ•ÿ®ÿØÿßÿπŸä" ŸÑÿ•ÿ∑ŸÑÿßŸÇ ÿÆŸäÿßŸÑ ÿßŸÑÿ∑ŸÑÿßÿ®</p>
    </div>
  `;
}

function endCreativeChallengeWithLeaderboard() {
  if (creativeTimerInterval) {
    clearInterval(creativeTimerInterval);
    creativeTimerInterval = null;
  }
  
  playCosmicSound('creative-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™ŸáŸâ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπ!', 'üé® ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ÿßŸÑŸÅŸÜÿßŸÜŸàŸÜ ÿßŸÑÿ≠ŸÇŸäŸÇŸäŸàŸÜ...', 'success');
  
  setTimeout(() => {
    showArenaLeaderboard('creative', 'ŸÖÿ®ÿØÿπŸäŸÜ', 'üé®');
  }, 2000);
}

// Science Arena Questions
function startNewScienceQuestion() {
  playCosmicSound('laboratory-beep');
  
  const sciencePrompts = [
    'üî¨ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ© ŸÖÿ´Ÿäÿ±ÿ© ÿ™ŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!',
    '‚öóÔ∏è ŸàŸÇÿ™ ÿßŸÑÿßŸÉÿ™ÿ¥ÿßŸÅ ÿßŸÑÿπŸÑŸÖŸä!',
    'üß™ ÿßŸÑÿπŸÑŸÖ Ÿäÿ®ÿØÿ£ ÿ®ÿ≥ÿ§ÿßŸÑ ÿ∞ŸÉŸä!',
    'üåå ÿßÿ≥ÿ™ŸÉÿ¥ŸÅŸàÿß ÿπÿ¨ÿßÿ¶ÿ® ÿßŸÑŸÉŸàŸÜ!'
  ];
  
  const randomPrompt = sciencePrompts[Math.floor(Math.random() * sciencePrompts.length)];
  
  const questionDisplay = document.getElementById('scienceQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">üî¨</div>
      <h2>ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑÿπŸÑŸÖŸäÿ© ÿ¨ÿßŸáÿ≤ÿ©!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿßŸÑÿπŸÑŸÖŸä ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÑŸÖŸä ŸàÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ© ÿßŸÑÿØŸÇŸäŸÇÿ©
      </div>
      <button class="science-btn" onclick="cancelScienceQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('üî¨ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ© ŸÜÿ¥ÿ∑ÿ©', randomPrompt, 'info');
}

function selectScienceCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ© ÿ¨ÿØŸäÿØÿ© ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const scienceMessages = [
    `üî¨üåü ${studentName} ÿπÿßŸÑŸÖ ÿµÿ∫Ÿäÿ± ŸÖÿ™ŸÖŸäÿ≤!`,
    `‚öóÔ∏èüí´ ${studentName} ÿ£ÿ¨ÿ±Ÿâ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ±ÿßÿ¶ÿπÿ©!`,
    `üß™üî• ${studentName} ŸÖŸÉÿ™ÿ¥ŸÅ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ!`,
    `üååüî¨ ${studentName} ÿπÿ®ŸÇÿ±Ÿä ÿπŸÑŸÖŸä!`
  ];
  
  const randomMessage = scienceMessages[Math.floor(Math.random() * scienceMessages.length)];
  
  const scoreElement = document.getElementById(`science-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  playSoundSequence(['discovery-chime', 'scientific-success'], 200);
  
  resetScienceQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('üî¨ ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿ±ÿßÿ¶ÿπ!', randomMessage, 'success');
}

function cancelScienceQuestion() {
  resetScienceQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©', 'üî¨ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ© ÿ¨ÿØŸäÿØÿ© ÿ™ŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!', 'info');
}

function resetScienceQuestionZone() {
  const questionDisplay = document.getElementById('scienceQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üî¨</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ¨ÿ±ÿ®ÿ©</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ¨ÿ±ÿ®ÿ© ÿπŸÑŸÖŸäÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿßŸÑÿπŸÑŸÖŸä</p>
    </div>
  `;
}

function endScienceChallengeWithLeaderboard() {
  if (scienceTimerInterval) {
    clearInterval(scienceTimerInterval);
    scienceTimerInterval = null;
  }
  
  playCosmicSound('scientific-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ™ÿ¨ÿßÿ±ÿ® ÿßŸÑÿπŸÑŸÖŸäÿ©!', 'üî¨ ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ÿßŸÑÿπŸÑŸÖÿßÿ° ÿßŸÑÿµÿ∫ÿßÿ±...', 'success');
  
  setTimeout(() => {
    showArenaLeaderboard('science', 'ÿπŸÑŸÖÿßÿ°', 'üî¨');
  }, 2000);
}

// Language Arena Questions
function startNewLanguageQuestion() {
  playCosmicSound('literary-bell');
  
  const languagePrompts = [
    'üìö ŸÉŸÑŸÖÿßÿ™ ÿ¨ŸÖŸäŸÑÿ© ÿ™ŸÜÿ™ÿ∏ÿ± ÿßŸÑÿ™ÿπÿ®Ÿäÿ±!',
    'üìñ ÿ±ÿ≠ŸÑÿ© ŸÅŸä ÿ®ÿ≠Ÿàÿ± ÿßŸÑŸÑÿ∫ÿ©!',
    '‚úíÔ∏è ÿ£ÿ∏Ÿáÿ±Ÿàÿß ÿ¨ŸÖÿßŸÑ ŸÑÿ∫ÿ™ŸÉŸÖ!',
    'üó£Ô∏è ÿßŸÑŸÅÿµÿßÿ≠ÿ© ÿ™ÿ™ÿ≠ÿØÿ´ ÿßŸÑÿ¢ŸÜ!'
  ];
  
  const randomPrompt = languagePrompts[Math.floor(Math.random() * languagePrompts.length)];
  
  const questionDisplay = document.getElementById('languageQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">üìö</div>
      <h2>ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÑÿ∫ŸàŸä ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿßŸÑŸÑÿ∫ŸàŸä ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿ¥ÿ¨ÿπ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ ÿßŸÑÿ¨ŸÖŸäŸÑÿ© ŸàÿßŸÑÿ™ÿπÿ®Ÿäÿ± ÿßŸÑÿ±ÿßŸÇŸä
      </div>
      <button class="language-btn" onclick="cancelLanguageQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('üìö ÿ™ÿ≠ÿØŸä ŸÑÿ∫ŸàŸä ŸÜÿ¥ÿ∑', randomPrompt, 'info');
}

function selectLanguageCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÑÿ∫ŸàŸä ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const languageMessages = [
    `üìöüíé ${studentName} ÿ£ÿØŸäÿ® ÿµÿ∫Ÿäÿ± ÿ±ÿßÿ¶ÿπ!`,
    `üìñüåü ${studentName} Ÿäÿ™ŸÇŸÜ ŸÅŸÜ ÿßŸÑŸÉŸÑÿßŸÖ!`,
    `‚úíÔ∏èüí´ ${studentName} ŸÇŸÑŸÖ ÿ∞Ÿáÿ®Ÿä!`,
    `üó£Ô∏èüëë ${studentName} ÿÆÿ∑Ÿäÿ® ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ!`
  ];
  
  const randomMessage = languageMessages[Math.floor(Math.random() * languageMessages.length)];
  
  const scoreElement = document.getElementById(`language-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  playSoundSequence(['eloquence-chime', 'literary-success'], 200);
  
  resetLanguageQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('üìö ÿ™ÿπÿ®Ÿäÿ± ÿ±ÿßÿ¶ÿπ!', randomMessage, 'success');
}

function cancelLanguageQuestion() {
  resetLanguageQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä', 'üìö ÿ™ÿ≠ÿØŸä ŸÑÿ∫ŸàŸä ÿ¨ÿØŸäÿØ ŸäŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!', 'info');
}

function resetLanguageQuestionZone() {
  const questionDisplay = document.getElementById('languageQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üìö</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÑÿ∫ŸàŸä</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ≠ÿØŸä ŸÑÿ∫ŸàŸä" ŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿ¨ŸÖÿßŸÑ ÿßŸÑŸÑÿ∫ÿ©</p>
    </div>
  `;
}

function endLanguageChallengeWithLeaderboard() {
  if (languageTimerInterval) {
    clearInterval(languageTimerInterval);
    languageTimerInterval = null;
  }
  
  playCosmicSound('literary-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™ŸáŸâ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÑÿ∫ŸàŸä!', 'üìö ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ÿßŸÑÿ£ÿØÿ®ÿßÿ° ÿßŸÑÿµÿ∫ÿßÿ±...', 'success');
  
  setTimeout(() => {
    showArenaLeaderboard('language', 'ÿ£ÿØÿ®ÿßÿ°', 'üìö');
  }, 2000);
}

// Math Arena Questions
function startNewMathQuestion() {
  playCosmicSound('calculator-beep');
  
  const mathPrompts = [
    'üî¢ ÿ™ÿ≠ÿØŸä ÿ±Ÿäÿßÿ∂Ÿä ŸÖÿ´Ÿäÿ±!',
    '‚ûï ŸàŸÇÿ™ ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ®Ÿäÿ©!',
    'üßÆ ÿ£ÿ∏Ÿáÿ±Ÿàÿß ŸÖŸáÿßÿ±ÿßÿ™ŸÉŸÖ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿ©!',
    'üìä ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿ™ŸÜÿ™ÿ∏ÿ± ÿßŸÑÿ≠ŸÑŸàŸÑ!'
  ];
  
  const randomPrompt = mathPrompts[Math.floor(Math.random() * mathPrompts.length)];
  
  const questionDisplay = document.getElementById('mathQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">üî¢</div>
      <h2>ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ŸÖÿ≥ÿ£ŸÑÿ™ŸÉ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿ© ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿ¥ÿ¨ÿπ ÿßŸÑÿ∑ÿ±ŸÇ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© ŸÑŸÑÿ≠ŸÑ ŸàÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑŸÖŸÜÿ∑ŸÇŸä
      </div>
      <button class="math-btn" onclick="cancelMathQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÖÿ≥ÿ£ŸÑÿ©
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('üî¢ ÿ™ÿ≠ÿØŸä ÿ±Ÿäÿßÿ∂Ÿä ŸÜÿ¥ÿ∑', randomPrompt, 'success');
}

function selectMathCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ÿ±Ÿäÿßÿ∂Ÿä ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const mathMessages = [
    `üî¢üèÜ ${studentName} ÿπÿ®ŸÇÿ±Ÿä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™!`,
    `‚ûïüí´ ${studentName} ÿ≠ÿßÿ≥ÿ® ÿ≥ÿ±Ÿäÿπ ŸàÿØŸÇŸäŸÇ!`,
    `üßÆüåü ${studentName} ÿ¢ŸÑÿ© ÿ≠ÿßÿ≥ÿ®ÿ© ÿ®ÿ¥ÿ±Ÿäÿ©!`,
    `üìäüëë ${studentName} ŸÖŸÑŸÉ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ!`
  ];
  
  const randomMessage = mathMessages[Math.floor(Math.random() * mathMessages.length)];
  
  const scoreElement = document.getElementById(`math-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  playSoundSequence(['math-success', 'calculation-complete'], 200);
  
  resetMathQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('üî¢ ÿ≠ŸÑ ÿ±ÿßÿ¶ÿπ!', randomMessage, 'success');
}

function cancelMathQuestion() {
  resetMathQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÖÿ≥ÿ£ŸÑÿ©', 'üî¢ ŸÖÿ≥ÿ£ŸÑÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ© ÿ¨ÿØŸäÿØÿ© ÿ™ŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!', 'info');
}

function resetMathQuestionZone() {
  const questionDisplay = document.getElementById('mathQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üî¢</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ™ÿ≠ÿØŸä ÿ±Ÿäÿßÿ∂Ÿä" ŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿπÿßŸÑŸÖ ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ</p>
    </div>
  `;
}

function endMathChallengeWithLeaderboard() {
  if (mathTimerInterval) {
    clearInterval(mathTimerInterval);
    mathTimerInterval = null;
  }
  
  playCosmicSound('mathematical-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™ŸáŸâ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä!', 'üî¢ ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ÿπÿ®ÿßŸÇÿ±ÿ© ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™...', 'success');
  
  setTimeout(() => {
    showArenaLeaderboard('math', 'ÿ±Ÿäÿßÿ∂ŸäŸäŸÜ', 'üî¢');
  }, 2000);
}

// History Arena Questions
function startNewHistoryQuestion() {
  playCosmicSound('ancient-bell');
  
  const historyPrompts = [
    'üï∞Ô∏è ÿ±ÿ≠ŸÑÿ© ÿπÿ®ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ!',
    'üèõÔ∏è ŸÇÿµÿµ ÿßŸÑÿ≠ÿ∂ÿßÿ±ÿßÿ™ ÿßŸÑÿπÿ∏ŸäŸÖÿ©!',
    'üìú ÿØÿ±ÿ≥ ŸÖŸÜ ÿßŸÑŸÖÿßÿ∂Ÿä ŸÑŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ!',
    'üëë ÿ®ÿ∑ŸàŸÑÿßÿ™ Ÿàÿ£ŸÖÿ¨ÿßÿØ ÿ™ÿßÿ±ŸäÿÆŸäÿ©!'
  ];
  
  const randomPrompt = historyPrompts[Math.floor(Math.random() * historyPrompts.length)];
  
  const questionDisplay = document.getElementById('historyQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">üï∞Ô∏è</div>
      <h2>ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ© ÿ¨ÿßŸáÿ≤ÿ©!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸä ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿßÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿßÿ∂Ÿä ÿ®ÿßŸÑÿ≠ÿßÿ∂ÿ± Ÿàÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑŸÜŸÇÿØŸä
      </div>
      <button class="history-btn" onclick="cancelHistoryQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ©
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('üï∞Ô∏è ÿ±ÿ≠ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ© ŸÜÿ¥ÿ∑ÿ©', randomPrompt, 'mystery');
}

function selectHistoryCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ±ÿ≠ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ© ÿ¨ÿØŸäÿØÿ© ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const historyMessages = [
    `üï∞Ô∏èüèÜ ${studentName} ŸÖÿ§ÿ±ÿÆ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ!`,
    `üèõÔ∏èüí´ ${studentName} ÿÆÿ®Ÿäÿ± ÿßŸÑÿ≠ÿ∂ÿßÿ±ÿßÿ™!`,
    `üìúüåü ${studentName} ÿ≠ÿßŸÅÿ∏ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ!`,
    `üëë‚≠ê ${studentName} ÿ±ÿßŸàŸä ÿßŸÑÿ®ÿ∑ŸàŸÑÿßÿ™!`
  ];
  
  const randomMessage = historyMessages[Math.floor(Math.random() * historyMessages.length)];
  
  const scoreElement = document.getElementById(`history-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  playSoundSequence(['historical-triumph', 'ancient-victory'], 200);
  
  resetHistoryQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('üï∞Ô∏è ŸÖÿπÿ±ŸÅÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ© ÿ±ÿßÿ¶ÿπÿ©!', randomMessage, 'success');
}

function cancelHistoryQuestion() {
  resetHistoryQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ©', 'üï∞Ô∏è ÿ±ÿ≠ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ© ÿ¨ÿØŸäÿØÿ© ÿ™ŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!', 'info');
}

function resetHistoryQuestionZone() {
  const questionDisplay = document.getElementById('historyQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üï∞Ô∏è</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ±ÿ≠ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ©" ŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ÿßŸÑŸÖÿßÿ∂Ÿä</p>
    </div>
  `;
}

function endHistoryChallengeWithLeaderboard() {
  if (historyTimerInterval) {
    clearInterval(historyTimerInterval);
    historyTimerInterval = null;
  }
  
  playCosmicSound('historical-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©!', 'üï∞Ô∏è ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ŸÖÿ§ÿ±ÿÆŸà ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ...', 'success');
  
  setTimeout(() => {
    showArenaLeaderboard('history', 'ŸÖÿ§ÿ±ÿÆŸäŸÜ', 'üï∞Ô∏è');
  }, 2000);
}

// Mystery Arena Questions
function startNewMysteryQuestion() {
  playCosmicSound('mystery-whisper');
  
  const mysteryPrompts = [
    'üîÆ ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂ ŸàŸÖÿ≠Ÿäÿ±!',
    'üß© ŸÖÿπÿ∂ŸÑÿ© ÿ™ÿ≠ÿ™ÿßÿ¨ ÿ∞ŸÉÿßÿ°!',
    'üïµÔ∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ≠ŸÇŸäŸÇ ŸàÿßŸÑÿßÿ≥ÿ™ÿØŸÑÿßŸÑ!',
    'üíé ÿßŸÑÿ≠ŸÑ ŸÖÿÆŸÅŸä ŸÅŸä ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ!'
  ];
  
  const randomPrompt = mysteryPrompts[Math.floor(Math.random() * mysteryPrompts.length)];
  
  const questionDisplay = document.getElementById('mysteryQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">üîÆ</div>
      <h2>ÿßŸÑŸÑÿ∫ÿ≤ ÿßŸÑÿ∫ÿßŸÖÿ∂ ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ŸÑÿ∫ÿ≤ŸÉ ÿßŸÑÿ∫ÿßŸÖÿ∂ ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿÆÿßÿ±ÿ¨ ÿßŸÑÿµŸÜÿØŸàŸÇ ŸàÿßŸÑÿ≠ŸÑŸàŸÑ ÿßŸÑÿ•ÿ®ÿØÿßÿπŸäÿ©
      </div>
      <button class="mystery-btn" onclick="cancelMysteryQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÑÿ∫ÿ≤
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('üîÆ ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂ ŸÜÿ¥ÿ∑', randomPrompt, 'mystery');
}

function selectMysteryCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂ ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const mysteryMessages = [
    `üîÆüèÜ ${studentName} ŸÖÿ≠ŸÇŸÇ ÿπÿ®ŸÇÿ±Ÿä!`,
    `üß©üí´ ${studentName} ÿ≠ŸÑÿßŸÑ ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤!`,
    `üïµÔ∏èüåü ${studentName} ÿßŸÑŸÖÿ≠ŸÇŸÇ ÿßŸÑÿµÿ∫Ÿäÿ±!`,
    `üíé‚≠ê ${studentName} ŸÉÿßÿ¥ŸÅ ÿßŸÑÿ£ÿ≥ÿ±ÿßÿ±!`
  ];
  
  const randomMessage = mysteryMessages[Math.floor(Math.random() * mysteryMessages.length)];
  
  const scoreElement = document.getElementById(`mystery-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  playSoundSequence(['mystery-solved', 'revelation-chime'], 200);
  
  resetMysteryQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('üîÆ ŸÑÿ∫ÿ≤ ŸÖÿ≠ŸÑŸàŸÑ!', randomMessage, 'success');
}

function cancelMysteryQuestion() {
  resetMysteryQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÑÿ∫ÿ≤', 'üîÆ ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂ ÿ¨ÿØŸäÿØ ŸäŸÜÿ™ÿ∏ÿ±ŸÉŸÖ!', 'info');
}

function resetMysteryQuestionZone() {
  const questionDisplay = document.getElementById('mysteryQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üîÆ</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ∫ÿ≤ ÿßŸÑÿ∫ÿßŸÖÿ∂</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂" ŸÑÿ™ÿ≠ÿØŸä ÿπŸÇŸàŸÑ ÿßŸÑÿ∑ŸÑÿßÿ®</p>
    </div>
  `;
}

function endMysteryChallengeWithLeaderboard() {
  if (mysteryTimerInterval) {
    clearInterval(mysteryTimerInterval);
    mysteryTimerInterval = null;
  }
  
  playCosmicSound('mystery-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™Ÿáÿ™ ÿ£ŸÑÿ∫ÿßÿ≤ ÿßŸÑŸÖŸÖŸÑŸÉÿ©!', 'üîÆ ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ÿßŸÑŸÖÿ≠ŸÇŸÇŸàŸÜ ÿßŸÑÿπÿ®ÿßŸÇÿ±ÿ©...', 'success');
  
  setTimeout(() => {
    showArenaLeaderboard('mystery', 'ŸÖÿ≠ŸÇŸÇŸäŸÜ', 'üîÆ');
  }, 2000);
}

// Team Battle Arena Questions
function startNewTeamBattleQuestion() {
  playCosmicSound('battle-horn');
  
  const battlePrompts = [
    '‚öîÔ∏è ŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ≠ÿ™ÿØŸÖÿ©!',
    'üõ°Ô∏è ŸàŸÇÿ™ ÿ•ÿ´ÿ®ÿßÿ™ ŸÇŸàÿ© ÿßŸÑŸÅÿ±ŸäŸÇ!',
    'üèÜ ŸÖŸÜ ÿ≥Ÿäÿ≠ŸÖŸÑ ÿ±ÿßŸäÿ© ÿßŸÑŸÜÿµÿ±ÿü',
    'üí• ÿµÿ±ÿßÿπ ÿßŸÑÿ£ÿ∞ŸÉŸäÿßÿ° ÿπŸÑŸâ ŸÇŸÖÿ© ÿßŸÑŸÖÿ¨ÿØ!'
  ];
  
  const randomPrompt = battlePrompts[Math.floor(Math.random() * battlePrompts.length)];
  
  const questionDisplay = document.getElementById('teamBattleQuestionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">‚öîÔ∏è</div>
      <h2>ÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿßŸÖŸÜÿ≠ ÿßŸÑŸÅÿ±ŸÇ ŸàŸÇÿ™ÿßŸã ŸÑŸÑÿ™ÿ¥ÿßŸàÿ±ÿå ÿ´ŸÖ ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ±ŸäŸÇ ÿµÿßÿ≠ÿ® ÿ£ŸÅÿ∂ŸÑ ÿ•ÿ¨ÿßÿ®ÿ©
      </div>
      <button class="team-battle-btn" onclick="cancelTeamBattleQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÖÿπÿ±ŸÉÿ©
      </button>
    </div>
  `;
  
  gameState.waitingForAnswer = true;
  showQuantumNotification('‚öîÔ∏è ŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸÅÿ±ŸÇ ŸÜÿ¥ÿ∑ÿ©', randomPrompt, 'battle');
}

function selectBattleTeam(teamIndex, team) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ŸÖÿπÿ±ŸÉÿ© ÿ¨ÿØŸäÿØÿ© ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  const battleMessages = [
    `‚öîÔ∏èüèÜ ŸÅÿ±ŸäŸÇ ${team.name} ŸÖÿ≠ÿßÿ±ÿ®ŸàŸÜ ÿ£ÿ¥ÿØÿßÿ°!`,
    `üõ°Ô∏èüí´ ŸÅÿ±ŸäŸÇ ${team.name} ŸäŸÇŸàÿØ ÿßŸÑŸÖÿπÿ±ŸÉÿ©!`,
    `üèÜüåü ŸÅÿ±ŸäŸÇ ${team.name} ÿ£ÿ®ÿ∑ÿßŸÑ ÿ≠ŸÇŸäŸÇŸäŸàŸÜ!`,
    `üí•‚≠ê ŸÅÿ±ŸäŸÇ ${team.name} ŸÇŸàÿ© ŸÑÿß ÿ™ŸèŸÇŸáÿ±!`
  ];
  
  const randomMessage = battleMessages[Math.floor(Math.random() * battleMessages.length)];
  
  const scoreElement = document.getElementById(`team-score-${teamIndex}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  playSoundSequence(['battle-victory', 'team-triumph'], 200);
  
  resetTeamBattleQuestionZone();
  gameState.waitingForAnswer = false;
  
  showQuantumNotification('‚öîÔ∏è ÿßŸÜÿ™ÿµÿßÿ± ÿßŸÑŸÅÿ±ŸäŸÇ!', randomMessage, 'battle');
}

function cancelTeamBattleQuestion() {
  resetTeamBattleQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÖÿπÿ±ŸÉÿ©', '‚öîÔ∏è ŸÖÿπÿ±ŸÉÿ© ÿ¨ÿØŸäÿØÿ© ÿ™ŸÜÿ™ÿ∏ÿ± ÿßŸÑŸÅÿ±ŸÇ!', 'info');
}

function resetTeamBattleQuestionZone() {
  const questionDisplay = document.getElementById('teamBattleQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">‚öîÔ∏è</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ©</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÖÿπÿ±ŸÉÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑŸÇÿ™ÿßŸÑ ÿßŸÑŸÅŸÉÿ±Ÿä</p>
    </div>
  `;
}

function endTeamBattleChallengeWithLeaderboard() {
  if (teamBattleTimerInterval) {
    clearInterval(teamBattleTimerInterval);
    teamBattleTimerInterval = null;
  }
  
  playCosmicSound('epic-battle-victory');
  showQuantumNotification('üèÅ ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸÖŸÑÿ≠ŸÖŸäÿ©!', '‚öîÔ∏è ŸÑŸÜÿ±Ÿâ ŸÖŸÜ ŸáŸÖ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖŸÜÿ™ÿµÿ±ÿ©...', 'success');
  
  setTimeout(() => {
    showTeamBattleLeaderboard();
  }, 2000);
}

// ===== UNIVERSAL LEADERBOARD FUNCTION =====
function showArenaLeaderboard(arenaType, competitorTitle, arenaIcon) {
  // ÿ¨ŸÖÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÖŸÜ ÿßŸÑÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©
  const scores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`${arenaType}-score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0),
      index: index
    };
  });
  
  // ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
  scores.sort((a, b) => b.score - a.score);
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
  const leaderboardModal = document.createElement('div');
  leaderboardModal.className = 'professional-leaderboard-modal';
  leaderboardModal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(26,26,46,0.98));
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(20px);
    animation: leaderboardEnter 0.8s ease-out;
  `;
  
  const arenaTypeMap = {
    wisdom: { color: '#4f46e5', bgColor: 'rgba(79,70,229,0.2)' },
    creative: { color: '#ec4899', bgColor: 'rgba(236,72,153,0.2)' },
    science: { color: '#06b6d4', bgColor: 'rgba(6,182,212,0.2)' },
    language: { color: '#10b981', bgColor: 'rgba(16,185,129,0.2)' },
    math: { color: '#f59e0b', bgColor: 'rgba(245,158,11,0.2)' },
    history: { color: '#8b5cf6', bgColor: 'rgba(139,92,246,0.2)' },
    mystery: { color: '#ef4444', bgColor: 'rgba(239,68,68,0.2)' }
  };
  
  const themeColors = arenaTypeMap[arenaType] || { color: '#ffd700', bgColor: 'rgba(255,215,0,0.2)' };
  
  leaderboardModal.innerHTML = `
    <div class="leaderboard-content" style="
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,255,255,0.05));
      border: 3px solid ${themeColors.color};
      border-radius: 25px;
      padding: 3rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      text-align: center;
      box-shadow: 0 20px 60px ${themeColors.bgColor};
      backdrop-filter: blur(15px);
    ">
      <div style="margin-bottom: 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">${arenaIcon}</div>
        <h2 style="color: ${themeColors.color}; font-size: 2.5rem; margin-bottom: 0.5rem; text-shadow: 0 0 20px ${themeColors.color};">
          üåü ŸÑŸàÿ≠ÿ© ${competitorTitle} üåü
        </h2>
        <p style="color: #00ffff; font-size: 1.2rem; text-shadow: 0 0 10px rgba(0,255,255,0.5);">
          ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ™ÿ≠ÿØŸä
        </p>
      </div>
      
      <div class="competitors-list" style="margin-bottom: 2rem;">
        ${scores.map((competitor, index) => {
          const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
          const bgColor = index === 0 ? themeColors.bgColor : 
                         index === 1 ? 'rgba(192,192,192,0.2)' : 
                         index === 2 ? 'rgba(205,127,50,0.2)' : 'rgba(255,255,255,0.1)';
          
          return `
            <div style="
              background: ${bgColor};
              border: 2px solid ${index < 3 ? themeColors.color : 'rgba(255,255,255,0.3)'};
              border-radius: 15px;
              padding: 1.5rem;
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
              gap: 1rem;
              transition: transform 0.3s ease;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
              <div style="font-size: 2.5rem;">${medal}</div>
              <div style="flex: 1; text-align: right;">
                <div style="color: white; font-size: 1.3rem; font-weight: 700; margin-bottom: 0.3rem;">
                  ${competitor.name}
                </div>
                <div style="color: ${themeColors.color}; font-size: 1.1rem; font-weight: 600;">
                  ${competitor.score} ŸÜŸÇÿ∑ÿ© ${arenaIcon}
                </div>
              </div>
              <div style="font-size: 1.5rem; color: ${themeColors.color}; font-weight: 900;">
                #${index + 1}
              </div>
            </div>
          `;
        }).join('')}
      </div>
      
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <button onclick="closeArenaLeaderboard()" style="
          background: linear-gradient(135deg, #ff6b6b, #ee5a52);
          border: 2px solid rgba(255,107,107,0.6);
          color: white;
          padding: 1rem 2rem;
          border-radius: 15px;
          font-size: 1.2rem;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        " onmouseover="this.style.transform='translateY(-3px)'" 
           onmouseout="this.style.transform='translateY(0)'">
          üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©
        </button>
        <button onclick="restartArenaChallenge('${arenaType}')" style="
          background: linear-gradient(135deg, ${themeColors.color}, rgba(0,100,200,0.8));
          border: 2px solid ${themeColors.color};
          color: white;
          padding: 1rem 2rem;
          border-radius: 15px;
          font-size: 1.2rem;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 5px 15px ${themeColors.bgColor};
        " onmouseover="this.style.transform='translateY(-3px)'" 
           onmouseout="this.style.transform='translateY(0)'">
          üîÑ ÿ™ÿ≠ÿØŸä ÿ¨ÿØŸäÿØ
        </button>
      </div>
    </div>
  `;
  
  document.body.appendChild(leaderboardModal);
  playCosmicSound('epic-victory');
}

function showTeamBattleLeaderboard() {
  // ÿ¨ŸÖÿπ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÅÿ±ŸÇ
  const teams = divideStudentsIntoTeams(selectedStudentsList);
  const teamScores = teams.map((team, index) => {
    const scoreElement = document.getElementById(`team-score-${index}`);
    return {
      name: team.name,
      members: team.members,
      score: parseInt(scoreElement ? scoreElement.textContent : 0)
    };
  });
  
  // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÅÿ±ŸÇ
  teamScores.sort((a, b) => b.score - a.score);
  
  const leaderboardModal = document.createElement('div');
  leaderboardModal.className = 'professional-leaderboard-modal';
  leaderboardModal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(26,26,46,0.98));
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(20px);
    animation: leaderboardEnter 0.8s ease-out;
  `;
  
  leaderboardModal.innerHTML = `
    <div class="leaderboard-content" style="
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,0,0,0.05));
      border: 3px solid #ff4444;
      border-radius: 25px;
      padding: 3rem;
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      text-align: center;
      box-shadow: 0 20px 60px rgba(255,68,68,0.3);
      backdrop-filter: blur(15px);
    ">
      <div style="margin-bottom: 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">‚öîÔ∏è</div>
        <h2 style="color: #ff4444; font-size: 2.5rem; margin-bottom: 0.5rem; text-shadow: 0 0 20px #ff4444;">
          üèÜ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖŸÜÿ™ÿµÿ±ÿ© üèÜ
        </h2>
        <p style="color: #00ffff; font-size: 1.2rem; text-shadow: 0 0 10px rgba(0,255,255,0.5);">
          ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑŸÖŸÑÿ≠ŸÖŸäÿ©
        </p>
      </div>
      
      <div class="teams-list" style="margin-bottom: 2rem;">
        ${teamScores.map((team, index) => {
          const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
          const bgColor = index === 0 ? 'rgba(255,68,68,0.3)' : 
                         index === 1 ? 'rgba(192,192,192,0.2)' : 
                         index === 2 ? 'rgba(205,127,50,0.2)' : 'rgba(255,255,255,0.1)';
          
          return `
            <div style="
              background: ${bgColor};
              border: 2px solid ${index < 3 ? '#ff4444' : 'rgba(255,255,255,0.3)'};
              border-radius: 15px;
              padding: 1.5rem;
              margin-bottom: 1rem;
              transition: transform 0.3s ease;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
              <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                <div style="font-size: 2.5rem;">${medal}</div>
                <div style="flex: 1; text-align: right;">
                  <div style="color: white; font-size: 1.3rem; font-weight: 700;">
                    ŸÅÿ±ŸäŸÇ ${team.name}
                  </div>
                  <div style="color: #ff4444; font-size: 1.1rem; font-weight: 600;">
                    ${team.score} ÿßŸÜÿ™ÿµÿßÿ± ‚öîÔ∏è
                  </div>
                </div>
                <div style="font-size: 1.5rem; color: #ff4444; font-weight: 900;">
                  #${index + 1}
                </div>
              </div>
              <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem; text-align: center;">
                ÿßŸÑÿ£ÿπÿ∂ÿßÿ°: ${team.members.join(' ‚Ä¢ ')}
              </div>
            </div>
          `;
        }).join('')}
      </div>
      
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <button onclick="closeArenaLeaderboard()" style="
          background: linear-gradient(135deg, #ff6b6b, #ee5a52);
          border: 2px solid rgba(255,107,107,0.6);
          color: white;
          padding: 1rem 2rem;
          border-radius: 15px;
          font-size: 1.2rem;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        " onmouseover="this.style.transform='translateY(-3px)'" 
           onmouseout="this.style.transform='translateY(0)'">
          üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©
        </button>
        <button onclick="restartArenaChallenge('battle')" style="
          background: linear-gradient(135deg, #ff4444, rgba(200,0,0,0.8));
          border: 2px solid #ff4444;
          color: white;
          padding: 1rem 2rem;
          border-radius: 15px;
          font-size: 1.2rem;
          font-weight: 700;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 5px 15px rgba(255,68,68,0.4);
        " onmouseover="this.style.transform='translateY(-3px)'" 
           onmouseout="this.style.transform='translateY(0)'">
          üîÑ ŸÖÿπÿ±ŸÉÿ© ÿ¨ÿØŸäÿØÿ©
        </button>
      </div>
    </div>
  `;
  
  document.body.appendChild(leaderboardModal);
  playCosmicSound('epic-battle-victory');
}

function closeArenaLeaderboard() {
  const modal = document.querySelector('.professional-leaderboard-modal');
  if (modal) {
    modal.style.animation = 'leaderboardExit 0.5s ease-in forwards';
    setTimeout(() => {
      modal.remove();
      returnToKingdom();
    }, 500);
  }
  playCosmicSound('ui-back');
}

function restartArenaChallenge(arenaType) {
  const modal = document.querySelector('.professional-leaderboard-modal');
  if (modal) {
    modal.remove();
  }
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ÿ≠ÿØŸä ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸàÿπ
  switch(arenaType) {
    case 'lightning':
      startLightningChallenge();
      break;
    case 'wisdom':
      startWisdomChallenge();
      break;
    case 'creative':
      startCreativeChallenge();
      break;
    case 'science':
      startScienceChallenge();
      break;
    case 'language':
      startLanguageChallenge();
      break;
    case 'math':
      startMathChallenge();
      break;
    case 'history':
      startHistoryChallenge();
      break;
    case 'mystery':
      startMysteryChallenge();
      break;
    case 'battle':
      startTeamBattleChallenge();
      break;
  }
  
  playCosmicSound('level-up');
  showQuantumNotification('üîÑ ÿ™ÿ≠ÿØŸä ÿ¨ÿØŸäÿØ!', 'ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑÿ¨ŸàŸÑÿ© ÿ£ÿÆÿ±Ÿâ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿπÿ© ŸàÿßŸÑÿ™ÿπŸÑŸÖ!', 'success');
}

// ===== PAUSE/RESUME/END FUNCTIONS FOR ALL ARENAS =====

// Wisdom Arena Controls
function pauseWisdomChallenge() {
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
    wisdomTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeWisdomChallenge() {
  startWisdomTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ± ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'success');
}

function endWisdomChallenge() {
  endWisdomChallengeWithLeaderboard();
}

// Creative Arena Controls
function pauseCreativeChallenge() {
  if (creativeTimerInterval) {
    clearInterval(creativeTimerInterval);
    creativeTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπ ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeCreativeChallenge() {
  startCreativeTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ± ÿ™ÿ≠ÿØŸä ÿßŸÑÿ•ÿ®ÿØÿßÿπ!', 'success');
}

function endCreativeChallenge() {
  endCreativeChallengeWithLeaderboard();
}

// Science Arena Controls
function pauseScienceChallenge() {
  if (scienceTimerInterval) {
    clearInterval(scienceTimerInterval);
    scienceTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ¨ÿßÿ±ÿ® ÿßŸÑÿπŸÑŸÖŸäÿ© ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeScienceChallenge() {
  startScienceTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ±ÿ™ ÿßŸÑÿ™ÿ¨ÿßÿ±ÿ® ÿßŸÑÿπŸÑŸÖŸäÿ©!', 'success');
}

function endScienceChallenge() {
  endScienceChallengeWithLeaderboard();
}

// Language Arena Controls
function pauseLanguageChallenge() {
  if (languageTimerInterval) {
    clearInterval(languageTimerInterval);
    languageTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÑÿ∫ŸàŸä ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeLanguageChallenge() {
  startLanguageTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ± ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÑÿ∫ŸàŸä!', 'success');
}

function endLanguageChallenge() {
  endLanguageChallengeWithLeaderboard();
}

// Math Arena Controls
function pauseMathChallenge() {
  if (mathTimerInterval) {
    clearInterval(mathTimerInterval);
    mathTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeMathChallenge() {
  startMathTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ± ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä!', 'success');
}

function endMathChallenge() {
  endMathChallengeWithLeaderboard();
}

// History Arena Controls
function pauseHistoryChallenge() {
  if (historyTimerInterval) {
    clearInterval(historyTimerInterval);
    historyTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ© ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeHistoryChallenge() {
  startHistoryTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ±ÿ™ ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©!', 'success');
}

function endHistoryChallenge() {
  endHistoryChallengeWithLeaderboard();
}

// Mystery Arena Controls
function pauseMysteryChallenge() {
  if (mysteryTimerInterval) {
    clearInterval(mysteryTimerInterval);
    mysteryTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤ ÿßŸÑÿ∫ÿßŸÖÿ∂ÿ© ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeMysteryChallenge() {
  startMysteryTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ±ÿ™ ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤ ÿßŸÑÿ∫ÿßŸÖÿ∂ÿ©!', 'success');
}

function endMysteryChallenge() {
  endMysteryChallengeWithLeaderboard();
}

// Team Battle Arena Controls
function pauseTeamBattleChallenge() {
  if (teamBattleTimerInterval) {
    clearInterval(teamBattleTimerInterval);
    teamBattleTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ© ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
  }
}

function resumeTeamBattleChallenge() {
  startTeamBattleTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ±ÿ™ ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ©!', 'success');
}

function endTeamBattleChallenge() {
  endTeamBattleChallengeWithLeaderboard();
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖÿπ ŸÜŸÅÿ≥ ÿßŸÑÿ∑ŸÑÿßÿ®
function resetLightningArena() {
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
  lightningTimeLeft = 300; // 5 ÿØŸÇÿßÿ¶ŸÇ
  
  // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ≥ÿßÿ®ŸÇ ÿ•ŸÜ Ÿàÿ¨ÿØ
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
  gameState.waitingForAnswer = false;
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿßÿ®
  selectedStudentsList.forEach((studentName, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    if (scoreElement) {
      scoreElement.textContent = '0';
    }
  });
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
  resetQuestionZone();
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  updateLightningScoreboard();
}

// ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
function initializeCompetitors() {
  const competitorsGrid = document.getElementById('competitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card';
    competitorCard.id = `competitor-${index}`;
    competitorCard.onclick = () => selectCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿµŸàÿßÿπŸÇ</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
  
  updateLightningScoreboard();
}

// ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä - 5 ÿØŸÇÿßÿ¶ŸÇ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
let lightningTimerInterval;
let lightningTimeLeft = 300; // 5 ÿØŸÇÿßÿ¶ŸÇ (300 ÿ´ÿßŸÜŸäÿ©)

function startLightningTimer() {
  const timerElement = document.getElementById('lightningTimer');
  
  // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ŸÖÿ§ŸÇÿ™ ÿ≥ÿßÿ®ŸÇ
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
  }
  
  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ™ŸÜÿßÿ≤ŸÑŸä
  lightningTimerInterval = setInterval(() => {
    lightningTimeLeft--;
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂ ÿ®ÿ™ŸÜÿ≥ŸäŸÇ ÿØŸÇÿßÿ¶ŸÇ:ÿ´ŸàÿßŸÜŸä
    const minutes = Math.floor(lightningTimeLeft / 60);
    const seconds = lightningTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàÿµŸàÿ™Ÿäÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä
    updateTimerEffects(lightningTimeLeft, timerElement);
    
    // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿØŸàÿ±Ÿäÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
    showTimerNotifications(lightningTimeLeft);
    
    // ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™ - ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
    if (lightningTimeLeft <= 0) {
      endLightningChallengeWithLeaderboard();
    }
  }, 1000);
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© ŸàÿßŸÑÿµŸàÿ™Ÿäÿ© ŸÑŸÑŸÖÿ§ŸÇÿ™
function updateTimerEffects(timeLeft, timerElement) {
  const timerContainer = timerElement.parentElement;
  
  if (timeLeft <= 60) { // ÿßŸÑÿØŸÇŸäŸÇÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ© - ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿπÿßÿ¨ŸÑÿ©
    timerElement.style.color = '#ff4757';
    timerContainer.style.borderColor = '#ff4757';
    timerContainer.style.animation = 'urgentPulse 1s infinite';
    
    if (timeLeft <= 30) { // ŸÜÿµŸÅ ÿØŸÇŸäŸÇÿ© ÿ£ÿÆŸäÿ±ÿ©
      if (timeLeft % 5 === 0) {
        playCosmicSound('countdown-tick');
        createLightningBolt();
      }
    }
    
    if (timeLeft <= 10 && timeLeft > 0) { // ÿßŸÑÿπÿ¥ÿ± ÿ´ŸàÿßŸÜ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©
      playCosmicSound('countdown-beep');
      createLightningBolt();
      timerElement.style.animation = 'criticalPulse 0.5s infinite';
    }
  } else if (timeLeft <= 120) { // ÿßŸÑÿØŸÇŸäŸÇÿ™ÿßŸÜ ÿßŸÑÿ£ÿÆŸäÿ±ÿ™ÿßŸÜ
    timerElement.style.color = '#ffa502';
    timerContainer.style.borderColor = '#ffa502';
  } else if (timeLeft <= 180) { // ÿßŸÑÿ´ŸÑÿßÿ´ ÿØŸÇÿßÿ¶ŸÇ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©
    timerElement.style.color = '#ffff00';
    timerContainer.style.borderColor = '#ffff00';
  }
}

// ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸàŸÇÿ™
function showTimerNotifications(timeLeft) {
  if (timeLeft === 240) { // 4 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©
    showQuantumNotification('‚è∞ 4 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©!', 'üî• ÿßŸÑŸÜÿßÿ± ŸÖÿß ÿ≤ÿßŸÑÿ™ ŸÖÿ¥ÿ™ÿπŸÑÿ©! ÿßÿ≥ÿ™ŸÖÿ±Ÿàÿß!', 'info');
    playCosmicSound('ai-notification');
  } else if (timeLeft === 180) { // 3 ÿØŸÇÿßÿ¶ŸÇ
    showQuantumNotification('‚ö° 3 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©!', 'üí´ ÿßŸÑÿ∑ÿßŸÇÿ© ÿ™ÿ±ÿ™ŸÅÿπ! ŸÖŸÜ ÿ≥Ÿäÿ™ÿµÿØÿ±ÿü', 'warning');
    playCosmicSound('level-up');
  } else if (timeLeft === 120) { // ÿØŸÇŸäŸÇÿ™ÿßŸÜ
    showQuantumNotification('üå©Ô∏è ÿØŸÇŸäŸÇÿ™ÿßŸÜ ŸÖÿ™ÿ®ŸÇŸäÿ™ÿßŸÜ!', 'üî•‚ö° ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿ™ÿ≠ÿ™ÿØŸÖ! ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ≠ÿßÿ≥ŸÖÿ©!', 'battle');
    playCosmicSound('battle-horn');
  } else if (timeLeft === 60) { // ÿØŸÇŸäŸÇÿ© Ÿàÿßÿ≠ÿØÿ©
    showQuantumNotification('üö® ÿØŸÇŸäŸÇÿ© ÿ£ÿÆŸäÿ±ÿ©!', 'üí• ÿßŸÑŸàŸÇÿ™ ŸäŸÜŸÅÿØ! ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ©!', 'error');
    playCosmicSound('final-countdown');
  } else if (timeLeft === 30) { // ŸÜÿµŸÅ ÿØŸÇŸäŸÇÿ©
    showQuantumNotification('‚è∞ 30 ÿ´ÿßŸÜŸäÿ©!', 'üî• ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©! ÿ£ÿπÿ∑Ÿàÿß ŸÉŸÑ ŸÖÿß ŸÑÿØŸäŸÉŸÖ!', 'error');
  } else if (timeLeft === 10) {
    showQuantumNotification('üîü ÿπÿ¥ÿ± ÿ´ŸàÿßŸÜ!', 'üí• ÿßŸÑÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä ŸÇÿßÿØŸÖ!', 'error');
  } else if (timeLeft === 5) {
    showQuantumNotification('5Ô∏è‚É£ ÿÆŸÖÿ≥ ÿ´ŸàÿßŸÜ!', '‚ö°üî• ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ©!', 'error');
  }
}

// ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä ŸÖÿπ ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
function endLightningChallengeWithLeaderboard() {
  // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÜŸáÿßŸäÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
  playCosmicSound('fireworks-burst');
  createCosmicExplosion(document.getElementById('lightningTimer'));
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
  showQuantumNotification('üèÅ ÿßŸÜÿ™ŸáŸâ ÿßŸÑÿ™ÿ≠ÿØŸä!', '‚ö° ÿ™ŸÖ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™! ŸÑŸÜÿ±Ÿâ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©...', 'success');
  
  // ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿ®ÿπÿØ ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ŸÑŸÑÿ™ÿ£ÿ´Ÿäÿ±
  setTimeout(() => {
    showProfessionalLeaderboard();
  }, 2000);
}

// ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©
function showProfessionalLeaderboard() {
  // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
  const sortedCompetitors = [...lightningState.competitors].sort((a, b) => b.score - a.score);
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
  const leaderboardModal = document.createElement('div');
  leaderboardModal.className = 'professional-leaderboard-modal';
  leaderboardModal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(26,26,46,0.98));
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(20px);
    animation: leaderboardEnter 0.8s ease-out;
  `;
  
  leaderboardModal.innerHTML = `
    <div class="leaderboard-content" style="
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,255,255,0.05));
      border: 3px solid rgba(255,215,0,0.6);
      border-radius: 25px;
      padding: 3rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      text-align: center;
      box-shadow: 0 20px 60px rgba(255,215,0,0.3);
      backdrop-filter: blur(15px);
    ">
      <div style="margin-bottom: 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üèÜ</div>
        <h2 style="color: #ffd700; font-size: 2.5rem; margin-bottom: 0.5rem; text-shadow: 0 0 20px rgba(255,215,0,0.8);">
          üåü ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ üåü
        </h2>
        <p style="color: #00ffff; font-size: 1.2rem; text-shadow: 0 0 10px rgba(0,255,255,0.5);">
          ŸÜÿ™ÿßÿ¶ÿ¨ ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ
        </p>
      </div>
      
      <div class="competitors-list" style="margin-bottom: 2rem;">
        ${sortedCompetitors.map((competitor, index) => {
          const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
          const bgColor = index === 0 ? 'rgba(255,215,0,0.2)' : 
                         index === 1 ? 'rgba(192,192,192,0.2)' : 
                         index === 2 ? 'rgba(205,127,50,0.2)' : 'rgba(255,255,255,0.1)';
          
          return `
            <div style="
              background: ${bgColor};
              border: 2px solid ${index < 3 ? '#ffd700' : 'rgba(255,255,255,0.3)'};
              border-radius: 15px;
              padding: 1.5rem;
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
              gap: 1rem;
              transition: transform 0.3s ease;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
              <div style="font-size: 2.5rem;">${medal}</div>
              <div style="flex: 1; text-align: right;">
                <div style="color: white; font-size: 1.3rem; font-weight: 700; margin-bottom: 0.3rem;">
                  ${competitor.name}
                </div>
                <div style="color: #ffff00; font-size: 1.1rem; font-weight: 600;">
                  ${competitor.score} ŸÜŸÇÿ∑ÿ© ‚ö°
                </div>
              </div>
              <div style="font-size: 1.5rem; color: #ffd700; font-weight: 900;">
                #${index + 1}
              </div>
            </div>
          `;
        }).join('')}
      </div>
      
      <button onclick="closeProfessionalLeaderboard()" style="
        background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        border: 2px solid rgba(255,107,107,0.6);
        color: white;
        padding: 1rem 2rem;
        border-radius: 15px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(255,107,107,0.4);
      " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(255,107,107,0.6)'" 
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(255,107,107,0.4)'">
        ÔøΩ ÿ•ÿ∫ŸÑÿßŸÇ
      </button>
    </div>
  `;
  
  // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ©
  const style = document.createElement('style');
  style.textContent = `
    @keyframes leaderboardEnter {
      0% {
        opacity: 0;
        transform: scale(0.8) rotateY(180deg);
      }
      50% {
        opacity: 0.8;
        transform: scale(1.05) rotateY(90deg);
      }
      100% {
        opacity: 1;
        transform: scale(1) rotateY(0deg);
      }
    }
  `;
  document.head.appendChild(style);
  
  document.body.appendChild(leaderboardModal);
  
  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿßŸÑŸÜÿµÿ±
  playCosmicSound('epic-victory');
}

// ÿ•ÿ∫ŸÑÿßŸÇ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
function closeProfessionalLeaderboard() {
  const modal = document.querySelector('.professional-leaderboard-modal');
  if (modal) {
    modal.style.animation = 'leaderboardExit 0.5s ease-in forwards';
    setTimeout(() => {
      modal.remove();
      // ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
      returnToKingdom();
    }, 500);
  }
  
  playCosmicSound('ui-back');
}

// ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
function startNewQuestion() {
  playCosmicSound('question-start');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÑŸÑÿ≥ÿ§ÿßŸÑ
  const questionStartMessages = [
    'üî• ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ®ÿ±ŸÇŸä ÿßŸÑŸÇÿßÿØŸÖ ÿ≥Ÿäÿ≠ÿ±ŸÇ ÿßŸÑÿπŸÇŸàŸÑ!',
    '‚ö° ÿßŸÜÿ∑ŸÑŸÇÿ™ ÿ¥ÿ±ÿßÿ±ÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©!',
    'üå©Ô∏è ÿπÿßÿµŸÅÿ© ÿ∞ŸáŸÜŸäÿ© ŸÇÿßÿØŸÖÿ©... ÿßÿ≥ÿ™ÿπÿØŸàÿß!',
    'üí´ ÿ∑ÿßŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ™ŸÖŸÑÿ£ ÿßŸÑŸÅÿ∂ÿßÿ°!',
    'üéØ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿßŸÑÿ¢ŸÜ... ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑÿ≠ÿßÿ≥ŸÖÿ©!',
    'üî•‚ö° ÿØŸÖÿßÿ∫ŸÉŸÖ ÿ≥Ÿäÿ≠ÿ™ÿ±ŸÇ ŸÖŸÜ ŸÇŸàÿ© Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑ!',
    'üåü ÿ®ÿ±ŸäŸÇ ÿßŸÑÿ∞ŸÉÿßÿ° ŸäŸÑŸÖÿπ ŸÅŸä ÿπŸäŸàŸÜŸÉŸÖ!'
  ];
  
  const randomQuestionMessage = questionStartMessages[Math.floor(Math.random() * questionStartMessages.length)];
  
  const questionDisplay = document.getElementById('questionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">‚ùì</div>
      <h2>ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿ¥ŸÅŸàŸäÿßŸã ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ∞Ÿä Ÿäÿ¨Ÿäÿ® ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠ ŸÑÿ•ÿπÿ∑ÿßÿ¶Ÿá ÿµÿßÿπŸÇÿ© ‚ö°
      </div>
      <button class="lightning-btn" onclick="cancelQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ
      </button>
    </div>
  `;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ©
  createLightningStorm();
  
  // ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©
  gameState.waitingForAnswer = true;
  
  // ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑŸÖÿπŸÑŸÖ ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('‚ùì ÿßŸÑÿ≥ÿ§ÿßŸÑ ŸÜÿ¥ÿ∑', randomQuestionMessage, 'info');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ∑ŸÑÿßÿ®
  setTimeout(() => {
    showQuantumNotification('üéØ ŸÑŸÑÿ∑ŸÑÿßÿ®', 'ŸÅŸÉÿ±Ÿàÿß ÿ®ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ®ÿ±ŸÇ! ŸÖŸÜ ÿ≥Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿµÿßÿπŸÇÿ©ÿü ‚ö°', 'warning');
  }, 1500);
}

// ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ® ŸÖÿ¨Ÿäÿ® (ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©)
function selectCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸáŸÜÿ¶ÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const congratsMessages = [
    `üî•‚ö° ${studentName} ÿßÿ¥ÿ™ÿπŸÑ ŸÖÿ´ŸÑ ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üí´ ${studentName} ÿ£ÿ∂ÿßÿ° ÿßŸÑÿ≥ŸÖÿßÿ° ÿ®ÿ∞ŸÉÿßÿ¶Ÿá!`,
    `‚ö°üß† ÿπŸÇŸÑ ${studentName} ÿ£ÿ≥ÿ±ÿπ ŸÖŸÜ ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üåü ${studentName} ŸÑŸÖÿπ ŸÉÿßŸÑŸÜÿ¨ŸÖ ÿßŸÑÿ≥ÿßÿ∑ÿπ!`,
    `üî• ${studentName} ÿ£ÿ≠ÿ±ŸÇ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿ®ŸÇŸàÿ©!`,
    `‚ö°üéØ ${studentName} ÿ∂ÿ±ÿ® ÿßŸÑŸáÿØŸÅ ÿ®ÿØŸÇÿ© ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üí• ÿßŸÜŸÅÿ¨ÿßÿ± ÿ∞ŸÉÿßÿ° ŸÖŸÜ ${studentName}!`,
    `üå©Ô∏è ${studentName} ÿπÿßÿµŸÅÿ© ÿ∞ŸáŸÜŸäÿ© ŸÇŸàŸäÿ©!`
  ];
  
  const randomCongratsMessage = congratsMessages[Math.floor(Math.random() * congratsMessages.length)];
  
  // ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ© ŸÑŸÑÿ∑ÿßŸÑÿ®
  const scoreElement = document.getElementById(`score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàŸÖÿ±ÿ¶Ÿäÿ©
  const competitorCard = document.getElementById(`competitor-${index}`);
  competitorCard.classList.add('answered-correct');
  
  setTimeout(() => {
    competitorCard.classList.remove('answered-correct');
  }, 1000);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ©
  playSoundSequence(['correct-answer', 'lightning-strike', 'power-up'], 200);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÇ
  createLightningBolt();
  createElectricExplosion(competitorCard);
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  updateLightningScoreboard();
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
  resetQuestionZone();
  
  // ÿ•ÿ¥ÿπÿßÿ± ÿ±ÿ¶Ÿäÿ≥Ÿä ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('‚ö° ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©!', randomCongratsMessage, 'success');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ•ÿ∂ÿßŸÅŸäÿ© ÿ≠ÿ≥ÿ® ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑
  setTimeout(() => {
    if (currentScore === 1) {
      showQuantumNotification('üåü ÿßŸÑÿ®ÿØÿßŸäÿ© ÿßŸÑŸÇŸàŸäÿ©!', `${studentName} ÿ®ÿØÿ£ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ®ÿ±ŸÇ!`, 'info');
    } else if (currentScore === 3) {
      showQuantumNotification('üî• ÿ´ŸÑÿßÿ´ ÿµŸàÿßÿπŸÇ!', `${studentName} Ÿäÿ≠ÿ™ÿ±ŸÇ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ°!`, 'warning');
    } else if (currentScore === 5) {
      showQuantumNotification('‚ö°üëë ŸÖŸÑŸÉ ÿßŸÑÿ®ÿ±ŸÇ!', `${studentName} ŸäŸÇÿ™ÿ±ÿ® ŸÖŸÜ ÿßŸÑÿπÿ±ÿ¥!`, 'battle');
    } else if (currentScore >= 7) {
      showQuantumNotification('üå©Ô∏èüí• ÿ•ÿπÿµÿßÿ± ÿ∞ŸáŸÜŸä!', `${studentName} ŸÑÿß ŸäŸèŸàŸÇŸÅ!`, 'success');
    }
  }, 1000);
  
  gameState.waitingForAnswer = false;
}

// ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ
function cancelQuestion() {
  resetQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ•ŸÑÿ∫ÿßÿ° ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const cancelMessages = [
    'üå™Ô∏è ÿßŸÑÿπÿßÿµŸÅÿ© ŸáÿØÿ£ÿ™... ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ£ŸÑÿ∫Ÿä!',
    'üí≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿ™ÿ®ÿØÿØÿ™... ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ ŸÇÿßÿØŸÖ!',
    '‚ö° ÿßŸÑÿµÿßÿπŸÇÿ© ÿßŸÜÿ∑ŸÅÿ£ÿ™... ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑÿ™ÿßŸÑŸä!',
    'üéØ ÿßŸÑŸáÿØŸÅ ÿ™ÿ∫Ÿäÿ±... ŸÅÿ±ÿµÿ© ÿ¨ÿØŸäÿØÿ© ŸÇÿßÿØŸÖÿ©!',
    'üîÑ ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿßŸÑÿ∑ÿßŸÇÿ©... ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßŸÜÿ∑ŸÑÿßŸÇ!'
  ];
  
  const randomCancelMessage = cancelMessages[Math.floor(Math.random() * cancelMessages.length)];
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ', randomCancelMessage, 'info');
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
function resetQuestionZone() {
  const questionDisplay = document.getElementById('questionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">‚ö°</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ¥ŸÅŸàŸäÿßŸã</p>
    </div>
  `;
}

// ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
function updateLightningScoreboard() {
  const scoresContainer = document.getElementById('lightningScores');
  
  // ÿ¨ŸÖÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  const scores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0),
      index: index
    };
  });
  
  // ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
  scores.sort((a, b) => b.score - a.score);
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  scoresContainer.innerHTML = scores.map((student, position) => `
    <div class="score-item ${position === 0 ? 'first-place' : ''}" style="
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: ${position === 0 ? 'linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.3))' : 'rgba(255,255,255,0.1)'};
      border-radius: 10px;
      border: ${position === 0 ? '2px solid #ffd700' : '1px solid rgba(255,255,255,0.2)'};
    ">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <div style="
          background: ${position === 0 ? '#ffd700' : position === 1 ? '#c0c0c0' : position === 2 ? '#cd7f32' : '#666'};
          color: ${position <= 2 ? '#000' : '#fff'};
          width: 30px;
          height: 30px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        ">
          ${position + 1}
        </div>
        <span style="color: white; font-weight: 600;">${student.name}</span>
      </div>
      <div style="color: #ffff00; font-weight: 700; font-size: 1.2rem;">
        ${student.score} ‚ö°
      </div>
    </div>
  `).join('');
}

// ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØŸä ŸÖÿ§ŸÇÿ™ÿßŸã
function pauseLightningChallenge() {
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØŸä ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
    
    // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµ ŸÑŸÑÿ≤ÿ±
    const pauseBtn = document.querySelector('.lightning-btn.secondary');
    pauseBtn.innerHTML = '‚ñ∂Ô∏è ŸÖÿ™ÿßÿ®ÿπÿ©';
    pauseBtn.onclick = resumeLightningChallenge;
  }
}

// ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ™ÿ≠ÿØŸä
function resumeLightningChallenge() {
  startLightningTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ± ÿßŸÑÿ™ÿ≠ÿØŸä!', 'success');
  
  // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµ ŸÑŸÑÿ≤ÿ±
  const pauseBtn = document.querySelector('.lightning-btn.secondary');
  pauseBtn.innerHTML = '‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™';
  pauseBtn.onclick = pauseLightningChallenge;
}

// ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä - Ÿäÿ≥ÿ™ÿØÿπŸä ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
function endLightningChallenge() {
  // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
  endLightningChallengeWithLeaderboard();
}

// ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
function showFinalResults() {
  const lightningArena = document.getElementById('lightningArena');
  
  // ÿ¨ŸÖÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
  const finalScores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0)
    };
  }).sort((a, b) => b.score - a.score);
  
  const winner = finalScores[0];
  
  lightningArena.innerHTML = `
    <div class="final-results">
      <div class="results-container">
        <div class="victory-header">
          <div class="victory-crown">üëë</div>
          <h1 class="victory-title">ÿßŸÜÿ™ŸáŸâ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ®ÿ±ŸÇ!</h1>
          <div class="lightning-effects-final">‚ö°‚ö°‚ö°</div>
        </div>
        
        <div class="winner-announcement">
          <h2 style="color: #ffd700; font-size: 2.5rem; margin: 1rem 0;">
            üèÜ ÿßŸÑŸÅÿßÿ¶ÿ≤: ${winner.name}
          </h2>
          <div style="color: #ffff00; font-size: 2rem; font-weight: 700;">
            ${winner.score} ÿµÿßÿπŸÇÿ© ‚ö°
          </div>
        </div>
        
        <div class="final-scoreboard">
          <h3 style="color: #00ffff; margin-bottom: 1rem;">üèÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©</h3>
          ${finalScores.map((student, index) => `
            <div class="final-score-item" style="
              display: flex;
              justify-content: space-between;
              padding: 1rem;
              margin: 0.5rem 0;
              background: ${index === 0 ? 'linear-gradient(135deg, rgba(255,215,0,0.4), rgba(255,165,0,0.4))' : 'rgba(255,255,255,0.1)'};
              border-radius: 15px;
              border: ${index === 0 ? '3px solid #ffd700' : '1px solid rgba(255,255,255,0.2)'};
              ${index === 0 ? 'animation: winnerGlow 2s ease-in-out infinite;' : ''}
            ">
              <span style="color: white; font-weight: 600;">${index + 1}. ${student.name}</span>
              <span style="color: #ffff00; font-weight: 700;">${student.score} ‚ö°</span>
            </div>
          `).join('')}
        </div>
        
        <div class="results-actions">
          <button class="lightning-btn" onclick="backToKingdomDashboard()" style="margin: 1rem;">
            üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©
          </button>
          <button class="lightning-btn secondary" onclick="startLightningChallenge()" style="margin: 1rem;">
            üîÑ ÿ™ÿ≠ÿØŸä ÿ¨ÿØŸäÿØ
          </button>
        </div>
      </div>
    </div>
  `;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÜŸáÿßÿ¶Ÿäÿ©
  createLightningStorm();
  playSoundSequence(['victory-fanfare', 'fireworks', 'applause'], 1000);
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
  const winnerMessages = [
    `üî•‚ö° ${winner.name} ÿ£ÿµÿ®ÿ≠ ÿ•ŸÖÿ®ÿ±ÿßÿ∑Ÿàÿ± ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ£ÿπÿ∏ŸÖ!`,
    `üëëüí´ ${winner.name} Ÿäÿ±ÿ™ÿØŸä ÿ™ÿßÿ¨ ŸÖŸÑŸÉ ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üå©Ô∏èüèÜ ${winner.name} ÿ≥ŸäÿØ ÿßŸÑÿπŸàÿßÿµŸÅ ÿßŸÑÿ∞ŸáŸÜŸäÿ©!`,
    `‚ö°üíé ${winner.name} ÿ¨ŸàŸáÿ±ÿ© ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üî•üëë ${winner.name} ÿ≠ÿßŸÉŸÖ ÿßŸÑÿµŸàÿßÿπŸÇ ÿßŸÑÿ¨ÿØŸäÿØ!`
  ];
  
  const randomWinnerMessage = winnerMessages[Math.floor(Math.random() * winnerMessages.length)];
  
  // ÿ•ÿπŸÑÿßŸÜ ÿßŸÑŸÅÿßÿ¶ÿ≤
  setTimeout(() => {
    showQuantumNotification('üëë ÿßŸÑŸÅÿßÿ¶ÿ≤ ÿßŸÑŸÖÿ™Ÿàÿ¨!', randomWinnerMessage, 'success');
  }, 500);
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÑŸÑÿ∑ŸÑÿßÿ® ÿ≠ÿ≥ÿ® ŸÜÿ™ÿßÿ¶ÿ¨ŸáŸÖ
  setTimeout(() => {
    if (finalScores.length > 1) {
      const second = finalScores[1];
      showQuantumNotification('ü•à ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÜŸä', `${second.name} ŸÖÿ≠ÿßÿ±ÿ® ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ¥ÿ¨ÿßÿπ! üó°Ô∏è‚ö°`, 'info');
    }
  }, 2000);
  
  setTimeout(() => {
    if (finalScores.length > 2) {
      const third = finalScores[2];
      showQuantumNotification('ü•â ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÑÿ´', `${third.name} ŸÅÿßÿ±ÿ≥ ÿßŸÑÿµŸàÿßÿπŸÇ ÿßŸÑŸÖÿ®ÿØÿπ! üõ°Ô∏è‚ö°`, 'warning');
    }
  }, 3500);
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿπÿßŸÖÿ©
  setTimeout(() => {
    showQuantumNotification('üåü ÿ¨ŸÖŸäÿπŸÉŸÖ ÿ£ÿ®ÿ∑ÿßŸÑ!', 'ŸÉŸÑ Ÿàÿßÿ≠ÿØ ŸÖŸÜŸÉŸÖ ŸÑÿØŸäŸá ÿ¥ÿ±ÿßÿ±ÿ© ÿßŸÑÿπÿ®ŸÇÿ±Ÿäÿ©! ÿßÿ≥ÿ™ŸÖÿ±Ÿàÿß ŸÅŸä ÿßŸÑÿ™ÿ£ŸÑŸÇ! ‚ú®', 'battle');
  }, 5000);
}

// ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ©
function backToKingdomDashboard() {
  // ÿ•ÿÆŸÅÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿ≠ÿ∞ŸÅŸáÿß ŸÑŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≠ÿßŸÑÿ©
  const lightningArena = document.getElementById('lightningArena');
  if (lightningArena) {
    lightningArena.style.display = 'none';
  }
  
  // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸäÿπŸÖŸÑ
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ ŸàÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ
  document.getElementById('kingdomContent').style.display = 'block';
  document.getElementById('kingdomDashboard').style.display = 'grid';
  playCosmicSound('ui-back');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿπŸàÿØÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const returnMessages = [
    'üè∞ ÿπÿØÿ™ŸÖ ÿ•ŸÑŸâ ÿßŸÑŸÇŸÑÿπÿ© ÿßŸÑŸÖŸÑŸÉŸäÿ© ÿ®ÿπÿØ ŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑÿ®ÿ±ŸÇ!',
    'üëë ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿ™ÿ±ÿ≠ÿ® ÿ®ÿπŸàÿØÿ© ŸÖÿ≠ÿßÿ±ÿ®Ÿä ÿßŸÑÿ®ÿ±ŸÇ!',
    'üåü ÿßŸÑŸÜÿ¨ŸàŸÖ ÿ™ÿ∂Ÿäÿ° ŸÑÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ÿ£ÿ®ÿ∑ÿßŸÑ ÿßŸÑŸÖÿπÿ±ŸÅÿ©!',
    '‚ö°üè∞ ÿ∑ÿßŸÇÿ© ÿßŸÑÿ®ÿ±ŸÇ ŸÖÿß ÿ≤ÿßŸÑÿ™ ÿ™ÿ≥ÿ±Ÿä ŸÅŸä ÿπÿ±ŸàŸÇŸÉŸÖ!',
    'üé≠ ÿßŸÑŸÖÿ≥ÿ±ÿ≠ ÿ¨ÿßŸáÿ≤ ŸÑŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©!',
    'üó°Ô∏è ÿßŸÑÿ£ÿ≥ŸÑÿ≠ÿ© ÿßŸÑÿ∞ŸáŸÜŸäÿ© ÿ¥Ÿèÿ≠ÿ∞ÿ™... ÿ£Ÿä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©ÿü'
  ];
  
  const randomReturnMessage = returnMessages[Math.floor(Math.random() * returnMessages.length)];
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿπ ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿ™ŸÅÿ∏ ÿ®ŸáŸÖ
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©', `${randomReturnMessage} (ŸÖÿ≠ÿ™ŸÅÿ∏ ÿ®ŸÄ ${studentsCount} ÿ∑ŸÑÿßÿ®)`, 'success');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©
  setTimeout(() => {
    showQuantumNotification('üéØ ÿ¨ÿßŸáÿ≤ ŸÑŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©ÿü', 'ÿßÿÆÿ™ÿ± ŸÖŸÖŸÑŸÉÿ© ÿ¨ÿØŸäÿØÿ© Ÿàÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ£ÿÆÿ±Ÿâ! üöÄ', 'info');
  }, 2000);
}

// ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© ÿßŸÑŸÖÿ∞ŸáŸÑÿ©
function createLightningStorm() {
  const effectsContainer = document.getElementById('lightningEffects');
  if (!effectsContainer) return;
  
  // ÿ•ŸÜÿ¥ÿßÿ° 5 ÿµŸàÿßÿπŸÇ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  for (let i = 0; i < 5; i++) {
    setTimeout(() => {
      createLightningBolt();
    }, i * 200);
  }
}

function createLightningBolt() {
  const effectsContainer = document.getElementById('lightningEffects');
  if (!effectsContainer) return;
  
  const bolt = document.createElement('div');
  bolt.className = 'lightning-bolt';
  bolt.style.left = Math.random() * 100 + '%';
  bolt.style.animationDelay = Math.random() * 0.5 + 's';
  
  effectsContainer.appendChild(bolt);
  
  // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ®ÿπÿØ ÿßŸÑÿßŸÜŸäŸÖŸäÿ¥ŸÜ
  setTimeout(() => {
    if (bolt.parentNode) {
      bolt.parentNode.removeChild(bolt);
    }
  }, 600);
  
  // ÿµŸàÿ™ ÿßŸÑÿ®ÿ±ŸÇ
  playCosmicSound('lightning-strike', { volume: 0.3 });
}

function createElectricExplosion(element) {
  // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÜŸÅÿ¨ÿßÿ± ŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä ÿ≠ŸàŸÑ ÿßŸÑÿπŸÜÿµÿ±
  const explosion = document.createElement('div');
  explosion.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,0,0.8), rgba(0,255,255,0.4), transparent);
    transform: translate(-50%, -50%) scale(0);
    animation: electricExplosion 0.6s ease-out;
    pointer-events: none;
    z-index: 1000;
  `;
  
  element.style.position = 'relative';
  element.appendChild(explosion);
  
  setTimeout(() => {
    if (explosion.parentNode) {
      explosion.parentNode.removeChild(explosion);
    }
  }, 600);
}

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä
const electricExplosionCSS = `
  @keyframes electricExplosion {
    0% { 
      transform: translate(-50%, -50%) scale(0);
      opacity: 1;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0.8;
    }
    100% { 
      transform: translate(-50%, -50%) scale(3);
      opacity: 0;
    }
  }
  
  @keyframes winnerGlow {
    0%, 100% { 
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    50% { 
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
    }
  }
  
  @keyframes urgentPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  
  .final-results {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 80vh;
    background: linear-gradient(135deg, #000428 0%, #004e92 100%);
    position: relative;
    overflow: hidden;
  }
  
  .results-container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 215, 0, 0.5);
    border-radius: 25px;
    padding: 3rem;
    max-width: 600px;
    width: 90%;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  }
  
  .victory-header {
    margin-bottom: 2rem;
  }
  
  .victory-crown {
    font-size: 4rem;
    animation: crownBounce 2s ease-in-out infinite;
  }
  
  @keyframes crownBounce {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  .victory-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: #ffd700;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
    margin: 1rem 0;
  }
  
  .lightning-effects-final {
    font-size: 2rem;
    color: #ffff00;
    animation: sparkle 1.5s ease-in-out infinite;
  }
  
  @keyframes sparkle {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
  }
  
  .winner-announcement {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
    border: 2px solid #ffd700;
    border-radius: 20px;
    padding: 2rem;
    margin: 2rem 0;
    animation: winnerGlow 2s ease-in-out infinite;
  }
  
  .final-scoreboard {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 1.5rem;
    margin: 2rem 0;
  }
  
  .results-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }
`;

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿ±ÿ£ÿ≥
const style = document.createElement('style');
style.textContent = electricExplosionCSS;
document.head.appendChild(style);

function startWisdomChallenge() {
  // Wisdom realm entrance
  playSoundSequence([
    'wisdom-chime',
    'ancient-bell',
    'brain-activate'
  ], 800);
  
  showQuantumNotification('üß† ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©', 'ÿ™ÿ≠ÿØŸä ŸÅŸÉÿ±Ÿä ÿπŸÖŸäŸÇ ŸàŸÖÿπŸÇÿØ!', 'info');
  
  // Wisdom challenge with thinking time
  setTimeout(() => {
    playCosmicSound('knowledge-unlock');
    showQuantumNotification('üí° ŸÅŸÉÿ± ÿ®ÿπŸÖŸÇ', 'ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑŸÑÿ™ÿ£ŸÖŸÑ ŸàÿßŸÑÿµÿ®ÿ±', 'info');
  }, 3000);
}

function startMysteryChallenge() {
  // Mystery realm entrance
  playSoundSequence([
    'mystery-whisper',
    'mystic-wind',
    'spell-cast'
  ], 700);
  
  showQuantumNotification('üîÆ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤', 'ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂ ŸäŸÜÿ™ÿ∏ÿ± ÿ≠ŸÑŸá!', 'special');
  
  // Mystery challenge with suspense
  setTimeout(() => {
    playCosmicSound('crystal-ping');
    showQuantumNotification('üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿØŸÑÿ©', 'ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿπŸäŸÜ ÿ´ÿßŸÇÿ®ÿ©!', 'special');
  }, 2000);
  
  setTimeout(() => {
    const solved = Math.random() > 0.5;
    if (solved) {
      playCosmicSound('riddle-solved');
      showQuantumNotification('‚úÖ ÿ≠ŸèŸÑ ÿßŸÑŸÑÿ∫ÿ≤!', 'ÿ£ÿ≠ÿ≥ŸÜÿ™! ŸÑŸÇÿØ ŸÉÿ¥ŸÅÿ™ ÿßŸÑÿ≠ŸÇŸäŸÇÿ©', 'success');
    }
  }, 8000);
}

function openSettings() {
  console.log('‚öôÔ∏è ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
  playCosmicSound('menu-open');
  
  const settingsModal = document.getElementById('settingsModal');
  if (settingsModal) {
    settingsModal.classList.add('active');
    settingsModal.style.display = 'flex';
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
    updateSettingsData();
    
    showQuantumNotification('‚öôÔ∏è ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ™ÿ≠ŸÉŸÖ', 'ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©', 'success');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
    showQuantumNotification('‚ùå ÿÆÿ∑ÿ£', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'error');
  }
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function updateSettingsData() {
  console.log('üìä ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™...');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿµŸÅŸàŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ®
  const classesCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  
  const classesCountElement = document.getElementById('classesCount');
  const totalStudentsElement = document.getElementById('totalStudentsCount');
  const lastUpdateElement = document.getElementById('lastUpdateTime');
  
  if (classesCountElement) classesCountElement.textContent = classesCount;
  if (totalStudentsElement) totalStudentsElement.textContent = totalStudents;
  if (lastUpdateElement) lastUpdateElement.textContent = new Date().toLocaleString('ar-SA');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿÆÿ™ÿßÿ±
  const selectedClassElement = document.getElementById('selectedClassDisplay');
  if (selectedClassElement && gameState.selectedClass) {
    selectedClassElement.innerHTML = `<option value="${gameState.selectedClass}" selected>${gameState.selectedClass}</option>`;
  }
  
  console.log(`‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${classesCount} ÿµŸÅŸàŸÅÿå ${totalStudents} ÿ∑ÿßŸÑÿ®`);
}

// ===== ENHANCED UI INTERACTIONS =====
// Add hover sound effects to buttons
document.addEventListener('DOMContentLoaded', () => {
  // Initialize audio system
  initAudioSystem();
  
  // Initialize control buttons
  initializeControlButtons();
  
  // Check if coming from kingdoms center cache clear
  checkCacheClearReturn();
  
  // Load student data first, then start with class selection
  loadStudentData().then(() => {
    loadClassSelection();
    
    // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ® Ÿàÿ•ÿ±ÿ¥ÿßÿØ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
    setTimeout(() => {
      showQuantumNotification(
        'üéâ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™!', 
        'ÿßÿÆÿ™ÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ´ŸÖ ÿßÿ∂ÿ∫ÿ∑ "ÿ®ÿØÿ° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™" ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØŸÖ goToKingdoms() ŸÅŸä Console ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±', 
        'info'
      );
    }, 2000);
  }).catch(error => {
    console.error('‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®:', error);
    loadClassSelection(); // Try to load anyway
  });
  
  // Add hover effects to neural buttons after page load
  setTimeout(() => {
    const buttons = document.querySelectorAll('.neural-button, .realm-card');
    buttons.forEach(button => {
      button.addEventListener('mouseenter', () => {
        playCosmicSound('button-hover', { volume: 0.3 });
      });
      
      button.addEventListener('click', () => {
        playCosmicSound('cosmic-click', { volume: 0.5 });
      });
    });
  }, 1000);
});

// ===== INITIALIZATION =====
window.addEventListener('load', async () => {
  await initializeKingdom();
});

async function initializeKingdom() {
  console.log('üè∞ ÿ®ÿØÿ° ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÖŸÖŸÑŸÉÿ©...');
  
  const progressBar = document.getElementById('progressBar');
  const loaderText = document.getElementById('loaderText');
  
  // Initialize particles
  initParticles();
  
  // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ∏ŸáŸàÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸàÿ±ÿßŸã
  setTimeout(() => {
    ensureControlHeaderVisible();
  }, 100);
  
  // Loading sequence with sound effects
  const loadingSteps = [
    { progress: 20, text: "ÔøΩ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑŸÉŸàŸÜŸäÿ©...", sound: 'cosmic-portal' },
    { progress: 40, text: "‚ö° ÿ¥ÿ≠ŸÜ ŸÖÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä...", sound: 'ai-beep' },
    { progress: 60, text: "üè∞ ÿ®ŸÜÿßÿ° ÿßŸÑŸÖŸÖÿßŸÑŸäŸÉ ÿßŸÑÿ≥ÿ≠ÿ±Ÿäÿ©...", sound: 'magic-sparkle' },
    { progress: 80, text: "üë• ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿßÿ±ÿ®ŸäŸÜ...", sound: 'data-process' },
    { progress: 100, text: "üéâ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ¨ÿßŸáÿ≤ÿ©!", sound: 'kingdom-enter' }
  ];
  
  for (let step of loadingSteps) {
    await new Promise(resolve => setTimeout(resolve, 800));
    progressBar.style.width = step.progress + '%';
    loaderText.textContent = step.text;
    
    // Play loading sound
    if (step.sound) {
      playCosmicSound(step.sound, { volume: 0.4 });
    }
  }
  
  // Load student data with confirmation
  loaderText.textContent = "üìö ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...";
  await loadStudentData();
  
  // Confirm data loaded
  const classCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  loaderText.textContent = `‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${classCount} ÿµŸÅŸàŸÅ ŸÖÿπ ${totalStudents} ÿ∑ÿßŸÑÿ®`;
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  // Hide loader and show main app
  await new Promise(resolve => setTimeout(resolve, 1000));
  document.getElementById('cosmicLoader').style.opacity = '0';
  setTimeout(() => {
    document.getElementById('cosmicLoader').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    
    // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ∏ŸáŸàÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿ®ÿπÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
    ensureControlHeaderVisible();
    
    // Additional visual confirmation
    setTimeout(() => {
      ensureControlHeaderVisible();
      initializeControlButtons(); // ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
      setupSettingsTabs(); // ÿ™ŸÅÿπŸäŸÑ ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
    }, 500);
    
    // Show class selection panel initially instead of welcome message
    loadClassSelection();
    
    // Debug info
    console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
    
    // ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿØÿßÿ°
    // showWelcomeMessage(); // Will be shown after student selection
  }, 1000);
}

// ===== Ÿàÿ∏ÿßÿ¶ŸÅ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπŸÑŸàŸäÿ© =====

// ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ≠ÿßÿ™ ŸàÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
function hideAllArenas() {
  // ÿ•ÿÆŸÅÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ
  const lightningArena = document.getElementById('lightningArena');
  if (lightningArena) {
    lightningArena.style.display = 'none';
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©
  const battleArena = document.getElementById('battleArena');
  if (battleArena) {
    battleArena.style.display = 'none';
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅŸàŸÅ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
  const selectionPanel = document.getElementById('selectionPanel');
  if (selectionPanel) {
    selectionPanel.style.display = 'none';
  }
  
  // ÿ•ÿÆŸÅÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÑÿπÿ®ÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
  const gameInterface = document.getElementById('gameInterface');
  if (gameInterface) {
    gameInterface.style.display = 'none';
  }
  
  // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ŸÖÿ§ŸÇÿ™ÿßÿ™ ŸÜÿ¥ÿ∑ÿ©
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  if (gameState.battleTimer) {
    clearInterval(gameState.battleTimer);
    gameState.battleTimer = null;
  }
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
  gameState.waitingForAnswer = false;
}

// ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
function initializeControlButtons() {
  console.log('üîß ÿ®ÿØÿ° ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ...');
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÇÿ®ŸÑ ÿ±ÿ®ÿ∑ ÿßŸÑÿ≠ÿØÿ´
  const homeBtn = document.getElementById('homeBtn');
  if (!homeBtn) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© homeBtn');
    return;
  } else {
    console.log('‚úÖ ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©');
  }

  // ÿ≤ÿ± ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
  homeBtn.addEventListener('click', function() {
    console.log('üè† ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©!');
    playCosmicSound('ui-back');
    
    console.log('üîç ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©...');
    
    // ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© (ÿµŸÅÿ≠ÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©)
    if (document.referrer && document.referrer !== window.location.href) {
      // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿµŸÅÿ≠ÿ© ÿ≥ÿßÿ®ŸÇÿ©ÿå ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸäŸáÿß
      console.log('‚Ü©Ô∏è ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©:', document.referrer);
      window.history.back();
    } else {
      // ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸáŸÜÿßŸÉ ÿµŸÅÿ≠ÿ© ÿ≥ÿßÿ®ŸÇÿ©ÿå ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©
      console.log('üè† ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©');
      window.location.href = '../index.html';
    }
  });

  // ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
  const kingdomsBtn = document.getElementById('kingdomsBtn');
  if (kingdomsBtn) {
    kingdomsBtn.addEventListener('click', function() {
      console.log('üè∞ ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ!');
      playCosmicSound('ui-back');
      
      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸäŸÜ
      if ((gameState.selectedStudents && gameState.selectedStudents.length > 0) || 
          (selectedStudentsList && selectedStudentsList.length > 0)) {
        // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸäŸÜÿå ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
        console.log('üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ ŸÖÿπ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿßŸÑÿ∑ŸÑÿßÿ®');
        
        // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ≠ÿßÿ™
        hideAllArenas();
        
        // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ
        showKingdoms();
        
        const studentsCount = gameState.selectedStudents?.length || selectedStudentsList?.length || 0;
        showQuantumNotification('üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ', `ŸÖÿ≠ÿ™ŸÅÿ∏ ÿ®ŸÄ ${studentsCount} ÿ∑ŸÑÿßÿ® - ÿßÿÆÿ™ÿ± ŸÖŸÖŸÑŸÉÿ© ÿ¨ÿØŸäÿØÿ©!`, 'success');
      } else {
        // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸáŸÜÿßŸÉ ÿ∑ŸÑÿßÿ®ÿå ÿßÿ∞Ÿáÿ® ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅŸàŸÅ
        console.log('üè∞ ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿßÿ® ŸÖÿ≠ÿØÿØŸàŸÜÿå ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ');
        loadClassSelection();
      }
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  }

  // ÿ≤ÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßŸÑÿµŸàÿ™
  const soundToggleBtn = document.getElementById('soundToggleBtn');
  if (soundToggleBtn) {
    soundToggleBtn.addEventListener('click', function() {
      gameState.soundEnabled = !gameState.soundEnabled;
      updateSoundButton();
      playCosmicSound('ui-click');
      showQuantumNotification(
        gameState.soundEnabled ? 'üîä ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿµŸàÿ™' : 'üîá ÿ™ŸÖ ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™',
        '', 
        'info'
      );
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™');
  }

  // ÿ≤ÿ± ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ
  const teacherGuideBtn = document.getElementById('teacherGuideBtn');
  if (teacherGuideBtn) {
    teacherGuideBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showTeacherGuide();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ');
  }  // ÿ≤ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
  const settingsBtn = document.getElementById('settingsBtn');
  if (settingsBtn) {
    settingsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showSettingsModal();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
  }

  // ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
  const sessionBtn = document.getElementById('sessionBtn');
  if (sessionBtn) {
    sessionBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showSessionManagement();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©');
    
    // Session button status update removed
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©');
  }

  // ÿ≤ÿ± ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
  const statsBtn = document.getElementById('statsBtn');
  if (statsBtn) {
    statsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showStatsModal();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™');
  }

  // ÿ≤ÿ± ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  if (fullscreenBtn) {
    fullscreenBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      toggleFullscreen();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©');
  }
  
  console.log('üîß ÿßŸÜÿ™Ÿáÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ');
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™
function updateSoundButton() {
  const soundBtn = document.getElementById('soundToggleBtn');
  const icon = soundBtn.querySelector('.btn-icon');
  icon.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
}

// ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function showSettingsModal() {
  const modal = document.getElementById('settingsModal');
  modal.classList.add('active');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
  updateSettingsDisplay();
  
  // ÿ™ŸÅÿπŸäŸÑ ÿ£ŸàŸÑ ÿ™ÿ®ŸàŸäÿ®
  showSettingsTab('game-settings');
  
  // ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
  setupSettingsTabs();
}

// ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
function setupSettingsTabs() {
  const tabButtons = document.querySelectorAll('.settings-tab-btn');
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const tabId = this.getAttribute('data-tab');
      showSettingsTab(tabId);
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÜÿ¥ÿ∑ÿ©
      tabButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
    });
  });
}

// ÿ•ÿ∏Ÿáÿßÿ± ÿ™ÿ®ŸàŸäÿ® ŸÖÿπŸäŸÜ
function showSettingsTab(tabId) {
  // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
  const allTabs = document.querySelectorAll('.settings-tab-content');
  allTabs.forEach(tab => tab.classList.remove('active'));
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ≠ÿØÿØ
  const targetTab = document.getElementById(tabId + '-content');
  if (targetTab) {
    targetTab.classList.add('active');
  }
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function updateSettingsDisplay() {
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿµŸàÿ™
  document.getElementById('masterVolumeSlider').value = (gameState.masterVolume || 0.5) * 100;
  document.getElementById('volumeDisplay').textContent = Math.round((gameState.masterVolume || 0.5) * 100) + '%';
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ÿÆÿ±Ÿâ
  document.getElementById('particlesToggle').checked = gameState.particlesEnabled !== false;
  document.getElementById('animationsToggle').checked = gameState.animationsEnabled !== false;
  document.getElementById('notificationsToggle').checked = gameState.notificationsEnabled !== false;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿµŸÅ
  updateClassDataDisplay();
  
  // ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ™ÿ∫ŸäŸäÿ± ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿµŸàÿ™
  setupVolumeSliders();
}

// ÿ•ÿπÿØÿßÿØ ÿ£ÿ¥ÿ±ÿ∑ÿ© ÿßŸÑÿµŸàÿ™
function setupVolumeSliders() {
  const masterSlider = document.getElementById('masterVolumeSlider');
  const effectsSlider = document.getElementById('effectsVolumeSlider');
  const musicSlider = document.getElementById('musicVolumeSlider');
  
  masterSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.masterVolume = volume;
    document.getElementById('volumeDisplay').textContent = this.value + '%';
    playCosmicSound('ui-click', { volume: volume });
  });
  
  effectsSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.effectsVolume = volume;
    document.getElementById('effectsVolumeDisplay').textContent = this.value + '%';
    playCosmicSound('cosmic-click', { volume: volume });
  });
  
  musicSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.musicVolume = volume;
    document.getElementById('musicVolumeDisplay').textContent = this.value + '%';
  });
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ
function updateClassDataDisplay() {
  const classesCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  
  document.getElementById('classesCount').textContent = classesCount;
  document.getElementById('totalStudentsCount').textContent = totalStudents;
  document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString('ar-SA');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿÆÿ™ÿßÿ±
  const selectedClassSelect = document.getElementById('selectedClassDisplay');
  selectedClassSelect.innerHTML = '<option value="">-- ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸÅ --</option>';
  Object.keys(studentData).forEach(className => {
    const option = document.createElement('option');
    option.value = className;
    option.textContent = className;
    if (gameState.selectedClass === className) {
      option.selected = true;
    }
    selectedClassSelect.appendChild(option);
  });
}

// ÿßÿÆÿ™ÿ®ÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™
function testAllSounds() {
  const soundTests = [
    'cosmic-click', 'button-hover', 'achievement', 'magic-sparkle', 
    'epic-charge', 'victory-fanfare', 'ui-back'
  ];
  
  let index = 0;
  const interval = setInterval(() => {
    if (index < soundTests.length) {
      playCosmicSound(soundTests[index], { volume: 0.3 });
      showQuantumNotification(`üéµ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿµŸàÿ™: ${soundTests[index]}`, '', 'info');
      index++;
    } else {
      clearInterval(interval);
      showQuantumNotification('üéº ÿßŸÜÿ™ŸáŸâ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ÿµŸàÿßÿ™!', '', 'success');
    }
  }, 1000);
}

// ŸÉÿ™ŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™
function muteAllSounds() {
  gameState.soundEnabled = false;
  gameState.masterVolume = 0;
  gameState.effectsVolume = 0;
  gameState.musicVolume = 0;
  
  document.getElementById('masterVolumeSlider').value = 0;
  document.getElementById('effectsVolumeSlider').value = 0;
  document.getElementById('musicVolumeSlider').value = 0;
  
  updateSoundButton();
  showQuantumNotification('üîá ÿ™ŸÖ ŸÉÿ™ŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™', '', 'info');
}

// ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function saveAllSettings() {
  const settings = {
    masterVolume: document.getElementById('masterVolumeSlider').value / 100,
    effectsVolume: document.getElementById('effectsVolumeSlider').value / 100,
    musicVolume: document.getElementById('musicVolumeSlider').value / 100,
    particlesEnabled: document.getElementById('particlesToggle').checked,
    animationsEnabled: document.getElementById('animationsToggle').checked,
    notificationsEnabled: document.getElementById('notificationsToggle').checked,
    fullscreenMode: document.getElementById('fullscreenModeToggle').checked,
    challengeDuration: document.getElementById('challengeDurationSelect').value,
    difficulty: document.getElementById('difficultySelect').value,
    scoringSystem: document.getElementById('scoringSystemSelect').value,
    colorTheme: document.getElementById('colorThemeSelect').value,
    autoSelectStudents: document.getElementById('autoSelectAllStudents').checked,
    randomizeOrder: document.getElementById('randomizeStudentOrder').checked,
    quickStart: document.getElementById('enableQuickStart').checked,
    rememberSelection: document.getElementById('rememberLastSelection').checked,
    timestamp: new Date().toISOString()
  };
  
  // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿπŸÑŸâ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿπÿßŸÖÿ©
  Object.assign(gameState, settings);
  
  // ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä
  localStorage.setItem('kingdomSettingsAdvanced', JSON.stringify(settings));
  
  playCosmicSound('achievement');
  showQuantumNotification('üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!', 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ¢ŸÜ', 'success');
  closeSettingsModal();
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function resetAllSettings() {
  if (confirm('üîÑ ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©ÿü\n\nÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿÆÿµÿµÿ©.')) {
    // ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
    const defaultSettings = {
      masterVolume: 0.5,
      effectsVolume: 0.7,
      musicVolume: 0.3,
      particlesEnabled: true,
      animationsEnabled: true,
      notificationsEnabled: true,
      fullscreenMode: false,
      challengeDuration: 60,
      difficulty: 'medium',
      scoringSystem: 'standard',
      colorTheme: 'cosmic',
      autoSelectStudents: false,
      randomizeOrder: false,
      quickStart: false,
      rememberSelection: true
    };
    
    Object.assign(gameState, defaultSettings);
    localStorage.removeItem('kingdomSettingsAdvanced');
    
    updateSettingsDisplay();
    playCosmicSound('ui-reset');
    showQuantumNotification('üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ¢ŸÜ', 'info');
  }
}

// ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function exportSettings() {
  const settings = JSON.parse(localStorage.getItem('kingdomSettingsAdvanced') || '{}');
  const exportData = {
    appName: 'ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©',
    version: '2.0',
    settings: settings,
    exportDate: new Date().toISOString(),
    exportedBy: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ'
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `kingdom-settings-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  playCosmicSound('achievement');
  showQuantumNotification('üì§ ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', '', 'success');
}

// ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ
function exportClassData() {
  const exportData = {
    appName: 'ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©',
    dataType: 'ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ®',
    classes: studentData,
    statistics: {
      totalClasses: Object.keys(studentData).length,
      totalStudents: Object.values(studentData).reduce((sum, students) => sum + students.length, 0)
    },
    exportDate: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `kingdom-class-data-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  playCosmicSound('achievement');
  showQuantumNotification('üì• ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠', '', 'success');
}

// ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function closeSettingsModal() {
  const modal = document.getElementById('settingsModal');
  modal.classList.remove('active');
  modal.style.display = 'none';
  playCosmicSound('ui-back');
}

// ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ (ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÇÿØŸäŸÖ)
function saveSettings() {
  saveAllSettings();
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ (ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÇÿØŸäŸÖ)
function resetSettings() {
  resetAllSettings();
}

// ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
function showSessionManagement() {
  const savedSession = loadTeacherSession();
  
  // ÿ•ŸÜÿ¥ÿßÿ° modal ŸÑŸÑÿ¨ŸÑÿ≥ÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØ
  let sessionModal = document.getElementById('sessionModal');
  if (!sessionModal) {
    sessionModal = document.createElement('div');
    sessionModal.id = 'sessionModal';
    sessionModal.className = 'cosmic-modal';
    document.body.appendChild(sessionModal);
  }
  
  sessionModal.innerHTML = `
    <div class="modal-overlay" onclick="closeSessionModal()"></div>
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2>üíæ ÿ•ÿØÿßÿ±ÿ© ÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿπŸÑŸÖ</h2>
        <button class="modal-close" onclick="closeSessionModal()">√ó</button>
      </div>
      <div class="modal-body">
        ${savedSession ? `
          <!-- ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© -->
          <div style="background: rgba(79, 172, 254, 0.1); border: 2px solid rgba(79, 172, 254, 0.3);
                      border-radius: 15px; padding: 2rem; margin-bottom: 2rem;">
            <h3 style="color: #4facfe; margin-bottom: 1rem;">üéì ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ©</h3>
            <div style="display: grid; gap: 1rem; text-align: right;">
              <div>
                <strong style="color: #ffd700;">ÿßŸÑÿµŸÅ:</strong> 
                <span style="color: white; font-size: 1.1rem;">${savedSession.selectedClass}</span>
              </div>
              <div>
                <strong style="color: #ffd700;">ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®:</strong> 
                <span style="color: white; font-size: 1.1rem;">${savedSession.selectedStudents.length} ÿ∑ÿßŸÑÿ®</span>
              </div>
              <div>
                <strong style="color: #ffd700;">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ≠ŸÅÿ∏:</strong>
                <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                  ${new Date(savedSession.timestamp).toLocaleString('ar-SA')}
                </span>
              </div>
            </div>
            
            <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ® -->
            <div style="margin-top: 1.5rem;">
              <strong style="color: #ffd700;">ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ŸàŸÜ:</strong>
              <div style="max-height: 150px; overflow-y: auto; margin-top: 0.5rem;
                          background: rgba(0,0,0,0.2); border-radius: 10px; padding: 1rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem;">
                  ${savedSession.selectedStudents.map(student => `
                    <span style="background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.3);
                                border-radius: 8px; padding: 0.5rem; text-align: center; font-size: 0.9rem;">
                      ${student}
                    </span>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
          
          <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ© -->
          <div style="display: grid; gap: 1rem;">
            <button class="neural-button" onclick="continueWithSavedSession(); closeSessionModal();" 
                    style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
              ‚úÖ ŸÖÿ™ÿßÿ®ÿπÿ© ŸÖÿπ Ÿáÿ∞Ÿá ÿßŸÑÿ¨ŸÑÿ≥ÿ©
            </button>
            
            <button class="neural-button" onclick="exportSession()" 
                    style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
              üì§ ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
            </button>
            
            <button class="neural-button" onclick="confirmClearSession()" 
                    style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
              üóëÔ∏è ŸÖÿ≥ÿ≠ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            </button>
          </div>
        ` : `
          <!-- ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ© -->
          <div style="text-align: center; padding: 3rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">üíæ</div>
            <h3 style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">
              ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©
            </h3>
            <p style="color: rgba(255,255,255,0.5); margin-bottom: 2rem;">
              ÿ≥Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿπŸÜÿØ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ®
            </p>
            
            <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.3);
                        border-radius: 15px; padding: 2rem; text-align: right;">
              <h4 style="color: #ffd700; margin-bottom: 1rem;">üí° ŸÉŸäŸÅ ŸäÿπŸÖŸÑ ŸÜÿ∏ÿßŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿü</h4>
              <ul style="color: rgba(255,255,255,0.8); list-style: none; padding: 0;">
                <li style="margin-bottom: 0.5rem;">üéØ Ÿäÿ≠ŸÅÿ∏ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ® ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã</li>
                <li style="margin-bottom: 0.5rem;">‚ö° Ÿäÿ≥ÿ™ÿπŸäÿØ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ ÿπŸÜÿØ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ™ÿ∑ÿ®ŸäŸÇ</li>
                <li style="margin-bottom: 0.5rem;">üîÑ Ÿäÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ŸÑŸÖÿØÿ© 24 ÿ≥ÿßÿπÿ©</li>
                <li style="margin-bottom: 0.5rem;">üéÆ ŸäŸàŸÅÿ± ŸàŸÇÿ™ ÿßŸÑŸÖÿπŸÑŸÖ ÿπŸÜÿØ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜ ÿßŸÑŸÖŸÖÿßŸÑŸÉ</li>
              </ul>
            </div>
          </div>
        `}
      </div>
    </div>
  `;
  
  sessionModal.classList.add('active');
}

function closeSessionModal() {
  const sessionModal = document.getElementById('sessionModal');
  if (sessionModal) {
    sessionModal.classList.remove('active');
  }
}

function confirmClearSession() {
  if (confirm('üóëÔ∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©ÿü\n\nÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ® Ÿàÿ≥ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ•ÿπÿßÿØÿ© ÿßÿÆÿ™Ÿäÿßÿ±ŸáŸÖ.')) {
    clearTeacherSession();
    closeSessionModal();
  }
}

function exportSession() {
  const savedSession = loadTeacherSession();
  if (savedSession) {
    const sessionData = {
      ...savedSession,
      exportDate: new Date().toISOString(),
      appVersion: '2.0'
    };
    
    const dataStr = JSON.stringify(sessionData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `kingdom-session-${savedSession.selectedClass}-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    
    URL.revokeObjectURL(url);
    
    showQuantumNotification('üì§ ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ±', 'ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
  }
}

// Session button status function removed
function updateSessionButtonStatus() {
  // Session button functionality removed - button no longer exists
}

// ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
function showStatsModal() {
  const modal = document.getElementById('statsModal');
  const content = document.getElementById('statsContent');
  
  content.innerHTML = `
    <div style="display: grid; gap: 1.5rem;">
      <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üéÆ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÑÿπÿ®</h3>
        <div>ÿπÿØÿØ ÿßŸÑÿ£ŸÑÿπÿßÿ®: ${gameState.totalGames || 0}</div>
        <div>ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖŸÉÿ™ÿ≥ÿ®ÿ©: ${gameState.totalPoints || 0}</div>
      </div>
      
      <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px;">
        <h3 style="color: #00ffff; margin-bottom: 1rem;">üë• ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®</h3>
        <div>ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ: ${gameState.selectedStudents?.length || 0}</div>
        <div>ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿÆÿ™ÿßÿ±: ${gameState.selectedClass || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</div>
      </div>
    </div>
  `;
  
  modal.classList.add('active');
}

// ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
function closeStatsModal() {
  const modal = document.getElementById('statsModal');
  modal.classList.remove('active');
  playCosmicSound('ui-back');
}

// Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().then(() => {
      showQuantumNotification('‚õ∂ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÖŸÅÿπŸÑ', '', 'info');
    });
  } else {
    document.exitFullscreen().then(() => {
      showQuantumNotification('‚õ∂ ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©', '', 'info');
    });
  }
}

// ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
function backToMainDashboard() {
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
  document.getElementById('selectionPanel').style.display = 'none';
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
  document.getElementById('kingdomContent').style.display = 'block';
  
  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿßŸÑÿπŸàÿØÿ©
  playCosmicSound('ui-back');
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ®
  showWelcomeMessage();
  
  showQuantumNotification(
    'üè∞ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™',
    'ÿßÿÆÿ™ÿ± ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑÿ®ÿØÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ©',
    'info'
  );
}

// ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
function loadSavedSettings() {
  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
  const advancedSettings = localStorage.getItem('kingdomSettingsAdvanced');
  if (advancedSettings) {
    const settings = JSON.parse(advancedSettings);
    Object.assign(gameState, settings);
    console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©');
    return;
  }
  
  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
  const oldSettings = localStorage.getItem('kingdomSettings');
  if (oldSettings) {
    const settings = JSON.parse(oldSettings);
    gameState.masterVolume = settings.masterVolume || 0.5;
    gameState.particlesEnabled = settings.particlesEnabled !== false;
    gameState.animationsEnabled = settings.animationsEnabled !== false;
    gameState.soundEnabled = settings.soundEnabled !== false;
    console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ© Ÿàÿ™ÿ±ŸÇŸäÿ™Ÿáÿß');
  } else {
    // ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
    gameState.masterVolume = 0.5;
    gameState.effectsVolume = 0.7;
    gameState.musicVolume = 0.3;
    gameState.particlesEnabled = true;
    gameState.animationsEnabled = true;
    gameState.notificationsEnabled = true;
    console.log('üìã ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©');
  }
}

// ===== NEW REALM FUNCTIONS =====

// ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ
function startCreativeChallenge() {
  hideAllArenas();
  document.getElementById('creativeArena').style.display = 'block';
  
  const creativePrompts = [
    'üé® ÿßÿ±ÿ≥ŸÖ ŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ŸÖÿØÿ±ÿ≥ÿ™ŸÉ ŸÅŸä ÿπÿßŸÖ 2030',
    'üìù ÿßŸÉÿ™ÿ® ŸÇÿµÿ© ŸÇÿµŸäÿ±ÿ© ÿπŸÜ ÿ±ÿ≠ŸÑÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖÿ±ŸäÿÆ',
    'üéµ ÿßÿÆÿ™ÿ±ÿπ ÿ£ÿ∫ŸÜŸäÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÑÿ≤ŸÖŸÑÿßÿ¶ŸÉ',
    'üí° ÿµŸÖŸÖ ÿßÿÆÿ™ÿ±ÿßÿπÿßŸã ŸÑÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿ®Ÿäÿ¶Ÿäÿ©',
    'üåü ÿßŸÇÿ™ÿ±ÿ≠ ŸÅŸÉÿ±ÿ© ŸÑŸÜÿ¥ÿßÿ∑ ŸÖŸÖÿ™ÿπ ŸÅŸä ÿßŸÑŸÖÿØÿ±ÿ≥ÿ©'
  ];
  
  const randomPrompt = creativePrompts[Math.floor(Math.random() * creativePrompts.length)];
  document.getElementById('creativePrompt').textContent = randomPrompt;
  
  startCreativeTimer();
  playCosmicSound('achievement-unlock');
}

// ===== ENHANCED LIGHTNING KINGDOM FUNCTIONS =====
let lightningState = {
  competitors: [],
  currentRound: 1,
  timer: null,
  isPaused: false,
  timeLeft: 30,
  reactions: []
};

function startLightningChallenge() {
  hideAllArenas();
  document.getElementById('lightningArena').style.display = 'block';
  
  // Initialize competitors from selected students
  initializeLightningCompetitors();
  
  // Display initial competition status
  updateLightningCompetitionStatus('üéØ ÿßŸÑŸÖÿπŸÑŸÖ Ÿäÿ≠ÿ∂ÿ± ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ¥ŸÅŸàŸä...');
  
  // Setup quick answer buttons
  setupQuickAnswerButtons();
  
  // Add initial reaction
  addLightningReaction('‚ö° ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ! ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑŸÖŸÜÿßŸÅÿ≥ÿ© ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©!', 'system');
  
  playCosmicSound('lightning-strike');
}

function initializeLightningCompetitors() {
  if (!gameState.selectedStudents || gameState.selectedStudents.length === 0) {
    // Create demo competitors if no students selected
    lightningState.competitors = [
      { name: 'ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ', score: 0, totalCorrect: 0, status: 'ready' },
      { name: 'ŸÅÿßÿ∑ŸÖÿ© ÿπŸÑŸä', score: 0, totalCorrect: 0, status: 'ready' },
      { name: 'ŸÖÿ≠ŸÖÿØ ÿ≥ÿßŸÑŸÖ', score: 0, totalCorrect: 0, status: 'ready' },
      { name: 'ŸÜŸàÿ±ÿß ÿÆÿßŸÑÿØ', score: 0, totalCorrect: 0, status: 'ready' }
    ];
  } else {
    lightningState.competitors = gameState.selectedStudents.map(name => ({
      name: name,
      score: 0,
      totalCorrect: 0,
      status: 'ready'
    }));
  }
  
  displayLightningCompetitors();
}

function displayLightningCompetitors() {
  const grid = document.getElementById('lightningCompetitorsGrid');
  if (!grid) return;
  
  grid.innerHTML = lightningState.competitors.map((competitor, index) => `
    <div class="lightning-competitor-card ${competitor.status}" id="competitor-${index}" onclick="selectLightningWinner(${index})">
      <div class="competitor-avatar">${competitor.name.charAt(0)}</div>
      <div class="competitor-name">${competitor.name}</div>
      <div class="competitor-score">‚ö° ${competitor.score} ŸÜŸÇÿ∑ÿ©</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.3rem;">
        ‚úÖ ${competitor.totalCorrect} ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©
      </div>
      <div class="competitor-status" style="margin-top: 0.5rem; font-size: 0.9rem;">
        ${getCompetitorStatusIcon(competitor.status)} ${getCompetitorStatusText(competitor.status)}
      </div>
    </div>
  `).join('');
}

function getCompetitorStatusIcon(status) {
  switch(status) {
    case 'ready': return 'üü¢';
    case 'thinking': return 'ü§î';
    case 'answered': return '‚úã';
    case 'winner': return 'üèÜ';
    case 'waiting': return '‚è≥';
    default: return 'üü¢';
  }
}

function getCompetitorStatusText(status) {
  switch(status) {
    case 'ready': return 'ÿ¨ÿßŸáÿ≤';
    case 'thinking': return 'ŸäŸÅŸÉÿ±...';
    case 'answered': return 'ÿ±ŸÅÿπ ŸäÿØŸá';
    case 'winner': return 'ŸÅÿßÿ¶ÿ≤!';
    case 'waiting': return 'ŸäŸÜÿ™ÿ∏ÿ±';
    default: return 'ÿ¨ÿßŸáÿ≤';
  }
}

function setupQuickAnswerButtons() {
  const container = document.getElementById('quickAnswerButtons');
  if (!container) return;
  
  container.innerHTML = lightningState.competitors.map((competitor, index) => `
    <button class="neural-button" onclick="selectLightningWinner(${index})" style="font-size: 0.9rem; padding: 0.6rem;">
      üèÜ ${competitor.name}
    </button>
  `).join('');
}

function startLightningQuestion() {
  // Reset all competitors to thinking state
  lightningState.competitors.forEach(competitor => {
    competitor.status = 'thinking';
  });
  
  lightningState.timeLeft = 30;
  lightningState.isPaused = false;
  
  updateLightningCompetitionStatus('üî• ÿßŸÑÿ≥ÿ§ÿßŸÑ ŸÜÿ¥ÿ∑! ÿßŸÑÿ∑ŸÑÿßÿ® ŸäŸÅŸÉÿ±ŸàŸÜ...');
  displayLightningCompetitors();
  
  // Enable pause button, disable start button
  document.getElementById('startLightningQuestion').disabled = true;
  document.getElementById('pauseLightningTimer').disabled = false;
  
  // Start countdown
  startLightningTimer();
  
  // Add reaction
  addLightningReaction(`üöÄ ÿ®ÿØÿ£ÿ™ ÿßŸÑÿ¨ŸàŸÑÿ© ${lightningState.currentRound}! ÿßŸÑÿπÿØÿßÿØ Ÿäÿ™ŸäŸÉ ÿ™ŸÉ...`, 'system');
  
  playCosmicSound('countdown-tick');
}

function startLightningTimer() {
  if (lightningState.timer) {
    clearInterval(lightningState.timer);
  }
  
  lightningState.timer = setInterval(() => {
    if (!lightningState.isPaused) {
      lightningState.timeLeft--;
      
      // Update timer display with color changes
      const timerElement = document.getElementById('lightningTimer');
      if (timerElement) {
        timerElement.textContent = lightningState.timeLeft;
        
        // Change color based on remaining time
        if (lightningState.timeLeft <= 5) {
          timerElement.style.background = 'linear-gradient(45deg, #ff0000, #ff6600)';
          if (lightningState.timeLeft <= 3) {
            playCosmicSound('countdown-beep');
          }
        } else if (lightningState.timeLeft <= 10) {
          timerElement.style.background = 'linear-gradient(45deg, #ff6600, #ffff00)';
        }
      }
      
      if (lightningState.timeLeft <= 0) {
        clearInterval(lightningState.timer);
        endLightningQuestion();
      }
    }
  }, 1000);
}

function pauseLightningTimer() {
  lightningState.isPaused = !lightningState.isPaused;
  const pauseBtn = document.getElementById('pauseLightningTimer');
  
  if (lightningState.isPaused) {
    pauseBtn.textContent = '‚ñ∂Ô∏è ÿßÿ≥ÿ™ŸÉŸÖÿßŸÑ';
    updateLightningCompetitionStatus('‚è∏Ô∏è ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿπÿØÿßÿØ ŸÖÿ§ŸÇÿ™ÿßŸã');
    addLightningReaction('‚è∏Ô∏è ÿßŸÑŸÖÿπŸÑŸÖ ÿ£ŸàŸÇŸÅ ÿßŸÑÿπÿØÿßÿØ ŸÑŸÑÿ™Ÿàÿ∂Ÿäÿ≠', 'system');
  } else {
    pauseBtn.textContent = '‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™';
    updateLightningCompetitionStatus('‚ñ∂Ô∏è ÿßÿ≥ÿ™ÿ§ŸÜŸÅ ÿßŸÑÿπÿØÿßÿØ!');
    addLightningReaction('‚ñ∂Ô∏è ÿßÿ≥ÿ™ÿ§ŸÜŸÅ ÿßŸÑÿπÿØÿßÿØ! ÿßÿ≥ÿ™ÿπÿØŸàÿß...', 'system');
  }
  
  playCosmicSound('ui-click');
}

function selectLightningWinner(competitorIndex) {
  const competitor = lightningState.competitors[competitorIndex];
  if (!competitor) return;
  
  // Stop timer
  if (lightningState.timer) {
    clearInterval(lightningState.timer);
  }
  
  // Update winner
  competitor.status = 'winner';
  competitor.score += calculateLightningPoints();
  competitor.totalCorrect++;
  
  // Update others to waiting
  lightningState.competitors.forEach((comp, index) => {
    if (index !== competitorIndex) {
      comp.status = 'waiting';
    }
  });
  
  displayLightningCompetitors();
  
  // Show congratulations
  updateLightningCompetitionStatus(`üèÜ ${competitor.name} ŸÅÿßÿ≤ ÿ®ÿßŸÑŸÜŸÇÿßÿ∑! ÿ£ÿ≠ÿ≥ŸÜÿ™!`);
  
  // Add celebratory reactions
  const celebrationMessages = [
    `üéâ ÿ™ŸáÿßŸÜŸäŸÜÿß ${competitor.name}! ÿ•ÿ¨ÿßÿ®ÿ© ÿ±ÿßÿ¶ÿπÿ©!`,
    `‚ö° ${competitor.name} ÿ≥ÿ±Ÿäÿπ ŸÉÿßŸÑÿ®ÿ±ŸÇ! +${calculateLightningPoints()} ŸÜŸÇÿ∑ÿ©`,
    `üî• ÿπŸÇŸÑ ŸÑÿßŸÖÿπ! ${competitor.name} Ÿäÿ™ÿµÿØÿ± ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ©!`,
    `üí° ÿ∞ŸÉÿßÿ° ÿÆÿßÿ±ŸÇ ŸÖŸÜ ${competitor.name}!`
  ];
  
  const randomMessage = celebrationMessages[Math.floor(Math.random() * celebrationMessages.length)];
  addLightningReaction(randomMessage, 'celebration');
  
  // Enable start button for next question
  document.getElementById('startLightningQuestion').disabled = false;
  document.getElementById('pauseLightningTimer').disabled = true;
  
  // Play victory sound
  playCosmicSound('win');
  
  // Create visual explosion effect
  createLightningExplosion(document.getElementById(`competitor-${competitorIndex}`));
  
  // Update achievements
  updateQuickChallengeProgress(calculateLightningPoints());
  setTimeout(() => checkAchievement('speedDemon'), 1000);
}

function calculateLightningPoints() {
  const basePoints = 10;
  const timeBonus = Math.max(0, Math.floor(lightningState.timeLeft / 3));
  return basePoints + timeBonus;
}

function createLightningExplosion(element) {
  const explosion = document.createElement('div');
  explosion.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,0,0.8) 0%, transparent 70%);
    transform: translate(-50%, -50%) scale(0);
    animation: lightningBlast 1s ease-out forwards;
    pointer-events: none;
    z-index: 1000;
  `;
  
  element.style.position = 'relative';
  element.appendChild(explosion);
  
  setTimeout(() => {
    explosion.remove();
  }, 1000);
}

function endLightningQuestion() {
  updateLightningCompetitionStatus('‚è∞ ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™! ÿ¨ŸàŸÑÿ© ÿ¨ÿØŸäÿØÿ©ÿü');
  addLightningReaction('‚è∞ ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™! ŸÑÿß ÿ®ÿ£ÿ≥ÿå ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ÿ≥ÿ™ŸÉŸàŸÜ ÿ£ŸÅÿ∂ŸÑ!', 'system');
  
  // Reset all competitors to ready
  lightningState.competitors.forEach(competitor => {
    competitor.status = 'ready';
  });
  
  displayLightningCompetitors();
  
  // Enable start button
  document.getElementById('startLightningQuestion').disabled = false;
  document.getElementById('pauseLightningTimer').disabled = true;
  
  playCosmicSound('end-timer');
}

function nextLightningRound() {
  lightningState.currentRound++;
  
  // Reset timer
  lightningState.timeLeft = 30;
  document.getElementById('lightningTimer').textContent = '30';
  document.getElementById('lightningTimer').style.background = 'linear-gradient(45deg, #ffff00, #ff6600, #ff0000)';
  
  // Reset competitors status
  lightningState.competitors.forEach(competitor => {
    competitor.status = 'ready';
  });
  
  displayLightningCompetitors();
  updateLightningCompetitionStatus(`üéØ ÿßŸÑÿ¨ŸàŸÑÿ© ${lightningState.currentRound} - ÿßŸÑŸÖÿπŸÑŸÖ Ÿäÿ≠ÿ∂ÿ± ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ¨ÿØŸäÿØ...`);
  addLightningReaction(`üÜï ÿßŸÑÿ¨ŸàŸÑÿ© ${lightningState.currentRound} ÿ®ÿØÿ£ÿ™! ŸáŸäÿß ŸÜÿ±Ÿâ ŸÖŸÜ ÿ≥ŸäŸÅŸàÿ≤ Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ±ÿ©!`, 'system');
  
  // Enable start button
  document.getElementById('startLightningQuestion').disabled = false;
  document.getElementById('pauseLightningTimer').disabled = true;
  
  playCosmicSound('level-up');
}

function showLightningLeaderboard() {
  // Sort competitors by score
  const sortedCompetitors = [...lightningState.competitors].sort((a, b) => b.score - a.score);
  
  const leaderboardModal = document.createElement('div');
  leaderboardModal.className = 'modal-overlay leaderboard-modal';
  leaderboardModal.style.cssText = `
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(26,26,46,0.95)); 
    z-index: 10000; display: flex;
    align-items: center; justify-content: center; 
    backdrop-filter: blur(15px);
    padding: 20px;
  `;
  
  leaderboardModal.innerHTML = `
    <div class="leaderboard-content" style="
      background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(16, 21, 35, 0.95)); 
      border: 3px solid #ffd700; 
      border-radius: 25px; 
      padding: 2rem; 
      width: 98%; 
      height: 98vh;
      color: white; 
      display: flex; 
      flex-direction: column;
      box-shadow: 0 25px 60px rgba(0,0,0,0.5), inset 0 0 30px rgba(255,215,0,0.1);
      position: relative;
      overflow: hidden;
    ">
      <!-- ÿÆŸÑŸÅŸäÿ© ŸÖÿ™ÿ≠ÿ±ŸÉÿ© -->
      <div style="
        position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
        background: radial-gradient(circle, rgba(255,215,0,0.05) 0%, transparent 70%);
        animation: backgroundPulse 4s ease-in-out infinite;
        pointer-events: none;
      "></div>
      
      <!-- ÿ±ÿ£ÿ≥ ÿßŸÑŸÑŸàÿ≠ÿ© -->
      <div class="leaderboard-header" style="
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 2rem;
        border-bottom: 2px solid rgba(255,215,0,0.3);
        padding-bottom: 1rem;
        position: relative;
        z-index: 1;
      ">
        <h2 style="
          color: #ffd700; 
          margin: 0; 
          font-size: 2.5rem;
          background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          text-shadow: 0 5px 15px rgba(255,215,0,0.3);
          animation: titleShimmer 2s ease-in-out infinite;
        ">üèÜ ŸÑŸàÿ≠ÿ© ŸÖÿ™ÿµÿØÿ±Ÿä ÿßŸÑÿ®ÿ±ŸÇ</h2>
        
        <button onclick="this.closest('.modal-overlay').remove()" style="
          background: linear-gradient(135deg, #ff4757, #ff3742); 
          border: none; 
          color: white; 
          padding: 0.5rem; 
          border-radius: 50%; 
          width: 50px; 
          height: 50px; 
          cursor: pointer;
          font-size: 1.3rem;
          transition: all 0.3s ease;
          box-shadow: 0 5px 15px rgba(255,71,87,0.4);
        " onmouseover="this.style.transform='rotate(90deg) scale(1.1)'" onmouseout="this.style.transform='rotate(0deg) scale(1)'">‚úï</button>
      </div>
      
      <!-- ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿ© -->
      <div class="leaderboard-stats" style="
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
        gap: 1rem; 
        margin-bottom: 1.5rem;
        position: relative;
        z-index: 1;
      ">
        <div style="
          background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); 
          padding: 1rem; 
          border-radius: 15px; 
          text-align: center;
          border: 1px solid rgba(255,215,0,0.3);
        ">
          <div style="font-size: 1.8rem; color: #ffd700;">üë•</div>
          <div style="color: #ffd700; font-weight: bold;">${sortedCompetitors.length}</div>
          <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">ŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ</div>
        </div>
        
        <div style="
          background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); 
          padding: 1rem; 
          border-radius: 15px; 
          text-align: center;
          border: 1px solid rgba(255,215,0,0.3);
        ">
          <div style="font-size: 1.8rem; color: #43e97b;">‚ö°</div>
          <div style="color: #43e97b; font-weight: bold;">${sortedCompetitors.reduce((sum, c) => sum + c.score, 0)}</div>
          <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">ŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÜŸÇÿßÿ∑</div>
        </div>
        
        <div style="
          background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); 
          padding: 1rem; 
          border-radius: 15px; 
          text-align: center;
          border: 1px solid rgba(255,215,0,0.3);
        ">
          <div style="font-size: 1.8rem; color: #00ffff;">üìä</div>
          <div style="color: #00ffff; font-weight: bold;">${sortedCompetitors.length > 0 ? Math.round(sortedCompetitors.reduce((sum, c) => sum + c.score, 0) / sortedCompetitors.length) : 0}</div>
          <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÜŸÇÿßÿ∑</div>
        </div>
      </div>
      
      <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ™ŸÖÿ±Ÿäÿ± -->
      <div class="leaderboard-list" style="
        flex: 1; 
        overflow-y: auto; 
        overflow-x: hidden;
        padding-right: 10px;
        position: relative;
        z-index: 1;
      ">
        <!-- ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑŸÖÿÆÿµÿµ -->
        <style>
          .leaderboard-list::-webkit-scrollbar {
            width: 8px;
          }
          .leaderboard-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
          }
          .leaderboard-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 10px;
          }
          .leaderboard-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ffed4e, #ffd700);
          }
        </style>
        
        <div style="display: grid; gap: 1.2rem; padding-right: 5px;">
          ${sortedCompetitors.map((competitor, index) => {
            const isTop3 = index < 3;
            const medalColors = ['#ffd700', '#c0c0c0', '#cd7f32'];
            const medalEmojis = ['ü•á', 'ü•à', 'ü•â'];
            
            return `
              <div class="competitor-item" style="
                background: ${isTop3 ? 
                  `linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,165,0,0.15))` : 
                  `linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03))`
                }; 
                padding: 2rem; 
                border-radius: 20px; 
                display: flex; 
                align-items: center; 
                gap: 1.5rem; 
                border: 2px solid ${isTop3 ? '#ffd700' : 'rgba(255,255,255,0.1)'}; 
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                cursor: pointer;
              " 
              onmouseover="
                this.style.transform = 'translateY(-3px) scale(1.02)'; 
                this.style.boxShadow = '0 10px 25px rgba(255,215,0,0.3)';
                this.style.borderColor = '#ffd700';
              " 
              onmouseout="
                this.style.transform = 'translateY(0) scale(1)'; 
                this.style.boxShadow = 'none';
                this.style.borderColor = '${isTop3 ? '#ffd700' : 'rgba(255,255,255,0.1)'}';
              ">
                
                <!-- ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∂Ÿàÿ° ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉ -->
                <div style="
                  position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
                  background: linear-gradient(90deg, transparent, rgba(255,215,0,0.1), transparent);
                  transition: left 0.8s ease;
                  pointer-events: none;
                " class="light-effect"></div>
                
                <!-- ÿ±ŸÇŸÖ ÿßŸÑŸÖÿ±ŸÉÿ≤ ŸàÿßŸÑŸÖŸäÿØÿßŸÑŸäÿ© -->
                <div style="
                  display: flex; 
                  align-items: center; 
                  justify-content: center; 
                  width: 80px; 
                  height: 80px; 
                  border-radius: 50%; 
                  background: ${isTop3 ? 
                    `linear-gradient(135deg, ${medalColors[index]}, ${medalColors[index]}88)` : 
                    'linear-gradient(135deg, rgba(108,117,125,0.8), rgba(73,80,87,0.8))'
                  };
                  font-size: 2rem; 
                  font-weight: bold;
                  border: 3px solid ${isTop3 ? medalColors[index] : '#6c757d'};
                  box-shadow: 0 6px 18px rgba(0,0,0,0.4);
                ">
                  ${isTop3 ? medalEmojis[index] : `#${index + 1}`}
                </div>
                
                <!-- ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ -->
                <div style="flex: 1; min-width: 0;">
                  <div style="
                    font-weight: bold; 
                    font-size: 1.8rem; 
                    color: ${isTop3 ? '#ffd700' : 'white'};
                    margin-bottom: 0.8rem;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                  ">${competitor.name}</div>
                  
                  <div style="
                    display: flex; 
                    gap: 1.5rem; 
                    font-size: 1.2rem; 
                    color: rgba(255,255,255,0.8);
                    flex-wrap: wrap;
                  ">
                    <span style="color: #ffd700; font-weight: bold;">‚ö° ${competitor.score} ŸÜŸÇÿ∑ÿ©</span>
                    <span style="color: #43e97b; font-weight: bold;">‚úÖ ${competitor.totalCorrect} ÿµÿ≠Ÿäÿ≠ÿ©</span>
                    <span style="color: #ff4757; font-weight: bold;">‚ùå ${competitor.totalWrong || 0} ÿÆÿßÿ∑ÿ¶ÿ©</span>
                  </div>
                </div>
                
                <!-- ÿ¥ÿßÿ±ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ -->
                ${isTop3 ? `
                  <div style="
                    background: linear-gradient(135deg, ${medalColors[index]}, ${medalColors[index]}88);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 25px;
                    font-size: 1rem;
                    font-weight: bold;
                    text-transform: uppercase;
                    letter-spacing: 2px;
                    animation: achievementGlow 2s ease-in-out infinite;
                    text-align: center;
                    min-width: 120px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                  ">
                    ${index === 0 ? 'ÿ®ÿ∑ŸÑ ÿßŸÑÿ®ÿ±ŸÇ' : index === 1 ? 'ŸÜÿßÿ¶ÿ® ÿßŸÑÿ®ÿ∑ŸÑ' : 'ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÑÿ´'}
                  </div>
                ` : ''}
              </div>
            `;
          }).join('')}
          
          ${sortedCompetitors.length === 0 ? `
            <div style="
              text-align: center; 
              padding: 5rem; 
              color: rgba(255,255,255,0.6);
              font-size: 1.5rem;
            ">
              <div style="font-size: 6rem; margin-bottom: 2rem;">‚ö°</div>
              <div style="font-size: 2rem; margin-bottom: 1rem;">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ ÿ®ÿπÿØ</div>
              <div style="font-size: 1.3rem; margin-top: 1rem;">ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≠ÿØŸä ŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ!</div>
            </div>
          ` : ''}
        </div>
      </div>
      
      <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
      <div style="
        display: flex; 
        gap: 1.5rem; 
        margin-top: 2rem; 
        padding-top: 1.5rem; 
        border-top: 3px solid rgba(255,215,0,0.4);
        position: relative;
        z-index: 1;
        flex-wrap: wrap;
      ">
        <button onclick="exportLeaderboard()" style="
          flex: 1;
          min-width: 200px;
          background: linear-gradient(135deg, #4facfe, #00f2fe); 
          border: none; 
          color: white; 
          padding: 1.5rem 2rem; 
          border-radius: 15px; 
          cursor: pointer; 
          font-weight: bold;
          font-size: 1.2rem;
          transition: all 0.3s ease;
          box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        " onmouseover="this.style.transform='translateY(-3px) scale(1.02)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
          üìä ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
        </button>
        
        <button onclick="resetAllScores()" style="
          flex: 1;
          min-width: 200px;
          background: linear-gradient(135deg, #ff4757, #ff3742); 
          border: none; 
          color: white; 
          padding: 1.5rem 2rem; 
          border-radius: 15px; 
          cursor: pointer; 
          font-weight: bold;
          font-size: 1.2rem;
          transition: all 0.3s ease;
          box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        " onmouseover="this.style.transform='translateY(-3px) scale(1.02)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
          üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ
        </button>
      </div>
    </div>
  `;
  
  // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÉ ŸÑŸÑÿ∂Ÿàÿ° ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉ
  setTimeout(() => {
    const lightEffects = leaderboardModal.querySelectorAll('.light-effect');
    lightEffects.forEach((effect, index) => {
      setTimeout(() => {
        effect.style.left = '100%';
      }, index * 200);
    });
  }, 500);
  
  document.body.appendChild(leaderboardModal);
  playCosmicSound('epic-victory');
}

// ÿØÿßŸÑÿ© ÿ™ÿµÿØŸäÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
function exportLeaderboard() {
  const sortedCompetitors = [...lightningState.competitors].sort((a, b) => b.score - a.score);
  
  let exportText = "üèÜ ŸÑŸàÿ≠ÿ© ŸÖÿ™ÿµÿØÿ±Ÿä ÿßŸÑÿ®ÿ±ŸÇ - " + new Date().toLocaleString('ar-SA') + "\n";
  exportText += "=" * 50 + "\n\n";
  
  sortedCompetitors.forEach((competitor, index) => {
    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
    exportText += `${medal} ÿßŸÑŸÖÿ±ŸÉÿ≤ ${index + 1}: ${competitor.name}\n`;
    exportText += `   ÿßŸÑŸÜŸÇÿßÿ∑: ${competitor.score} ‚ö°\n`;
    exportText += `   ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©: ${competitor.totalCorrect} ‚úÖ\n`;
    exportText += `   ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿ∑ÿ¶ÿ©: ${competitor.totalWrong || 0} ‚ùå\n\n`;
  });
  
  exportText += "\n" + "=" * 50 + "\n";
  exportText += `ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ: ${sortedCompetitors.length}\n`;
  exportText += `ŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÜŸÇÿßÿ∑: ${sortedCompetitors.reduce((sum, c) => sum + c.score, 0)}\n`;
  exportText += `ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÜŸÇÿßÿ∑: ${sortedCompetitors.length > 0 ? Math.round(sortedCompetitors.reduce((sum, c) => sum + c.score, 0) / sortedCompetitors.length) : 0}\n`;
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ
  const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.style.display = 'none';
  a.href = url;
  a.download = `leaderboard_${new Date().toISOString().split('T')[0]}.txt`;
  document.body.appendChild(a);
  a.click();
  window.URL.revokeObjectURL(url);
  document.body.removeChild(a);
  
  showQuantumNotification('üìä ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ±', 'ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
  playCosmicSound('data-process');
}

// ÿØÿßŸÑÿ© ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸÇÿßÿ∑
function resetAllScores() {
  if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸÇÿßÿ∑ÿü\nÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÜŸáÿßÿ¶ŸäÿßŸã!')) {
    lightningState.competitors = [];
    localStorage.removeItem('lightningCompetitors');
    
    showQuantumNotification('üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸäŸäŸÜ', 'ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠', 'info');
    playCosmicSound('dimensional-shift');
    
    // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ© Ÿàÿ•ÿπÿßÿØÿ© ŸÅÿ™ÿ≠Ÿáÿß ŸÑÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ∫ŸäŸäÿ±
    setTimeout(() => {
      document.querySelector('.leaderboard-modal').remove();
      showLightningLeaderboard();
    }, 1500);
  }
}

// ÿØŸàÿßŸÑ ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
let currentCompetitors = [];
let filteredCompetitors = [];

function filterCompetitors(searchTerm) {
  const competitorItems = document.querySelectorAll('.competitor-item');
  const searchLower = searchTerm.toLowerCase().trim();
  
  competitorItems.forEach(item => {
    const nameElement = item.querySelector('div:nth-child(3) > div:first-child');
    if (nameElement) {
      const name = nameElement.textContent.toLowerCase();
      if (name.includes(searchLower) || searchTerm === '') {
        item.style.display = 'flex';
        item.style.animation = 'competitorSlideIn 0.3s ease-out';
      } else {
        item.style.display = 'none';
      }
    }
  });
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿßÿØ
  const visibleItems = Array.from(competitorItems).filter(item => item.style.display !== 'none');
  updateCompetitorCount(visibleItems.length);
}

function sortCompetitors(sortType) {
  const sortedCompetitors = [...lightningState.competitors];
  
  switch(sortType) {
    case 'score_desc':
      sortedCompetitors.sort((a, b) => b.score - a.score);
      break;
    case 'score_asc':
      sortedCompetitors.sort((a, b) => a.score - b.score);
      break;
    case 'name_asc':
      sortedCompetitors.sort((a, b) => a.name.localeCompare(b.name, 'ar'));
      break;
    case 'name_desc':
      sortedCompetitors.sort((a, b) => b.name.localeCompare(a.name, 'ar'));
      break;
    case 'correct_desc':
      sortedCompetitors.sort((a, b) => b.totalCorrect - a.totalCorrect);
      break;
  }
  
  // ÿ•ÿπÿßÿØÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
  refreshLeaderboardWithData(sortedCompetitors);
}

function refreshLeaderboard() {
  playCosmicSound('data-process');
  showQuantumNotification('üîÑ ÿ™ÿ≠ÿØŸäÿ´', 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ...', 'info');
  
  setTimeout(() => {
    const modal = document.querySelector('.leaderboard-modal');
    if (modal) {
      modal.remove();
      showLightningLeaderboard();
    }
  }, 500);
}

function refreshLeaderboardWithData(competitors) {
  const listContainer = document.querySelector('.leaderboard-list > div');
  if (!listContainer) return;
  
  listContainer.innerHTML = '';
  
  competitors.forEach((competitor, index) => {
    const isTop3 = index < 3;
    const medalColors = ['#ffd700', '#c0c0c0', '#cd7f32'];
    const medalEmojis = ['ü•á', 'ü•à', 'ü•â'];
    
    const competitorDiv = document.createElement('div');
    competitorDiv.className = 'competitor-item';
    competitorDiv.style.cssText = `
      background: ${isTop3 ? 
        `linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,165,0,0.15))` : 
        `linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03))`
      }; 
      padding: 1.2rem; 
      border-radius: 15px; 
      display: flex; 
      align-items: center; 
      gap: 1rem; 
      border: 2px solid ${isTop3 ? '#ffd700' : 'rgba(255,255,255,0.1)'}; 
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      margin-bottom: 0.8rem;
    `;
    
    competitorDiv.innerHTML = `
      <div style="
        position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,215,0,0.1), transparent);
        transition: left 0.8s ease;
        pointer-events: none;
      " class="light-effect"></div>
      
      <div style="
        display: flex; 
        align-items: center; 
        justify-content: center; 
        width: 60px; 
        height: 60px; 
        border-radius: 50%; 
        background: ${isTop3 ? 
          `linear-gradient(135deg, ${medalColors[index]}, ${medalColors[index]}88)` : 
          'linear-gradient(135deg, rgba(108,117,125,0.8), rgba(73,80,87,0.8))'
        };
        font-size: 1.5rem; 
        font-weight: bold;
        border: 2px solid ${isTop3 ? medalColors[index] : '#6c757d'};
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      ">
        ${isTop3 ? medalEmojis[index] : `#${index + 1}`}
      </div>
      
      <div style="flex: 1; min-width: 0;">
        <div style="
          font-weight: bold; 
          font-size: 1.2rem; 
          color: ${isTop3 ? '#ffd700' : 'white'};
          margin-bottom: 0.3rem;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        ">${competitor.name}</div>
        
        <div style="
          display: flex; 
          gap: 1rem; 
          font-size: 0.9rem; 
          color: rgba(255,255,255,0.8);
          flex-wrap: wrap;
        ">
          <span style="color: #ffd700;">‚ö° ${competitor.score} ŸÜŸÇÿ∑ÿ©</span>
          <span style="color: #43e97b;">‚úÖ ${competitor.totalCorrect} ÿµÿ≠Ÿäÿ≠ÿ©</span>
          <span style="color: #ff4757;">‚ùå ${competitor.totalWrong || 0} ÿÆÿßÿ∑ÿ¶ÿ©</span>
        </div>
      </div>
      
      ${isTop3 ? `
        <div style="
          background: linear-gradient(135deg, ${medalColors[index]}, ${medalColors[index]}88);
          color: white;
          padding: 0.5rem 1rem;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: bold;
          text-transform: uppercase;
          letter-spacing: 1px;
          animation: achievementGlow 2s ease-in-out infinite;
        ">
          ${index === 0 ? 'ÿ®ÿ∑ŸÑ ÿßŸÑÿ®ÿ±ŸÇ' : index === 1 ? 'ŸÜÿßÿ¶ÿ® ÿßŸÑÿ®ÿ∑ŸÑ' : 'ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÑÿ´'}
        </div>
      ` : ''}
    `;
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑ
    competitorDiv.addEventListener('mouseover', () => {
      competitorDiv.style.transform = 'translateY(-3px) scale(1.02)';
      competitorDiv.style.boxShadow = '0 10px 25px rgba(255,215,0,0.3)';
      competitorDiv.style.borderColor = '#ffd700';
      competitorDiv.querySelector('.light-effect').style.left = '100%';
    });
    
    competitorDiv.addEventListener('mouseout', () => {
      competitorDiv.style.transform = 'translateY(0) scale(1)';
      competitorDiv.style.boxShadow = 'none';
      competitorDiv.style.borderColor = isTop3 ? '#ffd700' : 'rgba(255,255,255,0.1)';
    });
    
    listContainer.appendChild(competitorDiv);
  });
  
  // ÿ™ÿ∑ÿ®ŸäŸÇ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ©
  setTimeout(() => {
    const items = listContainer.querySelectorAll('.competitor-item');
    items.forEach((item, index) => {
      setTimeout(() => {
        item.style.animation = 'competitorSlideIn 0.5s ease-out';
      }, index * 100);
    });
  }, 100);
}

function updateCompetitorCount(count) {
  const statsContainer = document.querySelector('.leaderboard-stats');
  if (statsContainer) {
    const competitorCountElement = statsContainer.querySelector('div:first-child div:nth-child(2)');
    if (competitorCountElement) {
      competitorCountElement.textContent = count;
    }
  }
}

function resetLightningRound() {
  // Stop timer
  if (lightningState.timer) {
    clearInterval(lightningState.timer);
  }
  
  // Reset state
  lightningState.timeLeft = 30;
  lightningState.isPaused = false;
  
  // Reset competitors
  lightningState.competitors.forEach(competitor => {
    competitor.status = 'ready';
  });
  
  // Reset UI
  document.getElementById('lightningTimer').textContent = '30';
  document.getElementById('lightningTimer').style.background = 'linear-gradient(45deg, #ffff00, #ff6600, #ff0000)';
  document.getElementById('startLightningQuestion').disabled = false;
  document.getElementById('pauseLightningTimer').disabled = true;
  
  displayLightningCompetitors();
  updateLightningCompetitionStatus('üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ¨ŸàŸÑÿ© - ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ®ÿØÿ°!');
  addLightningReaction('üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ! ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑÿ¨ŸàŸÑÿ© ÿ¨ÿØŸäÿØÿ©!', 'system');
  
  playCosmicSound('ui-back');
}

function endLightningCompetition() {
  if (lightningState.timer) {
    clearInterval(lightningState.timer);
  }
  
  // Show final results
  const winner = lightningState.competitors.reduce((prev, current) => 
    (prev.score > current.score) ? prev : current
  );
  
  addLightningReaction(`üéä ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ©! ÿßŸÑŸÅÿßÿ¶ÿ≤ ÿßŸÑŸÉÿ®Ÿäÿ± ŸáŸà ${winner.name} ÿ®ŸÖÿ¨ŸÖŸàÿπ ${winner.score} ŸÜŸÇÿ∑ÿ©!`, 'celebration');
  
  setTimeout(() => {
    showLightningLeaderboard();
  }, 2000);
  
  playCosmicSound('fireworks-burst');
}

function updateLightningCompetitionStatus(message) {
  const statusElement = document.getElementById('lightningCompetitionStatus');
  if (statusElement) {
    statusElement.textContent = message;
  }
}

function addLightningReaction(message, type = 'normal') {
  const reactionsContainer = document.getElementById('lightningReactions');
  if (!reactionsContainer) return;
  
  // Remove the placeholder if it exists
  if (reactionsContainer.children.length === 1 && reactionsContainer.textContent.includes('ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß')) {
    reactionsContainer.innerHTML = '';
  }
  
  const reaction = document.createElement('div');
  reaction.className = 'lightning-reaction';
  
  let bgColor, icon;
  switch(type) {
    case 'system':
      bgColor = 'rgba(0,255,255,0.2)';
      icon = 'ü§ñ';
      break;
    case 'celebration':
      bgColor = 'rgba(255,215,0,0.3)';
      icon = 'üéâ';
      break;
    default:
      bgColor = 'rgba(255,255,255,0.1)';
      icon = 'üí¨';
  }
  
  reaction.style.background = bgColor;
  reaction.innerHTML = `
    <div style="display: flex; align-items: center; gap: 0.5rem;">
      <span style="font-size: 1.2rem;">${icon}</span>
      <span style="flex: 1;">${message}</span>
      <span style="font-size: 0.8rem; color: rgba(255,255,255,0.6);">${new Date().toLocaleTimeString('ar')}</span>
    </div>
  `;
  
  reactionsContainer.appendChild(reaction);
  reactionsContainer.scrollTop = reactionsContainer.scrollHeight;
  
  // Keep only last 5 reactions
  while (reactionsContainer.children.length > 5) {
    reactionsContainer.removeChild(reactionsContainer.firstChild);
  }
}

// ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ
function startScienceChallenge() {
  hideAllArenas();
  document.getElementById('scienceArena').style.display = 'block';
  
  startScienceTimer();
  playCosmicSound('brain-activate');
  
  // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑŸÑŸÖÿπÿØÿßÿ™
  setupScienceEquipment();
}

// ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ
function startMathChallenge() {
  hideAllArenas();
  document.getElementById('mathArena').style.display = 'block';
  
  generateMathProblem();
  startMathTimer();
  playCosmicSound('crystal-ping');
}

// ŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÑÿ∫ÿ©
function startLanguageChallenge() {
  hideAllArenas();
  // ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© arena ÿÆÿßÿµ ÿ®ÿßŸÑŸÑÿ∫ÿ© ŸÑÿßÿ≠ŸÇÿßŸã
  showQuantumNotification('üìö ŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÑÿ∫ÿ©', 'ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ∑ŸÑÿßŸÇ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÑÿ∫ŸàŸäÿ© ŸÇÿ±Ÿäÿ®ÿßŸã!', 'info');
  setTimeout(() => {
    document.getElementById('kingdomDashboard').style.display = 'grid';
  }, 2000);
}

// ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ
function startHistoryChallenge() {
  hideAllArenas();
  // ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© arena ÿÆÿßÿµ ÿ®ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸÑÿßÿ≠ŸÇÿßŸã
  showQuantumNotification('üï∞Ô∏è ÿ¢ŸÑÿ© ÿßŸÑÿ≤ŸÖŸÜ', 'ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑÿ±ÿ≠ŸÑÿ© ÿπÿ®ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸÇÿ±Ÿäÿ®ÿßŸã!', 'mystery');
  setTimeout(() => {
    document.getElementById('kingdomDashboard').style.display = 'grid';
  }, 2000);
}

// ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ≠ÿßÿ™
function hideAllArenas() {
  document.getElementById('kingdomDashboard').style.display = 'none';
  document.getElementById('battleArena').style.display = 'none';
  document.getElementById('lightningArena').style.display = 'none';
  document.getElementById('creativeArena').style.display = 'none';
  document.getElementById('scienceArena').style.display = 'none';
  document.getElementById('mathArena').style.display = 'none';
}

// ===== CREATIVE ARENA FUNCTIONS =====
function showDrawingCanvas() {
  const canvas = document.getElementById('creativeCanvas');
  canvas.innerHTML = `
    <h4 style="color: #32cd32; margin-bottom: 1rem;">üñåÔ∏è ŸÑŸàÿ≠ÿ© ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ±ŸÇŸÖŸäÿ©</h4>
    <div style="background: white; height: 300px; border-radius: 10px; margin: 1rem 0; display: flex; align-items: center; justify-content: center;">
      <canvas id="drawingCanvas" width="500" height="250" style="border: 2px solid #32cd32; border-radius: 5px;"></canvas>
    </div>
    <div style="text-align: center;">
      <button class="neural-button" onclick="clearDrawing()">üóëÔ∏è ŸÖÿ≥ÿ≠</button>
      <button class="neural-button" onclick="saveDrawing()">üíæ ÿ≠ŸÅÿ∏</button>
    </div>
  `;
  setupDrawingCanvas();
}

function showStoryWriter() {
  const canvas = document.getElementById('creativeCanvas');
  canvas.innerHTML = `
    <h4 style="color: #32cd32; margin-bottom: 1rem;">üìù ŸÉÿßÿ™ÿ® ÿßŸÑŸÇÿµÿµ</h4>
    <textarea id="storyText" placeholder="ÿßŸÉÿ™ÿ® ŸÇÿµÿ™ŸÉ ŸáŸÜÿß..." style="width: 100%; height: 250px; padding: 1rem; border-radius: 10px; border: 2px solid #32cd32; font-family: 'Cairo', sans-serif; font-size: 1rem; background: rgba(255,255,255,0.9); color: #333;"></textarea>
    <div style="text-align: center; margin-top: 1rem;">
      <button class="neural-button" onclick="generateStoryIdea()">üí° ŸÅŸÉÿ±ÿ© ÿ¨ÿØŸäÿØÿ©</button>
      <button class="neural-button" onclick="saveStory()">üíæ ÿ≠ŸÅÿ∏ ÿßŸÑŸÇÿµÿ©</button>
    </div>
  `;
}

function showMusicComposer() {
  const canvas = document.getElementById('creativeCanvas');
  canvas.innerHTML = `
    <h4 style="color: #32cd32; margin-bottom: 1rem;">üéµ ŸÖÿ§ŸÑŸÅ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ</h4>
    <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem; margin: 1rem 0;">
      ${Array.from({length: 8}, (_, i) => 
        `<button class="neural-button" onclick="playNote(${i})" style="padding: 1rem; font-size: 1.2rem;">üéµ</button>`
      ).join('')}
    </div>
    <div style="text-align: center;">
      <button class="neural-button" onclick="playMelody()">üé∂ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÑÿ≠ŸÜ</button>
      <button class="neural-button" onclick="recordMelody()">üé§ ÿ™ÿ≥ÿ¨ŸäŸÑ</button>
    </div>
  `;
}

function showIdeaGenerator() {
  const canvas = document.getElementById('creativeCanvas');
  canvas.innerHTML = `
    <h4 style="color: #32cd32; margin-bottom: 1rem;">üí° ŸÖŸàŸÑÿØ ÿßŸÑÿ£ŸÅŸÉÿßÿ±</h4>
    <div id="ideaDisplay" style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 10px; margin: 1rem 0; min-height: 150px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: white;">
      ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ™ŸàŸÑŸäÿØ ŸÅŸÉÿ±ÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ© ÿ¨ÿØŸäÿØÿ©
    </div>
    <div style="text-align: center;">
      <button class="neural-button" onclick="generateCreativeIdea()">‚ö° ŸÅŸÉÿ±ÿ© ÿ¨ÿØŸäÿØÿ©</button>
      <button class="neural-button" onclick="favoriteIdea()">‚≠ê ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÖŸÅÿ∂ŸÑÿ©</button>
    </div>
  `;
}

// ===== SCIENCE LAB FUNCTIONS =====
function selectEquipment(equipment) {
  const experimentArea = document.getElementById('experimentArea');
  
  switch(equipment) {
    case 'microscope':
      experimentArea.innerHTML = `
        <h4 style="color: #9370db; margin-bottom: 1rem;">üî¨ ŸÅÿ≠ÿµ ÿ®ÿßŸÑŸÖÿ¨Ÿáÿ±</h4>
        <p>ÿßÿÆÿ™ÿ± ÿßŸÑÿπŸäŸÜÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ±ŸäÿØ ŸÅÿ≠ÿµŸáÿß:</p>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 1rem 0;">
          <button class="neural-button" onclick="examineSpecimen('leaf')">üåø Ÿàÿ±ŸÇÿ© ŸÜÿ®ÿßÿ™</button>
          <button class="neural-button" onclick="examineSpecimen('water')">üíß ŸÇÿ∑ÿ±ÿ© ŸÖÿßÿ°</button>
          <button class="neural-button" onclick="examineSpecimen('salt')">üßÇ ÿ®ŸÑŸàÿ±ÿßÿ™ ŸÖŸÑÿ≠</button>
        </div>
      `;
      break;
    case 'beaker':
      experimentArea.innerHTML = `
        <h4 style="color: #9370db; margin-bottom: 1rem;">üß™ ÿ™ÿ¨ÿ±ÿ®ÿ© ŸÉŸäŸÖŸäÿßÿ¶Ÿäÿ©</h4>
        <p>ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿßÿØ ŸÑŸÑÿ™ÿ¨ÿ±ÿ®ÿ©:</p>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 1rem 0;">
          <button class="neural-button" onclick="mixChemicals('acid')">üü° ÿ≠ŸÖÿ∂</button>
          <button class="neural-button" onclick="mixChemicals('base')">üü¢ ŸÇÿßÿπÿØÿ©</button>
        </div>
      `;
      break;
    default:
      experimentArea.innerHTML = `<p>ÿ¨Ÿáÿßÿ≤ ${equipment} ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ!</p>`;
  }
  
  playCosmicSound('ai-beep');
}

// ===== MATH KINGDOM FUNCTIONS =====
function generateMathProblem() {
  const problems = [
    { question: '25 + 17 = ?', answer: '42' },
    { question: '8 √ó 7 = ?', answer: '56' },
    { question: '100 √∑ 4 = ?', answer: '25' },
    { question: '15¬≤ = ?', answer: '225' },
    { question: '‚àö64 = ?', answer: '8' },
    { question: '12 √ó 12 = ?', answer: '144' },
    { question: '50 - 23 = ?', answer: '27' },
    { question: '9 √ó 9 = ?', answer: '81' }
  ];
  
  const randomProblem = problems[Math.floor(Math.random() * problems.length)];
  gameState.currentMathAnswer = randomProblem.answer;
  
  document.getElementById('mathProblem').textContent = randomProblem.question;
  document.getElementById('mathAnswer').value = '';
  document.getElementById('mathAnswer').focus();
}

function checkMathAnswer() {
  const userAnswer = document.getElementById('mathAnswer').value.trim();
  
  if (userAnswer === gameState.currentMathAnswer) {
    playCosmicSound('win');
    showQuantumNotification('‚úÖ ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©!', 'ÿ£ÿ≠ÿ≥ŸÜÿ™! ÿßŸÑŸÜŸÇÿßÿ∑ +10', 'success');
    setTimeout(() => nextMathProblem(), 1500);
  } else {
    playCosmicSound('wrong_answer');
    showQuantumNotification('‚ùå ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©', 'ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ!', 'error');
  }
}

function nextMathProblem() {
  generateMathProblem();
  playCosmicSound('cosmic-click');
}

function getMathHint() {
  showQuantumNotification('üí° ÿ™ŸÑŸÖŸäÿ≠', 'ŸÅŸÉÿ± ŸÅŸä ÿßŸÑÿπŸÖŸÑŸäÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®Ÿäÿ© ÿÆÿ∑Ÿàÿ© ÿ®ÿÆÿ∑Ÿàÿ©', 'info');
  playCosmicSound('ai-notification');
}

// ===== TIMER FUNCTIONS =====
function startCreativeTimer() {
  let timeLeft = 300; // 5 minutes
  const timer = document.getElementById('creativeTimer');
  
  const countdown = setInterval(() => {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    if (timeLeft <= 0) {
      clearInterval(countdown);
      playCosmicSound('end-timer');
      showQuantumNotification('‚è∞ ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!', 'ÿ£ÿ∏Ÿáÿ± ÿ•ÿ®ÿØÿßÿπŸÉ ÿßŸÑÿ¢ŸÜ!', 'warning');
    }
    timeLeft--;
  }, 1000);
}

function startScienceTimer() {
  let timeLeft = 600; // 10 minutes
  const timer = document.getElementById('scienceTimer');
  
  const countdown = setInterval(() => {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    if (timeLeft <= 0) {
      clearInterval(countdown);
      playCosmicSound('end-timer');
      showQuantumNotification('‚è∞ ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©!', 'ŸÖÿß ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ™Ÿä ÿ™ŸàÿµŸÑÿ™ ÿ•ŸÑŸäŸáÿßÿü', 'info');
    }
    timeLeft--;
  }, 1000);
}

function startMathTimer() {
  let timeLeft = 180; // 3 minutes
  const timer = document.getElementById('mathTimer');
  
  const countdown = setInterval(() => {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    if (timeLeft <= 0) {
      clearInterval(countdown);
      playCosmicSound('end-timer');
      showQuantumNotification('‚è∞ ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!', 'ŸÉŸÖ ŸÖÿ≥ÿ£ŸÑÿ© ÿ≠ŸÑŸÑÿ™ÿü', 'warning');
    }
    timeLeft--;
  }, 1000);
}

// ===== CREATIVE FUNCTIONS =====
function generateCreativeIdea() {
  const ideas = [
    'üåü ÿßÿ®ÿ™ŸÉÿ± ŸÑÿπÿ®ÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ¨ÿØŸäÿØÿ©',
    'üé® ÿµŸÖŸÖ ŸÖŸÑÿµŸÇÿßŸã ŸÑŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ© ÿπŸÑŸâ ÿßŸÑÿ®Ÿäÿ¶ÿ©',
    'ü§ñ ÿ™ÿÆŸäŸÑ ÿ±Ÿàÿ®Ÿàÿ™ ŸÖÿ≥ÿßÿπÿØ ŸÑŸÑÿ∑ŸÑÿßÿ®',
    'üöÄ ÿßÿÆÿ™ÿ±ÿπ Ÿàÿ≥ŸäŸÑÿ© ŸÜŸÇŸÑ ŸÖÿ≥ÿ™ŸÇÿ®ŸÑŸäÿ©',
    'üì± ÿ∑Ÿàÿ± ÿ™ÿ∑ÿ®ŸäŸÇÿßŸã ŸÖŸÅŸäÿØÿßŸã ŸÑŸÑÿ∑ŸÑÿßÿ®',
    'üè† ÿµŸÖŸÖ ÿ®Ÿäÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ',
    'üåç ÿßŸÇÿ™ÿ±ÿ≠ ÿ≠ŸÑŸàŸÑÿßŸã ŸÑŸÑŸÖÿ¥ÿßŸÉŸÑ ÿßŸÑÿπÿßŸÑŸÖŸäÿ©',
    'üé≠ ÿ£ŸÑŸÅ ŸÖÿ≥ÿ±ÿ≠Ÿäÿ© ŸÇÿµŸäÿ±ÿ©'
  ];
  
  const randomIdea = ideas[Math.floor(Math.random() * ideas.length)];
  document.getElementById('ideaDisplay').textContent = randomIdea;
  playCosmicSound('cosmic-click');
}

function setupScienceEquipment() {
  const equipmentItems = document.querySelectorAll('.equipment-item');
  equipmentItems.forEach(item => {
    item.addEventListener('mouseenter', () => {
      item.style.transform = 'scale(1.05)';
      item.style.background = 'rgba(147,112,219,0.3)';
    });
    item.addEventListener('mouseleave', () => {
      item.style.transform = 'scale(1)';
      item.style.background = 'rgba(255,255,255,0.1)';
    });
  });
}

// ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÖŸÜ ÿ£Ÿä ÿ≥ÿßÿ≠ÿ©
function returnToKingdom() {
  hideAllArenas();
  
  // ÿ•ŸäŸÇÿßŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ§ŸÇÿ™ÿßÿ™
  if (lightningTimerInterval) clearInterval(lightningTimerInterval);
  if (wisdomTimerInterval) clearInterval(wisdomTimerInterval);
  if (creativeTimerInterval) clearInterval(creativeTimerInterval);
  if (scienceTimerInterval) clearInterval(scienceTimerInterval);
  if (languageTimerInterval) clearInterval(languageTimerInterval);
  if (mathTimerInterval) clearInterval(mathTimerInterval);
  if (historyTimerInterval) clearInterval(historyTimerInterval);
  if (mysteryTimerInterval) clearInterval(mysteryTimerInterval);
  if (teamBattleTimerInterval) clearInterval(teamBattleTimerInterval);
  
  // ÿ•ÿ∏Ÿáÿßÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÖÿßŸÑŸÉ
  document.getElementById('kingdomContent').style.display = 'block';
  document.getElementById('kingdomDashboard').style.display = 'grid';
  
  playCosmicSound('ui-back');
  
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üè∞ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ÿπŸàÿØÿ™ŸÉ ŸÑŸÑŸÖŸÖŸÑŸÉÿ©', `ÿßÿÆÿ™ÿ± ŸÖŸÖŸÑŸÉÿ© ÿ£ÿÆÿ±Ÿâ ŸÑŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ! (${studentsCount} ÿ∑ŸÑÿßÿ® ÿ¨ÿßŸáÿ≤ŸàŸÜ)`, 'info');
}

function hideAllArenas() {
  const arenas = [
    'lightningArena', 'wisdomArena', 'creativeArena', 'scienceArena',
    'languageArena', 'mathArena', 'historyArena', 'mysteryArena', 
    'teamBattleArena', 'battleArena'
  ];
  
  arenas.forEach(arenaId => {
    const arena = document.getElementById(arenaId);
    if (arena) {
      arena.style.display = 'none';
    }
  });
}

// ===== ACHIEVEMENTS SYSTEM =====
const achievements = {
  firstSteps: { id: 'firstSteps', name: 'ÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ£ŸàŸÑŸâ', description: 'ÿ£ŸÉŸÖŸÑ ÿ£ŸàŸÑ ÿ™ÿ≠ÿØŸä', icon: 'üë∂', points: 10, unlocked: false },
  speedDemon: { id: 'speedDemon', name: 'ÿ®ÿ±ŸÇ ÿßŸÑÿ≥ÿ±ÿπÿ©', description: 'ÿ£ŸÉŸÖŸÑ 10 ÿ™ÿ≠ÿØŸäÿßÿ™ ŸÅŸä 5 ÿØŸÇÿßÿ¶ŸÇ', icon: '‚ö°', points: 50, unlocked: false },
  brainiac: { id: 'brainiac', name: 'ÿßŸÑÿπÿ®ŸÇÿ±Ÿä', description: 'ÿßÿ¨ŸÖÿπ 100 ŸÜŸÇÿ∑ÿ©', icon: 'üß†', points: 100, unlocked: false },
  perfectionist: { id: 'perfectionist', name: 'ÿßŸÑŸÉŸÖÿßŸÑŸä', description: 'ÿ£ÿ¨ÿ® ÿπŸÑŸâ 10 ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ© ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠', icon: 'üíé', points: 75, unlocked: false },
  explorer: { id: 'explorer', name: 'ÿßŸÑŸÖÿ≥ÿ™ŸÉÿ¥ŸÅ', description: 'ÿ≤ÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÖÿßŸÑŸÉ', icon: 'üó∫Ô∏è', points: 30, unlocked: false },
  creative: { id: 'creative', name: 'ÿßŸÑŸÖÿ®ÿØÿπ', description: 'ÿ£ŸÉŸÖŸÑ 5 ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ•ÿ®ÿØÿßÿπŸäÿ©', icon: 'üé®', points: 40, unlocked: false },
  scientist: { id: 'scientist', name: 'ÿßŸÑÿπÿßŸÑŸÖ', description: 'ÿ£ÿ¨ÿ± 10 ÿ™ÿ¨ÿßÿ±ÿ® ŸÅŸä ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿπŸÑŸàŸÖ', icon: 'üî¨', points: 60, unlocked: false },
  mathematician: { id: 'mathematician', name: 'ÿπÿßŸÑŸÖ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿßÿ™', description: 'ÿ≠ŸÑ 25 ŸÖÿ≥ÿ£ŸÑÿ© ÿ±Ÿäÿßÿ∂Ÿäÿ©', icon: 'üìê', points: 80, unlocked: false }
};

function initializeAchievements() {
  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
  const savedAchievements = localStorage.getItem('kingdomAchievements');
  if (savedAchievements) {
    const saved = JSON.parse(savedAchievements);
    Object.keys(achievements).forEach(key => {
      if (saved[key]) {
        achievements[key].unlocked = saved[key].unlocked;
      }
    });
  }
  
  displayAchievements();
}

function displayAchievements() {
  const container = document.getElementById('achievementsContainer');
  if (!container) return;
  
  const unlockedAchievements = Object.values(achievements).filter(a => a.unlocked);
  const recentAchievements = unlockedAchievements.slice(-3); // ÿ¢ÿÆÿ± 3 ÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™
  
  container.innerHTML = recentAchievements.map(achievement => `
    <div style="background: linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2)); padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid rgba(255,215,0,0.5);">
      <div style="font-size: 2rem; margin-bottom: 0.5rem;">${achievement.icon}</div>
      <h4 style="color: #ffd700; margin-bottom: 0.3rem; font-size: 1rem;">${achievement.name}</h4>
      <p style="font-size: 0.8rem; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem;">${achievement.description}</p>
      <div style="color: #ffd700; font-weight: bold;">+${achievement.points} ŸÜŸÇÿ∑ÿ©</div>
    </div>
  `).join('');
  
  if (recentAchievements.length === 0) {
    container.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: rgba(255,255,255,0.6);">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üèÜ</div>
        <div>ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ŸÑŸÅÿ™ÿ≠ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™!</div>
      </div>
    `;
  }
}

function checkAchievement(achievementId) {
  if (achievements[achievementId] && !achievements[achievementId].unlocked) {
    achievements[achievementId].unlocked = true;
    
    // ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™
    localStorage.setItem('kingdomAchievements', JSON.stringify(achievements));
    
    // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤
    showAchievementNotification(achievements[achievementId]);
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂
    displayAchievements();
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ© ŸàŸÖÿ±ÿ¶Ÿäÿ©
    playCosmicSound('achievement-unlock');
    createCosmicExplosion(document.getElementById('achievementsContainer'));
  }
}

function showAchievementNotification(achievement) {
  showQuantumNotification(
    `üèÜ ÿ•ŸÜÿ¨ÿßÿ≤ ÿ¨ÿØŸäÿØ: ${achievement.name}`,
    `${achievement.description} - +${achievement.points} ŸÜŸÇÿ∑ÿ©`,
    'success'
  );
}

function checkForNewAchievements() {
  const totalPoints = getTotalPoints();
  const completedChallenges = gameState.completedChallenges || 0;
  
  // ŸÅÿ≠ÿµ ŸÖÿÆÿ™ŸÑŸÅ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™
  if (completedChallenges >= 1) checkAchievement('firstSteps');
  if (totalPoints >= 100) checkAchievement('brainiac');
  if (gameState.visitedRealms && gameState.visitedRealms.length >= 4) checkAchievement('explorer');
  
  playCosmicSound('data-process');
  showQuantumNotification('üîç ŸÅÿ≠ÿµ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™', 'ÿ™ŸÖ ŸÅÿ≠ÿµ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©', 'info');
}

function showAllAchievements() {
  const modal = document.getElementById('achievementsModal');
  const grid = document.getElementById('achievementsGrid');
  
  // Clear and populate achievements
  grid.innerHTML = '';
  
  Object.keys(achievements).forEach(achievementId => {
    const achievement = achievements[achievementId];
    const isUnlocked = unlockedAchievements.includes(achievementId);
    
    const card = document.createElement('div');
    card.className = `achievement-card ${isUnlocked ? 'unlocked' : ''}`;
    
    card.innerHTML = `
      <div class="achievement-icon">${achievement.icon}</div>
      <div class="achievement-title">${achievement.title}</div>
      <div class="achievement-description">${achievement.description}</div>
      <div class="achievement-status ${isUnlocked ? 'unlocked' : 'locked'}">
        ${isUnlocked ? '‚úÖ ÿ™ŸÖ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤' : 'üîí ŸÖÿ§ŸÖŸÜ'}
      </div>
    `;
    
    grid.appendChild(card);
  });
  
  modal.classList.add('show');
  playCosmicSound('cosmic-portal');
}

function closeAchievementsModal() {
  const modal = document.getElementById('achievementsModal');
  modal.classList.remove('show');
  playCosmicSound('cosmic-click');
}

// ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿ®ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
document.addEventListener('click', function(e) {
  const achievementsModal = document.getElementById('achievementsModal');
  const settingsModal = document.getElementById('settingsModal');
  const statsModal = document.getElementById('statsModal');
  
  if (e.target === achievementsModal) {
    closeAchievementsModal();
  }
  
  if (e.target === settingsModal && settingsModal.style.display === 'flex') {
    closeSettings();
  }
  
  if (e.target === statsModal && statsModal.style.display === 'flex') {
    closeStats();
  }
});

// ===== QUICK CHALLENGES =====
function startOneMinuteChallenge() {
  gameState.quickChallenge = 'oneMinute';
  gameState.quickChallengeStartTime = Date.now();
  gameState.quickChallengeScore = 0;
  
  showQuantumNotification('‚è∞ ÿ™ÿ≠ÿØŸä ÿßŸÑÿØŸÇŸäŸÇÿ© ÿßŸÑŸàÿßÿ≠ÿØÿ©', 'ÿßÿ®ÿØÿ£ ÿßŸÑÿ¢ŸÜ! ŸÑÿØŸäŸÉ 60 ÿ´ÿßŸÜŸäÿ© ŸÅŸÇÿ∑', 'warning');
  playCosmicSound('countdown-tick');
  
  // ŸäŸÖŸÉŸÜ ÿØŸÖÿ¨Ÿá ŸÖÿπ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ≠ÿßŸÑŸä
  setTimeout(() => activateRealm('lightning'), 1000);
}

function startAccuracyChallenge() {
  gameState.quickChallenge = 'accuracy';
  gameState.quickChallengeScore = 0;
  gameState.consecutiveCorrect = 0;
  
  showQuantumNotification('üéØ ÿ™ÿ≠ÿØŸä ÿßŸÑÿØŸÇÿ©', '10 ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ®ÿØŸàŸÜ ÿ£ÿÆÿ∑ÿßÿ° - ŸáŸÑ ÿ™ÿ≥ÿ™ÿ∑Ÿäÿπÿü', 'info');
  playCosmicSound('brain-activate');
  
  setTimeout(() => activateRealm('wisdom'), 1000);
}

function startStarChallenge() {
  gameState.quickChallenge = 'stars';
  gameState.quickChallengeStartTime = Date.now();
  gameState.quickChallengeTarget = 50;
  
  showQuantumNotification('‚≠ê ÿ™ÿ≠ÿØŸä ÿßŸÑŸÜÿ¨ŸàŸÖ', 'ÿßÿ¨ŸÖÿπ 50 ŸÜŸÇÿ∑ÿ© ŸÅŸä ÿ£ÿ≥ÿ±ÿπ ŸàŸÇÿ™ ŸÖŸÖŸÉŸÜ!', 'success');
  playCosmicSound('level-up');
  
  // ŸäŸÖŸÉŸÜ ÿßŸÑÿ®ÿØÿ° ÿ®ÿ£Ÿä ŸÖŸÖŸÑŸÉÿ©
  setTimeout(() => {
    document.getElementById('kingdomDashboard').style.display = 'grid';
    showQuantumNotification('üéØ ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÖŸÑŸÉÿ©', 'ÿßÿ®ÿØÿ£ ŸÖŸÜ ÿ£Ÿä ŸÖŸÖŸÑŸÉÿ© ÿ™ÿ±ŸäÿØ!', 'info');
  }, 1500);
}

// ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ™ŸÇÿØŸÖ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©
function updateQuickChallengeProgress(points) {
  if (!gameState.quickChallenge) return;
  
  gameState.quickChallengeScore += points;
  
  switch (gameState.quickChallenge) {
    case 'oneMinute':
      const timeLeft = 60 - Math.floor((Date.now() - gameState.quickChallengeStartTime) / 1000);
      if (timeLeft <= 0) {
        completeQuickChallenge();
      }
      break;
      
    case 'accuracy':
      gameState.consecutiveCorrect++;
      if (gameState.consecutiveCorrect >= 10) {
        completeQuickChallenge();
      }
      break;
      
    case 'stars':
      if (gameState.quickChallengeScore >= gameState.quickChallengeTarget) {
        completeQuickChallenge();
      }
      break;
  }
}

function completeQuickChallenge() {
  const challenge = gameState.quickChallenge;
  const score = gameState.quickChallengeScore;
  
  let message = '';
  let bonus = 0;
  
  switch (challenge) {
    case 'oneMinute':
      message = `üî• ÿ£ÿ¨ÿ®ÿ™ ÿπŸÑŸâ ${score} ÿ≥ÿ§ÿßŸÑ ŸÅŸä ÿØŸÇŸäŸÇÿ© Ÿàÿßÿ≠ÿØÿ©!`;
      bonus = score * 2;
      break;
    case 'accuracy':
      message = `üéØ ŸÖÿ∞ŸáŸÑ! 10 ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿµÿ≠Ÿäÿ≠ÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ©!`;
      bonus = 50;
      checkAchievement('perfectionist');
      break;
    case 'stars':
      const timeSpent = Math.floor((Date.now() - gameState.quickChallengeStartTime) / 1000);
      message = `‚≠ê ÿ±ÿßÿ¶ÿπ! ÿ¨ŸÖÿπÿ™ 50 ŸÜŸÇÿ∑ÿ© ŸÅŸä ${timeSpent} ÿ´ÿßŸÜŸäÿ©!`;
      bonus = Math.max(10, 100 - timeSpent);
      break;
  }
  
  gameState.totalPoints = (gameState.totalPoints || 0) + bonus;
  
  showQuantumNotification('üèÜ ÿ™ÿ≠ÿØŸä ŸÖŸÉÿ™ŸÖŸÑ!', `${message} ŸÖŸÉÿßŸÅÿ£ÿ©: +${bonus} ŸÜŸÇÿ∑ÿ©`, 'success');
  playCosmicSound('epic-victory');
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ≥ÿ±Ÿäÿπ
  gameState.quickChallenge = null;
  
  // ŸÅÿ≠ÿµ ÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ÿ¨ÿØŸäÿØÿ©
  setTimeout(() => checkForNewAchievements(), 2000);
}

// ===== FINAL INITIALIZATION =====
console.log('üèÜ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ© - ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉÿ™ŸÖŸÑ!');
console.log('üéµ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ŸÖÿπ 61 ÿ™ÿ£ÿ´Ÿäÿ± ÿµŸàÿ™Ÿä ÿ¨ÿßŸáÿ≤!');
console.log('‚ö° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÖÿßŸÑŸäŸÉ ŸàÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑÿπŸÖŸÑ!');
console.log('üèÜ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ ŸÖŸÅÿπŸÑ!');
console.log('üéØ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ≥ÿ±Ÿäÿπÿ© ŸÖÿ™ÿßÿ≠ÿ©!');

// Initialize the enhanced audio system
initAudioSystem();

// ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπŸÑŸàŸäÿ©
initializeControlButtons();

// ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
loadSavedSettings();

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™
updateSoundButton();

// Session button update removed

// ÿ™ŸÅÿπŸäŸÑ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™
initializeAchievements();

// ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÖŸÖÿßŸÑŸäŸÉ ÿßŸÑŸÖÿ≤ÿßÿ±ÿ©
if (!gameState.visitedRealms) {
  gameState.visitedRealms = [];
}

// ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿ™ÿ®ÿπ ÿßŸÑŸÜŸÇÿßÿ∑
if (!gameState.totalPoints) {
  gameState.totalPoints = 0;
}

// ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπ ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÑŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ≥ÿ±Ÿäÿπ
document.addEventListener('keydown', function(event) {
  if (event.ctrlKey || event.metaKey) {
    switch(event.key) {
      case '1':
        event.preventDefault();
        activateRealm('lightning');
        break;
      case '2':
        event.preventDefault();
        activateRealm('wisdom');
        break;
      case '3':
        event.preventDefault();
        activateRealm('battle');
        break;
      case '4':
        event.preventDefault();
        activateRealm('creative');
        break;
      case 'h':
        event.preventDefault();
        returnToKingdom();
        break;
    }
  }
});

// ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ® ŸÖÿ≠ÿ≥ŸÜÿ©
setTimeout(() => {
  if (document.getElementById('kingdomContent').style.display !== 'none') {
    showQuantumNotification(
      'üëë ÿ£ŸáŸÑÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ±ÿ©!',
      'ÿßŸÉÿ™ÿ¥ŸÅ 9 ŸÖŸÖÿßŸÑŸÉ ŸÖÿÆÿ™ŸÑŸÅÿ©ÿå ÿßÿ¨ŸÖÿπ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ÿå Ÿàÿ™ÿ≠ÿØŸâ ŸÜŸÅÿ≥ŸÉ! üöÄ',
      'info'
    );
  }
}, 2000);
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const soundBtn = document.getElementById('soundBtn');
  if (soundBtn) {
    let isMuted = false;
    soundBtn.addEventListener('click', () => {
      isMuted = !isMuted;
      document.querySelectorAll('audio, video').forEach(el => {
        el.muted = isMuted;
      });
      const icon = soundBtn.querySelector('.btn-icon');
      if (icon) icon.textContent = isMuted ? 'üîá' : 'üîä';
    });
  }
  // ÿ•ÿ∂ÿßŸÅÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
  const soundConfig = {
    lightning: {
      entrance: 'lightning-strike',
      correct: 'electric-charge',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'lightning-whoosh'
    },
    wisdom: {
      entrance: 'brain-activate',
      correct: 'knowledge-unlock',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'mystic-wind'
    },
    creative: {
      entrance: 'magic-sparkle',
      correct: 'crystal-bonus',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'cosmic-portal'
    },
    science: {
      entrance: 'cosmic-explosion',
      correct: 'crystal-ping',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'dimensional-shift'
    },
    language: {
      entrance: 'mystic-wind',
      correct: 'achievement-unlock',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'ancient-bell'
    },
    math: {
      entrance: 'energy-boost',
      correct: 'level-up',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'cosmic-click'
    },
    history: {
      entrance: 'ancient-bell',
      correct: 'crown-ceremony',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'battle-horn'
    },
    mystery: {
      entrance: 'mystery-whisper',
      correct: 'cosmic-portal',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'dimensional-shift'
    },
    teamBattle: {
      entrance: 'battle-horn',
      correct: 'battle-victory',
      wrong: 'wrong_answer',
      timer: 'countdown-tick',
      end: 'epic-victory'
    }
  };

  function playArenaSound(arenaType, soundType) {
    const soundName = soundConfig[arenaType] ? soundConfig[arenaType][soundType] : null;
    if (soundName) {
      playCosmicSound(soundName);
    }
  }

  // ===== DIAGNOSTIC FUNCTIONS =====
  function testKingdomEntry(realmType = 'lightning') {
    console.log('üß™ ÿßÿÆÿ™ÿ®ÿßÿ± ÿØÿÆŸàŸÑ ÿßŸÑŸÖŸÖŸÑŸÉÿ©:', realmType);
    console.log('üìä ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸàŸÜ:', selectedStudentsList);
    console.log('üéÆ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿπÿ®ÿ©:', gameState);
    
    if (!selectedStudentsList || selectedStudentsList.length === 0) {
      console.log('‚ùå Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ŸÑÿßÿ® ÿ£ŸàŸÑÿßŸã');
      // ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ŸÑÿßÿ® ÿ™ÿ¨ÿ±Ÿäÿ®ŸäŸäŸÜ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
      selectedStudentsList = ['ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ', 'ŸÅÿßÿ∑ŸÖÿ© ÿπŸÑŸä', 'ÿπÿ®ÿØÿßŸÑŸÑŸá ÿ≥ÿßŸÑŸÖ'];
      console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ŸÑÿßÿ® ÿ™ÿ¨ÿ±Ÿäÿ®ŸäŸäŸÜ:', selectedStudentsList);
    }
    
    activateRealm(realmType);
  }

  // ÿØÿßŸÑÿ© ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖÿ®ÿßÿ¥ÿ± ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
  function quickTestArena(realmType = 'lightning') {
    console.log('üöÄ ÿßÿÆÿ™ÿ®ÿßÿ± ÿ≥ÿ±Ÿäÿπ ŸÑŸÑÿ≥ÿßÿ≠ÿ©:', realmType);
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ£ŸàŸÑÿßŸã
    if (!studentData || Object.keys(studentData).length === 0) {
      console.log('‚ùå ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ∫Ÿäÿ± ŸÖÿ≠ŸÖŸÑÿ©');
      loadStudentData().then(() => {
        quickTestArena(realmType); // ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©
      });
      return;
    }
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ŸÑÿßÿ® ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
    selectedStudentsList = ['ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä', 'ŸÅÿßÿ∑ŸÖÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±', 'ŸÖÿ≠ŸÖÿØ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨'];
    gameState.selectedStudents = [...selectedStudentsList];
    gameState.gameStarted = true; // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ© ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
    
    // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ ŸÖÿ®ÿßÿ¥ÿ±ÿ©
    document.getElementById('selectionPanel').style.display = 'none';
    document.getElementById('kingdomContent').style.display = 'block';
    
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿπÿØÿßÿØ ÿ∑ŸÑÿßÿ® ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±');
    
    // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑŸÖŸÖŸÑŸÉÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ©
    activateRealm(realmType);
    
    return true;
  }

  // ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
  function goToKingdoms() {
    console.log('üè∞ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÑŸÑŸÖŸÖÿßŸÑŸÉ');
    
    if (!selectedStudentsList || selectedStudentsList.length === 0) {
      // ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ŸÑÿßÿ® ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäŸäŸÜ
      selectedStudentsList = ['ÿ∑ÿßŸÑÿ® 1', 'ÿ∑ÿßŸÑÿ® 2', 'ÿ∑ÿßŸÑÿ® 3'];
      gameState.selectedStudents = [...selectedStudentsList];
    }
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® Ÿàÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ°
    updateSelectedCount();
    
    // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©
    gameState.gameStarted = true;
    
    // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ
    document.getElementById('selectionPanel').style.display = 'none';
    document.getElementById('kingdomContent').style.display = 'block';
    
    // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿ∏Ÿáÿßÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÖÿßŸÑŸÉ
    const kingdomDashboard = document.getElementById('kingdomDashboard');
    if (kingdomDashboard) {
      kingdomDashboard.style.display = 'grid';
      kingdomDashboard.style.visibility = 'visible';
      kingdomDashboard.style.opacity = '1';
    }
    
    showQuantumNotification('üè∞ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿßŸÑŸÖŸÖÿßŸÑŸÉ!', 'ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ±ŸäÿØ ÿØÿÆŸàŸÑŸáÿß', 'success');
    
    console.log('‚úÖ ÿ™ŸÖ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖŸÖÿßŸÑŸÉ');
    return true;
  }

  // ŸÅÿ≠ÿµ ÿ¨ÿßŸáÿ≤Ÿäÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ
  function checkSystemReadiness() {
    console.log('üîç ŸÅÿ≠ÿµ ÿ¨ÿßŸáÿ≤Ÿäÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ:');
    console.log('üìä ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®:', Object.keys(studentData).length > 0 ? 'ŸÖÿ≠ŸÖŸÑÿ© ‚úÖ' : 'ÿ∫Ÿäÿ± ŸÖÿ≠ŸÖŸÑÿ© ‚ùå');
    console.log('üìã ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸàŸÜ:', selectedStudentsList.length > 0 ? `${selectedStudentsList.length} ÿ∑ŸÑÿßÿ® ‚úÖ` : 'ŸÑÿß ŸäŸàÿ¨ÿØ ‚ùå');
    console.log('üéÆ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿπÿ®ÿ©:', gameState.currentRealm || 'ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©');
    
    // ŸÅÿ≠ÿµ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ°
    const startBtn = document.getElementById('startGameBtn');
    if (startBtn) {
      console.log('üöÄ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ°:', startBtn.disabled ? 'ŸÖÿπÿ∑ŸÑ ‚ùå' : 'ŸÖŸÅÿπŸÑ ‚úÖ');
    }
    
    // ÿ™ŸÇÿØŸäŸÖ ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™
    if (Object.keys(studentData).length === 0) {
      console.log('üí° ÿßŸÇÿ™ÿ±ÿßÿ≠: ÿ™ÿ¥ÿ∫ŸäŸÑ loadStudentData()');
    }
    if (selectedStudentsList.length === 0) {
      console.log('üí° ÿßŸÇÿ™ÿ±ÿßÿ≠: ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ŸÑÿßÿ® ÿ£Ÿà ÿ™ÿ¥ÿ∫ŸäŸÑ quickTestArena()');
    }
    if (startBtn && startBtn.disabled) {
      console.log('üí° ÿßŸÇÿ™ÿ±ÿßÿ≠: ÿ™ÿ¥ÿ∫ŸäŸÑ enableStartButton() ÿ£Ÿà goToKingdoms()');
    }
    
    return {
      dataLoaded: Object.keys(studentData).length > 0,
      studentsSelected: selectedStudentsList.length > 0,
      startButtonEnabled: startBtn ? !startBtn.disabled : false,
      ready: Object.keys(studentData).length > 0 && selectedStudentsList.length > 0
    };
  }

  // ÿØÿßŸÑÿ© ŸÑÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ° ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
  function enableStartButton() {
    console.log('üöÄ ÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ°...');
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ŸÑÿßÿ® ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸàÿ¨ÿØŸàÿß
    if (!selectedStudentsList || selectedStudentsList.length === 0) {
      selectedStudentsList = ['ÿ∑ÿßŸÑÿ® ÿßÿÆÿ™ÿ®ÿßÿ± 1', 'ÿ∑ÿßŸÑÿ® ÿßÿÆÿ™ÿ®ÿßÿ± 2'];
      gameState.selectedStudents = [...selectedStudentsList];
      console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ŸÑÿßÿ® ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±');
    }
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØ Ÿàÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≤ÿ±
    updateSelectedCount();
    
    const startBtn = document.getElementById('startGameBtn');
    if (startBtn) {
      startBtn.disabled = false;
      startBtn.style.opacity = '1';
      startBtn.style.cursor = 'pointer';
      console.log('‚úÖ ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ°');
      
      showQuantumNotification('üéØ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ®ÿØÿ°!', 'ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ≤ÿ± "ÿ®ÿØÿ° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™"', 'success');
    } else {
      console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ°');
    }
    
    return true;
  }

  // ÿßÿÆÿ™ÿ®ÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÖÿßŸÑŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã  
  function testAllKingdoms() {
    const realms = ['lightning', 'wisdom', 'creative', 'science', 'language', 'math', 'history', 'mystery', 'battle'];
    
    realms.forEach((realm, index) => {
      setTimeout(() => {
        console.log(`üß™ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÖŸÖŸÑŸÉÿ© ${index + 1}/9: ${realm}`);
        quickTestArena(realm);
        
        // ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜ
        setTimeout(() => {
          returnToKingdom();
        }, 3000);
      }, index * 4000);
    });
  }

  // ÿ•ÿ™ÿßÿ≠ÿ© ÿßŸÑŸàÿ∏ÿßÿ¶ŸÅ ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿπÿßŸÖ
  window.testKingdomEntry = testKingdomEntry;
  window.quickTestArena = quickTestArena;
  window.testAllKingdoms = testAllKingdoms;
  window.checkSystemReadiness = checkSystemReadiness;
  window.enableStartButton = enableStartButton;
  window.goToKingdoms = goToKingdoms;
  window.selectedStudentsList = selectedStudentsList;
  window.gameState = gameState;

  // ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™Ÿàÿ¨Ÿá ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä - ÿßŸÑÿ¢ŸÜ Ÿäÿ™ŸÖ ÿßŸÑÿ™Ÿàÿ¨Ÿá ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ≤ÿ± "ÿ®ÿØÿ° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™"
  console.log('üéÆ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸÖÿßŸÑŸÉ ÿ¨ÿßŸáÿ≤! ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ®ÿØÿ° ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™" ŸÑŸÑÿßŸÜÿ∑ŸÑÿßŸÇ');

});

// ===== CHECK CACHE CLEAR RETURN =====
function checkCacheClearReturn() {
  try {
    // ŸÅÿ≠ÿµ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ§ŸÇÿ™ÿ©
    const hasOldData = localStorage.getItem('squidGamePlayers') || 
                      localStorage.getItem('classData') ||
                      localStorage.getItem('kingdomGameState') ||
                      localStorage.getItem('currentSession');
    
    // ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßŸÑŸàÿµŸàŸÑ ŸÖŸÜ referrer ŸÖÿπŸäŸÜ
    const referrer = document.referrer;
    const fromKingdomsCenter = referrer.includes('kingdoms-center.html');
    
    // ŸÅÿ≠ÿµ URL parameters ŸÑŸÑŸÉÿ¥ŸÅ ÿπŸÜ ÿßŸÑÿπŸàÿØÿ© ŸÖŸÜ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ
    const urlParams = new URLSearchParams(window.location.search);
    const cacheCleared = urlParams.get('cache_cleared');
    
    if (!hasOldData || fromKingdomsCenter || cacheCleared) {
      // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ÿ™ÿ±ÿ≠Ÿäÿ®Ÿä ŸÑŸÑŸÖÿπŸÑŸÖ ÿßŸÑÿ¨ÿØŸäÿØ
      setTimeout(() => {
        showQuantumNotification(
          'üßπ ŸÜÿ∏ÿßŸÖ ŸÜÿ∏ŸäŸÅ ŸàŸÖÿ±ÿ™ÿ®!', 
          'ÿ™ŸÖ ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© ÿ®ŸÜÿ¨ÿßÿ≠. ŸäŸÖŸÉŸÜ ŸÑŸÑŸÖÿπŸÑŸÖ ÿßŸÑÿ¨ÿØŸäÿØ ÿßŸÑÿ®ÿØÿ° ÿ®ÿ™ÿ¨ÿ±ÿ®ÿ© ŸÜÿ∏ŸäŸÅÿ© ÿ™ŸÖÿßŸÖÿßŸã', 
          'success'
        );
        
        // ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä ŸÑŸÑÿ™ŸÜÿ∏ŸäŸÅ
        if (typeof confetti !== 'undefined') {
          confetti({
            particleCount: 50,
            spread: 70,
            origin: { y: 0.8 },
            colors: ['#4CAF50', '#8BC34A', '#CDDC39']
          });
        }
      }, 1000);
      
      console.log('üßπ ÿ™ŸÖ ÿßŸÑŸÉÿ¥ŸÅ ÿπŸÜ ŸÜÿ∏ÿßŸÖ ŸÜÿ∏ŸäŸÅ - ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ÿßŸÑŸÖÿπŸÑŸÖ ÿßŸÑÿ¨ÿØŸäÿØ!');
    } else {
      // ÿ•ÿ¥ÿπÿßÿ± ÿ®Ÿàÿ¨ŸàÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ©
      setTimeout(() => {
        showQuantumNotification(
          '‚ö†Ô∏è ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ©', 
          'Ÿäÿ®ÿØŸà ÿ£ŸÜ ŸáŸÜÿßŸÉ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿ¨ŸÑÿ≥ÿ© ÿ≥ÿßÿ®ŸÇÿ©. ŸäŸÖŸÉŸÜŸÉ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ŸÅŸä ŸÖÿ±ŸÉÿ≤ ÿßŸÑŸÖŸÖÿßŸÑŸÉ ŸÑÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÜÿ∏ÿßŸÖ', 
          'warning'
        );
      }, 500);
      
      console.log('üìä ÿ™ŸÖ ÿßŸÑŸÉÿ¥ŸÅ ÿπŸÜ ÿ®ŸäÿßŸÜÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ© ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ');
    }
    
    // ÿ™ŸÜÿ∏ŸäŸÅ URL ŸÖŸÜ ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™
    if (cacheCleared) {
      const cleanUrl = window.location.pathname;
      window.history.replaceState({}, document.title, cleanUrl);
    }
    
  } catch (error) {
    console.log('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ŸÅÿ≠ÿµ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ:', error);
  }
}
</script>

<!-- Responsive Helper Script -->
<script src="../assets/js/responsive-helper.js"></script>

</body>
</html>
