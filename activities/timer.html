<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#00796B"/>
  <meta name="description" content="المؤقت الصفي التفاعلي - أداة احترافية لإدارة الوقت في الصف"/>
  <meta name="keywords" content="مؤقت, وقت, تعليم, صف, تفاعلي, عُمان"/>
  <meta name="author" content=""/>

  <title>المؤقت الصفي - الأنشطة التفاعلية</title>

  <!-- الخطوط والأيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- فافيكون -->
  <link rel="icon" type="image/png" href="../assets/media/images/school-logo.png">
  
  <!-- Responsive CSS Framework -->
  <link rel="stylesheet" href="../assets/css/responsive.css">

  <style>
    :root {
      /* نظام ألوان عُماني متطور */
      --primary-color: #00796B;
      --primary-light: #4DB6AC;
      --primary-dark: #004D40;
      --secondary-color: #FF5722;
      --accent-color: #FFD700;
      --success-color: #4CAF50;
      --warning-color: #FF9800;
      --error-color: #F44336;
      --info-color: #2196F3;
      --text-primary: #212121;
      --text-secondary: #757575;
      --text-light: #FAFAFA;
      --background-light: #FAFAFA;
      --surface-color: #FFFFFF;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-medium: rgba(0, 0, 0, 0.2);
      --shadow-dark: rgba(0, 0, 0, 0.3);

      /* متغيرات التخطيط */
      --border-radius: 16px;
      --border-radius-small: 8px;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 48px;

      /* الانتقالات */
      --transition-fast: 0.2s ease-out;
      --transition-normal: 0.3s ease-out;
      --transition-slow: 0.5s ease-out;

      /* الخطوط */
      --font-xs: 0.75rem;
      --font-sm: 0.875rem;
      --font-base: 1rem;
      --font-lg: 1.125rem;
      --font-xl: 1.25rem;
      --font-2xl: 1.5rem;
      --font-3xl: 1.875rem;
      --font-4xl: 2.25rem;
      --font-5xl: 3rem;
      --font-6xl: 3.75rem;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg,
        #e0f7fa 0%,
        #b2dfdb 25%,
        #80cbc4 50%,
        #4db6ac 75%,
        #26a69a 100%);
      background-attachment: fixed;
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* خلفية متحركة */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0, 121, 107, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(255, 87, 34, 0.1) 0%, transparent 50%);
      animation: backgroundShift 20s ease-in-out infinite;
      z-index: -1;
    }

    @keyframes backgroundShift {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(-20px, 20px) rotate(1deg); }
      50% { transform: translate(20px, -20px) rotate(-1deg); }
      75% { transform: translate(-10px, -10px) rotate(0.5deg); }
    }

    /* أزرار التحكم */
    .control-buttons {
      position: fixed;
      top: var(--spacing-md);
      display: flex;
      gap: var(--spacing-sm);
      z-index: 1000;
    }

    .control-buttons.left {
      left: var(--spacing-md);
    }

    .control-buttons.right {
      right: var(--spacing-md);
    }

    .control-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      color: var(--primary-color);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px var(--shadow-medium);
      transition: all var(--transition-normal);
      backdrop-filter: blur(10px);
    }

    .control-btn:hover {
      transform: translateY(-3px) scale(1.05);
      background: var(--primary-color);
      color: white;
      box-shadow: 0 8px 20px var(--shadow-dark);
    }

    .control-btn:active {
      transform: translateY(0) scale(0.95);
    }

    /* الحاوي الرئيسي */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-xl) var(--spacing-lg);
      position: relative;
      z-index: 10;
    }

    /* رأس الصفحة */
    .header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      animation: slideDown 0.8s ease-out;
    }

    .header-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      box-shadow: 0 8px 32px var(--shadow-medium);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .header-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
    }

    .header-title {
      font-size: clamp(2rem, 5vw, 2.5rem);
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
      color: var(--primary-color);
      text-shadow: 2px 2px 4px var(--shadow-light);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .header-subtitle {
      font-size: clamp(1rem, 3vw, 1.2rem);
      color: var(--text-secondary);
      font-weight: 400;
      line-height: 1.5;
    }

    /* إعدادات المؤقت */
    .timer-settings {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(232, 245, 233, 0.95) 50%,
        rgba(255, 255, 255, 0.98) 100%);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 
        0 8px 32px rgba(0, 121, 107, 0.12),
        0 2px 8px rgba(0, 0, 0, 0.08);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(0, 121, 107, 0.1);
      animation: slideUp 0.8s ease-out 0.2s both;
    }

    .timer-settings h3 {
      font-size: 1.4rem;
      color: var(--primary-color);
      margin-bottom: var(--spacing-lg);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-weight: 600;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .setting-group {
      background: rgba(255, 255, 255, 0.8);
      border-radius: var(--border-radius-small);
      padding: var(--spacing-lg);
      border: 1px solid rgba(0, 121, 107, 0.1);
      transition: all var(--transition-normal);
    }

    .setting-group:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 121, 107, 0.15);
      border-color: var(--primary-light);
    }

    .setting-label {
      display: block;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .timer-select {
      width: 100%;
      padding: var(--spacing-md);
      border: 2px solid rgba(0, 121, 107, 0.2);
      border-radius: var(--border-radius-small);
      background: white;
      color: var(--text-primary);
      font-size: 1rem;
      font-family: 'Cairo', sans-serif;
      cursor: pointer;
      transition: all var(--transition-normal);
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: left 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-left: 2.5rem;
    }

    .timer-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 121, 107, 0.1);
    }

    .timer-select:hover {
      border-color: var(--primary-light);
    }

    /* أزرار الأوقات المحددة مسبقاً */
    .preset-times {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }

    .preset-btn {
      background: linear-gradient(135deg, var(--secondary-color), #FF7043);
      color: white;
      border: none;
      padding: var(--spacing-md);
      border-radius: var(--border-radius-small);
      font-family: 'Cairo', sans-serif;
      font-size: var(--font-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
      box-shadow: 0 2px 8px rgba(255, 87, 34, 0.3);
      position: relative;
      overflow: hidden;
    }

    .preset-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .preset-btn:hover::before {
      left: 100%;
    }

    .preset-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 6px 16px rgba(255, 87, 34, 0.4);
      background: linear-gradient(135deg, #FF7043, var(--secondary-color));
    }

    .preset-btn:active {
      transform: translateY(0) scale(0.95);
    }

    /* عرض المؤقت */
    .timer-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-2xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 0 8px 32px var(--shadow-medium);
      backdrop-filter: blur(15px);
      animation: slideUp 0.8s ease-out 0.4s both;
      position: relative;
      overflow: hidden;
    }

    .timer-display::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, 
        transparent 30%, 
        rgba(0, 121, 107, 0.1) 50%, 
        transparent 70%);
      animation: shimmer 4s infinite;
      pointer-events: none;
    }

    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* دائرة المؤقت */
    .timer-circle-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin-bottom: var(--spacing-lg);
    }

    .timer-circle {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .timer-circle circle {
      fill: none;
      stroke-width: 12;
      stroke-linecap: round;
    }

    .timer-bg-circle {
      stroke: rgba(0, 121, 107, 0.2);
    }

    .timer-progress-circle {
      stroke: var(--primary-color);
      stroke-dasharray: 942; /* 2π × 150 */
      stroke-dashoffset: 942;
      transition: all var(--transition-normal);
      filter: drop-shadow(0 0 10px rgba(0, 121, 107, 0.5));
    }

    .timer-progress-circle.warning {
      stroke: var(--warning-color);
      animation: warningPulse 1s ease-in-out infinite;
    }

    .timer-progress-circle.danger {
      stroke: var(--error-color);
      animation: dangerPulse 0.5s ease-in-out infinite;
    }

    @keyframes warningPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 10px rgba(255, 152, 0, 0.5));
        stroke-width: 12;
      }
      50% { 
        filter: drop-shadow(0 0 20px rgba(255, 152, 0, 0.8));
        stroke-width: 14;
      }
    }

    @keyframes dangerPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 15px rgba(244, 67, 54, 0.7));
        stroke-width: 12;
      }
      50% { 
        filter: drop-shadow(0 0 25px rgba(244, 67, 54, 1));
        stroke-width: 16;
      }
    }

    /* نص المؤقت */
    .timer-time {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: clamp(2.5rem, 8vw, 4rem);
      font-weight: 700;
      color: var(--primary-color);
      text-shadow: 2px 2px 8px rgba(0, 121, 107, 0.3);
      font-variant-numeric: tabular-nums;
      z-index: 10;
      transition: all var(--transition-normal);
    }

    .timer-time.warning {
      color: var(--warning-color);
      animation: timeWarning 1s ease-in-out infinite;
    }

    .timer-time.danger {
      color: var(--error-color);
      animation: timeDanger 0.5s ease-in-out infinite;
      text-shadow: 
        2px 2px 8px rgba(244, 67, 54, 0.5),
        0 0 20px rgba(244, 67, 54, 0.7);
    }

    @keyframes timeWarning {
      0%, 100% { 
        transform: translate(-50%, -50%) scale(1);
        text-shadow: 2px 2px 8px rgba(255, 152, 0, 0.3);
      }
      50% { 
        transform: translate(-50%, -50%) scale(1.05);
        text-shadow: 2px 2px 12px rgba(255, 152, 0, 0.6);
      }
    }

    @keyframes timeDanger {
      0%, 100% { 
        transform: translate(-50%, -50%) scale(1);
        text-shadow: 
          2px 2px 8px rgba(244, 67, 54, 0.5),
          0 0 20px rgba(244, 67, 54, 0.7);
      }
      50% { 
        transform: translate(-50%, -50%) scale(1.1);
        text-shadow: 
          2px 2px 12px rgba(244, 67, 54, 0.8),
          0 0 30px rgba(244, 67, 54, 1);
      }
    }

    /* مؤشر الحالة */
    .status-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md) var(--spacing-lg);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 249, 250, 0.9));
      border: 2px solid rgba(0, 121, 107, 0.2);
      border-radius: var(--border-radius-small);
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      transition: all var(--transition-normal);
      margin-bottom: var(--spacing-lg);
      backdrop-filter: blur(10px);
    }

    .status-indicator.idle {
      border-color: var(--text-secondary);
      color: var(--text-secondary);
    }

    .status-indicator.running {
      border-color: var(--success-color);
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
      color: var(--success-color);
      animation: runningGlow 2s ease-in-out infinite;
    }

    .status-indicator.paused {
      border-color: var(--warning-color);
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 152, 0, 0.05));
      color: var(--warning-color);
    }

    .status-indicator.finished {
      border-color: var(--accent-color);
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
      color: #B8860B;
      animation: finishedCelebration 1s ease-in-out infinite;
    }

    @keyframes runningGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(76, 175, 80, 0.3); }
      50% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.5); }
    }

    @keyframes finishedCelebration {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      }
      50% { 
        transform: scale(1.02);
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
      }
    }

    /* أزرار التحكم في المؤقت */
    .timer-controls {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      justify-content: center;
      margin-bottom: var(--spacing-xl);
      animation: slideUp 0.8s ease-out 0.6s both;
    }

    .timer-btn {
      padding: var(--spacing-md) var(--spacing-xl);
      font-size: clamp(1rem, 3vw, 1.2rem);
      font-weight: 600;
      border: none;
      border-radius: var(--border-radius-small);
      cursor: pointer;
      transition: all var(--transition-normal);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      min-width: 140px;
      justify-content: center;
      box-shadow: 0 4px 12px var(--shadow-light);
      font-family: 'Cairo', sans-serif;
      position: relative;
      overflow: hidden;
    }

    .timer-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .timer-btn:hover::before {
      left: 100%;
    }

    .timer-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .timer-btn:disabled::before {
      display: none;
    }

    .start-btn {
      background: linear-gradient(45deg, var(--success-color), #66BB6A);
      color: white;
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
    }

    .pause-btn {
      background: linear-gradient(45deg, var(--warning-color), #FFB74D);
      color: white;
    }

    .pause-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
    }

    .resume-btn {
      background: linear-gradient(45deg, var(--info-color), #42A5F5);
      color: white;
    }

    .sound-settings-btn {
      background: linear-gradient(45deg, #8E24AA, #BA68C8);
      color: white;
      position: relative;
      overflow: hidden;
    }

    .sound-settings-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(142, 36, 170, 0.4);
    }

    .sound-settings-btn.active {
      background: linear-gradient(45deg, #5E35B1, #7E57C2);
      transform: scale(0.95);
      box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-md);
      border-bottom: 2px solid var(--primary-color);
    }

    .close-sound-settings-btn {
      background: transparent;
      border: none;
      color: var(--text-light);
      font-size: 1.2rem;
      cursor: pointer;
      padding: var(--spacing-sm);
      border-radius: 50%;
      transition: all var(--transition-normal);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-sound-settings-btn:hover {
      background: rgba(231, 76, 60, 0.1);
      color: var(--danger-color);
      transform: scale(1.1);
    }

    /* تحسينات الرسوم المتحركة للوحة الإعدادات */
    #soundSettingsPanel {
      transform-origin: top center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(142, 36, 170, 0.2);
    }

    .sound-settings-btn span:first-child {
      transition: transform var(--transition-normal);
    }

    .sound-settings-btn.active span:first-child {
      transform: scale(1.2);
    }

    .resume-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(33, 150, 243, 0.4);
    }

    .reset-btn {
      background: linear-gradient(45deg, var(--text-secondary), #9E9E9E);
      color: white;
    }

    .reset-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(158, 158, 158, 0.4);
    }

    .stop-btn {
      background: linear-gradient(45deg, var(--error-color), #EF5350);
      color: white;
    }

    .stop-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(244, 67, 54, 0.4);
    }
    .stop-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(244, 67, 54, 0.4);
    }

    /* إعدادات متقدمة */
    .advanced-settings {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(240, 248, 255, 0.95) 50%,
        rgba(255, 255, 255, 0.98) 100%);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 
        0 8px 32px rgba(33, 150, 243, 0.12),
        0 2px 8px rgba(0, 0, 0, 0.08);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(33, 150, 243, 0.1);
      animation: slideUp 0.8s ease-out 0.8s both;
    }

    .advanced-settings h3 {
      font-size: 1.3rem;
      color: var(--info-color);
      margin-bottom: var(--spacing-lg);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-weight: 600;
    }

    .sound-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
    }

    .sound-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-sm) var(--spacing-md);
      background: rgba(255, 255, 255, 0.8);
      border-radius: var(--border-radius-small);
      border: 1px solid rgba(33, 150, 243, 0.1);
      transition: all var(--transition-normal);
    }

    .sound-control:hover {
      background: rgba(33, 150, 243, 0.05);
      border-color: rgba(33, 150, 243, 0.2);
      transform: translateY(-1px);
    }

    .sound-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      cursor: pointer;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      border-radius: 24px;
      transition: all var(--transition-normal);
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: all var(--transition-normal);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch input:checked + .toggle-slider {
      background: linear-gradient(45deg, var(--info-color), #42A5F5);
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(20px);
      box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
    }

    .toggle-switch:hover .toggle-slider {
      box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
    }

    /* شريط مستوى الصوت */
    .volume-control {
      margin-top: var(--spacing-md);
      grid-column: 1 / -1;
    }

    .volume-slider {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      background: linear-gradient(to right, #ccc, var(--info-color));
      border-radius: var(--border-radius-small);
      outline: none;
      transition: all var(--transition-normal);
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--info-color);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px var(--shadow-medium);
      transition: all var(--transition-fast);
    }

    .volume-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 4px 12px var(--shadow-dark);
    }

    .volume-value {
      text-align: center;
      margin-top: var(--spacing-sm);
      font-weight: 600;
      color: var(--info-color);
      font-size: 0.9rem;
    }

    /* إحصائيات المؤقت */
    .timer-stats {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(248, 250, 252, 0.95) 50%,
        rgba(255, 255, 255, 0.98) 100%);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 
        0 8px 32px rgba(158, 158, 158, 0.12),
        0 2px 8px rgba(0, 0, 0, 0.08);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(158, 158, 158, 0.1);
      animation: slideUp 0.8s ease-out 1s both;
    }

    .timer-stats h3 {
      font-size: 1.3rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-lg);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      font-weight: 600;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-md);
    }

    .stat-item {
      background: linear-gradient(135deg, rgba(158, 158, 158, 0.1), rgba(189, 189, 189, 0.1));
      padding: var(--spacing-lg);
      border-radius: var(--border-radius-small);
      border: 2px solid rgba(158, 158, 158, 0.2);
      text-align: center;
      transition: all var(--transition-normal);
    }

    .stat-item:hover {
      transform: translateY(-2px);
      border-color: var(--text-secondary);
      box-shadow: 0 4px 12px rgba(158, 158, 158, 0.2);
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xs);
      font-variant-numeric: tabular-nums;
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
      opacity: 0.8;
    }

    /* نافذة الإكمال */
    .completion-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-normal);
      backdrop-filter: blur(5px);
    }

    .completion-modal.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: linear-gradient(135deg, white, #f8f9fa);
      border-radius: var(--border-radius);
      padding: var(--spacing-2xl);
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: scale(0.8);
      transition: all var(--transition-normal);
      max-width: 400px;
      margin: var(--spacing-lg);
      position: relative;
      overflow: hidden;
    }

    .completion-modal.show .modal-content {
      transform: scale(1);
    }

    .modal-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--success-color), var(--accent-color), var(--primary-color));
    }

    .modal-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--success-color);
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .modal-message {
      font-size: 1.2rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xl);
      line-height: 1.5;
    }

    .modal-buttons {
      display: flex;
      gap: var(--spacing-md);
      justify-content: center;
      flex-wrap: wrap;
    }

    .modal-btn {
      padding: var(--spacing-md) var(--spacing-xl);
      border: none;
      border-radius: var(--border-radius-small);
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
      min-width: 100px;
    }

    .modal-btn.primary {
      background: linear-gradient(45deg, var(--success-color), #66BB6A);
      color: white;
    }

    .modal-btn.secondary {
      background: linear-gradient(45deg, var(--text-secondary), #9E9E9E);
      color: white;
    }

    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow-medium);
    }

    /* تأثيرات الحركة */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* التجاوب مع الشاشات المختلفة */
    @media (max-width: 768px) {
      .main-container {
        padding: var(--spacing-lg) var(--spacing-md);
      }
      
      .timer-circle-container {
        width: 250px;
        height: 250px;
      }
      
      .timer-time {
        font-size: clamp(2rem, 6vw, 3rem);
      }
      
      .timer-controls {
        flex-direction: column;
        align-items: center;
      }
      
      .timer-btn {
        width: 100%;
        max-width: 280px;
      }
      
      .settings-grid {
        grid-template-columns: 1fr;
      }
      
      .preset-times {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .sound-controls {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .control-btn {
        width: 45px;
        height: 45px;
        font-size: 18px;
      }
    }

    @media (max-width: 480px) {
      .header-card {
        padding: var(--spacing-lg);
      }
      
      .timer-circle-container {
        width: 220px;
        height: 220px;
      }
      
      .timer-time {
        font-size: clamp(1.8rem, 5vw, 2.5rem);
      }
      
      .preset-times {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .modal-content {
        padding: var(--spacing-lg);
        margin: var(--spacing-md);
      }
      
      .modal-title {
        font-size: 1.6rem;
      }
      
      .modal-message {
        font-size: 1rem;
      }
      
      .modal-buttons {
        flex-direction: column;
      }
      
      .modal-btn {
        width: 100%;
      }
    }

    /* تحسينات إضافية للأداء */
    .timer-btn,
    .control-btn,
    .preset-btn {
      will-change: transform;
    }

    /* تأثيرات التركيز للوصولية */
    .timer-btn:focus,
    .control-btn:focus,
    .timer-select:focus,
    .preset-btn:focus,
    .volume-slider:focus {
      outline: 3px solid rgba(0, 121, 107, 0.5);
      outline-offset: 2px;
    }

    /* تأثير النقر */
    .click-effect {
      position: relative;
      overflow: hidden;
    }

    .click-effect::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(0, 121, 107, 0.3);
      transform: translate(-50%, -50%);
      animation: ripple 0.6s ease-out;
    }

    @keyframes ripple {
      to {
        width: 300px;
        height: 300px;
        opacity: 0;
      }
    }

    /* حالات خاصة */
    .celebrating {
      animation: celebrate 1s ease-out;
    }

    @keyframes celebrate {
      0% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.05) rotate(-2deg); }
      50% { transform: scale(1.1) rotate(2deg); }
      75% { transform: scale(1.05) rotate(-1deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    /* تأثيرات الصوت البصرية */
    .sound-wave {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100px;
      height: 100px;
      border: 2px solid var(--primary-color);
      border-radius: 50%;
      opacity: 0;
      animation: soundWave 1s ease-out;
    }

    @keyframes soundWave {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(3);
        opacity: 0;
      }
    }

    /* تحسينات الاستجابة المتقدمة للمؤقت الصفي */
    
    /* شاشات كبيرة جداً (1200px+) */
    @media (min-width: 1200px) {
      .main-container {
        max-width: 1100px;
        padding: var(--spacing-3xl);
      }

      .timer-circle-container {
        width: 350px;
        height: 350px;
      }

      .timer-time {
        font-size: 3.5rem;
      }

      .timer-controls {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-xl);
      }

      .timer-btn {
        padding: var(--spacing-lg) var(--spacing-xl);
        font-size: var(--font-size-lg);
      }

      .preset-times {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-lg);
      }

      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-xl);
      }
    }

    /* شاشات كبيرة (1024px - 1199px) */
    @media (max-width: 1199px) and (min-width: 1024px) {
      .main-container {
        max-width: 900px;
        padding: var(--spacing-2xl);
      }

      .timer-circle-container {
        width: 300px;
        height: 300px;
      }

      .timer-time {
        font-size: 2.8rem;
      }

      .timer-controls {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-lg);
      }

      .timer-btn {
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-base);
      }

      .preset-times {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-md);
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-lg);
      }
    }

    /* تابلت (768px - 1023px) */
    @media (max-width: 1023px) and (min-width: 768px) {
      .main-container {
        max-width: 700px;
        padding: var(--spacing-xl);
        margin: 0 auto;
      }

      .timer-circle-container {
        width: 250px;
        height: 250px;
      }

      .timer-time {
        font-size: 2.2rem;
      }

      .timer-controls {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-lg);
      }

      .timer-btn {
        padding: var(--spacing-md);
        font-size: var(--font-size-sm);
      }

      .timer-btn span:last-child {
        font-size: var(--font-size-xs);
      }

      .preset-times {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-md);
      }

      .preset-btn {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-size-sm);
      }

      .settings-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-md);
      }

      .header-title {
        font-size: var(--font-size-xl);
      }

      .header-subtitle {
        font-size: var(--font-size-base);
      }
    }

    /* موبايل كبير (480px - 767px) */
    @media (max-width: 767px) and (min-width: 480px) {
      .main-container {
        max-width: 100%;
        margin: 0 var(--spacing-md);
        padding: var(--spacing-lg);
      }

      .timer-circle-container {
        width: 200px;
        height: 200px;
      }

      .timer-time {
        font-size: 1.8rem;
      }

      .timer-controls {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .timer-btn {
        width: 100%;
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-base);
        justify-content: center;
      }

      .timer-btn span:first-child {
        font-size: var(--font-size-xl);
      }

      .preset-times {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-sm);
      }

      .preset-btn {
        padding: var(--spacing-sm);
        font-size: var(--font-size-sm);
      }

      .settings-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }

      .setting-group {
        padding: var(--spacing-md);
      }

      .sound-controls {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-sm);
      }

      .stat-item {
        padding: var(--spacing-md);
      }

      .header-title {
        font-size: var(--font-size-lg);
      }

      .header-title span:first-child {
        font-size: var(--font-size-2xl);
      }

      .header-subtitle {
        font-size: var(--font-size-sm);
        line-height: 1.4;
      }

      .status-indicator {
        font-size: var(--font-size-sm);
      }
    }

    /* موبايل صغير (320px - 479px) */
    @media (max-width: 479px) {
      .main-container {
        margin: 0 var(--spacing-sm);
        padding: var(--spacing-md);
      }

      .timer-circle-container {
        width: 180px;
        height: 180px;
      }

      .timer-time {
        font-size: 1.5rem;
      }

      .timer-controls {
        gap: var(--spacing-sm);
      }

      .timer-btn {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-size-sm);
        min-height: 50px;
      }

      .timer-btn span:first-child {
        font-size: var(--font-size-lg);
      }

      .timer-btn span:last-child {
        font-size: var(--font-size-xs);
      }

      .preset-times {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-xs);
      }

      .preset-btn {
        padding: var(--spacing-xs) var(--spacing-sm);
        font-size: var(--font-size-xs);
      }

      .timer-settings,
      .timer-display,
      .advanced-settings,
      .timer-stats {
        padding: var(--spacing-sm);
      }

      .header-card {
        padding: var(--spacing-md);
      }

      .header-title {
        font-size: var(--font-size-base);
      }

      .header-title span:first-child {
        font-size: var(--font-size-xl);
      }

      .header-subtitle {
        font-size: var(--font-size-xs);
        line-height: 1.3;
      }

      .setting-group {
        padding: var(--spacing-sm);
      }

      .setting-label {
        font-size: var(--font-size-xs);
      }

      .timer-select {
        font-size: var(--font-size-xs);
        padding: var(--spacing-xs) var(--spacing-sm);
      }

      .sound-control {
        padding: var(--spacing-xs);
      }

      .sound-label {
        font-size: var(--font-size-xs);
      }

      .volume-value {
        font-size: var(--font-size-xs);
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-xs);
      }

      .stat-item {
        padding: var(--spacing-sm);
      }

      .stat-number {
        font-size: var(--font-size-lg);
      }

      .stat-label {
        font-size: var(--font-size-xs);
      }

      .status-indicator {
        font-size: var(--font-size-xs);
        padding: var(--spacing-sm);
      }

      .control-buttons {
        top: var(--spacing-xs);
      }

      .control-btn {
        width: 35px;
        height: 35px;
        font-size: var(--font-size-sm);
      }
    }

    /* تحسينات خاصة للأجهزة اللمسية */
    @media (hover: none) and (pointer: coarse) {
      .timer-btn {
        min-height: 60px;
        border-width: 3px;
      }

      .timer-btn:hover {
        transform: none;
      }

      .timer-btn:active {
        transform: scale(0.98);
      }

      .preset-btn {
        min-height: 48px;
        border-width: 2px;
      }

      .control-btn {
        min-width: 44px;
        min-height: 44px;
      }

      .timer-select {
        min-height: 48px;
        border-width: 2px;
      }

      .volume-slider {
        height: 8px;
      }

      .volume-slider::-webkit-slider-thumb {
        width: 24px;
        height: 24px;
      }

      .volume-slider::-moz-range-thumb {
        width: 24px;
        height: 24px;
      }

      .toggle-switch {
        min-width: 50px;
        min-height: 28px;
      }
    }

    /* تحسينات للوضع الأفقي في الموبايل */
    @media screen and (max-height: 500px) and (orientation: landscape) {
      .header-card {
        padding: var(--spacing-sm);
      }

      .header-title {
        font-size: var(--font-size-base);
        margin-bottom: var(--spacing-xs);
      }

      .header-subtitle {
        font-size: var(--font-size-sm);
      }

      .main-container {
        padding: var(--spacing-md);
      }

      .timer-circle-container {
        width: 150px;
        height: 150px;
      }

      .timer-time {
        font-size: 1.2rem;
      }

      .timer-controls {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-xs);
      }

      .timer-btn {
        padding: var(--spacing-xs) var(--spacing-sm);
        font-size: var(--font-size-xs);
        min-height: 40px;
      }

      .timer-btn span:first-child {
        font-size: var(--font-size-lg);
      }

      .preset-times {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-xs);
      }

      .preset-btn {
        padding: var(--spacing-xs);
        font-size: var(--font-size-xs);
      }

      .timer-settings,
      .advanced-settings,
      .timer-stats {
        padding: var(--spacing-sm);
      }

      .settings-grid,
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-xs);
      }

      .setting-group,
      .stat-item {
        padding: var(--spacing-xs);
      }

      .status-indicator {
        padding: var(--spacing-xs);
      }
    }

    /* تحسينات الشاشات عالية الكثافة */
    @media (-webkit-min-device-pixel-ratio: 2),
           (min-resolution: 192dpi) {
      .timer-btn {
        border-width: 1.5px;
      }

      .preset-btn {
        border-width: 1.5px;
      }

      .control-btn {
        border-width: 1.5px;
      }

      .timer-select {
        border-width: 1.5px;
      }

      .timer-circle-container::before {
        border-width: 3px;
      }
    }

    /* RTL layout optimizations for responsive design */
    [dir="rtl"] .timer-controls {
      direction: rtl;
    }

    [dir="rtl"] .preset-times {
      direction: rtl;
    }

    [dir="rtl"] .settings-grid {
      direction: rtl;
    }

    [dir="rtl"] .stats-grid {
      direction: rtl;
    }

    @media (max-width: 767px) {
      [dir="rtl"] .timer-controls {
        direction: ltr;
      }

      [dir="rtl"] .preset-times {
        direction: ltr;
      }
    }
  </style>
</head>

<body class="responsive-body touch-device">
  <!-- أزرار التحكم -->
  <div class="control-buttons right mobile-optimized">
    <button class="control-btn touch-target" id="backBtn" title="العودة للقائمة الرئيسية" aria-label="العودة للقائمة الرئيسية">
      🏠
    </button>
  </div>

  <div class="control-buttons left mobile-optimized">
    <button class="control-btn touch-target" id="fullscreenBtn" title="ملء الشاشة" aria-label="ملء الشاشة">
      ⛶
    </button>
    <button class="control-btn touch-target" id="soundToggleBtn" title="تشغيل/إيقاف الصوت" aria-label="تشغيل/إيقاف الصوت">
      🔊
    </button>
  </div>

  <!-- المحتوى الرئيسي -->
  <div class="main-container responsive-container">
    <!-- رأس الصفحة -->
    <header class="header mobile-header">
      <div class="header-card mobile-card">
        <h1 class="header-title mobile-heading">
          <span>⏱️</span>
          <span>المؤقت الصفي التفاعلي</span>
        </h1>
        <p class="header-subtitle mobile-subtitle">
          أداة احترافية لإدارة الوقت في الأنشطة الصفية مع تحكم كامل وتأثيرات بصرية
        </p>
      </div>
    </header>

    <!-- إعدادات المؤقت -->
    <div class="timer-settings mobile-card">
      <h3 class="mobile-heading">
        <span>⚙️</span>
        <span>إعدادات المؤقت</span>
      </h3>
      
      <div class="settings-grid mobile-grid">
        <div class="setting-group mobile-input">
          <label class="setting-label mobile-label">
            <span>🔄</span>
            <span>نوع المؤقت</span>
          </label>
          <select class="timer-select touch-target" id="timerMode">
            <option value="countdown">⏱️ تنازلي (العد التنازلي)</option>
            <option value="countup">⏲️ تصاعدي (إيقاف عند حد معين)</option>
            <option value="stopwatch">⏱️ ساعة إيقاف (مؤقت مفتوح)</option>
          </select>
        </div>
        
        <div class="setting-group mobile-input">
          <label class="setting-label mobile-label">
            <span>⏰</span>
            <span>مدة المؤقت</span>
          </label>
          <select class="timer-select touch-target" id="timerDuration">
            <option value="30">30 ثانية</option>
            <option value="60">1 دقيقة</option>
            <option value="120">2 دقيقة</option>
            <option value="180">3 دقائق</option>
            <option value="300" selected>5 دقائق</option>
            <option value="600">10 دقائق</option>
            <option value="900">15 دقيقة</option>
            <option value="1200">20 دقيقة</option>
            <option value="1800">30 دقيقة</option>
            <option value="2700">45 دقيقة</option>
            <option value="3600">60 دقيقة</option>
          </select>
        </div>
      </div>

      <!-- أزرار الأوقات المحددة مسبقاً -->
      <div class="preset-times mobile-buttons">
        <button class="preset-btn touch-target mobile-btn" data-time="30">30 ثانية</button>
        <button class="preset-btn touch-target mobile-btn" data-time="60">1 دقيقة</button>
        <button class="preset-btn touch-target mobile-btn" data-time="120">2 دقيقة</button>
        <button class="preset-btn touch-target mobile-btn" data-time="180">3 دقائق</button>
        <button class="preset-btn touch-target mobile-btn" data-time="300">5 دقائق</button>
        <button class="preset-btn touch-target mobile-btn" data-time="600">10 دقائق</button>
        <button class="preset-btn touch-target mobile-btn" data-time="1200">20 دقيقة</button>
        <button class="preset-btn touch-target mobile-btn" data-time="2700">45 دقيقة</button>
      </div>
    </div>

    <!-- عرض المؤقت -->
    <div class="timer-display mobile-card">
      <div class="timer-circle-container mobile-timer">
        <svg class="timer-circle" viewBox="0 0 320 320">
          <circle class="timer-bg-circle" cx="160" cy="160" r="150"/>
          <circle class="timer-progress-circle" id="progressCircle" cx="160" cy="160" r="150"/>
        </svg>
        <div class="timer-time mobile-time" id="timerTime">00:00</div>
      </div>
      
      <!-- مؤشر الحالة -->
      <div class="status-indicator idle mobile-status" id="statusIndicator">
        <span id="statusIcon">⏸️</span>
        <span id="statusText" class="mobile-text">جاهز للبدء</span>
      </div>
    </div>

    <!-- أزرار التحكم في المؤقت -->
    <div class="timer-controls mobile-buttons">
      <button class="timer-btn start-btn touch-target mobile-btn" id="startBtn">
        <span>▶️</span>
        <span>ابدأ المؤقت</span>
      </button>
      <button class="timer-btn pause-btn touch-target mobile-btn" id="pauseBtn" disabled>
        <span>⏸️</span>
        <span>إيقاف مؤقت</span>
      </button>
      <button class="timer-btn reset-btn touch-target mobile-btn" id="resetBtn">
        <span>🔄</span>
        <span>إعادة تعيين</span>
      </button>
      <button class="timer-btn sound-settings-btn touch-target mobile-btn" id="soundSettingsBtn">
        <span>🔊</span>
        <span>إعدادات الصوت</span>
      </button>
      <button class="timer-btn stop-btn touch-target mobile-btn" id="stopBtn" disabled>
        <span>⏹️</span>
        <span>إيقاف نهائي</span>
      </button>
    </div>

    <!-- الإعدادات المتقدمة -->
    <div class="advanced-settings mobile-card" id="soundSettingsPanel" style="display: none;">
      <div class="settings-header">
        <h3 class="mobile-heading">
          <span>🎵</span>
          <span>إعدادات الصوت</span>
        </h3>
        <button class="close-sound-settings-btn touch-target" id="closeSoundSettingsBtn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="sound-controls mobile-toggles">
        <div class="sound-control mobile-toggle">
          <span class="sound-label mobile-label">
            <span>🔔</span>
            <span>صوت البداية</span>
          </span>
          <label class="toggle-switch touch-target">
            <input type="checkbox" id="startSoundToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="sound-control mobile-toggle">
          <span class="sound-label mobile-label">
            <span>⏰</span>
            <span>صوت النهاية</span>
          </span>
          <label class="toggle-switch touch-target">
            <input type="checkbox" id="endSoundToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="sound-control mobile-toggle">
          <span class="sound-label mobile-label">
            <span>⚠️</span>
            <span>صوت التحذير</span>
          </span>
          <label class="toggle-switch touch-target">
            <input type="checkbox" id="warningSoundToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="sound-control mobile-toggle">
          <span class="sound-label mobile-label">
            <span>🖱️</span>
            <span>صوت النقر</span>
          </span>
          <label class="toggle-switch touch-target">
            <input type="checkbox" id="clickSoundToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="volume-control mobile-input">
          <label class="sound-label mobile-label">
            <span>🔊</span>
            <span>مستوى الصوت</span>
          </label>
          <input type="range" class="volume-slider touch-target" id="volumeSlider" min="0" max="100" value="70">
          <div class="volume-value mobile-text" id="volumeValue">70%</div>
        </div>
      </div>
    </div>

    <!-- إحصائيات المؤقت -->
    <div class="timer-stats mobile-card">
      <h3 class="mobile-heading">
        <span>📊</span>
        <span>إحصائيات الجلسة</span>
      </h3>
      
      <div class="stats-grid mobile-grid">
        <div class="stat-item mobile-stat">
          <div class="stat-number mobile-number" id="totalSessions">0</div>
          <div class="stat-label mobile-text">عدد الجلسات</div>
        </div>
        <div class="stat-item mobile-stat">
          <div class="stat-number mobile-number" id="totalTime">00:00</div>
          <div class="stat-label mobile-text">إجمالي الوقت</div>
        </div>
        <div class="stat-item mobile-stat">
          <div class="stat-number mobile-number" id="averageTime">00:00</div>
          <div class="stat-label mobile-text">متوسط الوقت</div>
        </div>
        <div class="stat-item mobile-stat">
          <div class="stat-number mobile-number" id="completedSessions">0</div>
          <div class="stat-label mobile-text">مكتملة</div>
        </div>
      </div>
    </div>
  </div>

  <!-- نافذة الإكمال -->
  <div class="completion-modal" id="completionModal">
    <div class="modal-content">
      <h2 class="modal-title">
        <span>🎉</span>
        <span>انتهى الوقت!</span>
      </h2>
      <p class="modal-message" id="modalMessage">
        تم إكمال المؤقت بنجاح! هل تريد بدء جلسة جديدة؟
      </p>
      <div class="modal-buttons">
        <button class="modal-btn primary" id="newSessionBtn">
          <span>🔄 جلسة جديدة</span>
        </button>
        <button class="modal-btn secondary" id="closeModalBtn">
          <span>✅ إغلاق</span>
        </button>
      </div>
    </div>
  </div>

  <!-- عناصر الصوت -->
  <audio id="startSound" src="../assets/media/sounds/start-timer.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="endSound" src="../assets/media/sounds/end-timer.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="warningSound" src="../assets/media/sounds/countdown-beep.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="clickSound" src="../assets/media/sounds/Click.mp3" preload="auto" aria-hidden="true"></audio>

  <script>
    console.log('⏱️ بدء تحميل المؤقت الصفي التفاعلي...');

    // متغيرات المؤقت
    let timerInterval = null;
    let warningInterval = null;
    let currentMode = 'countdown';
    let duration = 300; // 5 دقائق افتراضية
    let timeLeft = 300;
    let elapsed = 0;
    let isRunning = false;
    let isPaused = false;
    let isFinished = false;
    let finalSoundStarted = false; // متابعة بدء صوت التحذير النهائي (10 ثوان)

    // إعدادات الصوت
    let audioSettings = {
      volume: 0.7,
      startSound: true,
      endSound: true,
      warningSound: true,
      clickSound: true,
      masterMute: false
    };

    // إحصائيات الجلسة
    let sessionStats = {
      totalSessions: 0,
      completedSessions: 0,
      totalTime: 0,
      sessions: []
    };

    // عناصر DOM
    const elements = {
      // التحكم الرئيسي
      timerMode: document.getElementById('timerMode'),
      timerDuration: document.getElementById('timerDuration'),
      timerTime: document.getElementById('timerTime'),
      progressCircle: document.getElementById('progressCircle'),
      statusIndicator: document.getElementById('statusIndicator'),
      statusIcon: document.getElementById('statusIcon'),
      statusText: document.getElementById('statusText'),
      
      // الأزرار
      startBtn: document.getElementById('startBtn'),
      pauseBtn: document.getElementById('pauseBtn'),
      resetBtn: document.getElementById('resetBtn'),
      stopBtn: document.getElementById('stopBtn'),
      backBtn: document.getElementById('backBtn'),
      fullscreenBtn: document.getElementById('fullscreenBtn'),
      soundToggleBtn: document.getElementById('soundToggleBtn'),
      
      // الإعدادات
      startSoundToggle: document.getElementById('startSoundToggle'),
      endSoundToggle: document.getElementById('endSoundToggle'),
      warningSoundToggle: document.getElementById('warningSoundToggle'),
      clickSoundToggle: document.getElementById('clickSoundToggle'),
      volumeSlider: document.getElementById('volumeSlider'),
      volumeValue: document.getElementById('volumeValue'),
      
      // الإحصائيات
      totalSessions: document.getElementById('totalSessions'),
      totalTime: document.getElementById('totalTime'),
      averageTime: document.getElementById('averageTime'),
      completedSessions: document.getElementById('completedSessions'),
      
      // النافذة المنبثقة
      completionModal: document.getElementById('completionModal'),
      modalMessage: document.getElementById('modalMessage'),
      newSessionBtn: document.getElementById('newSessionBtn'),
      closeModalBtn: document.getElementById('closeModalBtn'),
      
      // الأصوات
      startSound: document.getElementById('startSound'),
      endSound: document.getElementById('endSound'),
      warningSound: document.getElementById('warningSound'),
      clickSound: document.getElementById('clickSound')
    };

    // تشغيل الصوت مع معالجة الأخطاء والإعدادات
    function playSound(soundElement, soundType = 'general') {
      try {
        if (audioSettings.masterMute) return;

        const soundEnabled = {
          'start': audioSettings.startSound,
          'end': audioSettings.endSound,
          'warning': audioSettings.warningSound,
          'click': audioSettings.clickSound,
          'general': true
        };

        if (!soundEnabled[soundType]) return;

        if (soundElement && soundElement.readyState >= 2) {
          soundElement.currentTime = 0;
          soundElement.volume = audioSettings.volume;
          const playPromise = soundElement.play();
          if (playPromise !== undefined) {
            playPromise.catch(() => {
              console.log('🔇 تعذر تشغيل الصوت (يتطلب تفاعل المستخدم)');
            });
          }
        }
      } catch (error) {
        console.log('🔇 خطأ في تشغيل الصوت:', error);
      }
    }

    // تأثيرات بصرية للنقر
    function addClickEffect(element) {
      element.style.transform = 'scale(0.95)';
      setTimeout(() => {
        element.style.transform = '';
      }, 150);
    }

    // دوال إدارة إعدادات الصوت
    function toggleSoundSettings() {
      const panel = elements.soundSettingsPanel;
      const btn = elements.soundSettingsBtn;
      
      if (panel.style.display === 'none' || !panel.style.display) {
        showSoundSettings();
      } else {
        hideSoundSettings();
      }
    }

    function showSoundSettings() {
      const panel = elements.soundSettingsPanel;
      const btn = elements.soundSettingsBtn;
      
      // إظهار اللوحة
      panel.style.display = 'block';
      panel.style.opacity = '0';
      panel.style.transform = 'translateY(-20px)';
      
      // تفعيل حالة الزر
      btn.classList.add('active');
      
      // رسوم متحركة للظهور
      setTimeout(() => {
        panel.style.transition = 'all 0.3s ease-out';
        panel.style.opacity = '1';
        panel.style.transform = 'translateY(0)';
      }, 10);
    }

    function hideSoundSettings() {
      const panel = elements.soundSettingsPanel;
      const btn = elements.soundSettingsBtn;
      
      // رسوم متحركة للاختفاء
      panel.style.transition = 'all 0.3s ease-in';
      panel.style.opacity = '0';
      panel.style.transform = 'translateY(-20px)';
      
      // إلغاء تفعيل حالة الزر
      btn.classList.remove('active');
      
      // إخفاء اللوحة
      setTimeout(() => {
        panel.style.display = 'none';
      }, 300);
    }

    // إخفاء الإعدادات عند النقر خارجها
    function handleOutsideClick(e) {
      const panel = document.getElementById('soundSettingsPanel');
      const btn = document.getElementById('soundSettingsBtn');
      
      if (panel && panel.style.display !== 'none' && 
          !panel.contains(e.target) && 
          !btn.contains(e.target)) {
        hideSoundSettings();
      }
    }

    // تنسيق الوقت
    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      
      if (hours > 0) {
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }
      return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    // تحديث العرض
    function updateDisplay() {
      let displayTime;
      let progress;

      switch (currentMode) {
        case 'countdown':
          displayTime = timeLeft;
          progress = (duration - timeLeft) / duration;
          break;
        case 'countup':
          displayTime = elapsed;
          progress = elapsed / duration;
          break;
        case 'stopwatch':
          displayTime = elapsed;
          progress = 0; // ساعة الإيقاف لا تحتاج تقدم
          break;
      }

      elements.timerTime.textContent = formatTime(displayTime);
      
      // تحديث دائرة التقدم
      if (currentMode !== 'stopwatch') {
        const circumference = 2 * Math.PI * 150;
        const offset = circumference * (1 - progress);
        elements.progressCircle.style.strokeDasharray = circumference;
        elements.progressCircle.style.strokeDashoffset = offset;
      } else {
        // ساعة الإيقاف - دائرة كاملة
        elements.progressCircle.style.strokeDasharray = '0';
        elements.progressCircle.style.strokeDashoffset = '0';
      }

      // تحديث حالات التحذير
      updateWarningStates();
    }

    // تحديث حالات التحذير
    function updateWarningStates() {
      // إزالة جميع الفئات
      elements.timerTime.classList.remove('warning', 'danger');
      elements.progressCircle.classList.remove('warning', 'danger');

      if (currentMode === 'countdown' && isRunning) {
        if (timeLeft <= 10 && timeLeft > 0) {
          elements.timerTime.classList.add('danger');
          elements.progressCircle.classList.add('danger');
        } else if (timeLeft <= 30) {
          elements.timerTime.classList.add('warning');
          elements.progressCircle.classList.add('warning');
        }
      }
    }

    // تحديث حالة المؤقت
    function updateStatus(status, text, icon) {
      elements.statusIndicator.classList.remove('idle', 'running', 'paused', 'finished');
      elements.statusIndicator.classList.add(status);
      elements.statusText.textContent = text;
      elements.statusIcon.textContent = icon;
    }

    // تحديث أزرار التحكم
    function updateControls() {
      if (isRunning && !isPaused) {
        elements.startBtn.disabled = true;
        elements.pauseBtn.disabled = false;
        elements.pauseBtn.innerHTML = '<span>⏸️</span><span>إيقاف مؤقت</span>';
        elements.pauseBtn.className = 'timer-btn pause-btn';
        elements.stopBtn.disabled = false;
      } else if (isPaused) {
        elements.startBtn.disabled = true;
        elements.pauseBtn.disabled = false;
        elements.pauseBtn.innerHTML = '<span>▶️</span><span>استكمال</span>';
        elements.pauseBtn.className = 'timer-btn resume-btn';
        elements.stopBtn.disabled = false;
      } else {
        elements.startBtn.disabled = isFinished;
        elements.pauseBtn.disabled = true;
        elements.pauseBtn.innerHTML = '<span>⏸️</span><span>إيقاف مؤقت</span>';
        elements.pauseBtn.className = 'timer-btn pause-btn';
        elements.stopBtn.disabled = true;
      }
    }

    // بدء المؤقت
    function startTimer() {
      if (isRunning) return;

      isRunning = true;
      isPaused = false;
      isFinished = false;

      updateStatus('running', 'المؤقت يعمل', '▶️');
      updateControls();
      
      playSound(elements.startSound, 'start');
      addSoundWave();

      timerInterval = setInterval(() => {
        updateTimer();
      }, 1000);

      // بدء أصوات التحذير للعد التنازلي
      if (currentMode === 'countdown') {
        startWarningSound();
      }

      console.log(`🚀 بدء المؤقت - النمط: ${currentMode}, المدة: ${duration}s`);
    }

    // تحديث المؤقت
    function updateTimer() {
      switch (currentMode) {
        case 'countdown':
          timeLeft--;
          
          // تشغيل صوت التحذير (countdown-beep.mp3) في آخر 10 ثوان
          if (timeLeft === 10 && !finalSoundStarted && duration > 10) {
            finalSoundStarted = true;
            playSound(elements.warningSound, 'warning');
            console.log('⚠️ بدء صوت التحذير - 10 ثوان متبقية');
          }
          
          if (timeLeft <= 0) {
            completeTimer();
            return;
          }
          break;
        case 'countup':
          elapsed++;
          
          // تشغيل صوت التحذير (countdown-beep.mp3) في آخر 10 ثوان للعد التصاعدي
          if (elapsed === duration - 10 && !finalSoundStarted && duration > 10) {
            finalSoundStarted = true;
            playSound(elements.warningSound, 'warning');
            console.log('⚠️ بدء صوت التحذير - 10 ثوان متبقية');
          }
          
          if (elapsed >= duration) {
            completeTimer();
            return;
          }
          break;
        case 'stopwatch':
          elapsed++;
          break;
      }

      updateDisplay();
    }

    // إيقاف/استكمال المؤقت
    function togglePause() {
      if (!isRunning) return;

      // وقف جميع الأصوات
      stopAllSounds();
      playSound(elements.clickSound, 'click');

      if (isPaused) {
        // استكمال
        isPaused = false;
        updateStatus('running', 'المؤقت يعمل', '▶️');
        
        timerInterval = setInterval(() => {
          updateTimer();
        }, 1000);

        if (currentMode === 'countdown') {
          startWarningSound();
        }

        console.log('▶️ استكمال المؤقت');
      } else {
        // إيقاف مؤقت
        isPaused = true;
        clearInterval(timerInterval);
        clearInterval(warningInterval);
        
        updateStatus('paused', 'المؤقت متوقف مؤقتاً', '⏸️');
        console.log('⏸️ إيقاف المؤقت مؤقتاً');
      }

      updateControls();
    }

    // وقف جميع الأصوات
    function stopAllSounds() {
      [elements.startSound, elements.endSound, elements.warningSound, elements.clickSound]
        .forEach(audio => {
          if (audio && !audio.paused) {
            audio.pause();
            audio.currentTime = 0;
          }
        });
      
      // وقف الفواصل الزمنية للأصوات
      clearInterval(warningInterval);
      
      // إعادة تعيين حالة صوت النهاية عند الإيقاف
      finalSoundStarted = false;
      
      console.log('🔇 تم إيقاف جميع الأصوات والفواصل الزمنية');
    }

    // إعادة تعيين المؤقت
    function resetTimer() {
      clearInterval(timerInterval);
      clearInterval(warningInterval);
      
      // وقف جميع الأصوات
      stopAllSounds();
      
      isRunning = false;
      isPaused = false;
      isFinished = false;
      finalSoundStarted = false; // إعادة تعيين صوت النهاية
      timeLeft = duration;
      elapsed = 0;

      updateDisplay();
      updateStatus('idle', 'جاهز للبدء', '⏸️');
      updateControls();
      
      playSound(elements.clickSound, 'click');
      console.log('🔄 إعادة تعيين المؤقت');
    }

    // إيقاف نهائي
    function stopTimer() {
      if (!isRunning && !isPaused) return;

      clearInterval(timerInterval);
      clearInterval(warningInterval);
      
      // وقف جميع الأصوات
      stopAllSounds();
      
      isRunning = false;
      isPaused = false;
      isFinished = true;
      finalSoundStarted = false; // إعادة تعيين صوت النهاية

      // حفظ الجلسة (غير مكتملة)
      saveSession(false);

      updateStatus('finished', 'تم إيقاف المؤقت', '⏹️');
      updateControls();
      
      playSound(elements.clickSound, 'click');
      console.log('⏹️ إيقاف المؤقت نهائياً');
    }

    // إكمال المؤقت
    function completeTimer() {
      clearInterval(timerInterval);
      clearInterval(warningInterval);
      
      // وقف أصوات التحذير
      if (elements.warningSound && !elements.warningSound.paused) {
        elements.warningSound.pause();
        elements.warningSound.currentTime = 0;
      }
      
      isRunning = false;
      isPaused = false;
      isFinished = true;

      updateDisplay();
      updateStatus('finished', 'انتهى الوقت!', '⏰');
      updateControls();

      // تشغيل صوت النافذة المنبثقة (end-timer.mp3) عند الإكمال
      playSound(elements.endSound, 'end');
      console.log('🎉 تشغيل صوت النافذة المنبثقة عند انتهاء الوقت');
      
      // إضافة تأثير الاحتفال
      addCelebrationEffect();

      // حفظ الجلسة (مكتملة)
      saveSession(true);

      // إظهار نافذة الإكمال
      showCompletionModal();

      console.log('🎉 تم إكمال المؤقت بنجاح!');
    }

    // بدء صوت التحذير
    function startWarningSound() {
      clearInterval(warningInterval);
      
      warningInterval = setInterval(() => {
        // تشغيل الصوت فقط في الثواني 5، 4، 3، 2، 1 (ليس 10 لأنه مخصص للصوت الطويل)
        if (isRunning && !isPaused && 
            (timeLeft === 5 || timeLeft === 4 || 
             timeLeft === 3 || timeLeft === 2 || timeLeft === 1)) {
          playSound(elements.warningSound, 'warning');
          console.log(`⚠️ تحذير قصير: ${timeLeft} ثانية متبقية`);
        }
      }, 1000);
    }

    // إضافة تأثير موجة الصوت
    function addSoundWave() {
      const wave = document.createElement('div');
      wave.className = 'sound-wave';
      elements.timerTime.parentElement.appendChild(wave);
      
      setTimeout(() => {
        wave.remove();
      }, 1000);
    }

    // إضافة تأثير الاحتفال
    function addCelebrationEffect() {
      elements.timerTime.parentElement.classList.add('celebrating');
      setTimeout(() => {
        elements.timerTime.parentElement.classList.remove('celebrating');
      }, 1000);
    }

    // حفظ بيانات الجلسة
    function saveSession(completed) {
      const session = {
        mode: currentMode,
        duration: duration,
        timeSpent: currentMode === 'countdown' ? duration - timeLeft : elapsed,
        completed: completed,
        timestamp: new Date()
      };

      sessionStats.sessions.push(session);
      sessionStats.totalSessions++;
      if (completed) {
        sessionStats.completedSessions++;
      }
      sessionStats.totalTime += session.timeSpent;

      updateStatsDisplay();
      
      // حفظ في localStorage
      localStorage.setItem('timerStats', JSON.stringify(sessionStats));
    }

    // تحديث عرض الإحصائيات
    function updateStatsDisplay() {
      elements.totalSessions.textContent = sessionStats.totalSessions;
      elements.completedSessions.textContent = sessionStats.completedSessions;
      elements.totalTime.textContent = formatTime(sessionStats.totalTime);
      
      const averageTime = sessionStats.totalSessions > 0 ? 
        Math.floor(sessionStats.totalTime / sessionStats.totalSessions) : 0;
      elements.averageTime.textContent = formatTime(averageTime);
    }

    // إظهار نافذة الإكمال
    function showCompletionModal() {
      const modeText = {
        'countdown': 'العد التنازلي',
        'countup': 'العد التصاعدي', 
        'stopwatch': 'ساعة الإيقاف'
      };

      elements.modalMessage.textContent = 
        `تم إكمال ${modeText[currentMode]} بنجاح! الوقت المستغرق: ${formatTime(currentMode === 'countdown' ? duration : elapsed)}`;
      
      elements.completionModal.classList.add('show');
      
      // إغلاق تلقائي بعد 10 ثوان
      setTimeout(() => {
        if (elements.completionModal.classList.contains('show')) {
          closeCompletionModal();
        }
      }, 10000);
    }

    // إغلاق نافذة الإكمال
    function closeCompletionModal() {
      // وقف جميع الأصوات
      stopAllSounds();
      
      elements.completionModal.classList.remove('show');
      playSound(elements.clickSound, 'click');
    }

    // بدء جلسة جديدة
    function startNewSession() {
      // وقف جميع الأصوات
      stopAllSounds();
      
      closeCompletionModal();
      resetTimer();
      setTimeout(() => {
        startTimer();
      }, 500);
    }
    // تغيير نمط المؤقت
    function changeMode() {
      const newMode = elements.timerMode.value;
      if (newMode !== currentMode) {
        // وقف جميع الأصوات
        stopAllSounds();
        
        currentMode = newMode;
        finalSoundStarted = false; // إعادة تعيين صوت النهاية
        resetTimer();
        playSound(elements.clickSound, 'click');
        
        const modeNames = {
          'countdown': 'العد التنازلي',
          'countup': 'العد التصاعدي',
          'stopwatch': 'ساعة الإيقاف'
        };
        
        console.log(`🔄 تغيير النمط إلى: ${modeNames[currentMode]}`);
      }
    }

    // تغيير المدة
    function changeDuration() {
      const newDuration = parseInt(elements.timerDuration.value);
      if (newDuration !== duration) {
        // وقف جميع الأصوات
        stopAllSounds();
        
        duration = newDuration;
        finalSoundStarted = false; // إعادة تعيين صوت النهاية
        resetTimer();
        playSound(elements.clickSound, 'click');
        console.log(`⏰ تغيير المدة إلى: ${duration}s`);
      }
    }

    // تعيين وقت محدد مسبقاً
    function setPresetTime(seconds) {
      // وقف جميع الأصوات
      stopAllSounds();
      
      duration = seconds;
      finalSoundStarted = false; // إعادة تعيين صوت النهاية
      elements.timerDuration.value = seconds;
      resetTimer();
      playSound(elements.clickSound, 'click');
      console.log(`⚡ تعيين وقت محدد مسبقاً: ${seconds}s`);
    }

    // تحديث إعدادات الصوت
    function updateAudioSettings() {
      audioSettings.volume = parseInt(elements.volumeSlider.value) / 100;
      elements.volumeValue.textContent = `${parseInt(elements.volumeSlider.value)}%`;
      
      audioSettings.startSound = elements.startSoundToggle.checked;
      audioSettings.endSound = elements.endSoundToggle.checked;
      audioSettings.warningSound = elements.warningSoundToggle.checked;
      audioSettings.clickSound = elements.clickSoundToggle.checked;
      
      // تطبيق مستوى الصوت على جميع عناصر الصوت
      [elements.startSound, elements.endSound, elements.warningSound, elements.clickSound]
        .forEach(audio => {
          if (audio) audio.volume = audioSettings.volume;
        });
      
      console.log('🔊 تم تحديث إعدادات الصوت:', audioSettings);
    }

    // تبديل كتم الصوت الرئيسي
    function toggleMasterMute() {
      audioSettings.masterMute = !audioSettings.masterMute;
      elements.soundToggleBtn.textContent = audioSettings.masterMute ? '🔇' : '🔊';
      elements.soundToggleBtn.title = audioSettings.masterMute ? 'تشغيل الصوت' : 'كتم الصوت';
      
      playSound(elements.clickSound, 'click');
      console.log(`🔊 الصوت الرئيسي: ${audioSettings.masterMute ? 'مكتوم' : 'مفعل'}`);
    }

    // وضع ملء الشاشة
    async function toggleFullScreen() {
      try {
        if (!document.fullscreenElement) {
          await document.documentElement.requestFullscreen();
          console.log('🖥️ تم تفعيل ملء الشاشة');
        } else {
          await document.exitFullscreen();
          console.log('🖥️ تم إلغاء ملء الشاشة');
        }
        playSound(elements.clickSound, 'click');
      } catch (error) {
        console.warn('⚠️ فشل في تغيير وضع ملء الشاشة:', error);
      }
    }

    // تحميل الإحصائيات المحفوظة
    function loadStats() {
      try {
        const savedStats = localStorage.getItem('timerStats');
        if (savedStats) {
          sessionStats = JSON.parse(savedStats);
          updateStatsDisplay();
        }
      } catch (error) {
        console.warn('⚠️ فشل في تحميل الإحصائيات:', error);
      }
    }

    // مسح الإحصائيات
    function clearStats() {
      if (confirm('هل تريد مسح جميع الإحصائيات؟\nهذا الإجراء لا يمكن التراجع عنه.')) {
        sessionStats = {
          totalSessions: 0,
          completedSessions: 0,
          totalTime: 0,
          sessions: []
        };
        updateStatsDisplay();
        localStorage.removeItem('timerStats');
        playSound(elements.clickSound, 'click');
        console.log('🗑️ تم مسح الإحصائيات');
      }
    }

    // تهيئة المؤقت
    function initializeTimer() {
      console.log('⚡ جاري تهيئة المؤقت الصفي التفاعلي...');
      
      // تحميل الإحصائيات
      loadStats();
      
      // تحديث الإعدادات
      updateAudioSettings();
      
      // إعداد المؤقت الأولي
      resetTimer();
      
      console.log('🎉 تم تحميل المؤقت بنجاح!');
    }

    // معالجة الأحداث
    document.addEventListener('DOMContentLoaded', () => {
      console.log('📄 تم تحميل DOM - بدء تهيئة الأحداث...');
      
      // تهيئة المؤقت
      initializeTimer();

      // أزرار التحكم الرئيسية
      elements.startBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        startTimer();
      });

      elements.pauseBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        togglePause();
      });

      elements.resetBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        resetTimer();
      });

      elements.stopBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        stopTimer();
      });

      // زر إعدادات الصوت
      elements.soundSettingsBtn = document.getElementById('soundSettingsBtn');
      elements.soundSettingsPanel = document.getElementById('soundSettingsPanel');
      elements.closeSoundSettingsBtn = document.getElementById('closeSoundSettingsBtn');

      elements.soundSettingsBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        toggleSoundSettings();
      });

      elements.closeSoundSettingsBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        hideSoundSettings();
      });

      // إضافة معالج النقر خارج الإعدادات
      document.addEventListener('click', handleOutsideClick);

      // الإعدادات
      elements.timerMode.addEventListener('change', changeMode);
      elements.timerDuration.addEventListener('change', changeDuration);

      // أزرار الأوقات المحددة مسبقاً
      document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          addClickEffect(e.target);
          const time = parseInt(e.target.dataset.time);
          setPresetTime(time);
        });
      });

      // إعدادات الصوت
      elements.volumeSlider.addEventListener('input', updateAudioSettings);
      elements.startSoundToggle.addEventListener('change', updateAudioSettings);
      elements.endSoundToggle.addEventListener('change', updateAudioSettings);
      elements.warningSoundToggle.addEventListener('change', updateAudioSettings);
      elements.clickSoundToggle.addEventListener('change', updateAudioSettings);

      // أزرار التحكم العلوية
      elements.backBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        
        // إيقاف المؤقت إذا كان يعمل
        if (isRunning) {
          stopTimer();
        }
        
        // تأثير انتقال سلس
        document.body.style.opacity = '0';
        document.body.style.transform = 'scale(0.95)';
        
        setTimeout(() => {
          window.location.href = '../main.html';
        }, 300);
      });

      elements.fullscreenBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        toggleFullScreen();
      });

      elements.soundToggleBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        toggleMasterMute();
      });

      // أزرار النافذة المنبثقة
      elements.newSessionBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        startNewSession();
      });

      elements.closeModalBtn.addEventListener('click', (e) => {
        addClickEffect(e.target);
        closeCompletionModal();
      });

      // إغلاق النافذة بالنقر خارجها
      elements.completionModal.addEventListener('click', (e) => {
        if (e.target === elements.completionModal) {
          closeCompletionModal();
        }
      });

      // اختصارات لوحة المفاتيح
      document.addEventListener('keydown', (e) => {
        switch(e.key) {
          case 'Enter':
          case ' ':
            e.preventDefault();
            if (!isRunning && !isPaused) {
              elements.startBtn.click();
            } else if (isRunning || isPaused) {
              elements.pauseBtn.click();
            }
            break;
          case 'Escape':
            if (elements.completionModal.classList.contains('show')) {
              closeCompletionModal();
            } else if (isRunning || isPaused) {
              elements.stopBtn.click();
            } else if (document.fullscreenElement) {
              document.exitFullscreen();
            }
            break;
          case 'r':
          case 'R':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              elements.resetBtn.click();
            }
            break;
          case 'F11':
            e.preventDefault();
            toggleFullScreen();
            break;
          case 'm':
          case 'M':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              toggleMasterMute();
            }
            break;
          case 's':
          case 'S':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              if (isRunning || isPaused) {
                elements.stopBtn.click();
              }
            }
            break;
        }
      });

      // مسح الإحصائيات بالنقر المزدوج على العنوان
      elements.totalSessions.addEventListener('dblclick', clearStats);

      console.log('✅ تم تهيئة جميع الأحداث بنجاح!');
    });

    // معالجة الأخطاء العامة
    window.addEventListener('error', (e) => {
      console.error('💥 خطأ عام في المؤقت:', e.error);
    });

    window.addEventListener('unhandledrejection', (e) => {
      console.error('💥 خطأ غير معالج في Promise:', e.reason);
    });

    // تنظيف عند إغلاق الصفحة
    window.addEventListener('beforeunload', () => {
      clearInterval(timerInterval);
      clearInterval(warningInterval);
    });

    // إيقاف المؤقت عند فقدان التركيز
    window.addEventListener('blur', () => {
      if (isRunning && !isPaused) {
        togglePause();
        console.log('⚠️ تم إيقاف المؤقت مؤقتاً بسبب فقدان التركيز');
      }
    });

    console.log('📝 تم تحميل جميع النصوص البرمجية للمؤقت!');
  </script>
  
  <!-- Responsive Helper Script -->
  <script src="../assets/js/responsive-helper.js"></script>
</body>
</html>
