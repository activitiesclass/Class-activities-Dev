<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#00796B"/>
  <meta name="description" content="نشاط الاختيار العشوائي للطلاب"/>
  <meta name="keywords" content="اختيار عشوائي, طلاب, تفاعلي, تعليم, مدرسة, عُمان"/>
  <meta name="author" content=""/>

  <title>الاسم العشوائي - الأنشطة الصفية</title>

  <!-- الخطوط والأيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- فافيكون -->
  <link rel="icon" type="image/png" href="../assets/media/images/school-logo.png">
  
  <!-- Responsive CSS Framework -->
  <link rel="stylesheet" href="../assets/css/responsive.css">

  <style>
    :root {
      /* نظام ألوان عُماني متطور */
      --primary-color: #00796B;
      --primary-light: #4DB6AC;
      --primary-dark: #004D40;
      --secondary-color: #FF5722;
      --accent-color: #FFD700;
      --success-color: #4CAF50;
      --warning-color: #FF9800;
      --error-color: #F44336;
      --text-primary: #212121;
      --text-secondary: #757575;
      --background-light: #FAFAFA;
      --surface-color: #FFFFFF;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-medium: rgba(0, 0, 0, 0.2);
      --shadow-dark: rgba(0, 0, 0, 0.3);

      /* متغيرات التخطيط */
      --border-radius: 16px;
      --border-radius-small: 8px;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;

      /* الانتقالات */
      --transition-fast: 0.2s ease-out;
      --transition-normal: 0.3s ease-out;
      --transition-slow: 0.5s ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg,
        #e0f7fa 0%,
        #b2dfdb 25%,
        #80cbc4 50%,
        #4db6ac 75%,
        #26a69a 100%);
      background-attachment: fixed;
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* خلفية متحركة */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0, 121, 107, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(255, 87, 34, 0.1) 0%, transparent 50%);
      animation: backgroundShift 20s ease-in-out infinite;
      z-index: -1;
    }

    @keyframes backgroundShift {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(-20px, 20px) rotate(1deg); }
      50% { transform: translate(20px, -20px) rotate(-1deg); }
      75% { transform: translate(-10px, -10px) rotate(0.5deg); }
    }

    /* أزرار التحكم */
    .control-buttons {
      position: fixed;
      top: var(--spacing-md);
      display: flex;
      gap: var(--spacing-sm);
      z-index: 1000;
    }

    .control-buttons.left {
      left: var(--spacing-md);
    }

    .control-buttons.right {
      right: var(--spacing-md);
    }

    .control-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      color: var(--primary-color);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px var(--shadow-medium);
      transition: all var(--transition-normal);
      backdrop-filter: blur(10px);
    }

    .control-btn:hover {
      transform: translateY(-3px) scale(1.05);
      background: var(--primary-color);
      color: white;
      box-shadow: 0 8px 20px var(--shadow-dark);
    }

    .control-btn:active {
      transform: translateY(0) scale(0.95);
    }

    /* الحاوي الرئيسي */
    .main-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: var(--spacing-xl) var(--spacing-lg);
      position: relative;
      z-index: 10;
    }

    /* رأس الصفحة */
    .header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      animation: slideDown 0.8s ease-out;
    }

    .header-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      box-shadow: 0 8px 32px var(--shadow-medium);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .header-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
    }

    .header-title {
      font-size: clamp(2rem, 5vw, 2.5rem);
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
      color: var(--primary-color);
      text-shadow: 2px 2px 4px var(--shadow-light);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .header-subtitle {
      font-size: clamp(1rem, 3vw, 1.2rem);
      color: var(--text-secondary);
      font-weight: 400;
      line-height: 1.5;
    }

    /* اختيار الصف */
    .class-selector {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(232, 245, 233, 0.95) 50%,
        rgba(255, 255, 255, 0.98) 100%);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 
        0 8px 32px rgba(0, 121, 107, 0.12),
        0 2px 8px rgba(0, 0, 0, 0.08);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(0, 121, 107, 0.1);
      animation: slideUp 0.8s ease-out 0.2s both;
      position: relative;
      overflow: hidden;
    }

    .class-selector::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, 
        var(--primary-color) 0%,
        var(--primary-light) 50%,
        var(--accent-color) 100%);
      border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .class-selector::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, 
        transparent 0%,
        rgba(0, 121, 107, 0.05) 25%,
        transparent 50%,
        rgba(255, 215, 0, 0.05) 75%,
        transparent 100%);
      border-radius: var(--border-radius);
      z-index: -1;
      animation: borderGlow 3s ease-in-out infinite;
    }

    @keyframes borderGlow {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    .class-selector h3 {
      font-size: 1.4rem;
      color: var(--primary-color);
      margin-bottom: var(--spacing-lg);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      text-shadow: 1px 1px 2px rgba(0, 121, 107, 0.1);
      font-weight: 600;
    }

    .class-selector h3 span:first-child {
      font-size: 1.6rem;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-3px); }
    }

    /* حاوي قائمة الاختيار */
    .select-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      background: linear-gradient(135deg, #ffffff 0%, #f8fffe 100%);
      border: 2px solid rgba(0, 121, 107, 0.15);
      border-radius: var(--border-radius-small);
      overflow: hidden;
      transition: all var(--transition-normal);
      box-shadow: 
        0 4px 16px rgba(0, 121, 107, 0.1),
        inset 0 1px 2px rgba(255, 255, 255, 0.8);
    }

    .select-wrapper:hover {
      border-color: var(--primary-light);
      box-shadow: 
        0 8px 24px rgba(0, 121, 107, 0.15),
        inset 0 1px 2px rgba(255, 255, 255, 0.9);
      transform: translateY(-2px);
    }

    .select-wrapper:focus-within {
      border-color: var(--primary-color);
      box-shadow: 
        0 0 0 3px rgba(0, 121, 107, 0.2),
        0 8px 32px rgba(0, 121, 107, 0.2),
        inset 0 1px 2px rgba(255, 255, 255, 0.9);
      transform: scale(1.02);
    }

    .select-icon {
      padding: 0 var(--spacing-md);
      font-size: 1.2rem;
      color: var(--primary-color);
      background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .select-arrow {
      position: absolute;
      right: var(--spacing-md);
      color: var(--primary-color);
      pointer-events: none;
      transition: all var(--transition-normal);
    }

    .select-wrapper:hover .select-arrow {
      color: var(--primary-dark);
      transform: scale(1.1);
    }

    .select-wrapper:focus-within .select-arrow {
      transform: rotate(180deg) scale(1.1);
    }

    .class-select {
      flex: 1;
      padding: var(--spacing-md) var(--spacing-lg);
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 1.1rem;
      font-family: 'Cairo', sans-serif;
      text-align: center;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      outline: none;
      transition: all var(--transition-normal);
      font-weight: 500;
    }

    .class-select:focus {
      color: var(--primary-dark);
    }

    .class-select option {
      padding: var(--spacing-md) var(--spacing-lg);
      background: white;
      color: var(--text-primary);
      font-size: 1rem;
      border: none;
      font-family: 'Cairo', sans-serif;
      font-weight: 500;
      text-align: right;
      direction: rtl;
    }

    .class-select option:hover {
      background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
      color: white;
    }

    .class-select option:checked {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      font-weight: 600;
    }

    .class-select option[value=""] {
      color: var(--text-secondary);
      font-style: italic;
      background: #f8f9fa;
    }

    .class-select option[value=""]:hover {
      background: linear-gradient(135deg, #e9ecef, #dee2e6);
      color: var(--text-primary);
    }

    /* تأثير عند اختيار صف */
    .class-selector.selected {
      background: linear-gradient(135deg, 
        rgba(232, 245, 233, 0.98) 0%, 
        rgba(200, 230, 201, 0.95) 50%,
        rgba(232, 245, 233, 0.98) 100%);
      border-color: var(--success-color);
      box-shadow: 
        0 12px 40px rgba(76, 175, 80, 0.2),
        0 4px 12px rgba(0, 0, 0, 0.1);
      animation: successPulse 1s ease-out;
    }

    @keyframes successPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    .class-selector.selected::before {
      background: linear-gradient(90deg, 
        var(--success-color) 0%,
        #66BB6A 50%,
        var(--accent-color) 100%);
    }

    .class-selector.selected .select-wrapper {
      border-color: var(--success-color);
      background: linear-gradient(135deg, #ffffff 0%, #e8f5e8 100%);
    }

    .class-selector.selected .select-icon {
      background: linear-gradient(135deg, var(--success-color), #66BB6A);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .class-selector.selected .select-arrow {
      color: var(--success-color);
    }

    /* رسالة التأكيد */
    .selection-confirmation {
      margin-top: var(--spacing-md);
      padding: var(--spacing-sm) var(--spacing-md);
      background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(102, 187, 106, 0.1));
      border: 1px solid rgba(76, 175, 80, 0.3);
      border-radius: var(--border-radius-small);
      color: var(--success-color);
      font-size: 0.9rem;
      text-align: center;
      opacity: 0;
      transform: translateY(-10px);
      transition: all var(--transition-normal);
      display: none;
    }

    .selection-confirmation.show {
      opacity: 1;
      transform: translateY(0);
      display: block;
      animation: slideDown 0.3s ease-out;
    }

    .selection-confirmation .icon {
      margin-left: var(--spacing-xs);
      font-size: 1rem;
    }

    /* منطقة عرض النتيجة */
    .result-display {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 0 8px 32px var(--shadow-medium);
      backdrop-filter: blur(15px);
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      animation: slideUp 0.8s ease-out 0.4s both;
    }

    .result-display::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, 
        transparent 30%, 
        rgba(255, 215, 0, 0.1) 50%, 
        transparent 70%);
      animation: shimmer 4s infinite;
      pointer-events: none;
    }

    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .rolling-animation {
      position: relative;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .rolling-names {
      position: absolute;
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      font-weight: 600;
      color: var(--secondary-color);
      opacity: 0.7;
      animation: roll 0.1s infinite;
    }

    @keyframes roll {
      0% { transform: translateY(-30px); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: translateY(30px); opacity: 0; }
    }

    .selected-name {
      font-size: clamp(2rem, 7vw, 3.5rem);
      font-weight: 700;
      color: var(--primary-color);
      text-shadow: 3px 3px 6px var(--shadow-medium);
      z-index: 10;
      position: relative;
      text-align: center;
      animation: nameAppear 0.8s ease-out;
    }

    @keyframes nameAppear {
      0% { 
        opacity: 0; 
        transform: scale(0.5) rotate(-10deg); 
      }
      50% { 
        transform: scale(1.1) rotate(5deg); 
      }
      100% { 
        opacity: 1; 
        transform: scale(1) rotate(0deg); 
      }
    }

    .welcome-message {
      font-size: clamp(1.2rem, 4vw, 1.8rem);
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.6;
      animation: fadeIn 1s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* أزرار التحكم الرئيسية */
    .main-controls {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      justify-content: center;
      margin-bottom: var(--spacing-xl);
      animation: slideUp 0.8s ease-out 0.6s both;
    }

    .main-btn {
      padding: var(--spacing-md) var(--spacing-xl);
      font-size: clamp(1rem, 3vw, 1.2rem);
      font-weight: 600;
      border: none;
      border-radius: var(--border-radius-small);
      cursor: pointer;
      transition: all var(--transition-normal);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      min-width: 140px;
      justify-content: center;
      box-shadow: 0 4px 12px var(--shadow-light);
      font-family: 'Cairo', sans-serif;
    }

    .main-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .start-btn {
      background: linear-gradient(45deg, var(--success-color), #66BB6A);
      color: white;
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
    }

    .stop-btn {
      background: linear-gradient(45deg, var(--error-color), #EF5350);
      color: white;
    }

    .stop-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(244, 67, 54, 0.4);
    }

    .remove-btn {
      background: linear-gradient(45deg, var(--warning-color), #FFB74D);
      color: white;
    }

    .remove-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
    }

    .honor-btn {
      background: linear-gradient(45deg, var(--accent-color), #FFE082);
      color: #4A4A4A;
    }

    .honor-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
    }

    .reset-btn {
      background: linear-gradient(45deg, var(--text-secondary), #9E9E9E);
      color: white;
    }

    .reset-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(158, 158, 158, 0.4);
    }

    /* إعدادات الاختيار */
    .settings-panel {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: 0 4px 20px var(--shadow-light);
      backdrop-filter: blur(10px);
      animation: slideUp 0.8s ease-out 0.8s both;
      position: relative;
      border: 2px solid var(--primary-color);
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .settings-panel h3 {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .close-settings-btn {
      background: var(--error-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-normal);
      font-size: 1rem;
    }

    .close-settings-btn:hover {
      background: var(--error-dark);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }

    .settings-btn {
      background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
      color: white;
      position: relative;
      overflow: hidden;
    }

    .settings-btn:hover:not(:disabled) {
      background: linear-gradient(45deg, var(--primary-light), var(--primary-color));
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(0, 121, 107, 0.4);
    }

    .settings-btn.active {
      background: linear-gradient(45deg, #ff6b35, #ffa500) !important;
      animation: pulse 1.5s infinite;
    }

    .settings-btn.active span:first-child {
      animation: rotate 2s infinite linear;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
    }

    .setting-item {
      text-align: center;
    }

    .setting-label {
      display: block;
      margin-bottom: var(--spacing-sm);
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 0.9rem;
    }

    /* مفاتيح الصوت */
    .sound-toggles {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-sm);
    }

    .toggle-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-xs) var(--spacing-sm);
      background: rgba(0, 121, 107, 0.05);
      border-radius: var(--border-radius-small);
      border: 1px solid rgba(0, 121, 107, 0.1);
      transition: all var(--transition-normal);
    }

    .toggle-item:hover {
      background: rgba(0, 121, 107, 0.1);
      border-color: rgba(0, 121, 107, 0.2);
      transform: translateX(-2px);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
      cursor: pointer;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      border-radius: 24px;
      transition: all var(--transition-normal);
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: all var(--transition-normal);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch input:checked + .toggle-slider {
      background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(26px);
      box-shadow: 0 2px 8px rgba(0, 121, 107, 0.3);
    }

    .toggle-switch:hover .toggle-slider {
      box-shadow: 0 0 0 3px rgba(0, 121, 107, 0.1);
    }

    .toggle-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .toggle-item:hover .toggle-label {
      color: var(--primary-color);
    }

    .speed-slider {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      background: linear-gradient(to right, var(--error-color), var(--warning-color), var(--success-color));
      border-radius: var(--border-radius-small);
      outline: none;
      transition: all var(--transition-normal);
    }

    .speed-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px var(--shadow-medium);
      transition: all var(--transition-fast);
    }

    .speed-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 4px 12px var(--shadow-dark);
    }

    .speed-slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px var(--shadow-medium);
      transition: all var(--transition-fast);
    }

    .speed-value {
      margin-top: var(--spacing-sm);
      font-weight: 600;
      color: var(--primary-color);
      font-size: 0.9rem;
    }

    /* معلومات الطلاب */
    .student-info {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      box-shadow: 0 4px 20px var(--shadow-light);
      backdrop-filter: blur(10px);
      animation: slideUp 0.8s ease-out 1s both;
    }

    .student-info h3 {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin-bottom: var(--spacing-md);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .student-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--spacing-md);
      text-align: center;
    }

    .stat-item {
      background: linear-gradient(135deg, rgba(0, 121, 107, 0.1), rgba(77, 182, 172, 0.1));
      padding: var(--spacing-md);
      border-radius: var(--border-radius-small);
      border: 2px solid rgba(0, 121, 107, 0.2);
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: var(--spacing-xs);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* لوحة الشرف */
    .honor-board {
      background: linear-gradient(135deg, 
        rgba(255, 248, 225, 0.98) 0%, 
        rgba(255, 243, 176, 0.95) 50%,
        rgba(255, 248, 225, 0.98) 100%);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 
        0 8px 32px rgba(255, 215, 0, 0.15),
        0 2px 8px rgba(0, 0, 0, 0.08);
      backdrop-filter: blur(15px);
      border: 2px solid rgba(255, 215, 0, 0.2);
      animation: slideUp 0.8s ease-out 1.2s both;
      position: relative;
      overflow: hidden;
    }

    .honor-board::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, 
        var(--accent-color) 0%,
        #FFE082 25%,
        #FFCC02 50%,
        #FFE082 75%,
        var(--accent-color) 100%);
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      animation: goldenGlow 2s ease-in-out infinite;
    }

    @keyframes goldenGlow {
      0%, 100% { 
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      }
      50% { 
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
      }
    }

    .honor-board h3 {
      font-size: 1.4rem;
      color: #B8860B;
      margin-bottom: var(--spacing-lg);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      text-shadow: 2px 2px 4px rgba(184, 134, 11, 0.2);
      font-weight: 700;
    }

    .honor-board h3 span:first-child {
      font-size: 1.8rem;
      animation: trophyShine 3s ease-in-out infinite;
    }

    @keyframes trophyShine {
      0%, 100% { 
        transform: scale(1) rotate(0deg);
        filter: brightness(1);
      }
      25% { 
        transform: scale(1.1) rotate(-5deg);
        filter: brightness(1.3);
      }
      75% { 
        transform: scale(1.1) rotate(5deg);
        filter: brightness(1.3);
      }
    }

    .honor-list {
      max-height: 400px;
      overflow-y: auto;
      padding: var(--spacing-sm);
      border-radius: var(--border-radius-small);
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(255, 215, 0, 0.2);
    }

    .honor-list::-webkit-scrollbar {
      width: 8px;
    }

    .honor-list::-webkit-scrollbar-track {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 4px;
    }

    .honor-list::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, var(--accent-color), #FFE082);
      border-radius: 4px;
    }

    .honor-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.9) 0%,
        rgba(255, 248, 225, 0.8) 100%);
      border-radius: var(--border-radius-small);
      border: 1px solid rgba(255, 215, 0, 0.3);
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.1);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .honor-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--accent-color), #FFE082);
    }

    .honor-item:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 16px rgba(255, 215, 0, 0.2);
      border-color: var(--accent-color);
    }

    .honor-item:nth-child(1) {
      background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.3) 0%,
        rgba(255, 248, 225, 0.9) 100%);
      border: 2px solid var(--accent-color);
      animation: firstPlace 2s ease-in-out infinite;
    }

    @keyframes firstPlace {
      0%, 100% { 
        box-shadow: 0 2px 8px rgba(255, 215, 0, 0.1);
      }
      50% { 
        box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
      }
    }

    .honor-item:nth-child(2) {
      background: linear-gradient(135deg, 
        rgba(192, 192, 192, 0.3) 0%,
        rgba(255, 248, 225, 0.9) 100%);
      border: 2px solid #C0C0C0;
    }

    .honor-item:nth-child(3) {
      background: linear-gradient(135deg, 
        rgba(205, 127, 50, 0.3) 0%,
        rgba(255, 248, 225, 0.9) 100%);
      border: 2px solid #CD7F32;
    }

    .honor-student-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      flex: 1;
    }

    .honor-rank {
      font-size: 1.5rem;
      font-weight: 700;
      min-width: 40px;
      text-align: center;
    }

    .honor-item:nth-child(1) .honor-rank {
      color: var(--accent-color);
      text-shadow: 1px 1px 2px rgba(255, 215, 0, 0.3);
    }

    .honor-item:nth-child(2) .honor-rank {
      color: #C0C0C0;
      text-shadow: 1px 1px 2px rgba(192, 192, 192, 0.3);
    }

    .honor-item:nth-child(3) .honor-rank {
      color: #CD7F32;
      text-shadow: 1px 1px 2px rgba(205, 127, 50, 0.3);
    }

    .honor-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    .honor-medal {
      font-size: 1.2rem;
      animation: medalSpin 4s linear infinite;
    }

    @keyframes medalSpin {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(180deg); }
      100% { transform: rotateY(360deg); }
    }

    .honor-time {
      font-size: 0.8rem;
      color: var(--text-secondary);
      opacity: 0.8;
    }

    .no-honors {
      text-align: center;
      padding: var(--spacing-xl);
      color: var(--text-secondary);
    }

    .honor-icon {
      font-size: 3rem;
      margin-bottom: var(--spacing-md);
      opacity: 0.6;
      animation: starTwinkle 2s ease-in-out infinite;
    }

    @keyframes starTwinkle {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    .no-honors p {
      font-size: 1.1rem;
      margin-bottom: var(--spacing-sm);
      font-weight: 500;
    }

    .no-honors small {
      font-size: 0.9rem;
      opacity: 0.7;
    }

    .honor-actions {
      display: flex;
      gap: var(--spacing-md);
      justify-content: center;
      margin-top: var(--spacing-lg);
      padding-top: var(--spacing-lg);
      border-top: 1px solid rgba(255, 215, 0, 0.2);
    }

    .honor-action-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      font-size: 0.9rem;
      font-weight: 500;
      border: none;
      border-radius: var(--border-radius-small);
      cursor: pointer;
      transition: all var(--transition-normal);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-family: 'Cairo', sans-serif;
      box-shadow: 0 2px 6px var(--shadow-light);
    }

    .clear-honors-btn {
      background: linear-gradient(45deg, var(--error-color), #EF5350);
      color: white;
    }

    .clear-honors-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    }

    .export-honors-btn {
      background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
      color: white;
    }

    .export-honors-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 121, 107, 0.3);
    }

    .honor-action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* تأثيرات الحركة */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideDown {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-30px);
      }
    }

    /* التجاوب مع الشاشات المختلفة */
    @media (max-width: 768px) {
      .main-container {
        padding: var(--spacing-lg) var(--spacing-md);
      }
      
      .main-controls {
        flex-direction: column;
        align-items: center;
      }
      
      .main-btn {
        width: 100%;
        max-width: 300px;
      }
      
      .control-btn {
        width: 45px;
        height: 45px;
        font-size: 18px;
      }
      
      .settings-grid {
        grid-template-columns: 1fr;
      }
      
      .student-stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .class-selector {
        padding: var(--spacing-lg);
      }

      .class-selector h3 {
        font-size: 1.2rem;
        margin-bottom: var(--spacing-md);
      }

      .select-wrapper {
        flex-direction: column;
        text-align: center;
      }

      .select-icon {
        padding: var(--spacing-sm) 0;
        order: -1;
      }

      .select-arrow {
        position: relative;
        right: auto;
        margin-top: var(--spacing-sm);
      }

      .class-select {
        text-align: center;
        padding: var(--spacing-md);
      }

      .sound-toggles {
        gap: var(--spacing-xs);
      }

      .toggle-item {
        padding: var(--spacing-xs);
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-xs);
      }

      .toggle-switch {
        width: 40px;
        height: 20px;
      }

      .toggle-slider:before {
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
      }

      .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(20px);
      }

      .honor-board {
        padding: var(--spacing-md);
      }

      .honor-board h3 {
        font-size: 1.2rem;
        flex-direction: column;
        gap: var(--spacing-xs);
      }

      .honor-item {
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-xs);
        padding: var(--spacing-sm);
      }

      .honor-student-info {
        justify-content: center;
        gap: var(--spacing-sm);
      }

      .honor-rank {
        font-size: 1.3rem;
      }

      .honor-name {
        font-size: 1rem;
      }

      .honor-actions {
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .honor-action-btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .header-card {
        padding: var(--spacing-lg);
      }
      
      .result-display {
        padding: var(--spacing-lg);
        min-height: 250px;
      }
      
      .student-stats {
        grid-template-columns: 1fr;
      }

      .class-selector {
        padding: var(--spacing-md);
      }

      .class-selector h3 {
        font-size: 1.1rem;
        flex-direction: column;
        gap: var(--spacing-xs);
      }

      .selection-confirmation {
        font-size: 0.8rem;
        padding: var(--spacing-xs) var(--spacing-sm);
      }

      .toggle-label {
        font-size: 0.75rem;
      }

      .settings-panel {
        padding: var(--spacing-md);
      }
    }

    /* تحسينات إضافية للأداء */
    .main-btn,
    .control-btn {
      will-change: transform;
    }

    /* تأثيرات التركيز للوصولية */
    .main-btn:focus,
    .control-btn:focus,
    .class-select:focus,
    .speed-slider:focus {
      outline: 3px solid rgba(0, 121, 107, 0.5);
      outline-offset: 2px;
    }

    /* تأثير النقر */
    .click-effect {
      position: relative;
      overflow: hidden;
    }

    .click-effect::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(0, 121, 107, 0.3);
      transform: translate(-50%, -50%);
      animation: ripple 0.6s ease-out;
    }

    @keyframes ripple {
      to {
        width: 300px;
        height: 300px;
        opacity: 0;
      }
    }

    /* حالات خاصة */
    .pulsing {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .celebration {
      animation: celebrate 1s ease-out;
    }

    @keyframes celebrate {
      0% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(-5deg); }
      50% { transform: scale(1.2) rotate(5deg); }
      75% { transform: scale(1.1) rotate(-2deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    /* تحسينات الاستجابة المتقدمة للاختيار العشوائي */
    
    /* شاشات كبيرة جداً (1200px+) */
    @media (min-width: 1200px) {
      .main-container {
        max-width: 1100px;
        padding: var(--spacing-3xl);
      }

      .main-controls {
        grid-template-columns: repeat(5, 1fr);
        gap: var(--spacing-xl);
      }

      .main-btn {
        padding: var(--spacing-lg) var(--spacing-xl);
        font-size: var(--font-size-lg);
      }

      .settings-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-xl);
      }

      .result-display {
        min-height: 200px;
        font-size: var(--font-size-2xl);
      }
    }

    /* شاشات كبيرة (1024px - 1199px) */
    @media (max-width: 1199px) and (min-width: 1024px) {
      .main-container {
        max-width: 900px;
        padding: var(--spacing-2xl);
      }

      .main-controls {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-lg);
      }

      .main-btn {
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-base);
      }

      .settings-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-lg);
      }

      .result-display {
        min-height: 180px;
      }
    }

    /* تابلت (768px - 1023px) */
    @media (max-width: 1023px) and (min-width: 768px) {
      .main-container {
        max-width: 700px;
        padding: var(--spacing-xl);
        margin: 0 auto;
      }

      .main-controls {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-lg);
      }

      .main-btn {
        padding: var(--spacing-md);
        font-size: var(--font-size-sm);
      }

      .main-btn span:last-child {
        font-size: var(--font-size-xs);
      }

      .settings-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .result-display {
        min-height: 160px;
        padding: var(--spacing-lg);
      }

      .header-title {
        font-size: var(--font-size-xl);
      }

      .header-subtitle {
        font-size: var(--font-size-base);
      }

      .control-buttons {
        top: var(--spacing-sm);
      }
    }

    /* موبايل كبير (480px - 767px) */
    @media (max-width: 767px) and (min-width: 480px) {
      .main-container {
        max-width: 100%;
        margin: 0 var(--spacing-md);
        padding: var(--spacing-lg);
      }

      .main-controls {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .main-btn {
        width: 100%;
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-base);
        justify-content: center;
      }

      .main-btn span:first-child {
        font-size: var(--font-size-xl);
      }

      .settings-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }

      .setting-item {
        padding: var(--spacing-md);
      }

      .sound-toggles {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }

      .result-display {
        min-height: 140px;
        padding: var(--spacing-md);
      }

      .rolling-animation {
        font-size: var(--font-size-lg);
      }

      .header-title {
        font-size: var(--font-size-lg);
      }

      .header-title span:first-child {
        font-size: var(--font-size-2xl);
      }

      .header-subtitle {
        font-size: var(--font-size-sm);
        line-height: 1.4;
      }

      .class-selector h3 {
        font-size: var(--font-size-base);
      }

      .class-select {
        font-size: var(--font-size-sm);
        padding: var(--spacing-sm) var(--spacing-md);
      }

      .honor-board h3 {
        font-size: var(--font-size-base);
      }

      .honor-actions {
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .honor-action-btn {
        width: 100%;
        padding: var(--spacing-md);
        font-size: var(--font-size-sm);
      }
    }

    /* موبايل صغير (320px - 479px) */
    @media (max-width: 479px) {
      .main-container {
        margin: 0 var(--spacing-sm);
        padding: var(--spacing-md);
      }

      .main-controls {
        gap: var(--spacing-sm);
      }

      .main-btn {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-size-sm);
        min-height: 50px;
      }

      .main-btn span:first-child {
        font-size: var(--font-size-lg);
      }

      .main-btn span:last-child {
        font-size: var(--font-size-xs);
      }

      .settings-panel,
      .class-selector,
      .result-display,
      .honor-board {
        padding: var(--spacing-sm);
      }

      .result-display {
        min-height: 120px;
      }

      .rolling-animation {
        font-size: var(--font-size-base);
      }

      .header-card {
        padding: var(--spacing-md);
      }

      .header-title {
        font-size: var(--font-size-base);
      }

      .header-title span:first-child {
        font-size: var(--font-size-xl);
      }

      .header-subtitle {
        font-size: var(--font-size-xs);
        line-height: 1.3;
      }

      .class-selector h3 {
        font-size: var(--font-size-sm);
      }

      .class-select {
        font-size: var(--font-size-xs);
        padding: var(--spacing-xs) var(--spacing-sm);
      }

      .setting-item {
        padding: var(--spacing-sm);
      }

      .setting-label {
        font-size: var(--font-size-xs);
      }

      .speed-value {
        font-size: var(--font-size-xs);
      }

      .toggle-label {
        font-size: var(--font-size-xs);
      }

      .control-buttons {
        top: var(--spacing-xs);
      }

      .control-btn {
        width: 35px;
        height: 35px;
        font-size: var(--font-size-sm);
      }

      .honor-action-btn {
        font-size: var(--font-size-xs);
        padding: var(--spacing-sm);
      }
    }

    /* تحسينات خاصة للأجهزة اللمسية */
    @media (hover: none) and (pointer: coarse) {
      .main-btn {
        min-height: 60px;
        border-width: 3px;
      }

      .main-btn:hover {
        transform: none;
      }

      .main-btn:active {
        transform: scale(0.98);
      }

      .control-btn {
        min-width: 44px;
        min-height: 44px;
      }

      .class-select {
        min-height: 48px;
        border-width: 2px;
      }

      .speed-slider {
        height: 8px;
      }

      .speed-slider::-webkit-slider-thumb {
        width: 24px;
        height: 24px;
      }

      .speed-slider::-moz-range-thumb {
        width: 24px;
        height: 24px;
      }

      .toggle-switch {
        min-width: 50px;
        min-height: 28px;
      }
    }

    /* تحسينات للوضع الأفقي في الموبايل */
    @media screen and (max-height: 500px) and (orientation: landscape) {
      .header-card {
        padding: var(--spacing-sm);
      }

      .header-title {
        font-size: var(--font-size-base);
        margin-bottom: var(--spacing-xs);
      }

      .header-subtitle {
        font-size: var(--font-size-sm);
      }

      .main-container {
        padding: var(--spacing-md);
      }

      .result-display {
        min-height: 80px;
        padding: var(--spacing-sm);
      }

      .rolling-animation {
        font-size: var(--font-size-sm);
      }

      .main-controls {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--spacing-xs);
      }

      .main-btn {
        padding: var(--spacing-xs) var(--spacing-sm);
        font-size: var(--font-size-xs);
        min-height: 40px;
      }

      .main-btn span:first-child {
        font-size: var(--font-size-lg);
      }

      .settings-panel,
      .honor-board {
        padding: var(--spacing-sm);
      }

      .settings-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-xs);
      }

      .setting-item {
        padding: var(--spacing-xs);
      }
    }

    /* تحسينات الشاشات عالية الكثافة */
    @media (-webkit-min-device-pixel-ratio: 2),
           (min-resolution: 192dpi) {
      .main-btn {
        border-width: 1.5px;
      }

      .control-btn {
        border-width: 1.5px;
      }

      .class-select {
        border-width: 1.5px;
      }

      .header-card::before,
      .class-selector::before,
      .result-display::before {
        height: 3px;
      }
    }

    /* RTL layout optimizations for responsive design */
    [dir="rtl"] .main-controls {
      direction: rtl;
    }

    [dir="rtl"] .settings-grid {
      direction: rtl;
    }

    [dir="rtl"] .honor-actions {
      direction: rtl;
    }

    @media (max-width: 767px) {
      [dir="rtl"] .main-controls {
        direction: ltr;
      }

      [dir="rtl"] .honor-actions {
        direction: ltr;
      }
    }
  </style>
</head>

<body class="responsive-body touch-device">
  <!-- أزرار التحكم -->
  <div class="control-buttons right mobile-optimized">
    <button class="control-btn touch-target" id="backBtn" title="العودة للقائمة الرئيسية" aria-label="العودة للقائمة الرئيسية">
      🏠
    </button>
  </div>

  <div class="control-buttons left mobile-optimized">
    <button class="control-btn touch-target" id="fullscreenBtn" title="ملء الشاشة" aria-label="ملء الشاشة">
      ⛶
    </button>
  </div>

  <!-- المحتوى الرئيسي -->
  <div class="main-container responsive-container">
    <!-- رأس الصفحة -->
    <header class="header mobile-header">
      <div class="header-card mobile-card">
        <h1 class="header-title mobile-heading">
          <span>🎯</span>
          <span>الاختيار العشوائي للطلاب</span>
        </h1>
        <p class="header-subtitle mobile-subtitle">
          اختر طالباً بشكل عشوائي وعادل لبدء المشاركة أو تنفيذ النشاط الصفي
        </p>
      </div>
    </header>

    <!-- اختيار الصف -->
    <div class="class-selector mobile-card" id="classSelector">
      <h3 class="mobile-heading">
        <span>🎓</span>
        <span>اختر الصف الدراسي</span>
      </h3>
      <div class="select-wrapper mobile-select">
        <div class="select-icon">📚</div>
        <select class="class-select touch-target" id="classSelect">
          <option value="">-- اختر الصف الدراسي --</option>
        </select>
        <div class="select-arrow">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M8 11L3 6H13L8 11Z" fill="currentColor"/>
          </svg>
        </div>
      </div>
      <div class="selection-confirmation mobile-notification" id="selectionConfirmation">
        <span class="icon">✅</span>
        <span id="confirmationText">تم اختيار الصف بنجاح!</span>
      </div>
    </div>

    <!-- منطقة عرض النتيجة -->
    <div class="result-display mobile-card" id="resultDisplay">
      <div class="rolling-animation mobile-animation" id="rollingAnimation">
        <div class="welcome-message mobile-text" id="welcomeMessage">
          👋 مرحباً بك في نشاط الاختيار العشوائي<br>
          اختر الصف الدراسي أولاً لبدء المتعة!
        </div>
      </div>
    </div>

    <!-- أزرار التحكم الرئيسية -->
    <div class="main-controls mobile-buttons">
      <button class="main-btn start-btn touch-target mobile-btn" id="startBtn" disabled>
        <span>🚀</span>
        <span>ابدأ الاختيار</span>
      </button>
      <button class="main-btn stop-btn touch-target mobile-btn" id="stopBtn" disabled>
        <span>⏹️</span>
        <span>توقف</span>
      </button>
      <button class="main-btn remove-btn touch-target mobile-btn" id="removeBtn" disabled>
        <span>❌</span>
        <span>استبعاد الطالب</span>
      </button>
      <button class="main-btn honor-btn touch-target mobile-btn" id="honorBtn" disabled>
        <span>🏆</span>
        <span>إضافة للوحة الشرف</span>
      </button>
      <button class="main-btn settings-btn touch-target mobile-btn" id="settingsBtn">
        <span>⚙️</span>
        <span>الإعدادات</span>
      </button>
      <button class="main-btn reset-btn touch-target mobile-btn" id="resetBtn" disabled>
        <span>🔄</span>
        <span>إعادة تعيين</span>
      </button>
    </div>

    <!-- إعدادات الاختيار -->
    <div class="settings-panel mobile-card" id="settingsPanel" style="display: none;">
      <div class="settings-header">
        <h3 class="mobile-heading">
          <span>⚙️</span>
          <span>إعدادات الاختيار</span>
        </h3>
        <button class="close-settings-btn touch-target" id="closeSettingsBtn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="settings-grid mobile-grid">
        <div class="setting-item mobile-input">
          <label class="setting-label mobile-label" for="speedSlider">سرعة التدوير</label>
          <input type="range" id="speedSlider" class="speed-slider touch-target" min="50" max="300" value="150">
          <div class="speed-value mobile-text" id="speedValue">متوسط</div>
        </div>
        <div class="setting-item mobile-input">
          <label class="setting-label mobile-label" for="durationSlider">مدة التدوير</label>
          <input type="range" id="durationSlider" class="speed-slider touch-target" min="1" max="10" value="3">
          <div class="speed-value mobile-text" id="durationValue">3 ثوان</div>
        </div>
        <div class="setting-item mobile-input">
          <label class="setting-label mobile-label" for="volumeSlider">مستوى الصوت</label>
          <input type="range" id="volumeSlider" class="speed-slider touch-target" min="0" max="100" value="70">
          <div class="speed-value mobile-text" id="volumeValue">70%</div>
        </div>
        <div class="setting-item mobile-input">
          <label class="setting-label mobile-label">تشغيل الأصوات</label>
          <div class="sound-toggles mobile-toggles">
            <div class="toggle-item mobile-toggle">
              <label class="toggle-switch touch-target">
                <input type="checkbox" id="rollingAudioToggle" checked>
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label mobile-text">🎵 صوت التدوير</span>
            </div>
            <div class="toggle-item mobile-toggle">
              <label class="toggle-switch touch-target">
                <input type="checkbox" id="selectionAudioToggle" checked>
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label mobile-text">🎯 صوت الاختيار</span>
            </div>
            <div class="toggle-item mobile-toggle">
              <label class="toggle-switch touch-target">
                <input type="checkbox" id="celebrationAudioToggle" checked>
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label mobile-text">🎉 صوت الاحتفال</span>
            </div>
            <div class="toggle-item mobile-toggle">
              <label class="toggle-switch touch-target">
                <input type="checkbox" id="clickAudioToggle" checked>
                <span class="toggle-slider"></span>
              </label>
              <span class="toggle-label mobile-text">🖱️ صوت النقر</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- لوحة الشرف -->
    <div class="honor-board mobile-card" id="honorBoard" style="display: none;">
      <h3 class="mobile-heading">
        <span>🏆</span>
        <span>لوحة الشرف - الطلاب المكرمون</span>
      </h3>
      <div class="honor-list mobile-list" id="honorList">
        <div class="no-honors mobile-empty">
          <div class="honor-icon">⭐</div>
          <p class="mobile-text">لم يتم تكريم أي طالب بعد</p>
          <small class="mobile-text">اختر طالباً واضغط على زر التكريم لإضافته للوحة الشرف</small>
        </div>
      </div>
      <div class="honor-actions mobile-buttons">
        <button class="honor-action-btn clear-honors-btn touch-target mobile-btn" id="clearHonorsBtn">
          <span>🗑️</span>
          <span>مسح لوحة الشرف</span>
        </button>
        <button class="honor-action-btn export-honors-btn touch-target mobile-btn" id="exportHonorsBtn">
          <span>📋</span>
          <span>نسخ قائمة المكرمين</span>
        </button>
      </div>
    </div>

    <!-- معلومات الطلاب -->
    <div class="student-info" id="studentInfo" style="display: none;">
      <h3>
        <span>📊</span>
        <span>إحصائيات الطلاب</span>
      </h3>
      <div class="student-stats">
        <div class="stat-item">
          <div class="stat-number" id="totalStudents">0</div>
          <div class="stat-label">إجمالي الطلاب</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="remainingStudents">0</div>
          <div class="stat-label">طلاب متبقون</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="selectedCount">0</div>
          <div class="stat-label">تم اختيارهم</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="removedCount">0</div>
          <div class="stat-label">تم استبعادهم</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="honoredCount">0</div>
          <div class="stat-label">مكرمون</div>
        </div>
      </div>
    </div>
  </div>

  <!-- الأصوات -->
  <audio id="rollingSound" src="../assets/media/sounds/name-start.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="selectSound" src="../assets/media/sounds/name-stop.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="clickSound" src="../assets/media/sounds/Click.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="celebrationSound" src="../assets/media/sounds/clap.mp3" preload="auto" aria-hidden="true"></audio>

  <script>
    console.log('🎯 بدء تحميل نشاط الاختيار العشوائي...');

    // متغيرات النشاط
    let currentStudents = [];
    let availableStudents = [];
    let removedStudents = [];
    let selectedStudents = [];
    let honoredStudents = [];
    let isRolling = false;
    let rollingInterval = null;
    let currentSelectedName = '';
    let rollingSpeed = 150;
    let rollingDuration = 3000;

    // إعدادات الصوت
    let audioSettings = {
      volume: 0.7,
      rollingEnabled: true,
      selectionEnabled: true,
      celebrationEnabled: true,
      clickEnabled: true
    };

    // عناصر DOM
    const elements = {
      classSelect: document.getElementById('classSelect'),
      classSelector: document.getElementById('classSelector'),
      selectionConfirmation: document.getElementById('selectionConfirmation'),
      confirmationText: document.getElementById('confirmationText'),
      resultDisplay: document.getElementById('resultDisplay'),
      rollingAnimation: document.getElementById('rollingAnimation'),
      welcomeMessage: document.getElementById('welcomeMessage'),
      startBtn: document.getElementById('startBtn'),
      stopBtn: document.getElementById('stopBtn'),
      removeBtn: document.getElementById('removeBtn'),
      honorBtn: document.getElementById('honorBtn'),
      resetBtn: document.getElementById('resetBtn'),
      settingsBtn: document.getElementById('settingsBtn'),
      settingsPanel: document.getElementById('settingsPanel'),
      closeSettingsBtn: document.getElementById('closeSettingsBtn'),
      speedSlider: document.getElementById('speedSlider'),
      durationSlider: document.getElementById('durationSlider'),
      speedValue: document.getElementById('speedValue'),
      durationValue: document.getElementById('durationValue'),
      volumeSlider: document.getElementById('volumeSlider'),
      volumeValue: document.getElementById('volumeValue'),
      rollingAudioToggle: document.getElementById('rollingAudioToggle'),
      selectionAudioToggle: document.getElementById('selectionAudioToggle'),
      celebrationAudioToggle: document.getElementById('celebrationAudioToggle'),
      clickAudioToggle: document.getElementById('clickAudioToggle'),
      studentInfo: document.getElementById('studentInfo'),
      totalStudents: document.getElementById('totalStudents'),
      remainingStudents: document.getElementById('remainingStudents'),
      selectedCount: document.getElementById('selectedCount'),
      removedCount: document.getElementById('removedCount'),
      honoredCount: document.getElementById('honoredCount'),
      honorBoard: document.getElementById('honorBoard'),
      honorList: document.getElementById('honorList'),
      clearHonorsBtn: document.getElementById('clearHonorsBtn'),
      exportHonorsBtn: document.getElementById('exportHonorsBtn'),
      backBtn: document.getElementById('backBtn'),
      fullscreenBtn: document.getElementById('fullscreenBtn'),
      rollingSound: document.getElementById('rollingSound'),
      selectSound: document.getElementById('selectSound'),
      clickSound: document.getElementById('clickSound'),
      celebrationSound: document.getElementById('celebrationSound')
    };

    // تشغيل الصوت مع معالجة الأخطاء والإعدادات
    function playSound(soundElement, soundType = 'general') {
      try {
        // التحقق من إعدادات الصوت
        const soundEnabled = {
          'rolling': audioSettings.rollingEnabled,
          'selection': audioSettings.selectionEnabled,
          'celebration': audioSettings.celebrationEnabled,
          'click': audioSettings.clickEnabled,
          'general': true
        };

        if (!soundEnabled[soundType]) {
          console.log(`🔇 تم إلغاء تشغيل صوت ${soundType} (مُعطل في الإعدادات)`);
          return;
        }

        if (soundElement && soundElement.readyState >= 2) {
          soundElement.currentTime = 0;
          soundElement.volume = audioSettings.volume;
          const playPromise = soundElement.play();
          if (playPromise !== undefined) {
            playPromise.catch(() => {
              console.log('🔇 تعذر تشغيل الصوت (يتطلب تفاعل المستخدم)');
            });
          }
        }
      } catch (error) {
        console.log('🔇 خطأ في تشغيل الصوت:', error);
      }
    }

    // تأثيرات بصرية للنقر
    function addClickEffect(element) {
      element.style.transform = 'scale(0.95)';
      setTimeout(() => {
        element.style.transform = '';
      }, 150);
    }

    // وظيفة ملء الشاشة
    async function toggleFullScreen() {
      try {
        if (!document.fullscreenElement) {
          await document.documentElement.requestFullscreen();
          console.log('🖥️ تم تفعيل ملء الشاشة');
        } else {
          await document.exitFullscreen();
          console.log('🖥️ تم إلغاء ملء الشاشة');
        }
      } catch (error) {
        console.warn('⚠️ فشل في تغيير وضع ملء الشاشة:', error);
      }
    }

    // تحميل بيانات الطلاب
    async function loadStudentData() {
      try {
        console.log('📚 جاري تحميل بيانات الطلاب...');
        const response = await fetch('../data/studentData.json');
        
        if (!response.ok) {
          throw new Error('فشل في تحميل بيانات الطلاب');
        }
        
        const data = await response.json();
        console.log('✅ تم تحميل بيانات الطلاب:', data);
        
        // تعبئة قائمة الصفوف من البنية الجديدة
        if (data && typeof data === 'object') {
          Object.keys(data).forEach(className => {
            if (Array.isArray(data[className]) && data[className].length > 0) {
              const option = document.createElement('option');
              option.value = className;
              option.textContent = `الصف ${className}`;
              elements.classSelect.appendChild(option);
            }
          });
        }
        
        return data;
        
      } catch (error) {
        console.error('❌ خطأ في تحميل بيانات الطلاب:', error);
        // إنشاء بيانات تجريبية
        createDemoData();
        return null;
      }
    }

    // إنشاء بيانات تجريبية
    function createDemoData() {
      console.log('🎭 إنشاء بيانات تجريبية...');
      
      const demoData = {
        'الخامس أ': ['أحمد محمد', 'فاطمة علي', 'يوسف سالم', 'مريم خالد', 'عبدالله سعيد', 'نور الدين', 'هند عبدالله', 'محمد يوسف'],
        'الخامس ب': ['سارة أحمد', 'علي محمد', 'لينا سالم', 'حمزة علي', 'زينب محمد', 'عمر خالد', 'ريم سعيد', 'خالد أحمد'],
        'السادس أ': ['منى علي', 'محمود سالم', 'دينا محمد', 'طارق أحمد', 'ريما خالد', 'سلطان علي', 'نوال محمد', 'فيصل سعيد']
      };

      Object.keys(demoData).forEach(className => {
        const option = document.createElement('option');
        option.value = className;
        option.textContent = `الصف ${className}`;
        elements.classSelect.appendChild(option);
      });

      // حفظ البيانات التجريبية
      window.demoStudentData = demoData;
    }

    // عرض رسالة التأكيد
    function showSelectionConfirmation(className) {
      elements.confirmationText.textContent = `تم اختيار الصف "${className}" بنجاح! 🎉`;
      elements.selectionConfirmation.classList.add('show');
      elements.classSelector.classList.add('selected');
      
      // إخفاء الرسالة بعد 3 ثوان
      setTimeout(() => {
        elements.selectionConfirmation.classList.remove('show');
      }, 3000);
    }

    // إخفاء رسالة التأكيد
    function hideSelectionConfirmation() {
      elements.selectionConfirmation.classList.remove('show');
      elements.classSelector.classList.remove('selected');
    }

    // تحديث قائمة الطلاب عند تغيير الصف
    async function updateStudentList(className) {
      if (!className) {
        currentStudents = [];
        availableStudents = [];
        hideSelectionConfirmation();
        resetActivity();
        return;
      }

      try {
        let studentData = null;
        
        // محاولة تحميل البيانات الحقيقية
        try {
          const response = await fetch('../data/studentData.json');
          if (response.ok) {
            studentData = await response.json();
          }
        } catch (error) {
          console.log('استخدام البيانات التجريبية');
        }
        
        // استخدام البيانات التجريبية إذا لم تتوفر البيانات الحقيقية
        if (!studentData && window.demoStudentData) {
          studentData = window.demoStudentData;
        }
        
        if (studentData) {
          // التعامل مع البنية الجديدة للبيانات
          let studentsArray = null;
          
          if (studentData[className] && Array.isArray(studentData[className])) {
            // البنية الجديدة: مفتاح مباشر للصف
            studentsArray = studentData[className];
          } else if (studentData.classes) {
            // البنية القديمة: classes array (للبيانات التجريبية القديمة)
            const selectedClass = studentData.classes.find(cls => cls.className === className);
            if (selectedClass && selectedClass.students) {
              studentsArray = selectedClass.students;
            }
          }
          
          if (studentsArray && studentsArray.length > 0) {
            currentStudents = [...studentsArray];
            availableStudents = [...studentsArray];
            removedStudents = [];
            selectedStudents = [];
            
            // إظهار رسالة التأكيد
            showSelectionConfirmation(className);
            
            updateUI();
            updateStats();
            showStudentInfo();
            
            console.log(`✅ تم تحميل ${currentStudents.length} طالب من الصف ${className}`);
          } else {
            console.warn(`⚠️ لم يتم العثور على طلاب في الصف ${className}`);
            alert(`⚠️ لم يتم العثور على طلاب في الصف ${className}!`);
            hideSelectionConfirmation();
          }
        }
        
      } catch (error) {
        console.error('❌ خطأ في تحديث قائمة الطلاب:', error);
        hideSelectionConfirmation();
      }
    }

    // تحديث واجهة المستخدم
    function updateUI() {
      const hasStudents = availableStudents.length > 0;
      
      elements.startBtn.disabled = !hasStudents || isRolling;
      elements.stopBtn.disabled = !isRolling;
      elements.removeBtn.disabled = !currentSelectedName || isRolling;
      elements.honorBtn.disabled = !currentSelectedName || isRolling;
      elements.resetBtn.disabled = currentStudents.length === 0;
      
      if (hasStudents && !currentSelectedName) {
        showWelcomeMessage();
      }
    }

    // عرض رسالة الترحيب
    function showWelcomeMessage() {
      const honoredCount = honoredStudents.length;
      let message = `🎯 الصف محدد ونحن جاهزون!<br>${availableStudents.length} طالب متاح للاختيار`;
      
      if (honoredCount > 0) {
        message += `<br>🏆 ${honoredCount} طالب مُكرم في لوحة الشرف`;
      }
      
      elements.rollingAnimation.innerHTML = `
        <div class="welcome-message">
          ${message}
        </div>
      `;
    }

    // بدء عملية الاختيار العشوائي
    function startSelection() {
      if (availableStudents.length === 0) {
        alert('⚠️ لا يوجد طلاب متاحون للاختيار!');
        return;
      }

      isRolling = true;
      currentSelectedName = '';
      updateUI();
      
      playSound(elements.rollingSound, 'rolling');
      
      // إزالة أي محتوى سابق
      elements.rollingAnimation.innerHTML = '';
      
      // إنشاء عنصر التدوير
      const rollingElement = document.createElement('div');
      rollingElement.className = 'rolling-names';
      elements.rollingAnimation.appendChild(rollingElement);
      
      // بدء التدوير
      rollingInterval = setInterval(() => {
        const randomIndex = Math.floor(Math.random() * availableStudents.length);
        rollingElement.textContent = availableStudents[randomIndex];
      }, rollingSpeed);
      
      // إيقاف التدوير بعد المدة المحددة
      setTimeout(() => {
        if (isRolling) {
          stopSelection();
        }
      }, rollingDuration);
      
      console.log('🎲 بدء عملية الاختيار العشوائي');
    }

    // إيقاف عملية الاختيار
    function stopSelection() {
      if (!isRolling || availableStudents.length === 0) return;
      
      clearInterval(rollingInterval);
      isRolling = false;
      
      // اختيار طالب عشوائي نهائي
      const randomIndex = Math.floor(Math.random() * availableStudents.length);
      currentSelectedName = availableStudents[randomIndex];
      
      // إضافة إلى قائمة المختارين
      selectedStudents.push(currentSelectedName);
      
      // عرض النتيجة
      showSelectedName(currentSelectedName);
      
      playSound(elements.selectSound, 'selection');
      setTimeout(() => {
        playSound(elements.celebrationSound, 'celebration');
      }, 500);
      
      updateUI();
      updateStats();
      
      console.log(`✅ تم اختيار: ${currentSelectedName}`);
    }

    // عرض الاسم المختار
    function showSelectedName(name) {
      elements.rollingAnimation.innerHTML = `
        <div class="selected-name celebration">
          🎉 ${name} 🎉
        </div>
      `;
      
      // إضافة تأثير الاحتفال
      elements.resultDisplay.classList.add('pulsing');
      setTimeout(() => {
        elements.resultDisplay.classList.remove('pulsing');
      }, 2000);
    }

    // استبعاد الطالب المختار
    function removeSelectedStudent() {
      if (!currentSelectedName) return;
      
      // إضافة إلى قائمة المستبعدين
      removedStudents.push(currentSelectedName);
      
      // إزالة من قائمة المتاحين
      const index = availableStudents.indexOf(currentSelectedName);
      if (index > -1) {
        availableStudents.splice(index, 1);
      }
      
      // إزالة من قائمة المختارين
      const selectedIndex = selectedStudents.indexOf(currentSelectedName);
      if (selectedIndex > -1) {
        selectedStudents.splice(selectedIndex, 1);
      }
      
      currentSelectedName = '';
      
      if (availableStudents.length > 0) {
        showWelcomeMessage();
      } else {
        elements.rollingAnimation.innerHTML = `
          <div class="welcome-message">
            🏁 تم استبعاد جميع الطلاب!<br>
            استخدم زر "إعادة تعيين" لبدء من جديد
          </div>
        `;
      }
      
      updateUI();
      updateStats();
      
      console.log(`❌ تم استبعاد: ${removedStudents[removedStudents.length - 1]}`);
    }

    // تكريم الطالب المختار
    function honorSelectedStudent() {
      if (!currentSelectedName) return;
      
      // التحقق من عدم تكريم الطالب مسبقاً
      const isAlreadyHonored = honoredStudents.some(student => student.name === currentSelectedName);
      if (isAlreadyHonored) {
        // إذا كان مُكرماً بالفعل، نسأل المعلم إذا كان يريد تكريمه مرة أخرى
        if (!confirm(`🏆 هذا الطالب مُكرم بالفعل في لوحة الشرف!\nهل تريد تكريمه مرة أخرى؟`)) {
          return;
        }
      }
      
      // إضافة إلى قائمة المكرمين (حتى لو كان مُكرماً مسبقاً)
      const honoredStudent = {
        name: currentSelectedName,
        timestamp: new Date(),
        rank: honoredStudents.length + 1
      };
      
      honoredStudents.push(honoredStudent);
      
      // عرض تأثير التكريم
      showHonorEffect(currentSelectedName);
      
      // تحديث لوحة الشرف
      updateHonorBoard();
      showHonorBoard();
      
      // تشغيل صوت التكريم
      playSound(elements.celebrationSound, 'celebration');
      
      // مسح الاسم المختار الحالي فقط (لا نزيل الطالب من قائمة المتاحين)
      currentSelectedName = '';
      
      // إظهار رسالة الاستعداد للاختيار التالي
      if (availableStudents.length > 0) {
        showWelcomeMessage();
      }
      
      updateUI();
      updateStats();
      
      console.log(`🏆 تم تكريم: ${honoredStudent.name} - الطالب يبقى متاحاً للاختيار`);
    }

    // عرض تأثير التكريم
    function showHonorEffect(name) {
      elements.rollingAnimation.innerHTML = `
        <div class="selected-name celebration" style="color: var(--accent-color); text-shadow: 3px 3px 6px rgba(255, 215, 0, 0.5);">
          🏆 تم تكريم ${name} 🏆
          <div style="font-size: 0.6em; margin-top: 10px; color: #B8860B;">
            ✨ تمت إضافته إلى لوحة الشرف ✨
          </div>
          <div style="font-size: 0.5em; margin-top: 8px; color: var(--primary-color);">
            📚 الطالب يبقى متاحاً للاختيار مرة أخرى
          </div>
        </div>
      `;
      
      // إضافة تأثير الاحتفال الذهبي
      elements.resultDisplay.classList.add('celebration');
      setTimeout(() => {
        elements.resultDisplay.classList.remove('celebration');
      }, 4000);
    }

    // تحديث لوحة الشرف
    function updateHonorBoard() {
      if (honoredStudents.length === 0) {
        elements.honorList.innerHTML = `
          <div class="no-honors">
            <div class="honor-icon">⭐</div>
            <p>لم يتم تكريم أي طالب بعد</p>
            <small>اختر طالباً واضغط على زر التكريم لإضافته للوحة الشرف</small>
          </div>
        `;
        elements.clearHonorsBtn.disabled = true;
        elements.exportHonorsBtn.disabled = true;
        return;
      }

      let honorHTML = '';
      honoredStudents.forEach((student, index) => {
        const medals = ['🥇', '🥈', '🥉'];
        const medal = medals[index] || '🏅';
        const rankText = index === 0 ? '1st' : index === 1 ? '2nd' : index === 2 ? '3rd' : `${index + 1}th`;
        
        honorHTML += `
          <div class="honor-item">
            <div class="honor-student-info">
              <div class="honor-rank">${index + 1}</div>
              <div class="honor-name">${student.name}</div>
            </div>
            <div class="honor-medal">${medal}</div>
            <div class="honor-time">${formatHonorTime(student.timestamp)}</div>
          </div>
        `;
      });

      elements.honorList.innerHTML = honorHTML;
      elements.clearHonorsBtn.disabled = false;
      elements.exportHonorsBtn.disabled = false;
    }

    // تنسيق وقت التكريم
    function formatHonorTime(timestamp) {
      const now = new Date();
      const diff = now - timestamp;
      const minutes = Math.floor(diff / 60000);
      
      if (minutes < 1) return 'الآن';
      if (minutes === 1) return 'منذ دقيقة';
      if (minutes < 60) return `منذ ${minutes} دقائق`;
      
      const hours = Math.floor(minutes / 60);
      if (hours === 1) return 'منذ ساعة';
      if (hours < 24) return `منذ ${hours} ساعات`;
      
      return timestamp.toLocaleDateString('ar-SA');
    }

    // إظهار لوحة الشرف
    function showHonorBoard() {
      elements.honorBoard.style.display = 'block';
    }

    // إخفاء لوحة الشرف
    function hideHonorBoard() {
      elements.honorBoard.style.display = 'none';
    }

    // مسح لوحة الشرف
    function clearHonorBoard() {
      if (honoredStudents.length === 0) return;
      
      if (confirm('هل تريد مسح جميع الطلاب من لوحة الشرف؟\nهذا الإجراء لا يمكن التراجع عنه.')) {
        honoredStudents = [];
        updateHonorBoard();
        updateStats();
        hideHonorBoard();
        
        playSound(elements.clickSound, 'click');
        console.log('🗑️ تم مسح لوحة الشرف');
      }
    }

    // تصدير قائمة المكرمين
    function exportHonorsList() {
      if (honoredStudents.length === 0) {
        alert('⚠️ لا يوجد طلاب مكرمون لتصديرهم!');
        return;
      }

      let exportText = '🏆 لوحة الشرف - الطلاب المكرمون 🏆\n\n';
      exportText += `التاريخ: ${new Date().toLocaleDateString('ar-SA')}\n`;
      exportText += `الوقت: ${new Date().toLocaleTimeString('ar-SA')}\n\n`;
      exportText += '═══════════════════════════════\n\n';

      honoredStudents.forEach((student, index) => {
        const medals = ['🥇', '🥈', '🥉'];
        const medal = medals[index] || '🏅';
        exportText += `${medal} المركز ${index + 1}: ${student.name}\n`;
        exportText += `   وقت التكريم: ${formatHonorTime(student.timestamp)}\n\n`;
      });

      exportText += '═══════════════════════════════\n';
      exportText += `إجمالي الطلاب المكرمين: ${honoredStudents.length}\n`;
      exportText += '\n🎓 مبارك لجميع الطلاب المتميزين! 🎓';

      // نسخ النص للحافظة
      navigator.clipboard.writeText(exportText).then(() => {
        alert('✅ تم نسخ قائمة المكرمين إلى الحافظة بنجاح!\nيمكنك الآن لصقها في أي مكان تريد.');
        playSound(elements.selectSound, 'selection');
      }).catch(() => {
        // إذا فشل النسخ، عرض النص في نافذة
        const newWindow = window.open('', '_blank');
        newWindow.document.write(`<pre style="font-family: Arial; direction: rtl; text-align: right; padding: 20px; line-height: 1.6;">${exportText}</pre>`);
        newWindow.document.title = 'لوحة الشرف - الطلاب المكرمون';
      });

      console.log('📋 تم تصدير قائمة المكرمين');
    }

    // إعادة تعيين النشاط
    function resetActivity() {
      clearInterval(rollingInterval);
      isRolling = false;
      currentSelectedName = '';
      
      if (currentStudents.length > 0) {
        availableStudents = [...currentStudents];
        removedStudents = [];
        selectedStudents = [];
        showWelcomeMessage();
        showStudentInfo();
        
        // إظهار لوحة الشرف إذا كان هناك طلاب مكرمون
        if (honoredStudents.length > 0) {
          showHonorBoard();
        }
      } else {
        hideStudentInfo();
        hideHonorBoard();
        elements.rollingAnimation.innerHTML = `
          <div class="welcome-message">
            👋 مرحباً بك في نشاط الاختيار العشوائي<br>
            اختر الصف الدراسي أولاً لبدء المتعة!
          </div>
        `;
      }
      
      updateUI();
      updateStats();
      
      console.log('🔄 تم إعادة تعيين النشاط');
    }

    // تحديث الإحصائيات
    function updateStats() {
      elements.totalStudents.textContent = currentStudents.length;
      elements.remainingStudents.textContent = availableStudents.length;
      elements.selectedCount.textContent = selectedStudents.length;
      elements.removedCount.textContent = removedStudents.length;
      elements.honoredCount.textContent = honoredStudents.length;
    }

    // إظهار معلومات الطلاب
    function showStudentInfo() {
      elements.studentInfo.style.display = 'block';
    }

    // إخفاء معلومات الطلاب
    function hideStudentInfo() {
      elements.studentInfo.style.display = 'none';
    }

    // تحديث إعدادات السرعة والصوت
    function updateSpeedSettings() {
      rollingSpeed = parseInt(elements.speedSlider.value);
      rollingDuration = parseInt(elements.durationSlider.value) * 1000;
      
      // تحديث النصوص
      const speedLabels = {
        50: 'سريع جداً',
        100: 'سريع',
        150: 'متوسط',
        200: 'بطيء',
        250: 'بطيء جداً',
        300: 'بطيء للغاية'
      };
      
      const closestSpeed = Object.keys(speedLabels).reduce((prev, curr) => 
        Math.abs(curr - rollingSpeed) < Math.abs(prev - rollingSpeed) ? curr : prev
      );
      
      elements.speedValue.textContent = speedLabels[closestSpeed];
      elements.durationValue.textContent = `${rollingDuration / 1000} ثوان`;
    }

    // تحديث إعدادات الصوت
    function updateAudioSettings() {
      // تحديث مستوى الصوت
      audioSettings.volume = parseInt(elements.volumeSlider.value) / 100;
      elements.volumeValue.textContent = `${parseInt(elements.volumeSlider.value)}%`;
      
      // تحديث إعدادات تشغيل الأصوات
      audioSettings.rollingEnabled = elements.rollingAudioToggle.checked;
      audioSettings.selectionEnabled = elements.selectionAudioToggle.checked;
      audioSettings.celebrationEnabled = elements.celebrationAudioToggle.checked;
      audioSettings.clickEnabled = elements.clickAudioToggle.checked;
      
      // تطبيق مستوى الصوت على جميع عناصر الصوت
      [elements.rollingSound, elements.selectSound, elements.clickSound, elements.celebrationSound]
        .forEach(audio => {
          if (audio) audio.volume = audioSettings.volume;
        });
      
      console.log('🔊 تم تحديث إعدادات الصوت:', audioSettings);
    }

    // إظهار لوحة الإعدادات
    function showSettings() {
      console.log('⚙️ إظهار لوحة الإعدادات...');
      playSound('click');
      
      elements.settingsPanel.style.display = 'block';
      elements.settingsPanel.style.animation = 'slideUp 0.4s ease-out';
      
      // تحديث حالة زر الإعدادات
      elements.settingsBtn.classList.add('active');
      elements.settingsBtn.querySelector('span:last-child').textContent = 'إخفاء الإعدادات';
      
      console.log('✅ تم إظهار لوحة الإعدادات');
    }

    // إخفاء لوحة الإعدادات
    function hideSettings() {
      console.log('❌ إخفاء لوحة الإعدادات...');
      playSound('click');
      
      elements.settingsPanel.style.animation = 'slideDown 0.4s ease-out';
      
      setTimeout(() => {
        elements.settingsPanel.style.display = 'none';
      }, 400);
      
      // إعادة تعيين حالة زر الإعدادات
      elements.settingsBtn.classList.remove('active');
      elements.settingsBtn.querySelector('span:last-child').textContent = 'الإعدادات';
      
      console.log('✅ تم إخفاء لوحة الإعدادات');
    }

    // تبديل عرض الإعدادات
    function toggleSettings() {
      const isVisible = elements.settingsPanel.style.display !== 'none';
      
      if (isVisible) {
        hideSettings();
      } else {
        showSettings();
      }
    }

    // تهيئة النشاط
    async function initializeActivity() {
      console.log('⚡ جاري تهيئة نشاط الاختيار العشوائي...');
      
      await loadStudentData();
      updateSpeedSettings();
      updateAudioSettings();
      updateUI();
      
      console.log('🎉 تم تحميل النشاط بنجاح!');
    }

    // معالجة الأحداث
    document.addEventListener('DOMContentLoaded', () => {
      console.log('📄 تم تحميل DOM - بدء تهيئة الأحداث...');
      
      // تهيئة النشاط
      initializeActivity();

      // اختيار الصف
      elements.classSelect.addEventListener('change', (e) => {
        console.log(`🎓 تم اختيار الصف: ${e.target.value}`);
        
        if (e.target.value) {
          // تشغيل صوت عند اختيار صف
          playSound(elements.selectSound, 'selection');
          
          // تأثير بصري على القائمة
          addClickEffect(e.target);
        }
        
        updateStudentList(e.target.value);
      });

      // أزرار التحكم الرئيسية
      elements.startBtn.addEventListener('click', (e) => {
        console.log('🚀 تم النقر على زر البدء');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        startSelection();
      });

      elements.stopBtn.addEventListener('click', (e) => {
        console.log('⏹️ تم النقر على زر التوقف');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        stopSelection();
      });

      elements.removeBtn.addEventListener('click', (e) => {
        console.log('❌ تم النقر على زر الاستبعاد');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        
        if (confirm(`هل تريد استبعاد "${currentSelectedName}" من القائمة؟`)) {
          removeSelectedStudent();
        }
      });

      elements.honorBtn.addEventListener('click', (e) => {
        console.log('🏆 تم النقر على زر التكريم');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        
        if (confirm(`🏆 هل تريد إضافة "${currentSelectedName}" إلى لوحة الشرف؟\n\n(الطالب سيبقى متاحاً للاختيار مرة أخرى)`)) {
          honorSelectedStudent();
        }
      });

      elements.resetBtn.addEventListener('click', (e) => {
        console.log('🔄 تم النقر على زر إعادة التعيين');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        
        if (confirm('هل تريد إعادة تعيين النشاط وإرجاع جميع الطلاب؟')) {
          resetActivity();
        }
      });

      // زر الإعدادات
      elements.settingsBtn.addEventListener('click', (e) => {
        console.log('⚙️ تم النقر على زر الإعدادات');
        addClickEffect(e.target);
        toggleSettings();
      });

      // زر إغلاق الإعدادات
      elements.closeSettingsBtn.addEventListener('click', (e) => {
        console.log('❌ تم النقر على زر إغلاق الإعدادات');
        addClickEffect(e.target);
        hideSettings();
      });

      // إغلاق الإعدادات عند النقر خارج اللوحة
      document.addEventListener('click', (e) => {
        const isSettingsPanel = elements.settingsPanel.contains(e.target);
        const isSettingsBtn = elements.settingsBtn.contains(e.target);
        const isSettingsVisible = elements.settingsPanel.style.display !== 'none';
        
        if (!isSettingsPanel && !isSettingsBtn && isSettingsVisible) {
          hideSettings();
        }
      });

      // إعدادات السرعة والمدة والصوت
      elements.speedSlider.addEventListener('input', updateSpeedSettings);
      elements.durationSlider.addEventListener('input', updateSpeedSettings);
      elements.volumeSlider.addEventListener('input', updateAudioSettings);
      elements.rollingAudioToggle.addEventListener('change', updateAudioSettings);
      elements.selectionAudioToggle.addEventListener('change', updateAudioSettings);
      elements.celebrationAudioToggle.addEventListener('change', updateAudioSettings);
      elements.clickAudioToggle.addEventListener('change', updateAudioSettings);

      // أزرار لوحة الشرف
      elements.clearHonorsBtn.addEventListener('click', (e) => {
        console.log('🗑️ تم النقر على زر مسح لوحة الشرف');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        clearHonorBoard();
      });

      elements.exportHonorsBtn.addEventListener('click', (e) => {
        console.log('📋 تم النقر على زر تصدير قائمة المكرمين');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        exportHonorsList();
      });

      // أزرار التحكم العلوية
      elements.fullscreenBtn.addEventListener('click', (e) => {
        console.log('🖥️ تم النقر على زر ملء الشاشة');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        toggleFullScreen();
      });

      elements.backBtn.addEventListener('click', (e) => {
        console.log('🏠 تم النقر على زر العودة');
        addClickEffect(e.target);
        playSound(elements.clickSound, 'click');
        
        // تأثير انتقال سلس
        document.body.style.opacity = '0';
        document.body.style.transform = 'scale(0.95)';
        
        setTimeout(() => {
          window.location.href = '../main.html';
        }, 300);
      });

      // اختصارات لوحة المفاتيح
      document.addEventListener('keydown', (e) => {
        switch(e.key) {
          case 'Enter':
          case ' ':
            if (!isRolling && !elements.startBtn.disabled) {
              e.preventDefault();
              elements.startBtn.click();
            } else if (isRolling) {
              e.preventDefault();
              elements.stopBtn.click();
            }
            break;
          case 'Escape':
            if (isRolling) {
              elements.stopBtn.click();
            } else if (document.fullscreenElement) {
              document.exitFullscreen();
            }
            break;
          case 'F11':
            e.preventDefault();
            toggleFullScreen();
            break;
          case 'r':
          case 'R':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              elements.resetBtn.click();
            }
            break;
          case 'Delete':
          case 'Backspace':
            if (!isRolling && currentSelectedName) {
              e.preventDefault();
              elements.removeBtn.click();
            }
            break;
          case 'h':
          case 'H':
            if (!isRolling && currentSelectedName) {
              e.preventDefault();
              elements.honorBtn.click();
            }
            break;
        }
      });

      console.log('✅ تم تهيئة جميع الأحداث بنجاح!');
    });

    // معالجة الأخطاء العامة
    window.addEventListener('error', (e) => {
      console.error('💥 خطأ عام في النشاط:', e.error);
    });

    window.addEventListener('unhandledrejection', (e) => {
      console.error('💥 خطأ غير معالج في Promise:', e.reason);
    });

    console.log('📝 تم تحميل جميع النصوص البرمجية للنشاط!');
  </script>
  
  <!-- Responsive Helper Script -->
  <script src="../assets/js/responsive-helper.js"></script>
</body>
</html>
