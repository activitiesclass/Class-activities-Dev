  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ² ÙˆÙ„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù -->
  <div id="victory-screen" class="victory-screen" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:99999;background:rgba(0,0,0,0.85);align-items:center;justify-content:center;">
    <div class="victory-content" style="background:linear-gradient(135deg,#fffbe6 0%,#ffd700 100%);border-radius:30px;padding:40px 30px;box-shadow:0 0 60px #ffd700a0;max-width:400px;margin:auto;text-align:center;position:relative;">
      <button class="victory-close" onclick="victoryManager.hideVictoryScreen()" style="position:absolute;top:10px;left:10px;background:none;border:none;font-size:1.5em;cursor:pointer;color:#DC143C;"><i class="fas fa-times"></i></button>
      <div class="victory-crown" style="font-size:3.5em;">ğŸ‘‘</div>
      <h1 class="victory-title" id="victory-title" style="color:#DC143C;font-size:2em;margin:10px 0;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h1>
      <div class="winner-name" id="winner-name" style="font-size:1.5em;color:#23243a;font-weight:bold;margin-bottom:10px;">Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„ÙØ§Ø¦Ø²</div>
      <div class="victory-stats" style="margin:18px 0;">
        <div class="stats-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div class="stat-item"><span class="stat-value" id="final-time">00:00</span><span class="stat-label" style="display:block;font-size:0.9em;">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚</span></div>
          <div class="stat-item"><span class="stat-value" id="final-moves">0</span><span class="stat-label" style="display:block;font-size:0.9em;">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙƒØ§Øª</span></div>
          <div class="stat-item"><span class="stat-value" id="final-level">1</span><span class="stat-label" style="display:block;font-size:0.9em;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…ÙƒØªÙ…Ù„</span></div>
          <div class="stat-item"><span class="stat-value" id="final-score">0</span><span class="stat-label" style="display:block;font-size:0.9em;">Ø§Ù„Ù†Ù‚Ø§Ø·</span></div>
        </div>
      </div>
      <div class="victory-actions" style="margin-top:18px;display:flex;gap:10px;justify-content:center;">
        <button class="victory-btn btn-play-again" onclick="playAgain()" style="background:linear-gradient(90deg,#FFD700,#fffbe6 80%,#FFD700);color:#23243a;font-weight:bold;padding:12px 18px;border-radius:12px;border:none;font-size:1em;cursor:pointer;"><i class="fas fa-redo"></i> Ø§Ù„Ø¹Ø¨ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
        <button class="victory-btn btn-home" onclick="goToHome()" style="background:linear-gradient(90deg,#DC143C,#FFD700);color:#fff;font-weight:bold;padding:12px 18px;border-radius:12px;border:none;font-size:1em;cursor:pointer;"><i class="fas fa-home"></i> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      </div>
    </div>
  </div>
  <script>
    // Ù…Ø¯ÙŠØ± Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ²
    class VictoryManager {
      constructor() {
        this.victoryScreen = document.getElementById('victory-screen');
      }
      showVictoryScreen(winnerData) {
        const { name, time, moves, level, score } = winnerData;
        document.getElementById('winner-name').textContent = name;
        document.getElementById('final-time').textContent = time;
        document.getElementById('final-moves').textContent = moves;
        document.getElementById('final-level').textContent = level;
        document.getElementById('final-score').textContent = score;
        this.victoryScreen.style.display = 'flex';
        this.playVictorySound();
        setTimeout(()=>this.createCelebrationEffect(), 800);
      }
      hideVictoryScreen() {
        this.victoryScreen.style.display = 'none';
      }
      playVictorySound() {
        if(window.audioManager) {
          audioManager.playSound('battle-victory');
          setTimeout(()=>audioManager.playSound('crowd-cheer'), 500);
          setTimeout(()=>audioManager.playSound('perfect-score'), 1000);
        }
      }
      createCelebrationEffect() {
        for(let i=0;i<20;i++) {
          setTimeout(()=>{
            const particle = document.createElement('div');
            particle.innerHTML = ['ğŸ‰','âœ¨','ğŸŒŸ','ğŸ’«','ğŸŠ'][Math.floor(Math.random()*5)];
            particle.style.position = 'fixed';
            particle.style.fontSize = '2rem';
            particle.style.pointerEvents = 'none';
            particle.style.zIndex = '100000';
            particle.style.left = (window.innerWidth/2 + (Math.random()-0.5)*200) + 'px';
            particle.style.top = (window.innerHeight/2 + (Math.random()-0.5)*100) + 'px';
            document.body.appendChild(particle);
            particle.animate([
              { transform: 'translateY(0) scale(1)', opacity: 1 },
              { transform: `translateY(-${Math.random()*200+100}px) scale(0)`, opacity: 0 }
            ], { duration: 2000, easing: 'ease-out' }).onfinish = ()=>particle.remove();
          }, i*80);
        }
      }
    }
    window.victoryManager = new VictoryManager();
    function showGameVictory(winnerName, gameStats) {
      const winnerData = {
        name: winnerName,
        time: gameStats.time || '00:00',
        moves: gameStats.moves || 0,
        level: gameStats.level || 1,
        score: gameStats.score || 0
      };
      victoryManager.showVictoryScreen(winnerData);
    }
    function playAgain() {
      victoryManager.hideVictoryScreen();
      window.location.reload();
    }
    function goToHome() {
      victoryManager.hideVictoryScreen();
      setTimeout(()=>{ window.location.href = '../main.html'; }, 300);
    }
  </script>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --tower-gradient: linear-gradient(45deg, #ffd700 0%, #ff6b35 50%, #ffd700 100%);
      --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      --danger-gradient: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
      --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --cosmic-bg: linear-gradient(45deg, #181c2a 0%, #23243a 100%);
      --success-color: #11998e;
      --danger-color: #fc466b;
      --warning-color: #f5576c;
      --neon-cyan: #00f5ff;
      --neon-pink: #ff073a;
      --border-radius: 18px;
      --border-radius-small: 12px;
      --spacing-xs: 8px;
      --spacing-sm: 14px;
      --spacing-md: 22px;
      --spacing-lg: 36px;
      --spacing-xl: 48px;
      --transition-fast: 0.18s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      --transition-normal: 0.28s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      --transition-slow: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      --elastic-timing: cubic-bezier(0.68, -0.55, 0.265, 1.55);
      --cosmic-timing: cubic-bezier(0.25, 0.46, 0.45, 0.94);
      --text-primary: #fffbe6;
      --text-secondary: #ffd700;
      --text-light: #fff;
      --text-dark: #23243a;
      --shadow-strong: 0 8px 32px rgba(0,0,0,0.45);
      --shadow-soft: 0 2px 8px #FFD70022;
    }
    body {
      font-family: 'Cairo', sans-serif;
      background: var(--cosmic-bg);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      letter-spacing: 0.01em;
    }
    .top-toolbar {
      position: fixed; top: 0; left: 0; right: 0; height: 70px;
      background: linear-gradient(135deg, #181c2a 80%, #ffd70022 100%);
      backdrop-filter: blur(25px);
      border-bottom: 2px solid #ffd70055;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 var(--spacing-lg);
      z-index: 10000;
      box-shadow: var(--shadow-strong);
      animation: toolbarSlideDown 1s var(--cosmic-timing);
    }
    @keyframes toolbarSlideDown { 0% { opacity: 0; transform: translateY(-100%); } 100% { opacity: 1; transform: translateY(0); } }
    .game-logo {
      display: flex; align-items: center; gap: var(--spacing-sm);
      font-family: 'Orbitron', 'Cairo', sans-serif;
      font-size: 1.7rem; font-weight: 900;
      background: var(--tower-gradient);
      background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-shadow: 0 0 24px #ffd700a0;
      cursor: pointer; transition: all var(--transition-normal);
      position: relative;
      letter-spacing: 0.04em;
    }
    .game-logo::before { content: 'ğŸ‘‘'; font-size: 2.1rem; animation: logoFloat 3s ease-in-out infinite; filter: drop-shadow(0 0 15px #ffd700cc); }
    .game-logo:hover { transform: scale(1.07); filter: drop-shadow(0 0 30px #ffd700cc); }
    @keyframes logoFloat { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-7px) rotate(10deg); } }
    .toolbar-icons { display: flex; gap: var(--spacing-sm); align-items: center; }
    .toolbar-icon {
      width: 52px; height: 52px; border-radius: 50%;
      background: linear-gradient(135deg, #23243a 60%, #ffd70022 100%);
      border: 2px solid #ffd70055;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: all var(--elastic-timing);
      position: relative; overflow: hidden; font-size: 1.4rem;
      color: var(--text-secondary);
      box-shadow: 0 5px 20px #181c2a99, inset 0 1px 0 #ffd70033;
    }
    .toolbar-icon:hover {
      transform: translateY(-3px) scale(1.13);
      border-color: var(--neon-cyan);
      color: var(--neon-cyan);
      box-shadow: 0 15px 40px #00f5ff44, 0 0 30px var(--neon-cyan), inset 0 2px 5px #ffd70055;
      text-shadow: 0 0 18px currentColor;
    }
    .toolbar-icon:active { transform: translateY(-1px) scale(1.07); }
    .toolbar-icon[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute; bottom: -44px; left: 50%; transform: translateX(-50%);
      background: #23243aee; color: #ffd700; padding: 9px 14px; border-radius: 10px;
      font-size: 1.05rem; font-weight: 700; white-space: nowrap; z-index: 10001;
      animation: tooltipFadeIn 0.3s ease; box-shadow: 0 5px 15px #181c2a99;
      font-family: 'Cairo', sans-serif;
      letter-spacing: 0.02em;
    }
    @keyframes tooltipFadeIn { 0% { opacity: 0; transform: translateX(-50%) translateY(-10px); } 100% { opacity: 1; transform: translateX(-50%) translateY(0); } }
    .container { margin-top: 80px; }
    .main-container {
      background: linear-gradient(135deg, #23243a 80%, #ffd70011 100%);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-soft);
      padding: var(--spacing-lg) var(--spacing-md);
      max-width: 600px;
      margin: 0 auto 32px auto;
      border: 1.5px solid #ffd70033;
    }
    .title {
      font-size: 2.1rem;
      font-weight: 900;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 8px;
      letter-spacing: 0.03em;
      text-shadow: 0 0 18px #ffd70055;
    }
    .subtitle {
      font-size: 1.15rem;
      color: #fffbe6cc;
      text-align: center;
      margin-bottom: 18px;
      font-weight: 600;
    }
    .notif {
      text-align: center;
      margin-bottom: 12px;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-secondary);
      background: #23243a;
      border-radius: var(--border-radius-small);
      padding: 8px 0;
      box-shadow: 0 2px 8px #ffd70022;
    }
    .select-row label {
      font-weight: 700;
      color: var(--text-secondary);
      margin-left: 8px;
    }
    .select-row select, .select-row button {
      font-size: 1.1rem;
      border-radius: var(--border-radius-small);
      border: 1.5px solid #ffd70055;
      padding: 7px 14px;
      margin-left: 8px;
      background: #23243a;
      color: var(--text-primary);
      font-weight: 600;
      transition: border-color var(--transition-fast);
    }
    .select-row button {
      background: var(--success-gradient);
      color: #fff;
      border: none;
      font-weight: 800;
      box-shadow: 0 2px 8px #38ef7d44;
    }
    .select-row button:hover {
      background: var(--danger-gradient);
      color: #fffbe6;
    }
    .student-list {
      display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 18px;
    }
    .student-chip {
      background: linear-gradient(90deg, #ffd700 60%, #fffbe6 100%);
      color: #23243a;
      font-weight: 800;
      border-radius: 20px;
      padding: 10px 22px;
      font-size: 1.1rem;
      box-shadow: 0 2px 8px #ffd70033;
      cursor: pointer;
      border: 2px solid #ffd70055;
      transition: all var(--transition-fast);
    }
    .student-chip.selected, .student-chip:hover {
      background: var(--success-gradient);
      color: #fff;
      border-color: #38ef7d;
      box-shadow: 0 4px 16px #38ef7d44;
    }
    .control-panel {
      background: linear-gradient(135deg, #fffbe6 0%, #ffd70022 100%);
      border-radius: var(--border-radius);
      padding: 18px 12px;
      box-shadow: var(--shadow-soft);
      max-width: 420px;
      margin: 0 auto 18px auto;
      border: 1.5px solid #ffd70033;
    }
    .current-player {
      text-align: center;
      margin-bottom: 18px;
    }
    .player-avatar {
      width: 90px; height: 90px; border-radius: 50%;
      background: var(--success-gradient,#FFD700);
      display: flex; align-items: center; justify-content: center;
      font-size: 2.5rem; color: #fff; font-weight: 800;
      margin: 0 auto 10px auto;
      box-shadow: 0 0 30px #FFD70099;
      border: 2.5px solid #fffbe6;
      letter-spacing: 0.04em;
    }
    .player-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: 6px;
      letter-spacing: 0.02em;
    }
    .player-status {
      color: #23243a;
      font-size: 1.1rem;
      font-weight: 600;
      background: #ffd70033;
      border-radius: 8px;
      padding: 4px 10px;
      display: inline-block;
    }
    .control-buttons {
      display: flex; gap: 10px; justify-content: center;
    }
    .control-btn {
      font-size: 1.1rem;
      border-radius: 12px;
      padding: 10px 18px;
      font-weight: 800;
      border: none;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast);
      box-shadow: 0 2px 8px #ffd70022;
    }
    .btn-primary { background: var(--primary-gradient); color: #fff; }
    .btn-success { background: var(--success-gradient); color: #fff; }
    .btn-danger { background: var(--danger-gradient); color: #fff; }
    .control-btn:hover { filter: brightness(1.1) contrast(1.2); }
    .scoreboard {
      margin: 0 auto 18px auto;
      max-width: 420px;
      background: #23243a;
      border-radius: var(--border-radius-small);
      box-shadow: 0 2px 8px #ffd70022;
      padding: 12px 0;
      border: 1.5px solid #ffd70033;
    }
    .score-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 18px;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      border-bottom: 1px solid #ffd70022;
    }
    .score-row:last-child { border-bottom: none; }
    .score-row .name { color: var(--text-secondary); }
    .score-row .score { color: #fffbe6; }
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙˆØ¶ÙˆØ­ ÙˆØ§Ù„ØªØ¨Ø§ÙŠÙ† */
    ::selection { background: #ffd70088; color: #23243a; }
    input, select, button { outline: none; }
    /* ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ... */
  </style>
</head>
<body>
  <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© -->
  <div id="notificationBar" style="position:fixed;top:0;left:50%;transform:translateX(-50%);z-index:20000;min-width:220px;max-width:90vw;padding:14px 28px;background:linear-gradient(90deg,#23243a 60%,#ffd700 100%);color:#fffbe6;font-size:1.15em;font-weight:800;border-radius:0 0 18px 18px;box-shadow:0 8px 32px #FFD70055,0 2px 8px #FFD70022;display:none;align-items:center;gap:12px;text-align:center;pointer-events:none;animation:fadeInNotif 0.7s;">
    <span id="notifIcon" style="font-size:1.3em;"></span>
    <span id="notifMsg"></span>
  </div>
  <style>@keyframes fadeInNotif{0%{opacity:0;transform:translateY(-30px) scale(0.95);}100%{opacity:1;transform:translateY(0) scale(1);}}</style>
  <div class="top-toolbar">
    <div class="game-logo">Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ©</div>
    <div class="toolbar-icons">
      <div class="toolbar-icon sound-icon" id="soundToggle" data-tooltip="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª"><i class="fas fa-volume-up"></i></div>
      <div class="toolbar-icon cache-icon" id="clearCacheBtn" data-tooltip="Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´"><i class="fas fa-broom"></i></div>
      <div class="toolbar-icon settings-icon" id="settingsBtn" data-tooltip="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"><i class="fas fa-cog"></i></div>
      <div class="toolbar-icon fullscreen-icon" id="fullscreenBtn" data-tooltip="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©"><i class="fas fa-expand"></i></div>
    </div>
  </div>
  <div class="container">
    <div class="main-container">
    <div class="title">ğŸ† Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</div>
    <div class="subtitle">Ø§Ø®ØªØ± Ø§Ù„ØµÙØŒ Ø«Ù… Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨Ù‹Ø§ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ø£Ùˆ ÙŠØ¯ÙˆÙŠÙ‹Ø§ØŒ ÙˆØ§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ù‹Ø§ Ø´ÙÙˆÙŠÙ‹Ø§ ÙˆÙ‚ÙŠÙ‘Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©!</div>
    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ù…ØªÙ†Ø§ÙØ³ÙŠÙ† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© -->
    <div class="selection-panel" id="selectionPanel">
      <div class="glass-container" style="background: rgba(0,0,0,0.8); border: 2px solid rgba(255,215,0,0.5);">
        <div style="position: relative; margin-bottom: 2rem;">
          <h2 style="text-align: center; color: #ffd700; font-size: 2.2rem; margin-bottom: 0.5rem;">ğŸ‘¥ Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ©</h2>
          <p style="text-align: center; color: rgba(255,255,255,0.8); font-size: 1.1rem;">âš¡ Ø§Ø®ØªØ± ØµÙÙƒ ÙˆØ·Ù„Ø§Ø¨Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø¨Ø§Ù‚</p>
        </div>
        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ -->
        <div class="class-selection-section" style="margin-bottom: 3rem;">
          <h3 style="color: #00ffff; font-size: 1.5rem; margin-bottom: 1rem; text-align: center;">ğŸ« Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ</h3>
          <div class="class-grid" id="classGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;"></div>
        </div>
        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨ -->
        <div class="student-selection-section" id="studentSelectionSection" style="display: none;">
          <h3 style="color: #ff6347; font-size: 1.5rem; margin-bottom: 1rem; text-align: center;">ğŸ¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</h3>
          <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <button class="neural-button" id="clearAllBtn">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„</button>
            <button class="neural-button" id="selectRandomBtn">ğŸ² Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
          </div>
          <div class="students-grid" id="studentsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 2rem;"></div>
          <div style="text-align: center; margin-bottom: 2rem;">
            <div style="background: rgba(0,255,255,0.2); padding: 1rem; border-radius: 15px; display: inline-block;">
              <span style="color: #00ffff; font-size: 1.1rem; font-weight: 700;">Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ† Ø§Ù„Ù…Ø®ØªØ§Ø±ÙˆÙ†: <span id="selectedCount">0</span></span>
            </div>
          </div>
          <div style="text-align: center;">
            <button class="neural-button" id="startRaceBtn" style="font-size: 1.1rem; padding: 1.2rem 2.5rem; background: linear-gradient(45deg, #ffd700, #ff6347);" disabled>ğŸš€ Ø¨Ø¯Ø¡ Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ©</button>
          </div>
        </div>
      </div>
    </div>
    <div class="control-panel" id="controlPanel" style="background:linear-gradient(135deg,#fffbe6 0%,#ffd70022 100%);border-radius:18px;padding:18px 12px;box-shadow:0 2px 8px #FFD70022;max-width:420px;margin:0 auto 18px auto;display:none;">
      <div class="current-player" style="text-align:center;margin-bottom:18px;">
        <div class="player-avatar" id="playerAvatar" style="width:90px;height:90px;border-radius:50%;background:var(--success-gradient,#FFD700);display:flex;align-items:center;justify-content:center;font-size:2.5rem;color:#fff;font-weight:800;margin:0 auto 10px auto;box-shadow:0 0 30px #FFD70099;">?</div>
        <div class="player-name" id="currentStudent" style="font-size:1.5rem;font-weight:700;color:#FFD700;margin-bottom:6px;"></div>
        <div class="player-status" id="playerStatus" style="color:#23243a;font-size:1.1rem;font-weight:600;"></div>
      </div>
      <div class="start-btns" id="startBtns" style="display:none;text-align:center;margin-bottom:12px;">
        <button class="control-btn btn-primary" id="startQuestionBtn"><i class="fas fa-play"></i> Ø¨Ø¯Ø¡</button>
      </div>
      <div class="control-buttons" id="evalBtns" style="display:none;gap:10px;justify-content:center;">
        <button class="control-btn btn-success" id="correctBtn"><i class="fas fa-check"></i> Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…</button>
        <button class="control-btn btn-danger" id="wrongBtn"><i class="fas fa-times"></i> Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© âŒ</button>
      </div>
    </div>
    <div class="scoreboard" id="scoreboard"></div>
  </div>
  <script>
    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ ========== // 
    class AudioManager {
      constructor() {
        this.sounds = {
          welcome: 'kingdom-sounds/character-intro.mp3',
          instruction: 'kingdom-sounds/book-open.mp3',
          select: 'kingdom-sounds/button-hover.mp3',
          correct: 'kingdom-sounds/perfect-score.mp3',
          wrong: 'kingdom-sounds/bomb-explosion.mp3',
          motivate: 'kingdom-sounds/achievement-unlock.mp3',
          start: 'kingdom-sounds/adventure-theme.mp3',
          finish: 'kingdom-sounds/battle-victory.mp3',
          cheer: 'kingdom-sounds/crowd-cheer.mp3',
          click: 'kingdom-sounds/cosmic-click.mp3',
          panel: 'kingdom-sounds/panel-slide.mp3',
          notify: 'kingdom-sounds/ai-notification.mp3',
          error: 'kingdom-sounds/ai-beep.mp3',
        };
        this.isMuted = false;
        this.volume = 1;
      }
      playSound(name, opts={}) {
        if(this.isMuted) return;
        let src = this.sounds[name] || name;
        let audio = new Audio('../assets/media/sounds/' + src);
        audio.volume = (typeof opts.volume === 'number') ? opts.volume : (typeof this.volume === 'number' ? this.volume : 1);
        audio.play();
      }
      toggleMute() { this.isMuted = !this.isMuted; }
    }
    window.audioManager = new AudioManager();

    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© ========== //
    class NotificationSystem {
      constructor() {
        this.bar = document.getElementById('notificationBar');
        this.icon = document.getElementById('notifIcon');
        this.msg = document.getElementById('notifMsg');
        this.timeout = null;
      }
      show(msg, color='#FFD700', icon='ğŸ’¡', duration=3200, sound='notify') {
        this.bar.style.display = 'flex';
        this.bar.style.background = `linear-gradient(90deg,#23243a 60%,${color} 100%)`;
        this.icon.textContent = icon;
        this.msg.textContent = msg;
        this.bar.style.animation = 'fadeInNotif 0.7s';
        if(window.audioManager && sound) audioManager.playSound(sound);
        clearTimeout(this.timeout);
        this.timeout = setTimeout(()=>{ this.hide(); }, duration);
      }
      hide() { this.bar.style.display = 'none'; }
    }
    window.notificationSystem = new NotificationSystem();

    // ...existing toolbar, victoryManager code...

    // ========== ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ========== //
    // Ø²Ø± Ø§Ù„ØµÙˆØª
    const soundToggle = document.getElementById('soundToggle');
    if (soundToggle) {
      soundToggle.onclick = function() {
        if (!window.audioManager) return;
        audioManager.toggleMute();
        const icon = soundToggle.querySelector('i');
        if (audioManager.isMuted) {
          icon.classList.remove('fa-volume-up');
          icon.classList.add('fa-volume-mute');
          window.notificationSystem && window.notificationSystem.show('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª','#DC143C');
        } else {
          icon.classList.remove('fa-volume-mute');
          icon.classList.add('fa-volume-up');
          window.notificationSystem && window.notificationSystem.show('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª','#228B22');
        }
      };
    }
    // Ø²Ø± Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´
    const clearCacheBtn = document.getElementById('clearCacheBtn');
    if (clearCacheBtn) {
      clearCacheBtn.onclick = function() {
        // Ù…Ø³Ø­ localStorage ÙˆsessionStorage
        localStorage.clear();
        sessionStorage.clear();
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„Ø®Ø¯Ù…Ø© (Ø¥Ù† ÙˆØ¬Ø¯)
        if ('caches' in window) {
          caches.keys().then(function(names) {
            for (let name of names) caches.delete(name);
          });
        }
        window.notificationSystem && window.notificationSystem.show('ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­!','#00ffff');
        window.audioManager && window.audioManager.playSound('cosmic-portal');
      };
    }
    // Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù†Ø§ÙØ°Ø© ÙˆÙ‡Ù…ÙŠØ©)
    const settingsBtn = document.getElementById('settingsBtn');
    if (settingsBtn) {
      settingsBtn.onclick = function() {
        // Ù†Ø§ÙØ°Ø© ØªØ­ÙƒÙ… ØµÙˆØªÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠØ©
        if(document.getElementById('audioControlModal')) {
          document.getElementById('audioControlModal').style.display = 'flex';
          return;
        }
        let modal = document.createElement('div');
        modal.id = 'audioControlModal';
        modal.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:20001;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;';
        modal.innerHTML = `
          <div style="background:linear-gradient(135deg,#fffbe6 0%,#ffd700 100%);border-radius:22px;padding:32px 28px;box-shadow:0 0 40px #ffd700a0;min-width:320px;max-width:90vw;text-align:center;position:relative;">
            <button id="closeAudioModal" style="position:absolute;top:10px;left:10px;background:none;border:none;font-size:1.5em;cursor:pointer;color:#DC143C;"><i class="fas fa-times"></i></button>
            <div style="font-size:2em;margin-bottom:10px;color:#23243a;"><i class='fas fa-volume-up'></i> Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØª</div>
            <div style="margin-bottom:18px;font-size:1.1em;color:#23243a;">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø£Ùˆ ÙƒØªÙ…/ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª.</div>
            <div style="display:flex;align-items:center;justify-content:center;gap:18px;margin-bottom:18px;">
              <button id="muteBtn" style="font-size:1.2em;padding:10px 18px;border-radius:10px;border:none;background:linear-gradient(90deg,#DC143C,#FFD700);color:#fff;font-weight:bold;cursor:pointer;"><i class="fas fa-volume-mute"></i> ÙƒØªÙ…</button>
              <button id="unmuteBtn" style="font-size:1.2em;padding:10px 18px;border-radius:10px;border:none;background:linear-gradient(90deg,#11998e,#FFD700);color:#fff;font-weight:bold;cursor:pointer;"><i class="fas fa-volume-up"></i> ØªØ´ØºÙŠÙ„</button>
            </div>
            <div style="margin-bottom:10px;color:#23243a;font-weight:700;">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª:</div>
            <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1" style="width:80%;accent-color:#FFD700;">
            <div id="volumeValue" style="margin-top:8px;color:#23243a;font-size:1.1em;font-weight:700;">100%</div>
          </div>
        `;
        document.body.appendChild(modal);
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        document.getElementById('closeAudioModal').onclick = ()=>{ modal.style.display = 'none'; };
        // ÙƒØªÙ… Ø§Ù„ØµÙˆØª
        document.getElementById('muteBtn').onclick = ()=>{
          if(window.audioManager) audioManager.isMuted = true;
          window.notificationSystem && window.notificationSystem.show('ØªÙ… ÙƒØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª','#DC143C');
        };
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
        document.getElementById('unmuteBtn').onclick = ()=>{
          if(window.audioManager) audioManager.isMuted = false;
          window.notificationSystem && window.notificationSystem.show('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª','#228B22');
        };
        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª
        let slider = document.getElementById('volumeSlider');
        let volumeValue = document.getElementById('volumeValue');
        slider.value = (window.audioManager && typeof window.audioManager.volume === 'number') ? window.audioManager.volume : 1;
        volumeValue.textContent = Math.round(slider.value*100) + '%';
        slider.oninput = function() {
          let v = parseFloat(slider.value);
          if(window.audioManager) window.audioManager.volume = v;
          volumeValue.textContent = Math.round(v*100) + '%';
        };
      };
    }
    // Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    if (fullscreenBtn) {
      fullscreenBtn.onclick = function() {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      };
    }

    // ========== Ù…Ù†Ø·Ù‚ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ ========== //
    let studentsData = {};
    let selectedClass = null;
    let selectedStudents = [];
    let allStudents = [];

    async function loadStudentsData() {
      try {
        const res = await fetch('../data/studentData.json');
        studentsData = await res.json();
      } catch {
        studentsData = { 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„': ['Ø·Ø§Ù„Ø¨1','Ø·Ø§Ù„Ø¨2'], 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ': ['Ø·Ø§Ù„Ø¨3','Ø·Ø§Ù„Ø¨4'] };
      }
      renderClassGrid();
      // Ø¥Ø´Ø¹Ø§Ø± ØªØ±Ø­ÙŠØ¨ÙŠ ÙˆØªØ¹Ù„ÙŠÙ…Ø§Øª
      setTimeout(()=>{
        window.notificationSystem.show('Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ Ø³Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ©!','cyan','ğŸ‘‘',3500,'welcome');
        setTimeout(()=>{
          window.notificationSystem.show('Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø«Ù… Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©','gold','ğŸ“–',4000,'instruction');
        }, 3700);
      }, 800);
    }

    function renderClassGrid() {
      const classGrid = document.getElementById('classGrid');
      classGrid.innerHTML = '';
      Object.keys(studentsData).forEach(className => {
        const card = document.createElement('div');
        card.className = 'class-card';
        card.innerHTML = `<div class="class-icon">ğŸ«</div><h4>${className}</h4><div class="student-count">${studentsData[className].length} Ø·Ø§Ù„Ø¨</div>`;
        card.onclick = () => selectClass(className, card);
        classGrid.appendChild(card);
      });
    }

    function selectClass(className, card) {
      selectedClass = className;
      allStudents = studentsData[className] || [];
      selectedStudents = [];
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
      document.querySelectorAll('.class-card').forEach(c => c.classList.remove('selected'));
      // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
      card.classList.add('selected');
      card.style.transition = 'box-shadow 0.5s, transform 0.5s';
      card.style.boxShadow = '0 0 40px 10px #00ffffcc, 0 0 0 4px #ffd700cc';
      card.style.transform = 'scale(1.08) rotate(-2deg)';
      setTimeout(()=>{
        card.style.boxShadow = '';
        card.style.transform = '';
      }, 700);
      // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµÙÙˆÙ Ù…Ø¹ ØªØ£Ø«ÙŠØ± ØªÙ„Ø§Ø´ÙŠ
      const classGrid = document.getElementById('classGrid');
      classGrid.style.transition = 'opacity 0.7s cubic-bezier(0.68,-0.55,0.27,1.55)';
      classGrid.style.opacity = '0';
      setTimeout(()=>{
        classGrid.style.display = 'none';
        renderStudentsGrid();
        document.getElementById('studentSelectionSection').style.display = 'block';
        updateSelectedCount();
        document.getElementById('startRaceBtn').disabled = true;
      }, 700);
  if(window.audioManager) audioManager.playSound('panel');
  window.notificationSystem && window.notificationSystem.show('Ø§Ø®ØªØ± Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† (Ø­ØªÙ‰ 8) Ø«Ù… Ø§Ø¶ØºØ· Ø¨Ø¯Ø¡','gold','ğŸ¯',3500,'instruction');
    }

    function renderStudentsGrid() {
      const studentsGrid = document.getElementById('studentsGrid');
      studentsGrid.innerHTML = '';
      allStudents.forEach((student, idx) => {
        const card = document.createElement('div');
        card.className = 'student-card';
        card.innerHTML = `<div class="selection-indicator">â—‹</div><div class="student-name">${student}</div>`;
        card.onclick = () => toggleStudent(card, student);
        card.onmouseenter = () => { if(window.audioManager) audioManager.playSound('button-hover', {volume:0.1}); };
        studentsGrid.appendChild(card);
      });
    }

    function toggleStudent(card, student) {
      if(card.classList.contains('selected')) {
        card.classList.remove('selected');
        card.querySelector('.selection-indicator').textContent = 'â—‹';
        selectedStudents = selectedStudents.filter(s => s !== student);
        if(window.audioManager) audioManager.playSound('select');
      } else {
        if(selectedStudents.length >= 8) {
          if(window.notificationSystem) window.notificationSystem.show('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 8 Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† ÙÙ‚Ø·!','#DC143C','ğŸš«',2500,'error');
          if(window.audioManager) audioManager.playSound('error');
          card.style.animation = 'shakeX 0.4s';
          setTimeout(()=>{ card.style.animation = ''; }, 400);
          return;
        }
        card.classList.add('selected');
        card.querySelector('.selection-indicator').textContent = 'âœ“';
        selectedStudents.push(student);
        if(window.audioManager) audioManager.playSound('select');
        // Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        const motivs = ['Ø£Ø­Ø³Ù†Øª!','Ù…Ù…ØªØ§Ø²!','Ø§Ø®ØªÙŠØ§Ø± Ø±Ø§Ø¦Ø¹!','Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ø¯ÙŠ!','Ø¨Ø·Ù„ Ù‚Ø§Ø¯Ù…!','ğŸ’ªğŸ”¥'];
        if(window.notificationSystem) window.notificationSystem.show(motivs[Math.floor(Math.random()*motivs.length)],'#38ef7d','âš¡',1200,'motivate');
      }
      updateSelectedCount();
      document.getElementById('startRaceBtn').disabled = selectedStudents.length === 0;
      card.style.transform = 'scale(1.05)';
      setTimeout(()=>{ card.style.transform = ''; }, 200);
    }

    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = selectedStudents.length;
    }

  // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
    document.getElementById('clearAllBtn').onclick = function() {
      selectedStudents = [];
      document.querySelectorAll('.student-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.selection-indicator').textContent = 'â—‹';
      });
      updateSelectedCount();
      document.getElementById('startRaceBtn').disabled = true;
      if(window.audioManager) audioManager.playSound('cosmic-click');
    };
    document.getElementById('selectRandomBtn').onclick = function() {
      selectedStudents = [];
      document.querySelectorAll('.student-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.selection-indicator').textContent = 'â—‹';
      });
      let cards = Array.from(document.querySelectorAll('.student-card'));
      // Ø®Ù„Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
      let count = Math.min(8, Math.max(4, Math.floor(cards.length * 0.4)));
      let selected = cards.slice(0, count);
      selected.forEach(card => {
        card.classList.add('selected');
        card.querySelector('.selection-indicator').textContent = 'âœ“';
        let name = card.querySelector('.student-name').textContent;
        if (!selectedStudents.includes(name)) selectedStudents.push(name);
      });
      updateSelectedCount();
      document.getElementById('startRaceBtn').disabled = selectedStudents.length === 0;
      if(window.audioManager) audioManager.playSound('cosmic-explosion');
      // Ø¥ØµÙ„Ø§Ø­: ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø¨Ø§Ù‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
      document.getElementById('startRaceBtn').style.display = 'inline-block';
    };

    document.getElementById('startRaceBtn').onclick = function() {
      if(selectedStudents.length === 0) return;
      window.notificationSystem && window.notificationSystem.show('Ø§Ø³ØªØ¹Ø¯ÙˆØ§ Ù„Ù„Ø³Ø¨Ø§Ù‚!','gold','ğŸš€',2000,'start');
      if(window.audioManager) audioManager.playSound('start');
      // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙˆØ±Ù‹Ø§
      document.getElementById('selectionPanel').style.display = 'none';
      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙŠ ØªØ£Ø®ÙŠØ± ÙÙŠ DOM
      setTimeout(function() {
        showRaceSetupScreen();
      }, 600);
    };

    // Ø´Ø§Ø´Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ø³Ø¨Ø§Ù‚
    function showRaceSetupScreen() {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø³Ø¨Ø§Ù‚ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
      let raceScreen = document.getElementById('raceScreen');
      if (!raceScreen) {
        raceScreen = document.createElement('div');
        raceScreen.id = 'raceScreen';
        raceScreen.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;background:linear-gradient(135deg,#23243a 80%,#ffd70022 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;';
        raceScreen.innerHTML = `
          <div id="raceSetup" style="background:rgba(0,0,0,0.85);border-radius:24px;padding:32px 24px;box-shadow:0 0 40px #ffd700a0;max-width:420px;margin:auto;text-align:center;">
            <h2 style="color:#FFD700;font-size:2rem;margin-bottom:1.2rem;">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</h2>
            <div id="roundInputs" style="margin-bottom:1.5rem;"></div>
            <button class="neural-button" id="startRealRaceBtn" style="font-size:1.2rem;padding:1rem 2.5rem;background:linear-gradient(45deg,#ffd700,#00ffff);">Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø¨Ø§Ù‚</button>
          </div>
          <div id="raceArena" style="display:none;width:100vw;height:100vh;align-items:center;justify-content:center;flex-direction:column;">
            <div id="raceTrack" style="width:90vw;max-width:900px;margin:0 auto 30px auto;"></div>
            <div id="raceQuestionBox" style="background:rgba(255,255,255,0.95);border-radius:18px;padding:24px 18px;max-width:420px;margin:auto;text-align:center;box-shadow:0 0 24px #ffd70055;">
              <div id="raceCurrentStudent" style="font-size:1.5rem;font-weight:800;color:#DC143C;margin-bottom:10px;"></div>
              <div id="raceQuestion" style="font-size:1.2rem;color:#23243a;margin-bottom:18px;">Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ù‹Ø§ Ø´ÙÙˆÙŠÙ‹Ø§ Ù„Ù„Ø·Ø§Ù„Ø¨</div>
              <div style="display:flex;gap:1rem;justify-content:center;">
                <button class="control-btn btn-success" id="raceCorrectBtn">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…</button>
                <button class="control-btn btn-danger" id="raceWrongBtn">Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© âŒ</button>
              </div>
              <div id="raceProgressInfo" style="margin-top:12px;font-size:1.1rem;color:#11998e;"></div>
            </div>
          </div>
          <div id="raceHonorBoard" style="display:none;position:absolute;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.93);z-index:10000;align-items:center;justify-content:center;flex-direction:column;">
            <div style="background:linear-gradient(135deg,#fffbe6 0%,#ffd700 100%);border-radius:20px;padding:16px 8px 18px 8px;box-shadow:0 0 28px #ffd700a0;max-width:320px;width:96vw;margin:auto;text-align:center;position:relative;overflow-y:auto;max-height:90vh;">
              <button class="victory-close" onclick="closeHonorBoard()" style="position:absolute;top:8px;left:8px;background:none;border:none;font-size:1.2em;cursor:pointer;color:#DC143C;"><i class="fas fa-times"></i></button>
              <div style="font-size:2em;margin-bottom:6px;">ğŸ</div>
              <h1 style="color:#DC143C;font-size:1.1em;margin:8px 0 10px 0;letter-spacing:0.02em;">Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù</h1>
              <div id="raceStats" style="font-size:0.98em;"></div>
              <div style="display:flex;gap:7px;justify-content:center;margin-top:12px;flex-wrap:wrap;">
                <button class="neural-button" onclick="window.location.reload()" style="font-size:0.95em;padding:7px 13px;background:linear-gradient(90deg,#FFD700,#fffbe6 80%,#FFD700);color:#23243a;font-weight:bold;border-radius:10px;border:none;cursor:pointer;"><i class='fas fa-redo'></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø³Ø¨Ø§Ù‚</button>
                <button class="neural-button" onclick="goToHome()" style="font-size:0.95em;padding:7px 13px;background:linear-gradient(90deg,#DC143C,#FFD700);color:#fff;font-weight:bold;border-radius:10px;border:none;cursor:pointer;"><i class='fas fa-home'></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(raceScreen);
      }
// Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù
function closeHonorBoard() {
  const raceScreen = document.getElementById('raceScreen');
  if(raceScreen) {
    raceScreen.querySelector('#raceHonorBoard').style.display = 'none';
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø³Ø¨Ø§Ù‚ Ø£Ùˆ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  }
}
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙ‚Ø·
      const roundInputs = raceScreen.querySelector('#roundInputs');
      roundInputs.innerHTML = `<div style='margin-bottom:10px;'><label style='color:#FFD700;font-weight:700;'>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨:</label> <input type='number' min='1' max='20' value='5' id='questionsPerStudent' style='width:60px;font-size:1.1em;border-radius:8px;border:1.5px solid #ffd700;padding:4px 8px;text-align:center;'></div><div style='color:#FFD700;font-size:1em;margin-bottom:8px;'>Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù‡Ùˆ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙŠ Ø³ÙŠÙØ³Ø£Ù„Ù‡Ø§ ÙƒÙ„ Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„Ø³Ø¨Ø§Ù‚.</div>`;
      raceScreen.style.display = 'flex';
      raceScreen.querySelector('#raceSetup').style.display = 'block';
      raceScreen.querySelector('#raceArena').style.display = 'none';
      raceScreen.querySelector('#raceHonorBoard').style.display = 'none';
      raceScreen.querySelector('#startRealRaceBtn').onclick = function(){
        let questions = parseInt(document.getElementById('questionsPerStudent').value)||1;
        // Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø¨Ø§Ù‚ØŒ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø¶Ù…Ø§Ø± ÙÙ‚Ø· Ù…Ø¹ Ø²Ø± "Ø§Ù†Ø·Ù„Ø§Ù‚"
        startRace(questions, true); // ÙˆØ¶Ø¹ Ø®Ø§Øµ: Ù„Ø§ ØªØ¸Ù‡Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ø¯
        let raceArena = document.getElementById('raceArena');
        if(raceArena) {
          raceArena.style.display = 'flex';
          // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù†Ø·Ù„Ø§Ù‚ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
          if(!document.getElementById('startRoundBtn')) {
            let btn = document.createElement('button');
            btn.id = 'startRoundBtn';
            btn.textContent = 'Ø§Ù†Ø·Ù„Ø§Ù‚';
            btn.className = 'neural-button';
            btn.style = 'font-size:1.3em;padding:1.2em 2.8em;margin:22px auto 0 auto;display:block;background:linear-gradient(90deg,#FFD700,#00f5ff);color:#23243a;font-weight:bold;border-radius:16px;border:none;box-shadow:0 2px 16px #FFD70055;letter-spacing:0.04em;';
            btn.onclick = function() {
              btn.style.display = 'none';
              let raceQuestionBox = document.getElementById('raceQuestionBox');
              if(raceQuestionBox) {
                raceQuestionBox.style.display = 'block';
                raceQuestionBox.scrollIntoView({behavior:'smooth',block:'center'});
              }
              showNextQuestion();
            };
            raceArena.insertBefore(btn, raceArena.firstChild);
          } else {
            let btn = document.getElementById('startRoundBtn');
            btn.textContent = 'Ø§Ù†Ø·Ù„Ø§Ù‚';
            btn.style.display = 'block';
            btn.onclick = function() {
              btn.style.display = 'none';
              let raceQuestionBox = document.getElementById('raceQuestionBox');
              if(raceQuestionBox) {
                raceQuestionBox.style.display = 'block';
                raceQuestionBox.scrollIntoView({behavior:'smooth',block:'center'});
              }
              showNextQuestion();
            };
          }
          // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø­ØªÙ‰ Ø§Ù„Ø¶ØºØ·
          let raceQuestionBox = document.getElementById('raceQuestionBox');
          if(raceQuestionBox) raceQuestionBox.style.display = 'none';
        }
      };
    }

    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø³Ø¨Ø§Ù‚ ÙˆØ§Ù„Ø¬ÙˆÙ„Ø§Øª
    let raceState = null;
    // Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ØªØªØ§Ù„ÙŠ
    let currentQuestionNumber = 0;
    function startRace(questionsPerStudent) {
      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø¨Ø§Ù‚ Ù„Ø¬ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø©
      let hideQuestionBox = false;
      if (typeof arguments[1] === 'boolean') hideQuestionBox = arguments[1];
      raceState = {
        students: selectedStudents.map(name=>({name,score:0,progress:0,answers:[]})),
        questionsPerStudent,
        finished: false
      };
      currentQuestionNumber = 0;
      // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø¨Ø§Ù‚
      const raceScreen = document.getElementById('raceScreen');
      raceScreen.querySelector('#raceSetup').style.display = 'none';
      raceScreen.querySelector('#raceArena').style.display = 'flex';
      raceScreen.querySelector('#raceArena').style.overflowY = 'auto';
      raceScreen.querySelector('#raceArena').style.maxHeight = '100vh';
      raceScreen.querySelector('#raceHonorBoard').style.display = 'none';
      setTimeout(function() {
        let raceQuestionBox = document.getElementById('raceQuestionBox');
        let raceArena = document.getElementById('raceArena');
        if(raceArena) {
          raceArena.style.display = 'flex';
          raceArena.style.overflowY = 'auto';
          raceArena.style.maxHeight = '100vh';
        }
        if(raceQuestionBox) {
          raceQuestionBox.style.display = hideQuestionBox ? 'none' : 'block';
          if (!hideQuestionBox) raceQuestionBox.scrollIntoView({behavior:'smooth',block:'center'});
        }
      }, 150);
      renderRaceTrack();
      if (!hideQuestionBox) showNextQuestion();
    }

    function renderRaceTrack() {
      const track = document.getElementById('raceTrack');
      const students = raceState.students;
      let maxScore = raceState.questionsPerStudent;
      // Ù…Ø¶Ù…Ø§Ø± Ù…Ø§Ø±Ø§Ø«ÙˆÙ† Ø±Ø£Ø³ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆØ£Ù„ÙˆØ§Ù† Ù…ØªØ¯Ø±Ø¬Ø© Ø¹ØµØ±ÙŠØ©
      track.innerHTML = '';
  track.style.position = 'relative';
  track.style.height = '';
  track.style.background = 'linear-gradient(180deg,#181c2a 60%,#23243a 100%)';
  track.style.borderRadius = '32px';
  track.style.boxShadow = '0 6px 32px #00f5ff33, 0 2px 18px #ffd70033';
  track.style.display = 'flex';
  track.style.flexDirection = 'column';
  track.style.justifyContent = 'flex-start';
  track.style.alignItems = 'stretch';
  track.style.padding = '40px 0 40px 0';
  track.style.overflowX = 'auto';
  // Ø±Ø£Ø³ Ø§Ù„Ù…Ø¶Ù…Ø§Ø±: Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„)
  let startName = students[0]?.name || '';
  let firstName = startName.split(' ')[0] || startName;
  let restName = startName.slice(firstName.length).trim();
  let startDiv = document.createElement('div');
  startDiv.style = 'display:flex;align-items:center;gap:18px;margin-bottom:28px;justify-content:flex-start;padding-right:40px;';
  startDiv.innerHTML = `<span style="font-size:1.3em;font-weight:900;color:#00f5ff;text-shadow:0 0 18px #00f5ff99;letter-spacing:0.04em;">ğŸ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</span><span style="font-size:1.3em;font-weight:900;"><span style='color:#FFD700;text-shadow:0 0 18px #FFD70099;'>${firstName}</span> <span style='color:#fffbe6;'>${restName}</span></span>`;
  track.appendChild(startDiv);
      // Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨: Ù…Ø¶Ù…Ø§Ø± ÙˆØ¹Ø¯Ø§Ø¡ Ù…ØªØ­Ø±Ùƒ
      students.forEach((student, idx) => {
        let percent = (student.score / maxScore);
        let runnerId = `runner-${idx}`;
        let lane = document.createElement('div');
        lane.style = 'position:relative;height:80px;margin-bottom:32px;display:flex;align-items:center;';
        // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø¹Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ
        let isCurrent = (typeof window.currentQuestionNumber === 'number' && raceState && idx === (window.currentQuestionNumber % students.length));
        let sFirst = student.name.split(' ')[0] || student.name;
        lane.innerHTML = `
          <div style="position:absolute;top:50%;left:0;transform:translateY(-50%);width:92%;height:20px;background:linear-gradient(90deg,#23243a 0%,#00f5ff 60%,#FFD700 100%);border-radius:14px;box-shadow:0 0 16px #00f5ff55,0 0 8px #ffd70055;"></div>
          <div id="${runnerId}" class="race-runner${isCurrent ? ' runner-current' : ''}" style="position:absolute;top:50%;left:0;transform:translateY(-50%);transition:left 0.8s cubic-bezier(0.68,-0.55,0.27,1.55);width:70px;height:70px;z-index:2;${isCurrent ? 'box-shadow:0 0 0 5px #FFD70099,0 0 24px #00f5ff;' : ''}">
            <div style="width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,#FFD700 60%,#00f5ff 100%);box-shadow:0 0 24px #FFD70099,0 0 24px #00f5ff99;display:flex;align-items:center;justify-content:center;font-size:2.3em;font-weight:900;color:#23243a;animation:runnerBounce 1.2s infinite alternate;filter:drop-shadow(0 0 12px #FFD70088);${isCurrent ? 'border:3px solid #FFD700;' : ''}">
              <span style='display:inline-block;transform:scaleX(-1);text-shadow:0 0 8px #00f5ff;'>ğŸƒâ€â™‚ï¸</span>
            </div>
            <div style="position:absolute;top:74px;left:50%;transform:translateX(-50%);font-size:1.08em;font-weight:900;text-shadow:0 0 8px #23243a,#00f5ff99;letter-spacing:0.02em;">
              <span style='color:#FFD700;'>${sFirst}</span> <span style='color:#FFD700;font-size:1em;text-shadow:0 0 8px #FFD700;'>${student.score}/${maxScore}</span>
            </div>
          </div>
        `;
        // Ø¹Ù„Ù… Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        if(idx === students.length-1) {
          lane.innerHTML += `<div style="position:absolute;top:50%;right:0;transform:translateY(-50%);font-size:2.5em;filter:drop-shadow(0 0 12px #FFD70088);">ğŸš©</div>`;
        }
        track.appendChild(lane);
        // Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©ØŒ Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø¹Ø¯Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…
        setTimeout(()=>{
          let runner = document.getElementById(runnerId);
          if(runner) {
            runner.style.left = `calc(${percent*88}% )`;
          }
        }, 50);
      });
      // Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¡
      if(!document.getElementById('runnerBounceStyle')) {
        let style = document.createElement('style');
        style.id = 'runnerBounceStyle';
        style.innerHTML = `@keyframes runnerBounce {0%{transform:translateY(0);}100%{transform:translateY(-16px);}}`;
        document.head.appendChild(style);
      }
    }

    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…ØªØªØ§Ù„ÙŠ Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø§Ø¨
    function showNextQuestion() {
      const students = raceState.students;
      const questionsPerStudent = raceState.questionsPerStudent;
      // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆÙ„Ø©
      const totalQuestions = students.length * questionsPerStudent;
      // Ø£ÙˆÙ„ Ù…Ø±Ø©: ØªÙ‡ÙŠØ¦Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„
      if (typeof currentQuestionNumber !== 'number' || currentQuestionNumber < 0) currentQuestionNumber = 0;
      // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø©
      if (currentQuestionNumber >= totalQuestions) {
        finishRace();
        return;
      }
      // Ù…Ù†Ø·Ù‚ Ù…ØªØªØ§Ù„ÙŠ: Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„ Ø«Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ ... Ø­ØªÙ‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª
      let studentIdx = currentQuestionNumber % students.length;
      let found = false;
      for (let i = 0; i < students.length; i++) {
        let idx = (currentQuestionNumber + i) % students.length;
        if (students[idx].answers.length < questionsPerStudent) {
          studentIdx = idx;
          found = true;
          break;
        }
      }
      if (!found) {
        finishRace();
        return;
      }
      // Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      setTimeout(function() {
        let raceQuestionBox = document.getElementById('raceQuestionBox');
        let raceArena = document.getElementById('raceArena');
        if(raceArena) {
          raceArena.style.display = 'flex';
          raceArena.style.overflowY = 'auto';
          raceArena.style.maxHeight = '100vh';
        }
        if(raceQuestionBox) {
          raceQuestionBox.style.display = 'block';
          raceQuestionBox.scrollIntoView({behavior:'smooth',block:'center'});
        }
      }, 80);
      // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø³Ø¤Ø§Ù„
  // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
  let sName = students[studentIdx].name;
  document.getElementById('raceCurrentStudent').innerHTML = `<span style='color:#FFD700;font-weight:900;font-size:1.1em;'>${sName}</span>`;
  // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù…Ø¶Ù…Ø§Ø± Ù„Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø¹Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ
  renderRaceTrack();
      document.getElementById('raceQuestion').textContent = `Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„ (${students[studentIdx].answers.length+1} Ù…Ù† ${questionsPerStudent})`;
      document.getElementById('raceProgressInfo').textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨: ${questionsPerStudent}`;
      // Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¹Ù†Ø¯ ÙƒÙ„ Ø³Ø¤Ø§Ù„
      const motivs = [
        'Ø±ÙƒØ² Ø¬ÙŠØ¯Ù‹Ø§ ÙˆØ£Ø¬Ø¨ Ø¨Ø«Ù‚Ø©!','Ø£Ù†Øª Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…!','Ø£Ø¸Ù‡Ø± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ!','ÙƒÙ„Ù†Ø§ Ù†Ø´Ø¬Ø¹Ùƒ!','Ø­Ø¸Ù‹Ø§ Ù…ÙˆÙÙ‚Ù‹Ø§!','Ø£Ù†Øª Ù‚Ø¯Ù‡Ø§!','ğŸ‘ğŸ”¥','ğŸ’¡'
      ];
      if(window.notificationSystem) window.notificationSystem.show(motivs[Math.floor(Math.random()*motivs.length)],'#FFD700','ğŸ¤',1800,'motivate');
      // ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
      document.getElementById('raceCorrectBtn').onclick = ()=>{
  students[studentIdx].score++;
  students[studentIdx].progress++;
  students[studentIdx].answers.push({correct:true});
  renderRaceTrack();
  // Ù…Ø¤Ø«Ø± Ø§Ø­ØªÙØ§Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
  setTimeout(()=>{ showConfetti(); }, 100);
  setTimeout(()=>{ window.notificationSystem && window.notificationSystem.show('Ø¥Ø¬Ø§Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø©!','lime','âœ…',1500,'correct'); }, 120);
  if(window.audioManager) setTimeout(()=>{ audioManager.playSound('correct'); }, 120);
  currentQuestionNumber++;
  setTimeout(()=>{ showNextQuestion(); }, 200);
      };
      document.getElementById('raceWrongBtn').onclick = ()=>{
  students[studentIdx].answers.push({correct:false});
  renderRaceTrack();
  setTimeout(()=>{ window.notificationSystem && window.notificationSystem.show('Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!','#DC143C','âŒ',1200,'wrong'); }, 80);
  if(window.audioManager) setTimeout(()=>{ audioManager.playSound('wrong'); }, 100);
  currentQuestionNumber++;
  setTimeout(()=>{ showNextQuestion(); }, 200);
      };
    }

    function finishRace() {
      raceState.finished = true;
      // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      const raceScreen = document.getElementById('raceScreen');
      raceScreen.querySelector('#raceArena').style.display = 'none';
      raceScreen.querySelector('#raceHonorBoard').style.display = 'flex';
      // Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù
      const honorActions = raceScreen.querySelector('#raceHonorBoard .neural-button')?.parentElement;
      if(honorActions) honorActions.style.display = 'flex';
      // Ù…Ø¤Ø«Ø± Ø§Ø­ØªÙØ§Ù„ÙŠ ÙˆØµÙˆØªÙŠ Ø¹Ù†Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø¨Ø§Ù‚
      showConfetti();
      if(window.audioManager) { audioManager.playSound('finish'); setTimeout(()=>audioManager.playSound('cheer'), 800); }
      window.notificationSystem && window.notificationSystem.show('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø³Ø¨Ø§Ù‚! ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ù„Ù„Ø¬Ù…ÙŠØ¹!','gold','ğŸ†',3500,'finish');
      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
      let sorted = [...raceState.students].sort((a,b)=>b.score-a.score);
      let statsHtml = '<div style="margin-bottom:18px;font-size:1.2em;color:#23243a;font-weight:700;">ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†:</div>';
      sorted.forEach((s,idx)=>{
        statsHtml += `<div style='background:linear-gradient(90deg,#ffd700,#fffbe6);margin:8px 0;padding:12px 18px;border-radius:16px;font-size:1.2em;font-weight:900;color:#DC143C;box-shadow:0 2px 12px #ffd70033;'>${idx+1}. ${s.name} <span style='color:#11998e;font-size:1em;'>(${s.score} Ù†Ù‚Ø·Ø©)</span></div>`;
      });
      // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
      statsHtml += `<div style='margin-top:18px;font-size:1.1em;color:#23243a;'>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨: ${raceState.questionsPerStudent}</div>`;
      statsHtml += `<div style='font-size:1.1em;color:#23243a;'>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ${raceState.questionsPerStudent * raceState.students.length}</div>`;
      raceScreen.querySelector('#raceStats').innerHTML = statsHtml;
    // ====== Ù…Ø¤Ø«Ø± Ø§Ø­ØªÙØ§Ù„ÙŠ (ÙƒÙˆÙ†ÙÙŠØªÙŠ) ====== //
    function showConfetti() {
      for(let i=0;i<22;i++) {
        setTimeout(()=>{
          const c = document.createElement('div');
          c.textContent = ['ğŸ‰','âœ¨','ğŸŒŸ','ğŸ’«','ğŸŠ','ğŸ¥‡','ğŸ¥³'][Math.floor(Math.random()*7)];
          c.style.position = 'fixed';
          c.style.fontSize = (Math.random()*1.2+1.2)+'em';
          c.style.pointerEvents = 'none';
          c.style.zIndex = '20001';
          c.style.left = (window.innerWidth*Math.random()*0.9+window.innerWidth*0.05)+'px';
          c.style.top = (window.innerHeight*Math.random()*0.5)+'px';
          c.style.opacity = 1;
          document.body.appendChild(c);
          c.animate([
            { transform: 'translateY(0) scale(1)', opacity: 1 },
            { transform: `translateY(${Math.random()*180+120}px) scale(0.7)`, opacity: 0.2 }
          ], { duration: 1800+Math.random()*800, easing: 'ease-out' }).onfinish = ()=>c.remove();
        }, i*60);
      }
    }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    loadStudentsData();
  </script>
</body>
</html>
