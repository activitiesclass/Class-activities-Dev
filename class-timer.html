<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جدول الحصص - Class Timer</title>
  <style>
    body {
      font-family: 'Cairo', Arial, sans-serif;
      background: linear-gradient(135deg, #e0ffe0 0%, #b2f7ef 100%);
      margin: 0;
      min-height: 100vh;
    }
    header {
      background: #fff;
      box-shadow: 0 4px 24px #b2f7ef55;
      padding: 32px 20px 24px 20px;
      text-align: center;
      border-radius: 0 0 32px 32px;
      position: relative;
      margin-bottom: 24px;
    }
    .logo {
      float: right;
      width: 70px;
      margin-left: 24px;
      border-radius: 16px;
      box-shadow: 0 2px 12px #b2f7ef55;
      background: #f7f7f7;
      padding: 4px;
    }
    .school-name {
      color: #009688;
      font-size: 2.3em;
      font-weight: bold;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #b2f7ef44;
    }
    .clock {
      color: #0074D9;
      font-size: 2em;
      float: left;
      margin-right: 24px;
      background: #e0ffe0;
      padding: 8px 18px;
      border-radius: 12px;
      box-shadow: 0 2px 8px #b2f7ef33;
    }
    .clear { clear: both; }
    .controls {
      margin: 30px auto 18px;
      text-align: center;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px #b2f7ef33;
      padding: 18px 0 10px 0;
      width: 90%;
      max-width: 600px;
    }
    select {
      font-size: 1.2em;
      padding: 7px 22px;
      border-radius: 8px;
      border: 1px solid #b2f7ef;
      background: #e0ffe0;
      margin: 0 8px;
      transition: border 0.2s;
    }
    select:focus {
      border: 2px solid #009688;
      outline: none;
    }
    table {
      width: 95%;
      margin: 24px auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 4px 24px #b2f7ef55;
      border-radius: 18px;
      overflow: hidden;
    }
    th, td {
      padding: 16px 10px;
      border: 1px solid #b2f7ef44;
      text-align: center;
      font-size: 1.1em;
    }
    th {
      background: linear-gradient(90deg, #e0ffe0 0%, #b2f7ef 100%);
      color: #009688;
      font-size: 1.15em;
      border-bottom: 2px solid #b2f7ef;
      letter-spacing: 1px;
    }
    tfoot td {
      background: #f9f9f9;
      color: #888;
    }
    .footer {
      text-align: center;
      color: #c00;
      font-weight: bold;
      margin: 30px 0 10px;
    }
  </style>
</head>
<body>
  <header>
  <img id="schoolLogo" src="assets/media/images/school-logo.png" class="logo" alt="شعار المدرسة">
  <span class="school-name" id="schoolName">اسم المدرسة</span>
    <span class="clock" id="clock"></span>
    <div class="clear"></div>
  </header>
  <div class="controls">
    <label for="daySelect">اختر اليوم:</label>
    <select id="daySelect"></select>
    <button id="todayBtn" class="modern-btn">اليوم الحالي</button>
  </div>
  <div id="currentSession" class="current-session"></div>
  <div id="timer" class="timer"></div>
  <table id="liveEventsTable" class="modern-table">
    <thead>
      <tr>
        <th>اليوم</th>
        <th>الصف</th>
        <th>المعلم</th>
        <th>الحصة</th>
        <th>وقت البداية</th>
        <th>وقت النهاية</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <!-- <div class="footer"></div> -->
  <script>
    // بيانات الأيام
  // في جافاسكريبت 0=الأحد، 1=الإثنين ... 6=السبت
  const days = ["الأحد", "الإثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة", "السبت"];
    const daySelect = document.getElementById('daySelect');
    days.forEach((day, idx) => {
      const opt = document.createElement('option');
      opt.value = day;
      opt.textContent = day;
      daySelect.appendChild(opt);
    });
    // تعيين اليوم الحالي افتراضيًا عند تحميل الصفحة أو عند الضغط على زر "اليوم الحالي"
    function setTodaySelect() {
      let todayIdx = new Date().getDay();
      if (todayIdx === 6 && !days.includes("السبت")) todayIdx = 0;
      daySelect.selectedIndex = todayIdx;
      updateCurrentSession();
    }
    setTodaySelect();
    document.getElementById('todayBtn').onclick = setTodaySelect;

    // تحديث الساعة الرقمية
    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent = now.toLocaleTimeString('ar-EG');
    }
    setInterval(updateClock, 1000);
    updateClock();


    // تحميل اسم المدرسة والشعار من ملف config/schoolInfo.json
    function setSchoolInfo() {
      fetch('config/schoolInfo.json')
        .then(r => r.ok ? r.json() : {schoolName: 'اسم المدرسة', logoUrl: 'assets/media/images/school-logo.png'})
        .then(info => {
          document.getElementById('schoolName').textContent = info.schoolName || 'اسم المدرسة';
          document.getElementById('schoolLogo').src = info.logoUrl || 'assets/media/images/school-logo.png';
        });
    }
    setSchoolInfo();


    // تحميل بيانات الحصص وبيانات اليوم فقط
    let schedule = [];
    let todayInfo = [];
    Promise.all([
      fetch('data/schedule.json').then(r => r.json()),
      fetch('data/todayInfo.json').then(r => r.json())
    ]).then(([scheduleData, todayData]) => {
      schedule = scheduleData;
      todayInfo = todayData;
      updateCurrentSession();
      setInterval(updateCurrentSession, 1000);
      daySelect.addEventListener('change', updateCurrentSession);
    });

    function updateCurrentSession() {
      const now = new Date();
      const today = daySelect.value;
      const currentTime = now.toTimeString().slice(0,8);
      let currentPeriod = null;
      for (let period of schedule) {
        if (currentTime >= period.start_time && currentTime <= period.end_time) {
          currentPeriod = period;
          break;
        }
      }
      let sessionInfo = '';
      let timerInfo = '';
      const liveTable = document.getElementById('liveEventsTable');
      const liveTbody = liveTable.querySelector('tbody');
      // عرض جميع الحصص لليوم المختار
      const todayEvents = todayInfo.filter(ev => ev.day === today);
      liveTbody.innerHTML = '';
      schedule.forEach(period => {
        const event = todayEvents.find(ev => ev.period == period.period);
        const isCurrent = currentPeriod && period.period == currentPeriod.period && today === days[now.getDay()];
        liveTbody.innerHTML += `<tr style="${isCurrent ? 'background: #d1f7c4; font-weight:bold;' : ''}">
          <td>${today}</td>
          <td>${event ? event.class_name : '-'}<\/td>
          <td>${event ? event.teacher : '-'}<\/td>
          <td>${period.period}<\/td>
          <td>${period.start_time}<\/td>
          <td>${period.end_time}<\/td>
        <\/tr>`;
      });
      liveTable.style.display = '';
      if (currentPeriod && today === days[now.getDay()]) {
        const event = todayEvents.find(ev => ev.period == currentPeriod.period);
        if (event) {
          sessionInfo = `اليوم: <b>${today}</b> | الصف: <b>${event.class_name}</b> | المعلم: <b>${event.teacher}</b> | الحصة: <b>${currentPeriod.period}</b>`;
        } else {
          sessionInfo = `اليوم: <b>${today}</b> | الحصة: <b>${currentPeriod.period}</b> (لا يوجد معلم أو صف محدد)`;
        }
        // حساب الوقت المتبقي
        const [h, m, s] = currentPeriod.end_time.split(":").map(Number);
        const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, s);
        let diff = Math.floor((end - now) / 1000);
        if (diff < 0) diff = 0;
        const mm = String(Math.floor(diff/60)).padStart(2,'0');
        const ss = String(diff%60).padStart(2,'0');
        timerInfo = `الوقت المتبقي: <b>${mm}:${ss}</b>`;
      } else {
        sessionInfo = `لا توجد حصة جارية الآن`;
        timerInfo = '';
      }
      document.getElementById('currentSession').innerHTML = sessionInfo;
      document.getElementById('timer').innerHTML = timerInfo;
    }
  </script>
  <style>
    .modern-table {
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 4px 24px #b2f7ef55;
      background: #fff;
      margin-bottom: 40px;
      font-size: 1.1em;
      min-width: 320px;
      max-width: 100%;
      transition: box-shadow 0.2s;
    }
    .modern-table th {
      background: linear-gradient(90deg, #e0ffe0 0%, #b2f7ef 100%);
      color: #009688;
      font-size: 1.15em;
      border-bottom: 2px solid #b2f7ef;
      letter-spacing: 1px;
    }
    .modern-table tr {
      transition: background 0.2s;
    }
    .modern-table tr:hover {
      background: #f0f8ff;
    }
    .modern-table td {
      border: 1px solid #b2f7ef44;
    }
    .modern-btn {
      margin-right: 15px;
      font-size: 1.1em;
      padding: 8px 22px;
      background: linear-gradient(90deg, #e0ffe0 0%, #b2f7ef 100%);
      border: 1px solid #b2f7ef;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
      font-weight: bold;
      color: #009688;
      box-shadow: 0 2px 8px #b2f7ef33;
    }
    .modern-btn:hover {
      background: #b2f7ef;
      box-shadow: 0 4px 16px #b2f7ef44;
      color: #00796b;
    }
    .current-session {
      text-align: center;
      margin: 32px 0 12px;
      font-size: 1.5em;
      color: #009688;
      font-weight: bold;
      letter-spacing: 1.5px;
      background: #e0ffe0;
      border-radius: 12px;
      padding: 10px 0;
      box-shadow: 0 2px 8px #b2f7ef33;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .timer {
      text-align: center;
      font-size: 2.2em;
      color: #c00;
      margin-bottom: 24px;
      font-family: 'Cairo', Arial, sans-serif;
      font-weight: bold;
      letter-spacing: 2px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px #b2f7ef33;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
      padding: 8px 0;
    }
    @media (max-width: 600px) {
      .modern-table, .modern-table th, .modern-table td {
        font-size: 0.95em;
        padding: 7px 2px;
      }
      .school-name {
        font-size: 1.2em;
      }
      .clock {
        font-size: 1.1em;
        padding: 4px 8px;
      }
      .modern-btn {
        font-size: 0.95em;
        padding: 5px 10px;
      }
      .current-session {
        font-size: 1.1em;
        padding: 6px 0;
      }
      .timer {
        font-size: 1.2em;
        padding: 4px 0;
      }
    }
  </style>
</body>
</html>

